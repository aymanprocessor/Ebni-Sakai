<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ¦ÙˆÙŠØ© - ØªÙ‚ÙˆÙŠØ© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠØ©</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Arial', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
                overflow-x: hidden;
            }

            .game-container {
                max-width: 900px;
                margin: 0 auto;
                padding: 20px;
                position: relative;
            }

            .header {
                text-align: center;
                background: rgba(255, 255, 255, 0.95);
                padding: 20px;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                margin-bottom: 30px;
                backdrop-filter: blur(10px);
            }

            .header h1 {
                color: #4a5568;
                font-size: 2.2rem;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .stars-display {
                display: inline-flex;
                align-items: center;
                gap: 10px;
                margin: 10px 0;
                padding: 10px 20px;
                background: linear-gradient(45deg, #ffd700, #ffed4e);
                border-radius: 25px;
                box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
            }

            .star {
                font-size: 1.8rem;
                color: #ff6b35;
                filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
                animation: sparkle 2s infinite alternate;
            }

            @keyframes sparkle {
                0% {
                    transform: scale(1) rotate(0deg);
                }
                100% {
                    transform: scale(1.1) rotate(5deg);
                }
            }

            .level-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(255, 255, 255, 0.9);
                padding: 15px 25px;
                border-radius: 15px;
                margin-bottom: 20px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .timer-setting {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 20px;
                background: rgba(255, 255, 255, 0.9);
                padding: 15px;
                border-radius: 15px;
            }

            .timer-input {
                padding: 8px 15px;
                border: 2px solid #667eea;
                border-radius: 10px;
                font-size: 1.1rem;
                text-align: center;
                width: 80px;
            }

            .start-btn,
            .next-btn {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 15px 30px;
                font-size: 1.2rem;
                border-radius: 15px;
                cursor: pointer;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                transition: all 0.3s ease;
                font-weight: bold;
            }

            .start-btn:hover,
            .next-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            }

            .game-area {
                background: rgba(255, 255, 255, 0.95);
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
                text-align: center;
                margin-bottom: 20px;
                backdrop-filter: blur(10px);
            }

            .phase-title {
                font-size: 1.8rem;
                color: #4a5568;
                margin-bottom: 20px;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }

            .items-display {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 20px;
                margin: 30px 0;
            }

            .item-card {
                background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
                padding: 20px;
                border-radius: 15px;
                min-width: 120px;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
                transform: translateY(0);
                transition: all 0.3s ease;
                border: 3px solid transparent;
            }

            .item-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            }

            .item-card.memorizing {
                border-color: #667eea;
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            .item-emoji {
                font-size: 3rem;
                display: block;
                margin-bottom: 10px;
            }

            .item-name {
                font-size: 1.3rem;
                font-weight: bold;
                color: #4a5568;
            }

            .recall-area {
                margin-top: 30px;
            }

            .options-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
                margin: 20px 0;
                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
            }

            .option-btn {
                background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
                border: 3px solid transparent;
                padding: 15px 10px;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 1.1rem;
                font-weight: bold;
                color: #4a5568;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .option-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
                border-color: #667eea;
            }

            .option-btn.selected {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border-color: #4a5568;
            }

            .option-btn.correct {
                background: linear-gradient(135deg, #56ab2f, #a8e6cf);
                border-color: #4caf50;
                animation: correctPulse 0.5s ease-in-out;
            }

            .option-btn.incorrect {
                background: linear-gradient(135deg, #ff6b6b, #feca57);
                border-color: #f44336;
                animation: shake 0.5s ease-in-out;
            }

            @keyframes correctPulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }

            @keyframes shake {
                0%,
                20%,
                40%,
                60%,
                80%,
                100% {
                    transform: translateX(0);
                }
                10%,
                30%,
                50%,
                70%,
                90% {
                    transform: translateX(-5px);
                }
            }

            .timer-display {
                font-size: 2rem;
                color: #667eea;
                font-weight: bold;
                margin: 20px 0;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .timer-display.warning {
                color: #ff6b35;
                animation: blink 1s infinite;
            }

            @keyframes blink {
                0%,
                50% {
                    opacity: 1;
                }
                51%,
                100% {
                    opacity: 0.5;
                }
            }

            .progress-bar {
                width: 100%;
                height: 15px;
                background: rgba(0, 0, 0, 0.1);
                border-radius: 10px;
                margin: 20px 0;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #667eea, #764ba2);
                border-radius: 10px;
                transition: width 0.3s ease;
            }

            .celebration {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            }

            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                background: #ff6b35;
                animation: fall 3s linear infinite;
            }

            @keyframes fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                }
            }

            .hidden {
                display: none !important;
            }

            .floating-particles {
                position: absolute;
                width: 100%;
                height: 100%;
                overflow: hidden;
                pointer-events: none;
                z-index: -1;
            }

            .particle {
                position: absolute;
                width: 4px;
                height: 4px;
                background: rgba(255, 255, 255, 0.7);
                border-radius: 50%;
                animation: float 6s infinite ease-in-out;
            }

            @keyframes float {
                0%,
                100% {
                    transform: translateY(0px) rotate(0deg);
                }
                33% {
                    transform: translateY(-20px) rotate(120deg);
                }
                66% {
                    transform: translateY(-10px) rotate(240deg);
                }
            }

            @media (max-width: 768px) {
                .header h1 {
                    font-size: 1.6rem;
                }
                .items-display {
                    gap: 15px;
                }
                .item-card {
                    min-width: 100px;
                    padding: 15px;
                }
                .item-emoji {
                    font-size: 2.5rem;
                }
                .item-name {
                    font-size: 1.1rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="floating-particles" id="particles"></div>

        <div class="game-container">
            <div class="header">
                <h1>ğŸ§  Ù„Ø¹Ø¨Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ¦ÙˆÙŠØ© Ø§Ù„Ø³Ø­Ø±ÙŠØ© ğŸŒŸ</h1>
                <div class="stars-display">
                    <span class="star">â­</span>
                    <span id="starCount">0</span>
                    <span>Ù†Ø¬Ù…Ø©</span>
                </div>
            </div>

            <div class="level-info">
                <div><strong>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: </strong><span id="currentLevel">1</span> <strong style="margin-right: 20px">Ø§Ù„ØµÙØ­Ø©: </strong><span id="currentPage">1</span>/5</div>
                <div><strong>Ø§Ù„ÙØ¦Ø©: </strong><span id="currentCategory">ÙÙˆØ§ÙƒÙ‡</span></div>
            </div>

            <div class="timer-setting">
                <label for="timerInput"><strong>ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ):</strong></label>
                <input type="number" id="timerInput" class="timer-input" value="10" min="5" max="60" />
                <button onclick="startGame()" class="start-btn">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="game-area" id="gameArea">
                <div class="phase-title" id="phaseTitle">Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©!</div>
                <div id="gameContent">
                    <p style="font-size: 1.3rem; color: #667eea">Ø§Ø®ØªØ± ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ø¶ØºØ· Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
                </div>
            </div>
        </div>

        <div class="celebration" id="celebration"></div>

        <script>
            // Game Configuration
            const gameData = {
                level1: {
                    name: 'Ø§Ù„Ù…Ø¨ØªØ¯Ø¦ (3-4 Ø³Ù†ÙˆØ§Øª)',
                    itemsPerPage: 3,
                    categories: {
                        ÙÙˆØ§ÙƒÙ‡: ['ğŸ ØªÙØ§Ø­', 'ğŸŒ Ù…ÙˆØ²', 'ğŸŠ Ø¨Ø±ØªÙ‚Ø§Ù„', 'ğŸ‡ Ø¹Ù†Ø¨', 'ğŸ“ ÙØ±Ø§ÙˆÙ„Ø©'],
                        Ø®Ø¶Ø§Ø±: ['ğŸ¥• Ø¬Ø²Ø±', 'ğŸ¥¬ Ø®Ø³', 'ğŸ… Ø·Ù…Ø§Ø·Ù…', 'ğŸ¥’ Ø®ÙŠØ§Ø±', 'ğŸŒ½ Ø°Ø±Ø©'],
                        Ø·Ø¹Ø§Ù…: ['ğŸ Ø®Ø¨Ø²', 'ğŸ¥› Ø­Ù„ÙŠØ¨', 'ğŸ§€ Ø¬Ø¨Ù†', 'ğŸ¯ Ø¹Ø³Ù„', 'ğŸ¥š Ø¨ÙŠØ¶']
                    }
                },
                level2: {
                    name: 'Ø§Ù„Ù…ØªÙˆØ³Ø· (4-5 Ø³Ù†ÙˆØ§Øª)',
                    itemsPerPage: 4,
                    categories: {
                        'Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø¬Ø³Ù…': ['ğŸ‘ï¸ Ø¹ÙŠÙ†', 'ğŸ‘‚ Ø£Ø°Ù†', 'ğŸ‘ƒ Ø£Ù†Ù', 'ğŸ‘„ ÙÙ…', 'ğŸ¤š ÙŠØ¯'],
                        Ø£Ù„ÙˆØ§Ù†: ['ğŸ”´ Ø£Ø­Ù…Ø±', 'ğŸ”µ Ø£Ø²Ø±Ù‚', 'ğŸŸ¢ Ø£Ø®Ø¶Ø±', 'ğŸŸ¡ Ø£ØµÙØ±', 'ğŸŸ£ Ø¨Ù†ÙØ³Ø¬ÙŠ'],
                        Ø£Ø«Ø§Ø«: ['ğŸª‘ ÙƒØ±Ø³ÙŠ', 'ğŸ›ï¸ Ø³Ø±ÙŠØ±', 'ğŸšª Ø¨Ø§Ø¨', 'ğŸªŸ Ù†Ø§ÙØ°Ø©', 'ğŸ“º ØªÙ„ÙØ§Ø²']
                    }
                },
                level3: {
                    name: 'Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (6-7 Ø³Ù†ÙˆØ§Øª)',
                    itemsPerPage: 5,
                    categories: {
                        'Ø£Ø«Ø§Ø« Ù…ØªÙ‚Ø¯Ù…': ['ğŸ›‹ï¸ ÙƒÙ†Ø¨Ø©', 'ğŸ—„ï¸ Ø®Ø²Ø§Ù†Ø©', 'ğŸª Ù…Ø±Ø¢Ø©', 'ğŸ’¡ Ù…ØµØ¨Ø§Ø­', 'ğŸ•°ï¸ Ø³Ø§Ø¹Ø©'],
                        Ø£Ø¯ÙˆØ§Øª: ['âœ‚ï¸ Ù…Ù‚Øµ', 'ğŸ”¨ Ù…Ø·Ø±Ù‚Ø©', 'ğŸª› Ù…ÙÙƒ', 'ğŸ“ Ù…Ø³Ø·Ø±Ø©', 'âœï¸ Ù‚Ù„Ù…']
                    }
                }
            };

            let currentLevel = 1;
            let currentCategory = '';
            let currentPage = 1;
            let currentItems = [];
            let selectedAnswers = [];
            let totalStars = 0;
            let gameTimer = null;
            let isMemorizing = true;
            let memoryTime = 10;

            // Audio Functions
            function playButtonSound() {
                // Button click sound
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.1);

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            }

            function playSuccessSound() {
                // Success glitter sound
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(523, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2); // G5

                gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            }

            function playErrorSound() {
                // Enhanced error buzz sound
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // Create a more dramatic error sound
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.2);

                gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);

                // Add a second buzzer for emphasis
                setTimeout(() => {
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode2 = audioContext.createGain();

                    oscillator2.connect(gainNode2);
                    gainNode2.connect(audioContext.destination);

                    oscillator2.frequency.setValueAtTime(250, audioContext.currentTime);
                    oscillator2.frequency.setValueAtTime(180, audioContext.currentTime + 0.1);

                    gainNode2.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                    oscillator2.start(audioContext.currentTime);
                    oscillator2.stop(audioContext.currentTime + 0.3);
                }, 200);
            }

            // Initialize particles
            function createParticles() {
                const container = document.getElementById('particles');
                for (let i = 0; i < 50; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 6 + 's';
                    particle.style.animationDuration = 3 + Math.random() * 3 + 's';
                    container.appendChild(particle);
                }
            }

            function startGame() {
                playButtonSound();
                memoryTime = parseInt(document.getElementById('timerInput').value);
                currentLevel = 1;
                currentPage = 1;
                totalStars = 0;
                updateStarDisplay();
                updateLevelInfo();
                startLevel();
            }

            function startLevel() {
                const levelData = gameData[`level${currentLevel}`];
                const categories = Object.keys(levelData.categories);
                currentCategory = categories[Math.floor(((currentPage - 1) / 5) * categories.length)];

                if (currentPage > 5) {
                    currentLevel++;
                    currentPage = 1;
                    if (currentLevel > 3) {
                        showGameComplete();
                        return;
                    }
                }

                updateLevelInfo();
                updateProgress();
                showMemorizationPhase();
            }

            function updateLevelInfo() {
                document.getElementById('currentLevel').textContent = currentLevel;
                document.getElementById('currentPage').textContent = currentPage;

                const levelData = gameData[`level${currentLevel}`];
                const categories = Object.keys(levelData.categories);
                const categoryIndex = Math.floor((currentPage - 1) / Math.ceil(5 / categories.length));
                currentCategory = categories[categoryIndex] || categories[0];
                document.getElementById('currentCategory').textContent = currentCategory;
            }

            function updateProgress() {
                const totalPages = 15; // 3 levels Ã— 5 pages
                const currentProgress = (currentLevel - 1) * 5 + currentPage - 1;
                const progressPercent = (currentProgress / totalPages) * 100;
                document.getElementById('progressFill').style.width = progressPercent + '%';
            }

            function showMemorizationPhase() {
                const levelData = gameData[`level${currentLevel}`];
                const categoryItems = levelData.categories[currentCategory];
                const itemsToShow = levelData.itemsPerPage;

                // Randomly select items for this page
                const shuffled = [...categoryItems].sort(() => 0.5 - Math.random());
                currentItems = shuffled.slice(0, itemsToShow);

                const gameArea = document.getElementById('gameArea');
                const phaseTitle = document.getElementById('phaseTitle');

                phaseTitle.textContent = `ØªØ°ÙƒØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† ÙØ¦Ø©: ${currentCategory}`;

                const itemsHTML = `
                <div class="timer-display" id="timerDisplay">${memoryTime}</div>
                <div class="items-display">
                    ${currentItems
                        .map(
                            (item) => `
                        <div class="item-card memorizing">
                            <span class="item-emoji">${item.split(' ')[0]}</span>
                            <div class="item-name">${item.split(' ')[1]}</div>
                        </div>
                    `
                        )
                        .join('')}
                </div>
                <p style="color: #667eea; font-size: 1.2rem;">Ø§Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¬ÙŠØ¯Ø§Ù‹!</p>
            `;

                document.getElementById('gameContent').innerHTML = itemsHTML;

                startMemoryTimer();
            }

            function startMemoryTimer() {
                let timeLeft = memoryTime;
                const timerDisplay = document.getElementById('timerDisplay');

                gameTimer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;

                    if (timeLeft <= 3) {
                        timerDisplay.classList.add('warning');
                    }

                    if (timeLeft <= 0) {
                        clearInterval(gameTimer);
                        showRecallPhase();
                    }
                }, 1000);
            }

            function showRecallPhase() {
                const levelData = gameData[`level${currentLevel}`];
                const categoryItems = levelData.categories[currentCategory];

                // Create options: current items + distractors from same category
                const distractors = categoryItems.filter((item) => !currentItems.includes(item));
                const shuffledDistractors = [...distractors].sort(() => 0.5 - Math.random());
                const options = [...currentItems, ...shuffledDistractors.slice(0, 3)];
                const shuffledOptions = [...options].sort(() => 0.5 - Math.random());

                const phaseTitle = document.getElementById('phaseTitle');
                phaseTitle.textContent = `Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ø±Ø£ÙŠØªÙ‡Ø§ Ù…Ù† ÙØ¦Ø©: ${currentCategory}`;

                const optionsHTML = `
                <p style="color: #4a5568; font-size: 1.2rem; margin-bottom: 20px;">
                    Ø§Ø®ØªØ± ${currentItems.length} Ø¹Ù†Ø§ØµØ± Ù…Ù† ${shuffledOptions.length} Ø®ÙŠØ§Ø±Ø§Øª
                </p>
                <div class="options-grid">
                    ${shuffledOptions
                        .map(
                            (item, index) => `
                        <button class="option-btn" onclick="selectOption(${index}, '${item}')" id="option-${index}">
                            <div style="font-size: 1.5rem;">${item.split(' ')[0]}</div>
                            <div>${item.split(' ')[1]}</div>
                        </button>
                    `
                        )
                        .join('')}
                </div>
                <button onclick="checkAnswers()" class="next-btn hidden" id="checkBtn">âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
            `;

                document.getElementById('gameContent').innerHTML = optionsHTML;
                selectedAnswers = [];
            }

            function selectOption(index, item) {
                playButtonSound();
                const optionBtn = document.getElementById(`option-${index}`);

                if (selectedAnswers.includes(item)) {
                    // Deselect
                    selectedAnswers = selectedAnswers.filter((answer) => answer !== item);
                    optionBtn.classList.remove('selected');
                } else if (selectedAnswers.length < currentItems.length) {
                    // Select
                    selectedAnswers.push(item);
                    optionBtn.classList.add('selected');
                }

                // Show check button when correct number of items selected
                const checkBtn = document.getElementById('checkBtn');
                if (selectedAnswers.length === currentItems.length) {
                    checkBtn.classList.remove('hidden');
                } else {
                    checkBtn.classList.add('hidden');
                }
            }

            function checkAnswers() {
                let correctCount = 0;
                const allOptions = document.querySelectorAll('.option-btn');

                // Disable all buttons
                allOptions.forEach((btn) => {
                    btn.style.pointerEvents = 'none';
                });

                allOptions.forEach((btn, index) => {
                    const item = btn.onclick.toString().match(/'([^']+)'/)[1];
                    if (currentItems.includes(item)) {
                        btn.classList.add('correct');
                        if (selectedAnswers.includes(item)) {
                            correctCount++;
                        }
                    } else if (selectedAnswers.includes(item)) {
                        btn.classList.add('incorrect');
                    }
                });

                // Award stars based on performance
                const accuracy = correctCount / currentItems.length;
                let starsEarned = 0;
                if (accuracy === 1) starsEarned = 3;
                else if (accuracy >= 0.75) starsEarned = 2;
                else if (accuracy >= 0.5) starsEarned = 1;

                totalStars += starsEarned;
                updateStarDisplay();

                // Show star celebration and play sounds
                if (starsEarned > 0) {
                    showStarCelebration(starsEarned);
                    playSuccessSound();
                    createConfetti();

                    setTimeout(() => {
                        nextPage();
                    }, 3000);
                } else {
                    playErrorSound();
                    setTimeout(() => {
                        showMemorizationPhase();
                    }, 2000);
                }
            }

            function showStarCelebration(starsEarned) {
                const celebration = document.createElement('div');
                celebration.className = 'star-celebration';

                const starText = 'â­'.repeat(starsEarned);
                celebration.innerHTML = `
                <div>${starText}</div>
                <div style="font-size: 1.5rem; margin-top: 10px; color: #667eea;">
                    Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${starsEarned} Ù†Ø¬Ù…${starsEarned > 1 ? 'Ø©' : ''}!
                </div>
            `;

                document.body.appendChild(celebration);

                setTimeout(() => {
                    celebration.remove();
                }, 2000);
            }

            function nextPage() {
                currentPage++;
                startLevel();
            }

            function updateStarDisplay() {
                document.getElementById('starCount').textContent = totalStars;
            }

            function createConfetti() {
                const celebration = document.getElementById('celebration');
                celebration.innerHTML = '';

                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#ff6b35', '#f7931e', '#ffd700', '#4ecdc4', '#45b7d1'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    celebration.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }
            }

            function showGameComplete() {
                const phaseTitle = document.getElementById('phaseTitle');
                phaseTitle.textContent = 'ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ‰';

                document.getElementById('gameContent').innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ†</div>
                    <h2 style="color: #667eea; margin-bottom: 20px;">Ø£Ø­Ø³Ù†Øª!</h2>
                    <p style="font-size: 1.3rem; color: #4a5568; margin-bottom: 20px;">
                        Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${totalStars} Ù†Ø¬Ù…Ø© Ù…Ù† Ø£ØµÙ„ 45 Ù†Ø¬Ù…Ø©!
                    </p>
                    <div class="stars-display" style="justify-content: center; margin: 20px 0;">
                        ${Array(Math.min(totalStars, 10)).fill('â­').join('')}
                    </div>
                    <button onclick="location.reload()" class="start-btn">ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
                </div>
            `;

                playSuccessSound();
                createConfetti();
            }

            // Initialize game
            document.addEventListener('DOMContentLoaded', function () {
                createParticles();
                updateLevelInfo();
            });
        </script>
    </body>
</html>
