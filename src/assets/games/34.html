<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ØµØ±ÙŠØ©</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Arial', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                color: white;
            }

            .game-header {
                text-align: center;
                margin-bottom: 30px;
            }

            .game-title {
                font-size: 2.5rem;
                color: #fff;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                margin-bottom: 10px;
            }

            .level-indicator {
                background: rgba(255, 255, 255, 0.2);
                padding: 15px 25px;
                border-radius: 25px;
                backdrop-filter: blur(10px);
                margin-bottom: 20px;
                font-size: 1.1rem;
                font-weight: bold;
            }

            .instructor-panel {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                border-radius: 15px;
                padding: 20px;
                margin-bottom: 20px;
                width: 100%;
                max-width: 900px;
            }

            .current-instruction {
                font-size: 1.3rem;
                font-weight: bold;
                text-align: center;
                color: #fff;
                margin-bottom: 15px;
            }

            .instructor-controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-size: 1rem;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                color: white;
            }

            .btn-primary {
                background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            }

            .btn-secondary {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
            }

            .btn-success {
                background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            }

            .btn-warning {
                background: linear-gradient(45deg, #ffa726, #ff7043);
            }

            .btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .game-area {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                padding: 30px;
                width: 100%;
                max-width: 900px;
                min-height: 500px;
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
            }

            .timer-display {
                font-size: 3rem;
                font-weight: bold;
                color: #ffd93d;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
                margin: 20px 0;
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                }
            }

            .cards-display {
                display: grid;
                gap: 20px;
                justify-content: center;
                margin: 30px 0;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                max-width: 600px;
            }

            .memory-card {
                width: 120px;
                height: 120px;
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 4rem;
                background: rgba(255, 255, 255, 0.9);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
                cursor: pointer;
                border: 4px solid transparent;
            }

            .memory-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
            }

            .memory-card.selected {
                border-color: #4ecdc4;
                background: rgba(78, 205, 196, 0.2);
                transform: scale(1.05);
            }

            .memory-card.correct {
                border-color: #56ab2f;
                background: rgba(86, 171, 47, 0.3);
                animation: bounce 0.6s ease-in-out;
            }

            .memory-card.wrong {
                border-color: #ff6b6b;
                background: rgba(255, 107, 107, 0.3);
                animation: shake 0.5s ease-in-out;
            }

            @keyframes bounce {
                0%,
                100% {
                    transform: scale(1.05);
                }
                50% {
                    transform: scale(1.2);
                }
            }

            @keyframes shake {
                0%,
                100% {
                    transform: translateX(0);
                }
                25% {
                    transform: translateX(-10px);
                }
                75% {
                    transform: translateX(10px);
                }
            }

            .choices-area {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 15px;
                max-width: 700px;
                margin: 20px 0;
            }

            .choice-card {
                width: 100px;
                height: 100px;
                border-radius: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3rem;
                background: rgba(255, 255, 255, 0.8);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                cursor: grab;
                transition: all 0.3s ease;
                user-select: none;
            }

            .choice-card:hover {
                transform: scale(1.1);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            }

            .choice-card.dragging {
                cursor: grabbing;
                transform: rotate(5deg) scale(1.1);
                z-index: 1000;
            }

            .choice-card.used {
                opacity: 0.3;
                cursor: not-allowed;
            }

            .drop-zone {
                width: 120px;
                height: 120px;
                border: 3px dashed rgba(255, 255, 255, 0.5);
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.9rem;
                color: rgba(255, 255, 255, 0.8);
                transition: all 0.3s ease;
                background: rgba(255, 255, 255, 0.05);
            }

            .drop-zone.active {
                border-color: #ffd93d;
                background: rgba(255, 217, 61, 0.2);
                box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
            }

            .drop-zone.filled {
                border-color: #4ecdc4;
                background: rgba(78, 205, 196, 0.2);
                font-size: 3rem;
            }

            .progress-container {
                display: flex;
                align-items: center;
                gap: 20px;
                margin: 20px 0;
                width: 100%;
                max-width: 600px;
            }

            .progress-bar {
                flex: 1;
                height: 20px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #4ecdc4, #44a08d);
                width: 0%;
                transition: width 0.5s ease;
                border-radius: 10px;
            }

            .stars-display {
                display: flex;
                gap: 10px;
            }

            .star {
                font-size: 2rem;
                color: #ffd93d;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                opacity: 0.3;
                transition: all 0.5s ease;
            }

            .star.earned {
                opacity: 1;
                animation: starPulse 0.6s ease-in-out;
            }

            @keyframes starPulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.3);
                }
                100% {
                    transform: scale(1);
                }
            }

            .phase-indicator {
                font-size: 1.2rem;
                font-weight: bold;
                padding: 10px 20px;
                border-radius: 15px;
                margin: 15px 0;
            }

            .phase-study {
                background: rgba(255, 217, 61, 0.3);
                color: #fff;
            }

            .phase-recall {
                background: rgba(78, 205, 196, 0.3);
                color: #fff;
            }

            .level-complete {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                display: none;
            }

            .level-complete h2 {
                font-size: 2rem;
                margin-bottom: 20px;
                color: white;
            }

            .celebration {
                font-size: 3rem;
                margin-bottom: 20px;
            }

            .game-stats {
                background: rgba(255, 255, 255, 0.1);
                padding: 15px;
                border-radius: 15px;
                margin: 15px 0;
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
                gap: 10px;
            }

            .stat-item {
                text-align: center;
                font-weight: bold;
            }

            .hidden {
                display: none !important;
            }

            @media (max-width: 768px) {
                .cards-display {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 15px;
                }

                .memory-card,
                .drop-zone {
                    width: 100px;
                    height: 100px;
                    font-size: 3rem;
                }

                .choice-card {
                    width: 80px;
                    height: 80px;
                    font-size: 2.5rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="game-header">
            <h1 class="game-title">ğŸ§  Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ØµØ±ÙŠØ© ğŸ§ </h1>
            <div class="level-indicator">
                <span id="levelDisplay">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: Ø§Ù„ÙÙˆØ§ÙƒÙ‡ - Ø§Ù„ØµÙØ­Ø© 1</span>
            </div>
        </div>

        <div class="instructor-panel">
            <div class="current-instruction" id="currentInstruction">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</div>
            <div class="phase-indicator phase-study" id="phaseIndicator">ğŸ“š Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</div>
            <div class="game-stats">
                <div class="stat-item">
                    <div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                    <div id="currentLevel">1</div>
                </div>
                <div class="stat-item">
                    <div>Ø§Ù„ØµÙØ­Ø©</div>
                    <div id="currentPage">1</div>
                </div>
                <div class="stat-item">
                    <div>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</div>
                    <div id="cardCount">3</div>
                </div>
                <div class="stat-item">
                    <div>Ø§Ù„ÙˆÙ‚Øª</div>
                    <div id="timeRemaining">10</div>
                </div>
            </div>
            <div class="instructor-controls">
                <button class="btn btn-primary" id="startBtn" onclick="startChallenge()">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
                <button class="btn btn-secondary" onclick="nextPage()">â¡ï¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
                <button class="btn btn-success" onclick="nextLevel()">â¬†ï¸ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                <button class="btn btn-warning" onclick="resetGame()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„</button>
            </div>
        </div>

        <div class="game-area">
            <div class="timer-display hidden" id="timerDisplay">10</div>

            <div class="cards-display" id="cardsDisplay">
                <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>

            <div class="choices-area hidden" id="choicesArea">
                <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="stars-display" id="starsDisplay">
                    <span class="star">â­</span>
                    <span class="star">â­</span>
                    <span class="star">â­</span>
                </div>
            </div>
        </div>

        <div class="level-complete" id="levelCompleteModal">
            <div class="celebration">ğŸ‰ğŸŠâœ¨</div>
            <h2 id="completionMessage">Ø£Ø­Ø³Ù†Øª! ØµÙØ­Ø© Ù…ÙƒØªÙ…Ù„Ø©!</h2>
            <div class="stars-display">
                <span class="star earned">â­</span>
                <span class="star earned">â­</span>
                <span class="star earned">â­</span>
            </div>
            <button class="btn btn-primary" id="proceedBtn" onclick="proceedNext()" style="margin-top: 20px">Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
        </div>

        <script>
            // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            let currentLevel = 1;
            let currentPage = 1;
            let gamePhase = 'waiting'; // waiting, studying, recalling, completed
            let studyTimer = null;
            let currentCards = [];
            let selectedChoices = [];
            let correctAnswers = 0;
            let starsEarned = 0;
            let audioContext = null;

            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰
            const gameData = {
                1: {
                    // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙÙˆØ§ÙƒÙ‡
                    name: 'Ø§Ù„ÙÙˆØ§ÙƒÙ‡',
                    cards: ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸŠ', 'ğŸ“', 'ğŸ¥', 'ğŸ‘', 'ğŸ’', 'ğŸ¥­', 'ğŸ'],
                    pages: [
                        { cards: 3, time: 10, choices: 6 },
                        { cards: 3, time: 8, choices: 7 },
                        { cards: 4, time: 10, choices: 8 },
                        { cards: 4, time: 8, choices: 9 },
                        { cards: 5, time: 10, choices: 10 }
                    ]
                },
                2: {
                    // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª
                    name: 'Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª',
                    cards: ['ğŸ±', 'ğŸ¶', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯'],
                    pages: [
                        { cards: 3, time: 9, choices: 6 },
                        { cards: 4, time: 9, choices: 7 },
                        { cards: 4, time: 7, choices: 8 },
                        { cards: 5, time: 8, choices: 9 },
                        { cards: 6, time: 10, choices: 10 }
                    ]
                },
                3: {
                    // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø®Ø¶Ø§Ø±
                    name: 'Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø®Ø¶Ø§Ø±',
                    cards: ['ğŸ¥•', 'ğŸ¥’', 'ğŸ…', 'ğŸ¥¬', 'âœï¸', 'ğŸ“š', 'âš½', 'ğŸ¨', 'ğŸ”§', 'âš–ï¸'],
                    pages: [
                        { cards: 4, time: 8, choices: 7 },
                        { cards: 4, time: 6, choices: 8 },
                        { cards: 5, time: 8, choices: 9 },
                        { cards: 5, time: 6, choices: 10 },
                        { cards: 6, time: 8, choices: 10 }
                    ]
                }
            };

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª
            function initializeAudio() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                } catch (e) {
                    console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª:', e);
                }
            }

            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
            function playSound(type) {
                if (!audioContext) return;

                try {
                    if (type === 'success') {
                        playTone(800, 200);
                        setTimeout(() => playTone(1000, 200), 100);
                    } else if (type === 'error') {
                        playTone(200, 500);
                    } else if (type === 'click') {
                        playTone(600, 100);
                    } else if (type === 'timer') {
                        playTone(400, 150);
                    }
                } catch (e) {
                    console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                }
            }

            function playTone(frequency, duration) {
                if (!audioContext) return;

                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration / 1000);
                } catch (e) {
                    console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø©:', e);
                }
            }

            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
            function startChallenge() {
                if (gamePhase !== 'waiting') return;

                gamePhase = 'studying';
                playSound('click');

                const levelData = gameData[currentLevel];
                const pageData = levelData.pages[currentPage - 1];

                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù…
                document.getElementById('currentInstruction').textContent = `Ø§Ù†ØªØ¨Ù‡! ØªØ°ÙƒØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¬ÙŠØ¯Ø§Ù‹ - ${pageData.cards} Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù…Ø¯Ø© ${pageData.time} Ø«Ø§Ù†ÙŠØ©`;
                document.getElementById('phaseIndicator').textContent = 'ğŸ‘€ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©';
                document.getElementById('phaseIndicator').className = 'phase-indicator phase-study';

                // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
                document.getElementById('startBtn').disabled = true;

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                showStudyCards(pageData);

                // Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆÙ‚ÙŠØª
                startStudyTimer(pageData.time);
            }

            // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©
            function showStudyCards(pageData) {
                const container = document.getElementById('cardsDisplay');
                container.innerHTML = '';

                // Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                const levelCards = gameData[currentLevel].cards;
                currentCards = [];

                for (let i = 0; i < pageData.cards; i++) {
                    let randomCard;
                    do {
                        randomCard = levelCards[Math.floor(Math.random() * levelCards.length)];
                    } while (currentCards.includes(randomCard));
                    currentCards.push(randomCard);
                }

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                currentCards.forEach((card) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'memory-card';
                    cardElement.textContent = card;
                    cardElement.style.animation = 'bounce 0.6s ease-in-out';
                    container.appendChild(cardElement);
                });

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateStats();
            }

            // Ø¨Ø¯Ø¡ ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©
            function startStudyTimer(duration) {
                let timeLeft = duration;
                document.getElementById('timerDisplay').textContent = timeLeft;
                document.getElementById('timerDisplay').classList.remove('hidden');
                document.getElementById('timeRemaining').textContent = timeLeft;

                studyTimer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timerDisplay').textContent = timeLeft;
                    document.getElementById('timeRemaining').textContent = timeLeft;

                    if (timeLeft <= 3 && timeLeft > 0) {
                        playSound('timer');
                    }

                    if (timeLeft <= 0) {
                        clearInterval(studyTimer);
                        studyTimer = null;
                        endStudyPhase();
                    }
                }, 1000);
            }

            // Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©
            function endStudyPhase() {
                gamePhase = 'recalling';

                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØª
                document.getElementById('cardsDisplay').innerHTML = '';
                document.getElementById('timerDisplay').classList.add('hidden');

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
                document.getElementById('currentInstruction').textContent = 'Ø§Ù„Ø¢Ù† Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø®ØµØµØ©!';
                document.getElementById('phaseIndicator').textContent = 'ğŸ¯ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡';
                document.getElementById('phaseIndicator').className = 'phase-indicator phase-recall';

                // Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡
                showRecallArea();
            }

            // Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡
            function showRecallArea() {
                const pageData = gameData[currentLevel].pages[currentPage - 1];
                const levelCards = gameData[currentLevel].cards;

                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¥ÙÙ„Ø§Øª
                const cardsContainer = document.getElementById('cardsDisplay');
                cardsContainer.innerHTML = '';

                for (let i = 0; i < currentCards.length; i++) {
                    const dropZone = document.createElement('div');
                    dropZone.className = 'drop-zone';
                    dropZone.textContent = `Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ${i + 1}`;
                    dropZone.dataset.index = i;

                    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥ÙÙ„Ø§Øª
                    dropZone.addEventListener('dragover', handleDragOver);
                    dropZone.addEventListener('drop', handleDrop);
                    dropZone.addEventListener('dragleave', handleDragLeave);

                    cardsContainer.appendChild(dropZone);
                }

                // Ø¥Ù†Ø´Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                const choicesContainer = document.getElementById('choicesArea');
                choicesContainer.innerHTML = '';
                choicesContainer.classList.remove('hidden');

                // Ø®Ù„Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø¹ Ø¨Ø·Ø§Ù‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                let allChoices = [...currentCards];
                while (allChoices.length < pageData.choices) {
                    let randomCard;
                    do {
                        randomCard = levelCards[Math.floor(Math.random() * levelCards.length)];
                    } while (allChoices.includes(randomCard));
                    allChoices.push(randomCard);
                }

                // Ø®Ù„Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                allChoices = allChoices.sort(() => Math.random() - 0.5);

                // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                allChoices.forEach((card) => {
                    const choiceElement = document.createElement('div');
                    choiceElement.className = 'choice-card';
                    choiceElement.textContent = card;
                    choiceElement.draggable = true;
                    choiceElement.dataset.card = card;

                    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ø­Ø¨
                    choiceElement.addEventListener('dragstart', handleDragStart);
                    choiceElement.addEventListener('dragend', handleDragEnd);
                    choiceElement.addEventListener('click', () => playSound('click'));

                    choicesContainer.appendChild(choiceElement);
                });
            }

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø³Ø­Ø¨
            function handleDragStart(e) {
                if (e.target.classList.contains('used')) {
                    e.preventDefault();
                    return;
                }
                e.dataTransfer.setData('text/plain', e.target.dataset.card);
                e.target.classList.add('dragging');
                playSound('click');
            }

            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            function handleDragOver(e) {
                e.preventDefault();
                if (!e.target.classList.contains('filled')) {
                    e.target.classList.add('active');
                }
            }

            function handleDragLeave(e) {
                e.target.classList.remove('active');
            }

            function handleDrop(e) {
                e.preventDefault();
                e.target.classList.remove('active');

                if (gamePhase !== 'recalling') return;
                if (e.target.classList.contains('filled')) return;

                const droppedCard = e.dataTransfer.getData('text/plain');
                const targetIndex = parseInt(e.target.dataset.index);
                const correctCard = currentCards[targetIndex];

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„
                e.target.classList.add('filled');
                e.target.textContent = droppedCard;

                if (droppedCard === correctCard) {
                    // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                    e.target.classList.add('correct');
                    playSound('success');
                    earnStar();
                    correctAnswers++;

                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                    const choiceCards = document.querySelectorAll('.choice-card');
                    choiceCards.forEach((card) => {
                        if (card.dataset.card === droppedCard && !card.classList.contains('used')) {
                            card.classList.add('used');
                            card.draggable = false;
                            return;
                        }
                    });

                    // ÙØ­Øµ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØµÙØ­Ø©
                    if (correctAnswers === currentCards.length) {
                        setTimeout(() => completeCurrentPage(), 1000);
                    }
                } else {
                    // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                    e.target.classList.add('wrong');
                    playSound('error');

                    setTimeout(() => {
                        e.target.classList.remove('filled', 'wrong');
                        e.target.textContent = `Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ${targetIndex + 1}`;
                    }, 1000);
                }

                updateProgress();
            }

            // ÙƒØ³Ø¨ Ù†Ø¬Ù…Ø©
            function earnStar() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                if (starsEarned < stars.length) {
                    stars[starsEarned].classList.add('earned');
                    starsEarned++;
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø¯Ù…
            function updateProgress() {
                const progress = (correctAnswers / currentCards.length) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            function updateStats() {
                document.getElementById('currentLevel').textContent = currentLevel;
                document.getElementById('currentPage').textContent = currentPage;
                document.getElementById('cardCount').textContent = currentCards.length || gameData[currentLevel].pages[currentPage - 1].cards;
            }

            // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            function completeCurrentPage() {
                gamePhase = 'completed';

                const isLastPage = currentPage === 5;
                const isLastLevel = currentLevel === 3;

                if (isLastPage && isLastLevel) {
                    document.getElementById('completionMessage').textContent = 'ğŸ† ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª! ğŸ†';
                    document.getElementById('proceedBtn').textContent = 'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©';
                } else if (isLastPage) {
                    document.getElementById('completionMessage').textContent = 'ğŸŠ Ø±Ø§Ø¦Ø¹! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰! ğŸŠ';
                    document.getElementById('proceedBtn').textContent = 'â¬†ï¸ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ';
                } else {
                    document.getElementById('completionMessage').textContent = 'âœ¨ Ù…Ù…ØªØ§Ø²! ØµÙØ­Ø© Ù…ÙƒØªÙ…Ù„Ø©! âœ¨';
                    document.getElementById('proceedBtn').textContent = 'â¡ï¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©';
                }

                document.getElementById('levelCompleteModal').style.display = 'block';
            }

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            function nextPage() {
                if (currentPage < 5) {
                    currentPage++;
                    resetCurrentPage();
                    updateLevelDisplay();
                    playSound('click');
                } else {
                    nextLevel();
                }
            }

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ
            function nextLevel() {
                if (currentLevel < 3) {
                    currentLevel++;
                    currentPage = 1;
                    resetCurrentPage();
                    updateLevelDisplay();
                    playSound('success');
                } else {
                    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„
                    currentLevel = 1;
                    currentPage = 1;
                    resetCurrentPage();
                    updateLevelDisplay();
                    playSound('click');
                }
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            function resetCurrentPage() {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø¥Ù† ÙˆØ¬Ø¯
                if (studyTimer) {
                    clearInterval(studyTimer);
                    studyTimer = null;
                }

                gamePhase = 'waiting';
                correctAnswers = 0;
                starsEarned = 0;
                currentCards = [];
                selectedChoices = [];

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('cardsDisplay').innerHTML = '';
                document.getElementById('choicesArea').innerHTML = '';
                document.getElementById('choicesArea').classList.add('hidden');
                document.getElementById('timerDisplay').classList.add('hidden');
                document.getElementById('levelCompleteModal').style.display = 'none';

                document.getElementById('currentInstruction').textContent = 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª';
                document.getElementById('phaseIndicator').textContent = 'ğŸ“š Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©';
                document.getElementById('phaseIndicator').className = 'phase-indicator phase-study';

                document.getElementById('startBtn').disabled = false;
                document.getElementById('timeRemaining').textContent = gameData[currentLevel].pages[currentPage - 1].time;

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„ØªÙ‚Ø¯Ù…
                resetStars();
                updateProgress();
                updateStats();
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¬ÙˆÙ…
            function resetStars() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                stars.forEach((star) => star.classList.remove('earned'));
                starsEarned = 0;
            }

            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            function updateLevelDisplay() {
                const levelName = gameData[currentLevel].name;
                document.getElementById('levelDisplay').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}: ${levelName} - Ø§Ù„ØµÙØ­Ø© ${currentPage}`;
            }

            // Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© (Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„)
            function proceedNext() {
                const isLastPage = currentPage === 5;
                const isLastLevel = currentLevel === 3;

                if (isLastPage && isLastLevel) {
                    resetGame();
                } else if (isLastPage) {
                    nextLevel();
                } else {
                    nextPage();
                }
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function resetGame() {
                currentLevel = 1;
                currentPage = 1;
                resetCurrentPage();
                updateLevelDisplay();
                playSound('click');

                document.getElementById('currentInstruction').textContent = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨ØµØ±ÙŠØ©! Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ" Ù„Ù„Ø¨Ø¯Ø¡';
            }

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.addEventListener(
                'click',
                function () {
                    if (!audioContext) {
                        initializeAudio();
                    }
                },
                { once: true }
            );

            document.addEventListener(
                'touchstart',
                function () {
                    if (!audioContext) {
                        initializeAudio();
                    }
                },
                { once: true }
            );

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.addEventListener('DOMContentLoaded', function () {
                updateLevelDisplay();
                updateStats();
                document.getElementById('timeRemaining').textContent = gameData[currentLevel].pages[currentPage - 1].time;
            });

            // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØµÙˆØ±
            document.addEventListener('dragstart', function (e) {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                }
            });

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            window.addEventListener('error', function (e) {
                console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©:', e.message);
            });

            // Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ
            document.addEventListener('selectstart', function (e) {
                if (e.target.classList.contains('choice-card') || e.target.classList.contains('memory-card')) {
                    e.preventDefault();
                }
            });
        </script>
    </body>
</html>
