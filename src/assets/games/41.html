<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© ØªØ±ØªÙŠØ¨ ØµÙˆØ± Ø§Ù„Ù‚ØµØ©</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Amiri', serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                min-height: 100vh;
                overflow-x: hidden;
                position: relative;
            }

            /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="stars" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="%23ffffff" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23stars)"/></svg>')
                    repeat;
                z-index: -1;
                animation: twinkle 3s ease-in-out infinite alternate;
            }

            @keyframes twinkle {
                0% {
                    opacity: 0.5;
                }
                100% {
                    opacity: 1;
                }
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                position: relative;
                z-index: 1;
            }

            .header {
                text-align: center;
                margin-bottom: 30px;
                background: rgba(255, 255, 255, 0.95);
                padding: 25px;
                border-radius: 30px;
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
                backdrop-filter: blur(15px);
                border: 2px solid rgba(255, 255, 255, 0.3);
            }

            .title {
                font-size: 2.8rem;
                background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 15px;
                animation: rainbow 3s ease-in-out infinite;
            }

            @keyframes rainbow {
                0%,
                100% {
                    filter: hue-rotate(0deg);
                }
                50% {
                    filter: hue-rotate(180deg);
                }
            }

            .stars-display {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin: 20px 0;
            }

            .star {
                font-size: 2.5rem;
                color: #ddd;
                transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            .star.earned {
                color: #ffd700;
                transform: scale(1.3);
                text-shadow: 0 0 20px #ffd700;
                animation: starGlow 1s ease-in-out;
            }

            @keyframes starGlow {
                0%,
                100% {
                    transform: scale(1.3);
                }
                50% {
                    transform: scale(1.5);
                }
            }

            .level-badge {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 12px 25px;
                border-radius: 50px;
                font-size: 1.4rem;
                font-weight: bold;
                display: inline-block;
                margin: 15px 0;
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }

            .game-area {
                background: rgba(255, 255, 255, 0.98);
                border-radius: 35px;
                padding: 35px;
                margin: 25px 0;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
                border: 3px solid rgba(255, 255, 255, 0.5);
            }

            .story-listening-phase {
                text-align: center;
                padding: 40px;
                background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
                border-radius: 25px;
                margin-bottom: 30px;
                border: 4px solid #ff9a56;
            }

            .story-title {
                font-size: 2.5rem;
                color: #ff6b6b;
                margin-bottom: 20px;
                font-weight: bold;
            }

            .story-text {
                font-size: 1.6rem;
                line-height: 2;
                color: #333;
                margin-bottom: 30px;
                padding: 20px;
                background: rgba(255, 255, 255, 0.8);
                border-radius: 15px;
            }

            .listen-controls {
                display: flex;
                justify-content: center;
                gap: 20px;
                flex-wrap: wrap;
                margin: 25px 0;
            }

            .listen-btn {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 50px;
                font-size: 1.3rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            }

            .listen-btn:hover {
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }

            .listen-btn.playing {
                background: linear-gradient(135deg, #ff6b6b, #ee5a52);
                animation: pulse 1s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            .images-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 25px;
                margin: 30px 0;
            }

            .story-card {
                background: linear-gradient(135deg, #f8f9ff 0%, #e8f4fd 100%);
                border: 4px solid #e1e8ff;
                border-radius: 25px;
                padding: 25px;
                text-align: center;
                cursor: pointer;
                transition: all 0.4s ease;
                position: relative;
                min-height: 200px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .story-card:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
                border-color: #4ecdc4;
            }

            .story-card.selected {
                border-color: #ff6b6b;
                background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
                transform: translateY(-8px) scale(1.05);
                box-shadow: 0 12px 35px rgba(255, 107, 107, 0.3);
            }

            .story-card.correct {
                border-color: #4ecdc4;
                background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
                animation: correctPulse 0.8s ease;
            }

            @keyframes correctPulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }

            .story-emoji {
                font-size: 3.5rem;
                line-height: 1.2;
                margin-bottom: 15px;
                transition: transform 0.3s ease;
            }

            .story-card:hover .story-emoji {
                transform: scale(1.1) rotate(5deg);
            }

            .story-description {
                font-size: 1.2rem;
                color: #333;
                line-height: 1.6;
                font-weight: 600;
            }

            .order-number {
                position: absolute;
                top: -15px;
                right: -15px;
                background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
                color: white;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                font-weight: bold;
                opacity: 0;
                transition: all 0.5s ease;
                box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            }

            .story-card.selected .order-number {
                opacity: 1;
                transform: scale(1.1);
            }

            .game-controls {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 35px 0;
                flex-wrap: wrap;
            }

            .game-btn {
                background: linear-gradient(135deg, #4ecdc4, #44a08d);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 50px;
                font-size: 1.3rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
            }

            .game-btn:hover {
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
            }

            .game-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            .btn-reset {
                background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            }

            .btn-next {
                background: linear-gradient(135deg, #667eea, #764ba2);
            }

            .feedback-area {
                text-align: center;
                font-size: 1.6rem;
                font-weight: bold;
                margin: 25px 0;
                padding: 20px;
                border-radius: 20px;
                transition: all 0.6s ease;
                min-height: 70px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .feedback-area.success {
                background: linear-gradient(135deg, #56ab2f, #a8e6cf);
                color: white;
                animation: successPulse 0.8s ease;
                box-shadow: 0 8px 25px rgba(86, 171, 47, 0.3);
            }

            .feedback-area.error {
                background: linear-gradient(135deg, #ff416c, #ff4b2b);
                color: white;
                animation: errorShake 0.6s ease;
                box-shadow: 0 8px 25px rgba(255, 65, 108, 0.3);
            }

            @keyframes successPulse {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            @keyframes errorShake {
                0%,
                100% {
                    transform: translateX(0);
                }
                25% {
                    transform: translateX(-10px);
                }
                75% {
                    transform: translateX(10px);
                }
            }

            .completion-screen {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 50px;
                border-radius: 35px;
                text-align: center;
                margin: 35px 0;
                box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
            }

            .completion-title {
                font-size: 3rem;
                margin-bottom: 25px;
                animation: bounce 1.5s ease-in-out infinite;
            }

            @keyframes bounce {
                0%,
                20%,
                50%,
                80%,
                100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-20px);
                }
                60% {
                    transform: translateY(-10px);
                }
            }

            .hidden {
                display: none;
            }

            .sound-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 12px;
                border-radius: 50px;
                font-size: 1.5rem;
                cursor: pointer;
                z-index: 1000;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                transition: all 0.3s ease;
            }

            .sound-toggle:hover {
                transform: scale(1.1);
            }

            .sound-toggle.muted {
                background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            }

            /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
            @media (max-width: 768px) {
                .title {
                    font-size: 2.2rem;
                }
                .images-container {
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px;
                }
                .story-card {
                    min-height: 180px;
                }
                .story-emoji {
                    font-size: 3rem;
                }
                .game-controls,
                .listen-controls {
                    flex-direction: column;
                    align-items: center;
                }
            }

            @media (max-width: 480px) {
                .container {
                    padding: 15px;
                }
                .header {
                    padding: 20px;
                }
                .game-area {
                    padding: 25px;
                }
                .story-title {
                    font-size: 2rem;
                }
                .story-text {
                    font-size: 1.4rem;
                }
            }
        </style>
    </head>
    <body>
        <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>

        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ­ Ù„Ø¹Ø¨Ø© ØªØ±ØªÙŠØ¨ ØµÙˆØ± Ø§Ù„Ù‚ØµØ© ğŸ­</h1>
                <div class="stars-display" id="starsDisplay">
                    <span class="star">â­</span>
                    <span class="star">â­</span>
                    <span class="star">â­</span>
                </div>
                <div class="level-badge" id="levelBadge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="levelNumber">1</span> - Ø§Ù„Ù‚ØµØ© <span id="storyNumber">1</span></div>
            </div>

            <!-- Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù‚ØµØ© -->
            <div class="story-listening-phase" id="listeningPhase">
                <h2 class="story-title" id="storyTitle">Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ù‚ØµØ©</h2>
                <div class="story-text" id="storyText"></div>
                <div class="listen-controls">
                    <button class="listen-btn" id="playStoryBtn" onclick="playStory()">ğŸ¤ Ø§Ø³Ù…Ø¹ Ø§Ù„Ù‚ØµØ©</button>
                    <button class="listen-btn" onclick="skipToGame()">â­ï¸ ØªØ®Ø·ÙŠ Ù„Ù„Ø¹Ø¨Ø©</button>
                </div>
            </div>

            <div class="game-area" id="gameArea">
                <div class="images-container" id="imagesContainer">
                    <!-- Ø§Ù„ØµÙˆØ± Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>

                <div class="game-controls">
                    <button class="game-btn btn-reset" onclick="resetGame()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨</button>
                    <button class="game-btn btn-next hidden" id="nextButton" onclick="nextStory()">â­ï¸ Ø§Ù„Ù‚ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
                </div>

                <div class="feedback-area" id="feedbackArea"></div>
            </div>

            <div class="completion-screen hidden" id="completionScreen">
                <h2 class="completion-title">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‰</h2>
                <p style="font-size: 1.8rem; margin-bottom: 30px">Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ØµØµ Ø¨Ù†Ø¬Ø§Ø­!</p>
                <div class="stars-display">
                    <span class="star earned">â­</span>
                    <span class="star earned">â­</span>
                    <span class="star earned">â­</span>
                </div>
                <button class="game-btn" onclick="restartGame()">ğŸ® Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
            </div>
        </div>

        <script>
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            const gameData = {
                currentLevel: 1,
                currentStory: 0,
                selectedOrder: [],
                earnedStars: 0,
                soundEnabled: true,
                speechSynth: window.speechSynthesis,
                gamePhase: 'listening' // listening, playing, completed
            };

            // Ù‚ØµØµ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
            const stories = {
                1: [
                    // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ - 3 ØµÙˆØ±
                    {
                        title: 'Ø§Ù„Ù‚Ø·Ø© Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ø­Ù„ÙŠØ¨',
                        story: 'ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ø¨Ø§ÙƒØ±ØŒ ÙˆØ¶Ø¹Øª Ø§Ù„Ø£Ù… ÙƒÙˆØ¨ Ø­Ù„ÙŠØ¨ Ø£Ø¨ÙŠØ¶ Ù„Ø°ÙŠØ° Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ù†ÙŠØ©. Ø±Ø£Øª Ø§Ù„Ù‚Ø·Ø© Ø§Ù„ØµØºÙŠØ±Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ÙƒÙˆØ¨ Ø§Ù„Ø­Ù„ÙŠØ¨ØŒ ÙØ§Ù‚ØªØ±Ø¨Øª Ù…Ù†Ù‡ Ø¨Ø­Ù…Ø§Ø³ Ø´Ø¯ÙŠØ¯. Ø´Ø±Ø¨Øª Ø§Ù„Ù‚Ø·Ø© ÙƒÙ„ Ø§Ù„Ø­Ù„ÙŠØ¨ Ø¨Ø³Ø¹Ø§Ø¯Ø© ÙˆØ£ØµØ¨Ø­Øª Ø±Ø§Ø¶ÙŠØ© ÙˆÙ…Ø¨ØªØ³Ù…Ø©!',
                        images: [
                            {
                                visual: 'ğŸŸ«<br/>ğŸ¥›',
                                description: 'ÙƒÙˆØ¨ Ø­Ù„ÙŠØ¨ Ø£Ø¨ÙŠØ¶ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ù†ÙŠØ©',
                                order: 1
                            },
                            {
                                visual: 'ğŸ± â¡ï¸ ğŸ¥›',
                                description: 'Ø§Ù„Ù‚Ø·Ø© ØªÙ…Ø´ÙŠ Ù†Ø­Ùˆ ÙƒÙˆØ¨ Ø§Ù„Ø­Ù„ÙŠØ¨',
                                order: 2
                            },
                            {
                                visual: 'ğŸ˜º<br/>ğŸ’•',
                                description: 'Ø§Ù„Ù‚Ø·Ø© Ø³Ø¹ÙŠØ¯Ø© Ø¨Ø¹Ø¯ Ø´Ø±Ø¨ Ø§Ù„Ø­Ù„ÙŠØ¨',
                                order: 3
                            }
                        ]
                    },
                    {
                        title: 'Ø§Ù„Ø·ÙÙ„ ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',
                        story: 'Ø§Ø³ØªÙŠÙ‚Ø¸ Ø£Ø­Ù…Ø¯ Ù…Ù† Ù†ÙˆÙ…Ù‡ Ø§Ù„Ø¹Ù…ÙŠÙ‚ ÙÙŠ ØµØ¨Ø§Ø­ Ø¬Ù…ÙŠÙ„. Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ù…Ø§Ù… ÙˆØ£Ø®Ø° ÙØ±Ø´Ø§Ø© Ø£Ø³Ù†Ø§Ù†Ù‡ ÙˆÙˆØ¶Ø¹ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ø¹Ø¬ÙˆÙ† Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø£Ø¨ÙŠØ¶. Ù†Ø¸Ù Ø£Ø³Ù†Ø§Ù†Ù‡ Ø¬ÙŠØ¯Ø§Ù‹ ÙˆØ£ØµØ¨Ø­Øª Ø¨ÙŠØ¶Ø§Ø¡ ÙˆÙ„Ø§Ù…Ø¹Ø© Ù…Ø«Ù„ Ø§Ù„Ù„Ø¤Ù„Ø¤!',
                        images: [
                            {
                                visual: 'ğŸ‘¦<br/>ğŸ›ï¸',
                                description: 'Ø§Ù„Ø·ÙÙ„ ÙŠØ³ØªÙŠÙ‚Ø¸ Ù…Ù† Ø§Ù„Ø³Ø±ÙŠØ±',
                                order: 1
                            },
                            {
                                visual: 'ğŸ‘¦<br/>ğŸª¥',
                                description: 'Ø§Ù„Ø·ÙÙ„ ÙŠØ³ØªØ®Ø¯Ù… ÙØ±Ø´Ø§Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†',
                                order: 2
                            },
                            {
                                visual: 'ğŸ‘¦<br/>âœ¨ğŸ˜',
                                description: 'Ø§Ù„Ø·ÙÙ„ ÙŠØ¨ØªØ³Ù… Ø¨Ø£Ø³Ù†Ø§Ù† Ù†Ø¸ÙŠÙØ©',
                                order: 3
                            }
                        ]
                    },
                    {
                        title: 'Ø§Ù„Ø£Ø±Ù†Ø¨ ÙˆØ§Ù„Ø¬Ø²Ø±Ø©',
                        story: 'ÙÙŠ Ø­Ø¯ÙŠÙ‚Ø© Ø®Ø¶Ø±Ø§Ø¡ Ø¬Ù…ÙŠÙ„Ø©ØŒ ÙƒØ§Ù†Øª ØªÙ†Ù…Ùˆ Ø¬Ø²Ø±Ø© Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© ÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø£Ø±Ø¶. Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø£Ø±Ù†Ø¨ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„ØµØºÙŠØ± Ø§Ù„Ø¬Ø²Ø±Ø© Ø§Ù„Ø´Ù‡ÙŠØ© Ù…Ù† Ø¨Ø¹ÙŠØ¯. Ù‚ÙØ² Ø§Ù„Ø£Ø±Ù†Ø¨ Ø¨ÙØ±Ø­ ÙˆØ£ÙƒÙ„ Ø§Ù„Ø¬Ø²Ø±Ø© Ø§Ù„Ù„Ø°ÙŠØ°Ø© Ø¨Ø´Ù‡ÙŠØ© Ø¹Ø§Ù„ÙŠØ©!',
                        images: [
                            {
                                visual: 'ğŸŒ±<br/>ğŸ¥•',
                                description: 'Ø¬Ø²Ø±Ø© ØªÙ†Ù…Ùˆ ÙÙŠ Ø§Ù„Ø£Ø±Ø¶',
                                order: 1
                            },
                            {
                                visual: 'ğŸ° ğŸ‘ï¸<br/>ğŸ¥•',
                                description: 'Ø§Ù„Ø£Ø±Ù†Ø¨ ÙŠØ±Ù‰ Ø§Ù„Ø¬Ø²Ø±Ø©',
                                order: 2
                            },
                            {
                                visual: 'ğŸ°<br/>ğŸ˜‹ğŸ¥•',
                                description: 'Ø§Ù„Ø£Ø±Ù†Ø¨ ÙŠØ£ÙƒÙ„ Ø§Ù„Ø¬Ø²Ø±Ø© Ø¨Ø³Ø¹Ø§Ø¯Ø©',
                                order: 3
                            }
                        ]
                    }
                ],
                2: [
                    // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ - 4 ØµÙˆØ±
                    {
                        title: 'Ø±Ø­Ù„Ø© Ø§Ù„ÙØ±Ø§Ø´Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©',
                        story: 'ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ ÙŠØ±Ù‚Ø© ØµØºÙŠØ±Ø© Ø®Ø¶Ø±Ø§Ø¡ ØªØ²Ø­Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚. Ù„ÙØª Ø§Ù„ÙŠØ±Ù‚Ø© Ù†ÙØ³Ù‡Ø§ ÙÙŠ Ø´Ø±Ù†Ù‚Ø© Ø­Ø±ÙŠØ±ÙŠØ© Ø¯Ø§ÙØ¦Ø© ÙˆÙ†Ø§Ù…Øª Ø¨Ù‡Ø¯ÙˆØ¡. Ø¨Ø¹Ø¯ Ø£ÙŠØ§Ù… Ù‚Ù„ÙŠÙ„Ø©ØŒ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„Ø´Ø±Ù†Ù‚Ø© ÙØ±Ø§Ø´Ø© Ø¬Ù…ÙŠÙ„Ø© Ø¨Ø£Ù„ÙˆØ§Ù† Ø²Ø§Ù‡ÙŠØ©. Ø·Ø§Ø±Øª Ø§Ù„ÙØ±Ø§Ø´Ø© Ø¨Ø³Ø¹Ø§Ø¯Ø© Ø¨ÙŠÙ† Ø§Ù„Ø²Ù‡ÙˆØ± Ø§Ù„Ù…Ù„ÙˆÙ†Ø© ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©!',
                        images: [
                            {
                                visual: 'ğŸ›<br/>ğŸƒ',
                                description: 'ÙŠØ±Ù‚Ø© Ø®Ø¶Ø±Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚',
                                order: 1
                            },
                            {
                                visual: 'ğŸ›¡ï¸<br/>ğŸ˜´',
                                description: 'Ø§Ù„Ø´Ø±Ù†Ù‚Ø© ØªÙ†Ø§Ù… Ø¨Ù‡Ø¯ÙˆØ¡',
                                order: 2
                            },
                            {
                                visual: 'ğŸ¦‹<br/>âœ¨',
                                description: 'ÙØ±Ø§Ø´Ø© Ø¬Ù…ÙŠÙ„Ø© ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ø´Ø±Ù†Ù‚Ø©',
                                order: 3
                            },
                            {
                                visual: 'ğŸ¦‹<br/>ğŸŒºğŸŒ¸',
                                description: 'Ø§Ù„ÙØ±Ø§Ø´Ø© ØªØ·ÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ø²Ù‡ÙˆØ±',
                                order: 4
                            }
                        ]
                    },
                    {
                        title: 'ØµÙ†Ø¹ Ø§Ù„ÙƒØ¹ÙƒØ© Ø§Ù„Ù„Ø°ÙŠØ°Ø©',
                        story: 'Ø¬Ù…Ø¹Øª Ø§Ù„Ø£Ù… Ø§Ù„Ø­Ù†ÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª: Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙˆØ§Ù„Ø³ÙƒØ± ÙˆØ§Ù„Ø¨ÙŠØ¶ ÙˆØ§Ù„Ø²Ø¨Ø¯Ø©. Ø®Ù„Ø·Øª ÙƒÙ„ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ÙÙŠ ÙˆØ¹Ø§Ø¡ ÙƒØ¨ÙŠØ± Ø­ØªÙ‰ Ø£ØµØ¨Ø­Øª Ø¹Ø¬ÙŠÙ†Ø© Ù†Ø§Ø¹Ù…Ø©. ÙˆØ¶Ø¹Øª Ø§Ù„Ø¹Ø¬ÙŠÙ†Ø© ÙÙŠ Ø§Ù„ÙØ±Ù† Ø§Ù„Ø³Ø§Ø®Ù† ÙˆØ§Ù†ØªØ¸Ø±Øª Ø­ØªÙ‰ ØªÙ†Ø¶Ø¬. Ø®Ø±Ø¬Øª ÙƒØ¹ÙƒØ© Ø°Ù‡Ø¨ÙŠØ© Ø¹Ø·Ø±Ø©ØŒ ÙˆØ§Ø¬ØªÙ…Ø¹Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ù„ØªÙ†Ø§ÙˆÙ„Ù‡Ø§ Ø¨ÙØ±Ø­!',
                        images: [
                            {
                                visual: 'ğŸ‘©â€ğŸ³<br/>ğŸ¥„ğŸš',
                                description: 'Ø§Ù„Ø£Ù… ØªØ¬Ù…Ø¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª',
                                order: 1
                            },
                            {
                                visual: 'ğŸ‘©â€ğŸ³ğŸ¥£<br/>ğŸŒ€',
                                description: 'Ø®Ù„Ø· Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ¹Ø§Ø¡',
                                order: 2
                            },
                            {
                                visual: 'ğŸ”¥ğŸ°<br/>â°',
                                description: 'ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø¬ÙŠÙ†Ø© ÙÙŠ Ø§Ù„ÙØ±Ù†',
                                order: 3
                            },
                            {
                                visual: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦<br/>ğŸ°ğŸ˜‹',
                                description: 'Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ØªØªÙ†Ø§ÙˆÙ„ Ø§Ù„ÙƒØ¹ÙƒØ© Ù…Ø¹Ø§Ù‹',
                                order: 4
                            }
                        ]
                    }
                ],
                3: [
                    // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø« - 5 ØµÙˆØ±
                    {
                        title: 'Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ø°Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø²Ù‡Ø±Ø©',
                        story: 'Ø²Ø±Ø¹ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø¨Ø°Ø±Ø© ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„ØªØ±Ø¨Ø© Ø§Ù„Ø®ØµØ¨Ø©. Ø³Ù‚Ù‰ Ø§Ù„Ø¨Ø°Ø±Ø© Ø¨Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø°Ø¨ ØªØ­Øª Ø£Ø´Ø¹Ø© Ø§Ù„Ø´Ù…Ø³ Ø§Ù„Ø¯Ø§ÙØ¦Ø© ÙƒÙ„ ÙŠÙˆÙ…. Ø¨Ø¯Ø£Øª Ø§Ù„Ø¨Ø°Ø±Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¨Ø§Øª ÙˆØ¸Ù‡Ø±Øª Ø¨Ø±Ø¹Ù… Ø£Ø®Ø¶Ø± ØµØºÙŠØ±. Ù†Ù…Øª Ø§Ù„Ù†Ø¨ØªØ© ÙŠÙˆÙ…Ø§Ù‹ Ø¨Ø¹Ø¯ ÙŠÙˆÙ… ÙˆØ£ØµØ¨Ø­Øª Ø£Ø·ÙˆÙ„ ÙˆØ£Ù‚ÙˆÙ‰. Ø£Ø®ÙŠØ±Ø§Ù‹ØŒ ØªÙØªØ­Øª Ø²Ù‡Ø±Ø© Ø¬Ù…ÙŠÙ„Ø© Ù…Ù„ÙˆÙ†Ø© ØªÙ†Ø´Ø± Ø¹Ø·Ø±Ù‡Ø§ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†!',
                        images: [
                            {
                                visual: 'ğŸŸ¤<br/>ğŸŒ±',
                                description: 'Ø¨Ø°Ø±Ø© ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„ØªØ±Ø¨Ø©',
                                order: 1
                            },
                            {
                                visual: 'â˜€ï¸ğŸ’§<br/>ğŸŒ±',
                                description: 'Ø³Ù‚ÙŠ Ø§Ù„Ø¨Ø°Ø±Ø© ØªØ­Øª Ø§Ù„Ø´Ù…Ø³',
                                order: 2
                            },
                            {
                                visual: 'ğŸŒ¿<br/>â¬†ï¸',
                                description: 'Ø§Ù„Ø¨Ø±Ø¹Ù… Ø§Ù„Ø£Ø®Ø¶Ø± ÙŠÙ†Ù…Ùˆ',
                                order: 3
                            },
                            {
                                visual: 'ğŸŒ¿<br/>ğŸ“',
                                description: 'Ø§Ù„Ù†Ø¨ØªØ© ØªØµØ¨Ø­ Ø£Ø·ÙˆÙ„',
                                order: 4
                            },
                            {
                                visual: 'ğŸŒ¸<br/>ğŸŒº',
                                description: 'Ø§Ù„Ø²Ù‡Ø±Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ØªØªÙØªØ­',
                                order: 5
                            }
                        ]
                    }
                ]
            };

            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            function initGame() {
                updateUI();
                showListeningPhase();
            }

            function updateUI() {
                document.getElementById('levelNumber').textContent = gameData.currentLevel;
                document.getElementById('storyNumber').textContent = gameData.currentStory + 1;
                updateStarsDisplay();
            }

            function showListeningPhase() {
                const story = getCurrentStory();
                gameData.gamePhase = 'listening';

                document.getElementById('storyTitle').textContent = story.title;
                document.getElementById('storyText').textContent = story.story;

                document.getElementById('listeningPhase').classList.remove('hidden');
                document.getElementById('gameArea').classList.add('hidden');

                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„Ø§Ù‹
                if (gameData.soundEnabled) {
                    setTimeout(() => {
                        playStory();
                    }, 1000);
                }
            }

            function getCurrentStory() {
                return stories[gameData.currentLevel][gameData.currentStory];
            }

            function playStory() {
                const story = getCurrentStory();
                const playBtn = document.getElementById('playStoryBtn');

                if (gameData.soundEnabled) {
                    playBtn.classList.add('playing');
                    playBtn.textContent = 'ğŸ”Š ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚ØµØ©...';

                    speakText(`Ø§Ø³ØªÙ…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹ Ù„Ù„Ù‚ØµØ©: ${story.story}`, () => {
                        playBtn.classList.remove('playing');
                        playBtn.textContent = 'ğŸ”„ Ø£Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚ØµØ©';

                        // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø¹Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù‚ØµØ©
                        setTimeout(() => {
                            startGamePhase();
                        }, 2000);
                    });
                }
            }

            function skipToGame() {
                // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ø¬Ø§Ø±ÙŠ
                if (gameData.speechSynth) {
                    gameData.speechSynth.cancel();
                }
                startGamePhase();
            }

            function startGamePhase() {
                gameData.gamePhase = 'playing';
                document.getElementById('listeningPhase').classList.add('hidden');
                document.getElementById('gameArea').classList.remove('hidden');

                displayStoryCards();

                if (gameData.soundEnabled) {
                    speakText('Ø§Ù„Ø¢Ù† Ø±ØªØ¨ Ø§Ù„ØµÙˆØ± Ø­Ø³Ø¨ ØªØ³Ù„Ø³Ù„ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚ØµØ© Ø§Ù„ØªÙŠ Ø³Ù…Ø¹ØªÙ‡Ø§');
                }
            }

            function displayStoryCards() {
                const story = getCurrentStory();
                const imagesContainer = document.getElementById('imagesContainer');
                imagesContainer.innerHTML = '';

                // Ù…Ø³Ø­ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
                gameData.selectedOrder = [];

                // Ø®Ù„Ø· Ø§Ù„ØµÙˆØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
                const shuffledImages = [...story.images].sort(() => Math.random() - 0.5);

                shuffledImages.forEach((image) => {
                    const card = document.createElement('div');
                    card.className = 'story-card';
                    card.innerHTML = `
                    <div class="story-emoji">${image.visual}</div>
                    <div class="story-description">${image.description}</div>
                    <div class="order-number"></div>
                `;

                    card.onclick = () => selectImage(card, image.order);
                    imagesContainer.appendChild(card);
                });

                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                document.getElementById('nextButton').classList.add('hidden');
                document.getElementById('feedbackArea').textContent = '';
                document.getElementById('feedbackArea').className = 'feedback-area';
            }

            function selectImage(cardElement, order) {
                const orderIndex = gameData.selectedOrder.indexOf(order);

                if (orderIndex !== -1) {
                    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                    gameData.selectedOrder.splice(orderIndex, 1);
                    cardElement.classList.remove('selected');
                    cardElement.querySelector('.order-number').textContent = '';
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                    gameData.selectedOrder.push(order);
                    cardElement.classList.add('selected');
                }

                // ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ±ØªÙŠØ¨
                updateOrderNumbers();

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                autoCheckAnswer();
            }

            function updateOrderNumbers() {
                const selectedCards = document.querySelectorAll('.story-card.selected');
                selectedCards.forEach((card, index) => {
                    const orderNumber = card.querySelector('.order-number');
                    const cardOrder = gameData.selectedOrder[index];
                    const displayIndex = gameData.selectedOrder.indexOf(cardOrder) + 1;
                    orderNumber.textContent = displayIndex;
                });
            }

            function autoCheckAnswer() {
                const story = getCurrentStory();

                // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±
                if (gameData.selectedOrder.length !== story.images.length) {
                    return;
                }

                const correctOrder = story.images.map((img) => img.order).sort((a, b) => a - b);
                const isCorrect = JSON.stringify(gameData.selectedOrder) === JSON.stringify(correctOrder);

                const feedbackArea = document.getElementById('feedbackArea');

                if (isCorrect) {
                    // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                    feedbackArea.textContent = 'ğŸ‰ Ù…Ù…ØªØ§Ø²! ØªØ±ØªÙŠØ¨ ØµØ­ÙŠØ­! ğŸ‰';
                    feedbackArea.className = 'feedback-area success';

                    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ÙƒØ±ÙˆØª Ø¨Ø§Ù„Ø£Ø®Ø¶Ø±
                    const cards = document.querySelectorAll('.story-card.selected');
                    cards.forEach((card) => {
                        card.classList.add('correct');
                    });

                    gameData.earnedStars++;
                    updateStarsDisplay();
                    playSuccessSound();

                    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù‚ØµØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„
                    setTimeout(() => {
                        document.getElementById('nextButton').classList.remove('hidden');
                        if (gameData.soundEnabled) {
                            speakText('Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø±ØªØ¨Øª Ø§Ù„Ù‚ØµØ© Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØµØ­ÙŠØ­ ØªÙ…Ø§Ù…Ø§Ù‹!');
                        }
                    }, 1000);
                } else {
                    // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                    feedbackArea.textContent = 'âŒ ØªØ±ØªÙŠØ¨ Ø®Ø§Ø·Ø¦! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ğŸ¤”';
                    feedbackArea.className = 'feedback-area error';
                    playErrorSound();

                    if (gameData.soundEnabled) {
                        speakText('Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„ÙŠØ³ ØµØ­ÙŠØ­Ø§Ù‹. ÙÙƒØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙŠ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«');
                    }

                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                    setTimeout(() => {
                        resetGame();
                    }, 2000);
                }
            }

            function resetGame() {
                gameData.selectedOrder = [];
                const cards = document.querySelectorAll('.story-card');
                cards.forEach((card) => {
                    card.classList.remove('selected', 'correct');
                    card.querySelector('.order-number').textContent = '';
                });

                document.getElementById('feedbackArea').textContent = '';
                document.getElementById('feedbackArea').className = 'feedback-area';
            }

            function nextStory() {
                gameData.currentStory++;

                if (gameData.currentStory >= stories[gameData.currentLevel].length) {
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ
                    gameData.currentLevel++;
                    gameData.currentStory = 0;

                    if (gameData.currentLevel > 3) {
                        // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                        showCompletionScreen();
                        return;
                    }

                    if (gameData.soundEnabled) {
                        speakText(`Ù…Ù…ØªØ§Ø²! Ø§Ù†ØªÙ‚Ù„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${gameData.currentLevel}!`);
                    }
                }

                updateUI();
                showListeningPhase();
            }

            function showCompletionScreen() {
                document.getElementById('gameArea').classList.add('hidden');
                document.getElementById('listeningPhase').classList.add('hidden');
                document.getElementById('completionScreen').classList.remove('hidden');

                if (gameData.soundEnabled) {
                    setTimeout(() => {
                        speakText('Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ØµØµ Ø¨Ù†Ø¬Ø§Ø­! Ø£Ù†Øª Ø¨Ø·Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ!');
                    }, 1000);
                }
            }

            function restartGame() {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                gameData.currentLevel = 1;
                gameData.currentStory = 0;
                gameData.selectedOrder = [];
                gameData.earnedStars = 0;
                gameData.gamePhase = 'listening';

                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„
                document.getElementById('completionScreen').classList.add('hidden');

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯
                updateUI();
                showListeningPhase();

                if (gameData.soundEnabled) {
                    speakText('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! Ù„Ù†Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ù‚ØµØµ!');
                }
            }

            function updateStarsDisplay() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                stars.forEach((star, index) => {
                    if (index < gameData.earnedStars) {
                        star.classList.add('earned');
                    } else {
                        star.classList.remove('earned');
                    }
                });
            }

            // Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù†Ø·Ù‚
            function toggleSound() {
                gameData.soundEnabled = !gameData.soundEnabled;
                const button = document.getElementById('soundToggle');

                if (gameData.soundEnabled) {
                    button.textContent = 'ğŸ”Š';
                    button.classList.remove('muted');
                    setTimeout(() => speakText('ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª'), 300);
                } else {
                    button.textContent = 'ğŸ”‡';
                    button.classList.add('muted');
                    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ø¬Ø§Ø±ÙŠ
                    if (gameData.speechSynth) {
                        gameData.speechSynth.cancel();
                    }
                }
            }

            function speakText(text, callback = null, rate = 0.8) {
                if (!gameData.soundEnabled || !gameData.speechSynth) {
                    if (callback) callback();
                    return;
                }

                // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙƒÙ„Ø§Ù… Ø¬Ø§Ø±ÙŠ
                gameData.speechSynth.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ar-SA';
                utterance.rate = rate;
                utterance.pitch = 1.1;
                utterance.volume = 0.9;

                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØª Ø¹Ø±Ø¨ÙŠ
                const voices = gameData.speechSynth.getVoices();
                const arabicVoice = voices.find((voice) => voice.lang.startsWith('ar') || voice.name.includes('Arabic') || voice.name.includes('Ø¹Ø±Ø¨ÙŠ'));

                if (arabicVoice) {
                    utterance.voice = arabicVoice;
                }

                if (callback) {
                    utterance.onend = callback;
                }

                gameData.speechSynth.speak(utterance);
            }

            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
            function playSuccessSound() {
                if (!gameData.soundEnabled) return;

                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5

                    frequencies.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.15);
                        oscillator.type = 'sine';

                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);

                        oscillator.start(audioContext.currentTime + index * 0.15);
                        oscillator.stop(audioContext.currentTime + index * 0.15 + 0.8);
                    });
                } catch (error) {
                    console.log('Audio context not supported');
                }
            }

            function playErrorSound() {
                if (!gameData.soundEnabled) return;

                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.4);
                    oscillator.type = 'sawtooth';

                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.4);
                } catch (error) {
                    console.log('Audio context not supported');
                }
            }

            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            window.addEventListener('load', () => {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                if (gameData.speechSynth && 'onvoiceschanged' in gameData.speechSynth) {
                    gameData.speechSynth.onvoiceschanged = () => {
                        console.log('Ø§Ù„Ø£ØµÙˆØ§Øª Ù…ØªØ§Ø­Ø©:', gameData.speechSynth.getVoices().length);
                    };
                }

                // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                setTimeout(() => {
                    initGame();
                    if (gameData.soundEnabled) {
                        speakText('Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© ØªØ±ØªÙŠØ¨ ØµÙˆØ± Ø§Ù„Ù‚ØµØ©!');
                    }
                }, 500);
            });
        </script>
    </body>
</html>
