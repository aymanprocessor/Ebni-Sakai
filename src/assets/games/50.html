<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>لعبة تقطيع الكلمات</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #2d3748;
                font-size: 22px;
                direction: rtl;
                line-height: 1.6;
            }

            .container {
                max-width: 900px;
                margin: 0 auto;
                padding: 20px;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .header {
                text-align: center;
                background: rgba(255, 255, 255, 0.98);
                border-radius: 20px;
                padding: 30px;
                margin-bottom: 25px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .title {
                font-size: 3em;
                color: #5a67d8;
                margin-bottom: 15px;
                font-weight: 800;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .subtitle {
                font-size: 1.4em;
                color: #4a5568;
                margin-bottom: 10px;
                font-weight: 600;
            }

            .description {
                font-size: 1.1em;
                color: #718096;
                max-width: 600px;
                margin: 0 auto;
            }

            .screen {
                background: rgba(255, 255, 255, 0.98);
                border-radius: 20px;
                padding: 30px;
                margin-bottom: 20px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                flex: 1;
            }

            .level-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .level-card {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 25px;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                border: 3px solid transparent;
                text-align: center;
            }

            .level-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
            }

            .level-card.selected {
                border-color: #48bb78;
                background: linear-gradient(135deg, #48bb78, #38a169);
            }

            .level-title {
                font-size: 1.4em;
                font-weight: bold;
                margin-bottom: 10px;
            }

            .level-desc {
                font-size: 1em;
                opacity: 0.9;
                margin-bottom: 10px;
            }

            .level-examples {
                font-size: 0.9em;
                opacity: 0.8;
                font-style: italic;
            }

            .start-btn {
                background: linear-gradient(135deg, #48bb78, #38a169);
                color: white;
                border: none;
                padding: 18px 45px;
                font-size: 1.4em;
                border-radius: 12px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s ease;
                display: block;
                margin: 0 auto;
                box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
            }

            .start-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
            }

            .start-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            .progress-section {
                background: #f7fafc;
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 25px;
                border: 2px solid #e2e8f0;
            }

            .progress-bar {
                background: #e2e8f0;
                height: 12px;
                border-radius: 10px;
                margin-bottom: 15px;
                overflow: hidden;
            }

            .progress-fill {
                background: linear-gradient(90deg, #48bb78, #38a169);
                height: 100%;
                transition: width 0.8s ease;
                border-radius: 10px;
            }

            .progress-text {
                text-align: center;
                font-size: 1.2em;
                font-weight: bold;
                color: #2d3748;
            }

            .question-container {
                text-align: center;
                margin-bottom: 30px;
            }

            .word-display {
                font-size: 3.2em;
                font-weight: 900;
                color: #2d3748;
                margin-bottom: 25px;
                padding: 20px;
                background: linear-gradient(135deg, #f7fafc, #edf2f7);
                border-radius: 15px;
                border: 3px solid #cbd5e0;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }

            .parts-display {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 8px;
                margin-bottom: 30px;
                flex-wrap: wrap;
            }

            .part-btn {
                background: linear-gradient(135deg, #ed8936, #dd6b20);
                color: white;
                border: none;
                padding: 15px 20px;
                font-size: 1.8em;
                font-weight: bold;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                min-width: 90px;
                box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
            }

            .part-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 20px rgba(237, 137, 54, 0.4);
            }

            .separator {
                font-size: 2em;
                color: #a0aec0;
                font-weight: bold;
            }

            .audio-controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-bottom: 30px;
                flex-wrap: wrap;
            }

            .btn {
                padding: 15px 25px;
                font-size: 1.2em;
                border: none;
                border-radius: 12px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s ease;
                min-height: 60px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .btn-primary {
                background: linear-gradient(135deg, #805ad5, #6b46c1);
                color: white;
                box-shadow: 0 4px 15px rgba(128, 90, 213, 0.3);
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(128, 90, 213, 0.4);
            }

            .btn-success {
                background: linear-gradient(135deg, #48bb78, #38a169);
                color: white;
                box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
            }

            .btn-success:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
            }

            .btn-warning {
                background: linear-gradient(135deg, #ed8936, #dd6b20);
                color: white;
                box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
            }

            .btn-warning:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(237, 137, 54, 0.4);
            }

            .btn-info {
                background: linear-gradient(135deg, #4299e1, #3182ce);
                color: white;
                box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
            }

            .btn-info:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(66, 153, 225, 0.4);
            }

            .input-section {
                background: #f7fafc;
                padding: 25px;
                border-radius: 15px;
                margin-bottom: 25px;
                border: 2px solid #e2e8f0;
            }

            .input-label {
                font-size: 1.3em;
                font-weight: bold;
                color: #2d3748;
                margin-bottom: 15px;
                text-align: center;
            }

            .word-input {
                width: 100%;
                max-width: 500px;
                font-size: 2em;
                padding: 20px;
                border: 3px solid #cbd5e0;
                border-radius: 12px;
                text-align: center;
                background: white;
                color: #2d3748;
                font-weight: bold;
                margin: 0 auto 20px;
                display: block;
                transition: all 0.3s ease;
            }

            .word-input:focus {
                outline: none;
                border-color: #4299e1;
                box-shadow: 0 0 0 4px rgba(66, 153, 225, 0.2);
            }

            .control-buttons {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .feedback {
                padding: 25px;
                border-radius: 15px;
                margin-bottom: 25px;
                font-size: 1.4em;
                font-weight: bold;
                text-align: center;
                border: 3px solid;
                transition: all 0.5s ease;
            }

            .feedback.correct {
                background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
                color: #22543d;
                border-color: #48bb78;
            }

            .feedback.incorrect {
                background: linear-gradient(135deg, #fed7d7, #fbb6ce);
                color: #742a2a;
                border-color: #e53e3e;
            }

            .word-breakdown {
                display: flex;
                justify-content: center;
                gap: 8px;
                margin-top: 20px;
                flex-wrap: wrap;
            }

            .word-part {
                padding: 10px 15px;
                border-radius: 8px;
                font-size: 1.3em;
                font-weight: bold;
                border: 2px solid;
            }

            .word-part:nth-child(1) {
                background: #fbb6ce;
                color: #97266d;
                border-color: #d53f8c;
            }
            .word-part:nth-child(2) {
                background: #9ae6b4;
                color: #22543d;
                border-color: #48bb78;
            }
            .word-part:nth-child(3) {
                background: #90cdf4;
                color: #2a69ac;
                border-color: #4299e1;
            }
            .word-part:nth-child(4) {
                background: #f6d55c;
                color: #744210;
                border-color: #ed8936;
            }

            .hint-display {
                background: linear-gradient(135deg, #fef5e7, #fed7aa);
                color: #744210;
                border: 3px solid #ed8936;
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 20px;
                font-size: 1.3em;
                text-align: center;
                font-weight: bold;
            }

            .results-section {
                text-align: center;
            }

            .final-score {
                font-size: 3em;
                margin-bottom: 25px;
                font-weight: 900;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .score-excellent {
                color: #48bb78;
            }

            .score-good {
                color: #4299e1;
            }

            .score-fair {
                color: #ed8936;
            }

            .score-poor {
                color: #e53e3e;
            }

            .score-message {
                font-size: 1.4em;
                margin-bottom: 30px;
                color: #4a5568;
                font-weight: 600;
            }

            .hidden {
                display: none !important;
            }

            .glitter-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            }

            .glitter {
                position: absolute;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                animation: glitterFall 2.5s ease-out forwards;
            }

            @keyframes glitterFall {
                0% {
                    opacity: 1;
                    transform: translateY(-20px) rotate(0deg) scale(1);
                }
                50% {
                    opacity: 1;
                    transform: translateY(50vh) rotate(180deg) scale(1.2);
                }
                100% {
                    opacity: 0;
                    transform: translateY(120vh) rotate(360deg) scale(0.8);
                }
            }

            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                }

                .title {
                    font-size: 2.2em;
                }

                .word-display {
                    font-size: 2.5em;
                }

                .part-btn {
                    font-size: 1.4em;
                    min-width: 70px;
                    padding: 12px 16px;
                }

                .word-input {
                    font-size: 1.6em;
                }

                .level-grid {
                    grid-template-columns: 1fr;
                }

                .btn {
                    font-size: 1.1em;
                    padding: 12px 20px;
                }
            }

            @media (max-width: 480px) {
                .audio-controls,
                .control-buttons {
                    flex-direction: column;
                    align-items: center;
                }

                .parts-display {
                    flex-direction: column;
                    align-items: center;
                }

                .separator {
                    transform: rotate(90deg);
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1 class="title">🎯 لعبة تقطيع الكلمات</h1>
                <p class="subtitle">تعلم قراءة الكلمات الطويلة بسهولة</p>
                <p class="description">اكتشف أجزاء الكلمات واجمعها لتكوين كلمات جديدة بطريقة ممتعة وتفاعلية</p>
            </div>

            <!-- Level Selection Screen -->
            <div id="levelScreen" class="screen">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2d3748; font-size: 2em">اختر مستوى التحدي</h2>

                <div class="level-grid">
                    <div class="level-card" data-level="1">
                        <div class="level-title">🌟 المستوى الأول</div>
                        <div class="level-desc">كلمات بسيطة - جزءان فقط</div>
                        <div class="level-examples">مثال: مستشفى → مس + تشفى</div>
                    </div>

                    <div class="level-card" data-level="2">
                        <div class="level-title">⭐ المستوى الثاني</div>
                        <div class="level-desc">كلمات متوسطة - ثلاثة أجزاء</div>
                        <div class="level-examples">مثال: مكتبة → مك + تب + ة</div>
                    </div>

                    <div class="level-card" data-level="3">
                        <div class="level-title">🏆 المستوى الثالث</div>
                        <div class="level-desc">كلمات متقدمة - أجزاء متعددة</div>
                        <div class="level-examples">مثال: مستشفى جامعي → مستشفى + جامعي</div>
                    </div>
                </div>

                <button id="startBtn" class="start-btn" disabled>ابدأ اللعب 🚀</button>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="screen hidden">
                <!-- Progress Section -->
                <div class="progress-section">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="progressText" class="progress-text">السؤال 1 من 4</div>
                </div>

                <!-- Question Container -->
                <div class="question-container">
                    <div id="wordDisplay" class="word-display"></div>

                    <div id="partsDisplay" class="parts-display"></div>

                    <div class="audio-controls">
                        <button id="hearPartsBtn" class="btn btn-primary">🔊 استمع للأجزاء</button>
                        <button id="combineBtn" class="btn btn-primary">🎵 اجمع الكلمة</button>
                        <button id="replayBtn" class="btn btn-info">🔄 إعادة التشغيل</button>
                    </div>
                </div>

                <!-- Input Section -->
                <div class="input-section">
                    <div class="input-label">اكتب الكلمة كاملة (بدون فواصل)</div>
                    <input type="text" id="wordInput" class="word-input" placeholder="اكتب هنا..." />

                    <div class="control-buttons">
                        <button id="checkBtn" class="btn btn-success">✅ تحقق من الإجابة</button>
                        <button id="hintBtn" class="btn btn-warning">💡 تلميح</button>
                    </div>
                </div>

                <!-- Feedback Area -->
                <div id="hintDisplay" class="hint-display hidden"></div>
                <div id="feedback" class="feedback hidden"></div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="screen hidden">
                <div class="results-section">
                    <div id="finalScore" class="final-score"></div>
                    <div id="scoreMessage" class="score-message"></div>

                    <div class="control-buttons">
                        <button id="playAgainBtn" class="btn btn-success">🔄 العب مرة أخرى</button>
                        <button id="changeLevelBtn" class="btn btn-info">📊 غير المستوى</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Game Data - بيانات اللعبة
            const LEVELS = {
                1: [
                    { word: 'مستشفى', parts: ['مس', 'تشفى'], hint: 'مكان للعلاج والرعاية الطبية', emoji: '🏥' },
                    { word: 'تلفاز', parts: ['تل', 'فاز'], hint: 'جهاز لمشاهدة البرامج والأفلام', emoji: '📺' },
                    { word: 'سوبرماركت', parts: ['سوبر', 'ماركت'], hint: 'متجر كبير لبيع الطعام والحاجيات', emoji: '🛒' },
                    { word: 'كرة قدم', parts: ['كرة', 'قدم'], hint: 'رياضة شعبية تلعب بالقدمين', emoji: '⚽' },
                    { word: 'طريق سريع', parts: ['طريق', 'سريع'], hint: 'طريق مخصص للسيارات السريعة', emoji: '🛣️' },
                    { word: 'ميناء بحري', parts: ['ميناء', 'بحري'], hint: 'مكان رسو السفن في البحر', emoji: '🚢' },
                    { word: 'مطار دولي', parts: ['مطار', 'دولي'], hint: 'مكان إقلاع الطائرات للخارج', emoji: '✈️' },
                    { word: 'حديقة عامة', parts: ['حديقة', 'عامة'], hint: 'مساحة خضراء للجميع', emoji: '🌳' }
                ],
                2: [
                    { word: 'مكتبة', parts: ['مك', 'تب', 'ة'], hint: 'مكان لقراءة واستعارة الكتب', emoji: '📚' },
                    { word: 'سيارة', parts: ['سي', 'ا', 'رة'], hint: 'وسيلة نقل تسير على الطرق', emoji: '🚗' },
                    { word: 'سفينة', parts: ['سف', 'ي', 'نة'], hint: 'مركب كبير يسير في البحر', emoji: '⛵' },
                    { word: 'بطاطس', parts: ['بط', 'ا', 'طس'], hint: 'خضروات تنمو تحت الأرض', emoji: '🥔' },
                    { word: 'مجلة', parts: ['مج', 'ل', 'ة'], hint: 'منشور دوري للقراءة والمعلومات', emoji: '📰' },
                    { word: 'مدرسة', parts: ['مد', 'ر', 'سة'], hint: 'مكان التعليم والتعلم', emoji: '🏫' },
                    { word: 'صيدلية', parts: ['صي', 'د', 'لية'], hint: 'مكان بيع الأدوية والعلاجات', emoji: '💊' },
                    { word: 'مطعم', parts: ['مط', 'ع', 'م'], hint: 'مكان تناول الطعام', emoji: '🍽️' }
                ],
                3: [
                    { word: 'استراحة', parts: ['است', 'را', 'حة'], hint: 'مكان للراحة والاسترخاء', emoji: '🛋️' },
                    { word: 'مستخدم', parts: ['مست', 'خد', 'م'], hint: 'شخص يستعمل البرامج أو الأجهزة', emoji: '💻' },
                    { word: 'مساعدة', parts: ['مس', 'اع', 'دة'], hint: 'تقديم العون والمساندة للآخرين', emoji: '🆘' },
                    { word: 'معلومات', parts: ['مع', 'لو', 'مات'], hint: 'بيانات وحقائق مفيدة', emoji: 'ℹ️' },
                    { word: 'محطة وقود', parts: ['محطة', 'وقود'], hint: 'مكان تعبئة البنزين للسيارات', emoji: '⛽' },
                    { word: 'مكتب البريد', parts: ['مكتب', 'البريد'], hint: 'مكان إرسال واستقبال الرسائل', emoji: '📮' },
                    { word: 'متحف أثري', parts: ['متحف', 'أثري'], hint: 'مكان عرض القطع التاريخية القديمة', emoji: '🏛️' },
                    { word: 'مركز تسوق', parts: ['مركز', 'تسوق'], hint: 'مبنى كبير يضم متاجر متنوعة', emoji: '🏬' },
                    { word: 'محطة قطار', parts: ['محطة', 'قطار'], hint: 'مكان صعود ونزول ركاب القطار', emoji: '🚂' },
                    { word: 'مستشفى عام', parts: ['مستشفى', 'عام'], hint: 'مستشفى يخدم جميع المواطنين', emoji: '🏥' },
                    { word: 'جامعة حكومية', parts: ['جامعة', 'حكومية'], hint: 'مؤسسة تعليم عالي تابعة للحكومة', emoji: '🎓' },
                    { word: 'منتجع سياحي', parts: ['منتجع', 'سياحي'], hint: 'مكان إقامة فاخر للعطلات', emoji: '🏖️' }
                ]
            };

            // Game State - حالة اللعبة
            let gameState = {
                currentLevel: null,
                currentQuestions: [],
                currentQuestionIndex: 0,
                currentWord: null,
                score: 0,
                attempts: 0,
                audioContext: null
            };

            // Audio Functions - وظائف الصوت
            function initAudio() {
                if (!gameState.audioContext) {
                    gameState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            function playSound(type, frequency, duration, waveType = 'sine') {
                initAudio();
                const oscillator = gameState.audioContext.createOscillator();
                const gainNode = gameState.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(gameState.audioContext.destination);

                oscillator.type = waveType;
                oscillator.frequency.setValueAtTime(frequency, gameState.audioContext.currentTime);

                gainNode.gain.setValueAtTime(0, gameState.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, gameState.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, gameState.audioContext.currentTime + duration);

                oscillator.start(gameState.audioContext.currentTime);
                oscillator.stop(gameState.audioContext.currentTime + duration);
            }

            function playBuzzer() {
                playSound('buzzer', 200, 0.4, 'sawtooth');
            }

            function playGlitter() {
                const frequencies = [600, 750, 900, 1050, 1200];
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        playSound('glitter', freq, 0.15, 'sine');
                    }, index * 100);
                });
                createGlitterEffect();
            }

            function createGlitterEffect() {
                const container = document.createElement('div');
                container.className = 'glitter-container';
                document.body.appendChild(container);

                const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57'];

                for (let i = 0; i < 40; i++) {
                    const glitter = document.createElement('div');
                    glitter.className = 'glitter';
                    glitter.style.left = Math.random() * 100 + '%';
                    glitter.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    glitter.style.animationDelay = Math.random() * 0.5 + 's';
                    glitter.style.animationDuration = 2 + Math.random() + 's';
                    container.appendChild(glitter);
                }

                setTimeout(() => {
                    if (container.parentNode) {
                        container.parentNode.removeChild(container);
                    }
                }, 3000);
            }

            // Speech Functions - وظائف النطق
            function speak(text, rate = 0.7, pitch = 1.0) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel(); // Cancel any ongoing speech

                    setTimeout(() => {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'ar-SA';
                        utterance.rate = rate;
                        utterance.pitch = pitch;
                        utterance.volume = 1.0;
                        speechSynthesis.speak(utterance);
                    }, 100);
                }
            }

            function speakPart(index) {
                if (gameState.currentWord && gameState.currentWord.parts[index]) {
                    speak(gameState.currentWord.parts[index], 0.6);
                }
            }

            function speakPartsSequentially() {
                if (!gameState.currentWord) return;

                gameState.currentWord.parts.forEach((part, index) => {
                    setTimeout(() => {
                        speak(part, 0.6);
                    }, index * 600);
                });
            }

            function speakCompleteWord() {
                if (gameState.currentWord) {
                    speak(gameState.currentWord.word, 0.5);
                }
            }

            // Text Normalization - تطبيع النصوص
            function normalizeArabicText(text) {
                return text
                    .replace(/[ًٌٍَُِّْ]/g, '') // Remove diacritics
                    .replace(/[آإأ]/g, 'ا') // Normalize alif variants
                    .replace(/ى/g, 'ي') // Normalize ya
                    .replace(/ة/g, 'ه') // Normalize ta marbouta (optional)
                    .replace(/[-\s]+/g, '') // Remove dashes and spaces
                    .trim()
                    .toLowerCase();
            }

            // Game Logic Functions - وظائف منطق اللعبة
            function selectLevel(level) {
                // Remove selection from all cards
                document.querySelectorAll('.level-card').forEach((card) => {
                    card.classList.remove('selected');
                });

                // Select clicked card
                document.querySelector(`[data-level="${level}"]`).classList.add('selected');
                gameState.currentLevel = level;

                // Enable start button
                document.getElementById('startBtn').disabled = false;
            }

            function startGame() {
                if (!gameState.currentLevel) return;

                // Get questions for selected level
                const levelData = LEVELS[gameState.currentLevel];

                // Shuffle and select 4 questions
                const shuffled = [...levelData].sort(() => Math.random() - 0.5);
                gameState.currentQuestions = shuffled.slice(0, 4);

                // Reset game state
                gameState.currentQuestionIndex = 0;
                gameState.score = 0;

                // Show game screen
                showScreen('gameScreen');
                nextQuestion();
            }

            function nextQuestion() {
                if (gameState.currentQuestionIndex >= gameState.currentQuestions.length) {
                    showResults();
                    return;
                }

                gameState.currentWord = gameState.currentQuestions[gameState.currentQuestionIndex];
                gameState.attempts = 0;

                renderQuestion();
                updateProgress();
                clearFeedback();

                // Focus on input
                document.getElementById('wordInput').focus();
            }

            function renderQuestion() {
                const word = gameState.currentWord;
                if (!word) return;

                // Display word with emoji
                document.getElementById('wordDisplay').textContent = `${word.emoji} ${word.word}`;

                // Create parts display
                const partsContainer = document.getElementById('partsDisplay');
                partsContainer.innerHTML = '';

                word.parts.forEach((part, index) => {
                    // Create part button
                    const partBtn = document.createElement('button');
                    partBtn.className = 'part-btn';
                    partBtn.textContent = part;
                    partBtn.onclick = () => speakPart(index);
                    partBtn.setAttribute('aria-label', `جزء ${index + 1}: ${part}`);
                    partsContainer.appendChild(partBtn);

                    // Add separator if not last part
                    if (index < word.parts.length - 1) {
                        const separator = document.createElement('span');
                        separator.className = 'separator';
                        separator.textContent = '-';
                        partsContainer.appendChild(separator);
                    }
                });

                // Clear input
                document.getElementById('wordInput').value = '';
            }

            function updateProgress() {
                const progress = (gameState.currentQuestionIndex / gameState.currentQuestions.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = `السؤال ${gameState.currentQuestionIndex + 1} من ${gameState.currentQuestions.length} | النقاط: ${gameState.score}`;
            }

            function clearFeedback() {
                document.getElementById('feedback').classList.add('hidden');
                document.getElementById('hintDisplay').classList.add('hidden');
            }

            function showHint() {
                const hintDisplay = document.getElementById('hintDisplay');
                hintDisplay.textContent = `💡 ${gameState.currentWord.hint}`;
                hintDisplay.classList.remove('hidden');
            }

            function checkAnswer() {
                const userInput = document.getElementById('wordInput').value.trim();
                if (!userInput) {
                    alert('الرجاء كتابة إجابة أولاً');
                    return;
                }

                const normalizedInput = normalizeArabicText(userInput);
                const normalizedCorrect = normalizeArabicText(gameState.currentWord.word);

                gameState.attempts++;

                if (normalizedInput === normalizedCorrect) {
                    handleCorrectAnswer();
                } else {
                    handleIncorrectAnswer();
                }
            }

            function handleCorrectAnswer() {
                // Award points only on first attempt
                if (gameState.attempts === 1) {
                    gameState.score++;
                }

                showCorrectFeedback();
                playGlitter();

                // Auto advance after delay
                setTimeout(() => {
                    gameState.currentQuestionIndex++;
                    nextQuestion();
                }, 1500);
            }

            function handleIncorrectAnswer() {
                playBuzzer();

                if (gameState.attempts >= 2) {
                    // Show correct answer after 2 attempts
                    showCorrectAnswerFeedback();
                    setTimeout(() => {
                        gameState.currentQuestionIndex++;
                        nextQuestion();
                    }, 2500);
                } else {
                    // Show incorrect feedback and hint
                    showIncorrectFeedback();
                    showHint();
                }
            }

            function showCorrectFeedback() {
                const feedback = document.getElementById('feedback');
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 15px;">
                    🎉 ممتاز! إجابة صحيحة! 🎉
                </div>
                <div class="word-breakdown">
                    ${gameState.currentWord.parts.map((part) => `<span class="word-part">${part}</span>`).join('')}
                </div>
            `;
                feedback.classList.remove('hidden');

                // Speak the word slowly
                setTimeout(() => speak(gameState.currentWord.word, 0.4), 300);
            }

            function showIncorrectFeedback() {
                const feedback = document.getElementById('feedback');
                feedback.className = 'feedback incorrect';

                const message = gameState.attempts === 1 ? '❌ إجابة غير صحيحة. حاول مرة أخرى! 💪' : '❌ إجابة غير صحيحة مرة أخرى. سأعرض الإجابة الصحيحة.';

                feedback.textContent = message;
                feedback.classList.remove('hidden');
            }

            function showCorrectAnswerFeedback() {
                const feedback = document.getElementById('feedback');
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                <div style="font-size: 1.1em; margin-bottom: 15px;">
                    الإجابة الصحيحة هي: <strong>${gameState.currentWord.word}</strong><br>
                    لا تقلق، ستتحسن مع التدريب! 😊
                </div>
                <div class="word-breakdown">
                    ${gameState.currentWord.parts.map((part) => `<span class="word-part">${part}</span>`).join('')}
                </div>
            `;
                feedback.classList.remove('hidden');

                speak(gameState.currentWord.word, 0.4);
            }

            function showResults() {
                showScreen('resultsScreen');

                const finalScore = document.getElementById('finalScore');
                const scoreMessage = document.getElementById('scoreMessage');

                let emoji, message, scoreClass;

                if (gameState.score === 4) {
                    emoji = '🏆';
                    message = 'مذهل! حصلت على الدرجة الكاملة!';
                    scoreClass = 'score-excellent';
                    playGlitter();
                } else if (gameState.score === 3) {
                    emoji = '🌟';
                    message = 'رائع! أداء ممتاز!';
                    scoreClass = 'score-good';
                } else if (gameState.score === 2) {
                    emoji = '👍';
                    message = 'جيد! يمكنك التحسن أكثر!';
                    scoreClass = 'score-fair';
                } else {
                    emoji = '💪';
                    message = 'لا تستسلم! التدريب يجعلك أفضل!';
                    scoreClass = 'score-poor';
                }

                finalScore.className = `final-score ${scoreClass}`;
                finalScore.textContent = `${emoji} ${gameState.score} / ${gameState.currentQuestions.length}`;
                scoreMessage.textContent = message;
            }

            function showScreen(screenId) {
                // Hide all screens
                document.querySelectorAll('.screen').forEach((screen) => {
                    screen.classList.add('hidden');
                });

                // Show target screen
                document.getElementById(screenId).classList.remove('hidden');
            }

            function playAgain() {
                startGame();
            }

            function changeLevel() {
                // Reset level selection
                gameState.currentLevel = null;
                document.querySelectorAll('.level-card').forEach((card) => {
                    card.classList.remove('selected');
                });
                document.getElementById('startBtn').disabled = true;

                showScreen('levelScreen');
            }

            // Event Handlers - معالجات الأحداث
            function setupEventHandlers() {
                // Level selection
                document.querySelectorAll('.level-card').forEach((card) => {
                    card.addEventListener('click', () => {
                        selectLevel(parseInt(card.dataset.level));
                    });
                });

                // Start button
                document.getElementById('startBtn').addEventListener('click', startGame);

                // Game controls
                document.getElementById('hearPartsBtn').addEventListener('click', speakPartsSequentially);
                document.getElementById('combineBtn').addEventListener('click', () => {
                    speakCompleteWord();
                    setTimeout(() => document.getElementById('wordInput').focus(), 500);
                });
                document.getElementById('replayBtn').addEventListener('click', speakPartsSequentially);
                document.getElementById('checkBtn').addEventListener('click', checkAnswer);
                document.getElementById('hintBtn').addEventListener('click', showHint);

                // Results controls
                document.getElementById('playAgainBtn').addEventListener('click', playAgain);
                document.getElementById('changeLevelBtn').addEventListener('click', changeLevel);

                // Input field
                const wordInput = document.getElementById('wordInput');
                wordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        checkAnswer();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('gameScreen').classList.contains('hidden')) return;

                    switch (e.key) {
                        case 'Enter':
                            if (e.target.id !== 'wordInput') {
                                e.preventDefault();
                                checkAnswer();
                            }
                            break;
                        case ' ':
                            if (e.target.id !== 'wordInput') {
                                e.preventDefault();
                                speakCompleteWord();
                            }
                            break;
                        default:
                            if (e.key >= '1' && e.key <= '9') {
                                const index = parseInt(e.key) - 1;
                                if (gameState.currentWord && gameState.currentWord.parts[index]) {
                                    speakPart(index);
                                }
                            }
                            break;
                    }
                });

                // Part buttons click handlers will be added dynamically in renderQuestion()
            }

            // Initialize Game - تهيئة اللعبة
            function initGame() {
                setupEventHandlers();
                showScreen('levelScreen');

                // Add accessibility attributes
                document.getElementById('wordInput').setAttribute('aria-label', 'اكتب الكلمة الكاملة هنا');
                document.getElementById('feedback').setAttribute('role', 'status');
                document.getElementById('hintDisplay').setAttribute('role', 'status');

                console.log('🎯 لعبة تقطيع الكلمات - جاهزة للعب!');
            }

            // Start the game when page loads
            document.addEventListener('DOMContentLoaded', initGame);
        </script>
    </body>
</html>
