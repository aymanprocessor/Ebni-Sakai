<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>لعبة ذاكرة المواقع - 10 مستويات</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: white;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .header {
                text-align: center;
                margin-bottom: 30px;
            }

            .title {
                font-size: 2.8rem;
                margin-bottom: 15px;
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
                background: linear-gradient(45deg, #ffd93d, #ff6b6b);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .level-info {
                background: rgba(255, 255, 255, 0.2);
                padding: 15px 30px;
                border-radius: 25px;
                backdrop-filter: blur(10px);
                display: inline-block;
                font-weight: bold;
                font-size: 1.2rem;
                border: 2px solid rgba(255, 255, 255, 0.3);
            }

            .control-panel {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(15px);
                border-radius: 20px;
                padding: 25px;
                margin-bottom: 25px;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }

            .stat-card {
                background: rgba(255, 255, 255, 0.1);
                padding: 15px;
                border-radius: 15px;
                text-align: center;
                border: 1px solid rgba(255, 255, 255, 0.2);
                transition: transform 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-5px);
            }

            .stat-label {
                font-size: 0.9rem;
                opacity: 0.8;
                margin-bottom: 8px;
            }

            .stat-value {
                font-size: 1.8rem;
                font-weight: bold;
                color: #ffd93d;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
                margin-bottom: 20px;
            }

            .btn {
                padding: 15px 30px;
                border: none;
                border-radius: 25px;
                font-size: 1.1rem;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                color: white;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
                position: relative;
                overflow: hidden;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                transition: all 0.3s ease;
            }

            .btn:hover::before {
                width: 200px;
                height: 200px;
            }

            .btn-primary {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
            }
            .btn-secondary {
                background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            }
            .btn-success {
                background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            }
            .btn-warning {
                background: linear-gradient(45deg, #ffa726, #ff7043);
            }

            .btn:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            .phase-indicator {
                text-align: center;
                padding: 18px;
                border-radius: 18px;
                font-weight: bold;
                font-size: 1.3rem;
                margin: 15px 0;
                background: linear-gradient(45deg, rgba(255, 217, 61, 0.3), rgba(255, 107, 107, 0.3));
                border: 2px solid #ffd93d;
                backdrop-filter: blur(10px);
            }

            .game-area {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(15px);
                border-radius: 25px;
                padding: 35px;
                min-height: 650px;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .scene-container {
                position: relative;
                width: 100%;
                max-width: 800px;
                height: 500px;
                margin: 0 auto 30px auto;
                border-radius: 25px;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
                border: 3px solid rgba(255, 255, 255, 0.3);
            }

            .scene {
                width: 100%;
                height: 100%;
                position: relative;
                transition: all 0.5s ease;
            }

            .object {
                position: absolute;
                width: 80px;
                height: 80px;
                font-size: 4rem;
                display: flex;
                align-items: center;
                justify-content: center;
                filter: drop-shadow(4px 4px 8px rgba(0, 0, 0, 0.6));
                transition: all 0.3s ease;
                user-select: none;
                z-index: 10;
                animation: popIn 0.5s ease-out;
            }

            @keyframes popIn {
                0% {
                    transform: scale(0);
                }
                80% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                }
            }

            .drop-zone {
                position: absolute;
                width: 100px;
                height: 100px;
                border: 3px dashed rgba(255, 255, 255, 0.7);
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                transform: translate(-50%, -50%);
                transition: all 0.3s ease;
                font-size: 1.1rem;
                color: rgba(255, 255, 255, 0.9);
                font-weight: bold;
                backdrop-filter: blur(5px);
            }

            .drop-zone.drag-over {
                border-color: #ffd93d;
                background: rgba(255, 217, 61, 0.4);
                box-shadow: 0 0 30px rgba(255, 217, 61, 0.9);
                transform: translate(-50%, -50%) scale(1.3);
            }

            .drop-zone.correct {
                border-color: #56ab2f;
                background: rgba(86, 171, 47, 0.5);
                animation: correctPulse 0.8s ease-in-out;
            }

            .drop-zone.wrong {
                border-color: #ff6b6b;
                background: rgba(255, 107, 107, 0.5);
                animation: wrongShake 0.8s ease-in-out;
            }

            @keyframes correctPulse {
                0%,
                100% {
                    transform: translate(-50%, -50%) scale(1.3);
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.6);
                }
            }

            @keyframes wrongShake {
                0%,
                100% {
                    transform: translate(-50%, -50%);
                }
                25% {
                    transform: translate(-60%, -45%);
                }
                75% {
                    transform: translate(-40%, -55%);
                }
            }

            .objects-panel {
                background: rgba(255, 255, 255, 0.15);
                border-radius: 20px;
                padding: 30px;
                margin: 25px 0;
                text-align: center;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .objects-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 25px;
                max-width: 700px;
                margin: 25px auto 0;
            }

            .draggable-object {
                width: 100px;
                height: 100px;
                background: linear-gradient(45deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
                border-radius: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 4rem;
                cursor: grab;
                transition: all 0.3s ease;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                user-select: none;
                border: 2px solid rgba(255, 255, 255, 0.5);
            }

            .draggable-object:hover:not(.used) {
                transform: scale(1.15) rotate(5deg);
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            }

            .draggable-object:active {
                cursor: grabbing;
            }

            .draggable-object.used {
                opacity: 0.3;
                cursor: not-allowed;
                transform: scale(0.9);
            }

            .countdown {
                text-align: center;
                font-size: 6rem;
                font-weight: bold;
                color: #ff6b6b;
                text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.6);
                margin: 80px 0;
                animation: countdownPulse 1s infinite;
            }

            @keyframes countdownPulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.2);
                }
                100% {
                    transform: scale(1);
                }
            }

            .progress-section {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 30px;
                margin: 40px 0;
                flex-wrap: wrap;
            }

            .progress-bar {
                width: 350px;
                height: 30px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 20px;
                overflow: hidden;
                border: 2px solid rgba(255, 255, 255, 0.3);
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #4ecdc4, #44a08d, #56ab2f);
                width: 0%;
                transition: width 1s ease;
                position: relative;
            }

            .progress-fill::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
                animation: progressShine 2s infinite;
            }

            @keyframes progressShine {
                0% {
                    left: -100%;
                }
                100% {
                    left: 100%;
                }
            }

            .stars {
                display: flex;
                gap: 15px;
            }

            .star {
                font-size: 3rem;
                color: #ffd93d;
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
                opacity: 0.3;
                transition: all 0.6s ease;
            }

            .star.earned {
                opacity: 1;
                transform: scale(1.3) rotate(360deg);
                animation: starGlow 2s infinite alternate;
            }

            @keyframes starGlow {
                0% {
                    filter: drop-shadow(0 0 10px #ffd93d);
                }
                100% {
                    filter: drop-shadow(0 0 20px #ffd93d);
                }
            }

            .hints-panel {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 18px;
                padding: 25px;
                margin: 25px 0;
                text-align: center;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .hint-text {
                font-size: 1.2rem;
                margin-bottom: 15px;
                min-height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.5s ease;
            }

            @keyframes fadeIn {
                0% {
                    opacity: 0;
                    transform: translateY(10px);
                }
                100% {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(5px);
            }

            .modal-content {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                padding: 60px;
                border-radius: 30px;
                text-align: center;
                box-shadow: 0 30px 70px rgba(0, 0, 0, 0.6);
                max-width: 600px;
                width: 90%;
                border: 3px solid rgba(255, 255, 255, 0.3);
            }

            .modal h2 {
                font-size: 2.5rem;
                margin-bottom: 25px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .celebration {
                font-size: 5rem;
                margin-bottom: 30px;
                animation: bounce 1s infinite;
            }

            @keyframes bounce {
                0%,
                100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-30px);
                }
            }

            .difficulty-indicator {
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.2);
                padding: 10px 20px;
                border-radius: 20px;
                font-weight: bold;
                backdrop-filter: blur(10px);
            }

            .timer-display {
                position: absolute;
                top: 20px;
                left: 20px;
                background: rgba(255, 107, 107, 0.3);
                padding: 10px 20px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 1.5rem;
                backdrop-filter: blur(10px);
                border: 2px solid #ff6b6b;
            }

            .hidden {
                display: none !important;
            }

            @media (max-width: 768px) {
                .title {
                    font-size: 2.2rem;
                }

                .scene-container {
                    height: 400px;
                }

                .object,
                .draggable-object {
                    width: 70px;
                    height: 70px;
                    font-size: 3rem;
                }

                .stats {
                    grid-template-columns: repeat(2, 1fr);
                }

                .progress-section {
                    flex-direction: column;
                    gap: 20px;
                }

                .progress-bar {
                    width: 280px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1 class="title">🏠 لعبة ذاكرة المواقع المطورة 🧠</h1>
                <div class="level-info">
                    <span id="levelDisplay">المستوى 1: غرفة النوم البسيطة</span>
                </div>
            </div>

            <div class="control-panel">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">المستوى</div>
                        <div class="stat-value" id="currentLevel">1</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">الأشياء</div>
                        <div class="stat-value" id="objectsCount">2</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">وقت العرض</div>
                        <div class="stat-value" id="studyTime">12</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">النجاح</div>
                        <div class="stat-value" id="successRate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">النجوم</div>
                        <div class="stat-value" id="totalStars">0</div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="startBtn">🎯 بدء المستوى</button>
                    <button class="btn btn-secondary" id="nextBtn">⬆️ المستوى التالي</button>
                    <button class="btn btn-success" id="hintBtn">💡 تلميح</button>
                    <button class="btn btn-warning" id="resetBtn">🔄 إعادة البدء</button>
                </div>

                <div class="phase-indicator" id="phaseIndicator">📚 اضغط "بدء المستوى" لمشاهدة الأشياء</div>
            </div>

            <div class="game-area">
                <div class="timer-display hidden" id="timerDisplay">⏰ 12</div>
                <div class="difficulty-indicator" id="difficultyIndicator">سهل 🟢</div>
                <div class="countdown hidden" id="countdown">3</div>

                <div class="scene-container">
                    <div class="scene" id="scene"></div>
                </div>

                <div class="objects-panel hidden" id="objectsPanel">
                    <h3>🎯 اسحب الأشياء إلى مواقعها الصحيحة</h3>
                    <div class="objects-grid" id="objectsGrid"></div>
                </div>

                <div class="hints-panel">
                    <div class="hint-text" id="hintText">💡 استخدم التلميحات للحصول على مساعدة إضافية</div>
                </div>

                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="stars" id="stars">
                        <span class="star">⭐</span>
                        <span class="star">⭐</span>
                        <span class="star">⭐</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="modal">
            <div class="modal-content">
                <div class="celebration">🎉</div>
                <h2 id="modalTitle">مبروك!</h2>
                <div id="modalMessage">لقد أكملت المستوى بنجاح!</div>
                <button class="btn btn-primary" id="continueBtn" style="margin-top: 25px">المتابعة</button>
            </div>
        </div>

        <script>
            // Game variables
            let currentLevel = 1;
            let gamePhase = 'waiting';
            let studyTimer = null;
            let distractionTimer = null;
            let autoStartTimer = null;
            let correctPlacements = 0;
            let totalAttempts = 0;
            let hintsUsed = 0;
            let starsEarned = 0;
            let totalStarsCollected = 0;

            // Sound context
            let audioContext = null;

            // Auto-start configuration
            const AUTO_START_DELAY = 2000; // 2 seconds delay before auto-start

            // Initialize audio context
            function initAudio() {
                if (!audioContext) {
                    try {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (e) {
                        console.log('Audio not supported');
                    }
                }
            }

            // Enhanced sound functions
            function playSound(frequency, duration, type = 'sine') {
                initAudio();
                if (!audioContext) return;

                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }

            function playSuccessSound() {
                playSound(659, 0.2); // E5
                setTimeout(() => playSound(784, 0.2), 100); // G5
                setTimeout(() => playSound(1047, 0.3), 200); // C6
            }

            function playErrorSound() {
                playSound(220, 0.3, 'square'); // A3
            }

            function playButtonSound() {
                playSound(440, 0.1); // A4
            }

            function playCountdownSound() {
                playSound(800, 0.2);
            }

            // Game data with 10 levels
            const levels = [
                {
                    name: 'غرفة النوم البسيطة',
                    background: 'linear-gradient(135deg, #8EC5FC 0%, #E0C3FC 100%)',
                    objects: 2,
                    studyTime: 12,
                    distractionTime: 3,
                    difficulty: 'سهل 🟢',
                    items: ['🛏️', '🕯️'],
                    positions: [
                        { left: '25%', top: '40%' },
                        { left: '70%', top: '30%' }
                    ],
                    hints: ['🛏️ السرير موجود في الجانب الأيسر من الغرفة', '🕯️ الشمعة بجانب النافذة في الجانب الأيمن العلوي']
                },
                {
                    name: 'المطبخ الصغير',
                    background: 'linear-gradient(135deg, #FFF3B4 0%, #FFAAA5 100%)',
                    objects: 3,
                    studyTime: 10,
                    distractionTime: 3,
                    difficulty: 'سهل 🟢',
                    items: ['🍎', '☕', '🥄'],
                    positions: [
                        { left: '30%', top: '45%' },
                        { left: '60%', top: '25%' },
                        { left: '45%', top: '65%' }
                    ],
                    hints: ['🍎 التفاحة على طاولة الطعام في الوسط الأيسر', '☕ فنجان القهوة في الأعلى بجانب الموقد الأيمن']
                },
                {
                    name: 'الحديقة الخضراء',
                    background: 'linear-gradient(135deg, #92FE9D 0%, #00C9FF 100%)',
                    objects: 3,
                    studyTime: 9,
                    distractionTime: 4,
                    difficulty: 'سهل 🟢',
                    items: ['🌸', '🦋', '🌳'],
                    positions: [
                        { left: '30%', top: '40%' },
                        { left: '60%', top: '25%' },
                        { left: '75%', top: '70%' }
                    ],
                    hints: ['🌸 الوردة الجميلة في وسط الحديقة على اليسار', '🦋 الفراشة الملونة تطير في الأعلى وسط الحديقة']
                },
                {
                    name: 'غرفة الأطفال المرحة',
                    background: 'linear-gradient(135deg, #FFD3A5 0%, #FD9853 100%)',
                    objects: 4,
                    studyTime: 8,
                    distractionTime: 4,
                    difficulty: 'متوسط 🟡',
                    items: ['🧸', '🎨', '📚', '🚗'],
                    positions: [
                        { left: '20%', top: '50%' },
                        { left: '45%', top: '25%' },
                        { left: '70%', top: '60%' },
                        { left: '55%', top: '75%' }
                    ],
                    hints: ['🧸 الدبدوب الصغير على الأريكة في الجانب الأيسر', '📚 الكتب الملونة مرتبة على الرف في الجانب الأيمن']
                },
                {
                    name: 'الصف الدراسي المنظم',
                    background: 'linear-gradient(135deg, #A8EDEA 0%, #FED6E3 100%)',
                    objects: 4,
                    studyTime: 7,
                    distractionTime: 4,
                    difficulty: 'متوسط 🟡',
                    items: ['📏', '🍎', '🖍️', '📖'],
                    positions: [
                        { left: '25%', top: '30%' },
                        { left: '50%', top: '55%' },
                        { left: '75%', top: '35%' },
                        { left: '40%', top: '70%' }
                    ],
                    hints: ['📏 المسطرة على مكتب المعلم في المقدمة اليسرى', '🖍️ الأقلام الملونة في علبة على الجانب الأيمن العلوي']
                },
                {
                    name: 'الصالة العائلية الكبيرة',
                    background: 'linear-gradient(135deg, #D299C2 0%, #FED6E3 100%)',
                    objects: 5,
                    studyTime: 6,
                    distractionTime: 5,
                    difficulty: 'متوسط 🟡',
                    items: ['📺', '🛋️', '🕰️', '🖼️', '🌱'],
                    positions: [
                        { left: '50%', top: '25%' },
                        { left: '30%', top: '60%' },
                        { left: '70%', top: '20%' },
                        { left: '15%', top: '30%' },
                        { left: '80%', top: '65%' }
                    ],
                    hints: ['📺 التلفاز الكبير معلق في منتصف الحائط الأمامي', '🕰️ الساعة الأنيقة على الحائط الأيمن في الأعلى']
                },
                {
                    name: 'متجر الألعاب الملون',
                    background: 'linear-gradient(135deg, #FF9A9E 0%, #FECFEF 50%, #FECFEF 100%)',
                    objects: 5,
                    studyTime: 5,
                    distractionTime: 5,
                    difficulty: 'صعب 🟠',
                    items: ['🎈', '🎯', '🧩', '🎪', '🎭'],
                    positions: [
                        { left: '20%', top: '25%' },
                        { left: '45%', top: '45%' },
                        { left: '70%', top: '25%' },
                        { left: '30%', top: '70%' },
                        { left: '65%', top: '70%' }
                    ],
                    hints: ['🎈 البالونات الملونة في الزاوية اليسرى العلوية من المتجر', '🎪 خيمة السيرك الصغيرة في الجانب الأيسر السفلي']
                },
                {
                    name: 'المكتبة الهادئة',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    objects: 6,
                    studyTime: 4,
                    distractionTime: 5,
                    difficulty: 'صعب 🟠',
                    items: ['📚', '🖊️', '💡', '🗂️', '🪑', '🌿'],
                    positions: [
                        { left: '15%', top: '30%' },
                        { left: '35%', top: '50%' },
                        { left: '55%', top: '20%' },
                        { left: '75%', top: '45%' },
                        { left: '25%', top: '75%' },
                        { left: '70%', top: '75%' }
                    ],
                    hints: ['📚 رف الكتب الكبير في الجانب الأيسر من المكتبة', '💡 مصباح القراءة المضيء في منطقة القراءة العلوية']
                },
                {
                    name: 'المختبر العلمي',
                    background: 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
                    objects: 6,
                    studyTime: 4,
                    distractionTime: 6,
                    difficulty: 'صعب 🟠',
                    items: ['🧪', '🔬', '⚗️', '📊', '🧬', '🥽'],
                    positions: [
                        { left: '20%', top: '40%' },
                        { left: '45%', top: '25%' },
                        { left: '70%', top: '35%' },
                        { left: '30%', top: '65%' },
                        { left: '60%', top: '70%' },
                        { left: '80%', top: '60%' }
                    ],
                    hints: ['🔬 المجهر العلمي على الطاولة المركزية في الأعلى', '🧪 أنبوب الاختبار في الجانب الأيسر من المختبر']
                },
                {
                    name: 'القصر السحري',
                    background: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    objects: 7,
                    studyTime: 3,
                    distractionTime: 6,
                    difficulty: 'صعب جداً 🔴',
                    items: ['👑', '🗡️', '💎', '🏺', '🕯️', '📜', '🔮'],
                    positions: [
                        { left: '15%', top: '25%' },
                        { left: '35%', top: '45%' },
                        { left: '55%', top: '20%' },
                        { left: '75%', top: '40%' },
                        { left: '25%', top: '70%' },
                        { left: '50%', top: '75%' },
                        { left: '80%', top: '70%' }
                    ],
                    hints: ['👑 التاج الذهبي اللامع في الزاوية اليسرى العلوية من القصر', '🔮 الكرة البلورية السحرية في الزاوية اليمنى السفلى']
                }
            ];

            // Get current level data
            function getCurrentLevel() {
                return levels[currentLevel - 1] || levels[0];
            }

            // Start level automatically
            function autoStartLevel() {
                if (gamePhase !== 'waiting') return;

                document.getElementById('phaseIndicator').textContent = '⏰ سيبدأ المستوى تلقائياً خلال ثوان...';

                let countdown = 3;
                const countdownElement = document.getElementById('phaseIndicator');

                autoStartTimer = setInterval(() => {
                    countdownElement.textContent = `🚀 بدء المستوى خلال ${countdown}...`;
                    playCountdownSound();
                    countdown--;

                    if (countdown < 0) {
                        clearInterval(autoStartTimer);
                        startLevel();
                    }
                }, 1000);
            }

            // Start level
            function startLevel() {
                if (gamePhase !== 'waiting') return;

                // Clear any existing auto-start timer
                if (autoStartTimer) {
                    clearInterval(autoStartTimer);
                    autoStartTimer = null;
                }

                playButtonSound();
                gamePhase = 'studying';
                const level = getCurrentLevel();

                // Disable start button and enable it again after level completion
                const startBtn = document.getElementById('startBtn');
                startBtn.disabled = true;
                startBtn.textContent = '⏳ جاري اللعب...';

                document.getElementById('phaseIndicator').textContent = '👀 شاهد الأشياء واحفظ مواقعها بعناية!';
                document.getElementById('timerDisplay').classList.remove('hidden');

                // Reset hint button
                const hintBtn = document.getElementById('hintBtn');
                hintBtn.disabled = false;
                hintBtn.textContent = '💡 تلميح';

                showStudyPhase();
            }

            // Show study phase
            function showStudyPhase() {
                const level = getCurrentLevel();
                const scene = document.getElementById('scene');

                scene.style.background = level.background;
                scene.innerHTML = '';

                // Add objects with animation delay
                level.items.forEach((item, index) => {
                    setTimeout(() => {
                        const object = document.createElement('div');
                        object.className = 'object';
                        object.textContent = item;
                        object.style.left = level.positions[index].left;
                        object.style.top = level.positions[index].top;
                        scene.appendChild(object);
                        playSound(600 + index * 100, 0.1);
                    }, index * 200);
                });

                // Start timer
                let timeLeft = level.studyTime;
                document.getElementById('timerDisplay').textContent = `⏰ ${timeLeft}`;

                studyTimer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timerDisplay').textContent = `⏰ ${timeLeft}`;

                    if (timeLeft <= 3 && timeLeft > 0) {
                        playCountdownSound();
                    }

                    if (timeLeft <= 0) {
                        clearInterval(studyTimer);
                        document.getElementById('timerDisplay').classList.add('hidden');
                        startDistraction();
                    }
                }, 1000);
            }

            // Start distraction phase
            function startDistraction() {
                gamePhase = 'distraction';
                document.getElementById('scene').innerHTML = '';
                document.getElementById('phaseIndicator').textContent = '🔢 عد تنازلياً وركز!';

                const level = getCurrentLevel();
                let timeLeft = level.distractionTime;
                const countdownEl = document.getElementById('countdown');

                countdownEl.classList.remove('hidden');
                countdownEl.textContent = timeLeft;

                distractionTimer = setInterval(() => {
                    timeLeft--;
                    if (timeLeft > 0) {
                        countdownEl.textContent = timeLeft;
                        playCountdownSound();
                    } else {
                        countdownEl.classList.add('hidden');
                        clearInterval(distractionTimer);
                        startRecall();
                    }
                }, 1000);
            }

            // Start recall phase
            function startRecall() {
                gamePhase = 'recall';
                document.getElementById('phaseIndicator').textContent = '🎯 اسحب الأشياء إلى مواقعها الصحيحة!';

                setupDropZones();
                setupDraggableObjects();
                document.getElementById('objectsPanel').classList.remove('hidden');
            }

            // Setup drop zones
            function setupDropZones() {
                const level = getCurrentLevel();
                const scene = document.getElementById('scene');
                scene.innerHTML = '';

                level.positions.forEach((position, index) => {
                    const dropZone = document.createElement('div');
                    dropZone.className = 'drop-zone';
                    dropZone.style.left = position.left;
                    dropZone.style.top = position.top;
                    dropZone.dataset.position = index;
                    dropZone.textContent = index + 1;

                    dropZone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        dropZone.classList.add('drag-over');
                    });

                    dropZone.addEventListener('dragleave', () => {
                        dropZone.classList.remove('drag-over');
                    });

                    dropZone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        dropZone.classList.remove('drag-over');
                        handleDrop(e, dropZone);
                    });

                    scene.appendChild(dropZone);
                });
            }

            // Setup draggable objects with touch support
            function setupDraggableObjects() {
                const level = getCurrentLevel();
                const grid = document.getElementById('objectsGrid');
                grid.innerHTML = '';

                const shuffled = [...level.items].sort(() => Math.random() - 0.5);

                shuffled.forEach((item) => {
                    const originalIndex = level.items.indexOf(item);
                    const draggable = document.createElement('div');
                    draggable.className = 'draggable-object';
                    draggable.textContent = item;
                    draggable.draggable = true;
                    draggable.dataset.item = item;
                    draggable.dataset.originalIndex = originalIndex;

                    // Desktop drag events
                    draggable.addEventListener('dragstart', (e) => {
                        playButtonSound();
                        e.dataTransfer.setData(
                            'text/plain',
                            JSON.stringify({
                                item: item,
                                originalIndex: originalIndex
                            })
                        );
                    });

                    // Touch events for mobile
                    let isDragging = false;
                    let startX, startY;
                    let draggedElement = null;

                    draggable.addEventListener('touchstart', (e) => {
                        if (draggable.classList.contains('used')) return;

                        e.preventDefault();
                        playButtonSound();
                        isDragging = true;

                        const touch = e.touches[0];
                        startX = touch.clientX;
                        startY = touch.clientY;

                        draggedElement = draggable.cloneNode(true);
                        draggedElement.style.position = 'fixed';
                        draggedElement.style.zIndex = '3000';
                        draggedElement.style.pointerEvents = 'none';
                        draggedElement.style.transform = 'scale(1.2)';
                        draggedElement.style.opacity = '0.8';
                        document.body.appendChild(draggedElement);

                        updateDraggedElementPosition(touch.clientX, touch.clientY);
                    });

                    draggable.addEventListener('touchmove', (e) => {
                        if (!isDragging || !draggedElement) return;
                        e.preventDefault();

                        const touch = e.touches[0];
                        updateDraggedElementPosition(touch.clientX, touch.clientY);

                        // Highlight drop zones
                        const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                        const dropZone = elementBelow?.closest('.drop-zone');

                        document.querySelectorAll('.drop-zone').forEach((zone) => {
                            zone.classList.remove('drag-over');
                        });

                        if (dropZone && !dropZone.classList.contains('filled')) {
                            dropZone.classList.add('drag-over');
                        }
                    });

                    draggable.addEventListener('touchend', (e) => {
                        if (!isDragging || !draggedElement) return;

                        const touch = e.changedTouches[0];
                        const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                        const dropZone = elementBelow?.closest('.drop-zone');

                        if (dropZone && !dropZone.classList.contains('filled')) {
                            // Create a fake drop event
                            const fakeDropEvent = {
                                preventDefault: () => {},
                                dataTransfer: {
                                    getData: () =>
                                        JSON.stringify({
                                            item: item,
                                            originalIndex: originalIndex
                                        })
                                }
                            };
                            handleDrop(fakeDropEvent, dropZone);
                        }

                        // Cleanup
                        isDragging = false;
                        if (draggedElement) {
                            document.body.removeChild(draggedElement);
                            draggedElement = null;
                        }

                        document.querySelectorAll('.drop-zone').forEach((zone) => {
                            zone.classList.remove('drag-over');
                        });
                    });

                    function updateDraggedElementPosition(x, y) {
                        if (draggedElement) {
                            draggedElement.style.left = x - 40 + 'px';
                            draggedElement.style.top = y - 40 + 'px';
                        }
                    }

                    grid.appendChild(draggable);
                });
            }

            // Handle drop
            function handleDrop(e, dropZone) {
                if (dropZone.classList.contains('filled')) return;

                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                const targetPosition = parseInt(dropZone.dataset.position);

                dropZone.classList.add('filled');
                dropZone.textContent = data.item;
                dropZone.style.fontSize = '3.5rem';

                totalAttempts++;

                if (targetPosition === data.originalIndex) {
                    // Correct!
                    dropZone.classList.add('correct');
                    correctPlacements++;
                    earnStar();
                    playSuccessSound();

                    // Mark object as used
                    const objects = document.querySelectorAll('.draggable-object');
                    objects.forEach((obj) => {
                        if (obj.dataset.item === data.item) {
                            obj.classList.add('used');
                            obj.draggable = false;
                        }
                    });

                    if (correctPlacements === getCurrentLevel().objects) {
                        setTimeout(completeLevel, 1500);
                    }
                } else {
                    // Wrong
                    dropZone.classList.add('wrong');
                    playErrorSound();
                    setTimeout(() => {
                        dropZone.classList.remove('filled', 'wrong');
                        dropZone.textContent = targetPosition + 1;
                        dropZone.style.fontSize = '';
                    }, 1500);
                }

                updateProgress();
                updateStats();
            }

            // Complete level
            function completeLevel() {
                gamePhase = 'completed';
                totalStarsCollected += starsEarned;
                const modal = document.getElementById('modal');

                playSound(523, 0.3); // C5
                setTimeout(() => playSound(659, 0.3), 150); // E5
                setTimeout(() => playSound(784, 0.5), 300); // G5

                if (currentLevel === levels.length) {
                    document.getElementById('modalTitle').textContent = '🏆 تهانينا! أكملت جميع المستويات!';
                    document.getElementById('modalMessage').textContent = `مجموع النجوم: ${totalStarsCollected} ⭐`;
                } else {
                    document.getElementById('modalTitle').textContent = `✨ رائع! أكملت ${getCurrentLevel().name}`;
                    document.getElementById('modalMessage').textContent = `حصلت على ${starsEarned} نجوم من 3! 🌟`;
                }

                modal.classList.remove('hidden');
            }

            // Earn star
            function earnStar() {
                const stars = document.querySelectorAll('.star');
                if (starsEarned < stars.length) {
                    stars[starsEarned].classList.add('earned');
                    starsEarned++;
                    playSound(880, 0.3); // A5
                }
            }

            // Update progress
            function updateProgress() {
                const progress = (correctPlacements / getCurrentLevel().objects) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }

            // Update stats
            function updateStats() {
                document.getElementById('currentLevel').textContent = currentLevel;
                document.getElementById('objectsCount').textContent = getCurrentLevel().objects;
                document.getElementById('totalStars').textContent = totalStarsCollected;

                const rate = totalAttempts > 0 ? Math.round((correctPlacements / totalAttempts) * 100) : 0;
                document.getElementById('successRate').textContent = rate + '%';
            }

            // Update level display
            function updateLevelDisplay() {
                const level = getCurrentLevel();
                document.getElementById('levelDisplay').textContent = `المستوى ${currentLevel}: ${level.name}`;
                document.getElementById('studyTime').textContent = level.studyTime;
                document.getElementById('difficultyIndicator').textContent = level.difficulty;
            }

            // Reset level
            function resetLevel() {
                if (studyTimer) clearInterval(studyTimer);
                if (distractionTimer) clearInterval(distractionTimer);
                if (autoStartTimer) clearInterval(autoStartTimer);

                gamePhase = 'waiting';
                correctPlacements = 0;
                totalAttempts = 0;
                hintsUsed = 0;
                starsEarned = 0;

                // Reset start button
                const startBtn = document.getElementById('startBtn');
                startBtn.disabled = false;
                startBtn.textContent = '🎯 بدء يدوي';

                // Reset hint button
                const hintBtn = document.getElementById('hintBtn');
                hintBtn.disabled = false;
                hintBtn.textContent = '💡 تلميح';

                document.getElementById('objectsPanel').classList.add('hidden');
                document.getElementById('countdown').classList.add('hidden');
                document.getElementById('modal').classList.add('hidden');
                document.getElementById('timerDisplay').classList.add('hidden');
                document.getElementById('phaseIndicator').textContent = '🎮 استعد! سيبدأ المستوى قريباً...';
                document.getElementById('hintText').textContent = '💡 استخدم التلميحات للحصول على مساعدة إضافية';

                const scene = document.getElementById('scene');
                scene.innerHTML = '';
                scene.style.background = getCurrentLevel().background;

                const stars = document.querySelectorAll('.star');
                stars.forEach((star) => star.classList.remove('earned'));

                updateProgress();
                updateStats();
                updateLevelDisplay();

                // Auto-start the level after a short delay
                setTimeout(autoStartLevel, AUTO_START_DELAY);
            }

            // Next level
            function nextLevel() {
                playButtonSound();
                if (currentLevel < levels.length) {
                    currentLevel++;
                } else {
                    currentLevel = 1;
                    totalStarsCollected = 0;
                }
                resetLevel();
            }

            // Show hint
            function showHint() {
                if (gamePhase !== 'recall' || hintsUsed >= 2) return;

                playButtonSound();
                const level = getCurrentLevel();
                const hintBtn = document.getElementById('hintBtn');

                if (hintsUsed < level.hints.length) {
                    document.getElementById('hintText').textContent = level.hints[hintsUsed];
                    hintsUsed++;

                    // Update hint button text
                    if (hintsUsed >= level.hints.length) {
                        hintBtn.disabled = true;
                        hintBtn.textContent = '❌ نفدت التلميحات';
                    } else {
                        hintBtn.textContent = `💡 تلميح (${2 - hintsUsed} متبقي)`;
                    }
                }
            }

            // Reset game
            function resetGame() {
                playButtonSound();
                currentLevel = 1;
                totalStarsCollected = 0;
                resetLevel();
            }

            // Event listeners
            document.addEventListener('DOMContentLoaded', () => {
                updateLevelDisplay();
                updateStats();

                const scene = document.getElementById('scene');
                scene.style.background = getCurrentLevel().background;

                // Button event listeners with sound effects
                document.getElementById('startBtn').addEventListener('click', startLevel);
                document.getElementById('nextBtn').addEventListener('click', nextLevel);
                document.getElementById('hintBtn').addEventListener('click', showHint);
                document.getElementById('resetBtn').addEventListener('click', resetGame);
                document.getElementById('continueBtn').addEventListener('click', () => {
                    playButtonSound();
                    document.getElementById('modal').classList.add('hidden');
                    if (currentLevel === levels.length && starsEarned > 0) {
                        nextLevel();
                    } else if (currentLevel < levels.length) {
                        nextLevel();
                    } else {
                        resetGame();
                    }
                });

                // Add hover sound effects to buttons (desktop only)
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach((btn) => {
                    btn.addEventListener('mouseenter', () => {
                        if (!btn.disabled && window.innerWidth > 768) {
                            playSound(330, 0.05); // E4
                        }
                    });
                });

                // Auto-start the first level
                setTimeout(() => {
                    autoStartLevel();
                }, AUTO_START_DELAY);
            });

            // Prevent default drag behavior and improve mobile experience
            document.addEventListener('dragstart', (e) => {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                }
            });

            // Prevent text selection during drag operations
            document.addEventListener('selectstart', (e) => {
                if (e.target.classList.contains('draggable-object') || e.target.classList.contains('object')) {
                    e.preventDefault();
                }
            });

            // Prevent context menu on long press (mobile)
            document.addEventListener('contextmenu', (e) => {
                if (e.target.classList.contains('draggable-object') || e.target.classList.contains('drop-zone')) {
                    e.preventDefault();
                }
            });

            // Prevent page refresh on pull-to-refresh (mobile)
            document.body.addEventListener(
                'touchstart',
                (e) => {
                    if (e.touches.length === 1 && window.scrollY === 0) {
                        e.preventDefault();
                    }
                },
                { passive: false }
            );

            document.body.addEventListener(
                'touchmove',
                (e) => {
                    if (e.touches.length === 1) {
                        e.preventDefault();
                    }
                },
                { passive: false }
            );

            // Enable audio on first user interaction
            document.addEventListener(
                'click',
                () => {
                    initAudio();
                },
                { once: true }
            );

            document.addEventListener(
                'touchstart',
                () => {
                    initAudio();
                },
                { once: true }
            );

            // Handle orientation change
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    // Recalculate layout after orientation change
                    const scene = document.getElementById('scene');
                    scene.style.height = '';
                    setTimeout(() => {
                        const rect = scene.getBoundingClientRect();
                        scene.style.height = rect.height + 'px';
                    }, 100);
                }, 500);
            });

            // Handle window resize
            window.addEventListener('resize', () => {
                // Debounce resize events
                clearTimeout(window.resizeTimeout);
                window.resizeTimeout = setTimeout(() => {
                    // Update layout if needed
                    updateProgress();
                }, 250);
            });
        </script>
    </body>
</html>
