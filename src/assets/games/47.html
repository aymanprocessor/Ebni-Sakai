<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© ØªÙÙƒÙŠÙƒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¥Ù„Ù‰ Ø£ØµÙˆØ§Øª</title>
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 20px;
                line-height: 1.6;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }

            .container {
                background: white;
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                max-width: 800px;
                width: 100%;
                text-align: center;
            }

            .screen {
                display: none;
            }

            .screen.active {
                display: block;
            }

            h1 {
                color: #4a5568;
                font-size: 2.5em;
                margin-bottom: 20px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .description {
                color: #666;
                font-size: 1.1em;
                margin-bottom: 30px;
                line-height: 1.8;
            }

            .level-buttons {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 30px 0;
                flex-wrap: wrap;
            }

            .btn {
                background: linear-gradient(45deg, #4caf50, #45a049);
                color: white;
                border: none;
                padding: 15px 30px;
                font-size: 1.2em;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.3s;
                min-width: 140px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            }

            .btn.secondary {
                background: linear-gradient(45deg, #2196f3, #1976d2);
            }

            .btn.danger {
                background: linear-gradient(45deg, #f44336, #d32f2f);
            }

            .word-display {
                font-size: 4em;
                margin: 20px 0;
                min-height: 80px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 20px;
            }

            .word-text {
                font-size: 2em;
                color: #4a5568;
                font-weight: bold;
            }

            .question {
                font-size: 1.3em;
                color: #333;
                margin: 20px 0;
                font-weight: bold;
            }

            .input-area {
                margin: 30px 0;
            }

            .phoneme-input {
                width: 100%;
                padding: 15px;
                font-size: 1.5em;
                border: 3px solid #ddd;
                border-radius: 10px;
                text-align: center;
                direction: rtl;
            }

            .phoneme-input:focus {
                border-color: #4caf50;
                outline: none;
                box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            }

            .controls {
                display: flex;
                justify-content: center;
                gap: 15px;
                margin: 20px 0;
                flex-wrap: wrap;
            }

            .feedback {
                margin: 20px 0;
                padding: 20px;
                border-radius: 10px;
                font-size: 1.2em;
                min-height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .feedback.success {
                background: #d4edda;
                color: #155724;
                border: 2px solid #c3e6cb;
            }

            .feedback.error {
                background: #f8d7da;
                color: #721c24;
                border: 2px solid #f5c6cb;
            }

            .colored-answer {
                font-size: 1.5em;
                margin: 15px 0;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 10px;
                direction: rtl;
            }

            .phoneme-span {
                padding: 8px 12px;
                margin: 0 5px;
                border-radius: 8px;
                font-weight: bold;
                display: inline-block;
            }

            .correct {
                background: #28a745;
                color: white;
            }
            .missing {
                background: #ffc107;
                color: #856404;
                border: 2px dashed #856404;
                font-style: italic;
            }
            .extra {
                background: #dc3545;
                color: white;
                opacity: 0.7;
            }

            .progress-bar {
                background: #e9ecef;
                height: 20px;
                border-radius: 10px;
                margin: 20px 0;
                overflow: hidden;
            }

            .progress-fill {
                background: linear-gradient(45deg, #4caf50, #45a049);
                height: 100%;
                transition: width 0.5s ease;
            }

            .stats {
                display: flex;
                justify-content: space-between;
                margin: 20px 0;
                font-size: 1.1em;
                font-weight: bold;
                color: #4a5568;
            }

            .show-word-btn {
                background: linear-gradient(45deg, #ff9800, #f57c00);
                margin-bottom: 20px;
            }

            @media (max-width: 600px) {
                .container {
                    padding: 20px;
                    margin: 10px;
                }

                h1 {
                    font-size: 2em;
                }

                .word-display {
                    font-size: 3em;
                    flex-direction: column;
                    gap: 10px;
                }

                .word-text {
                    font-size: 1.5em;
                }

                .level-buttons {
                    flex-direction: column;
                    align-items: center;
                }
            }

            /* Accessibility */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            [role='status'] {
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
            <div id="start-screen" class="screen active">
                <h1>ğŸ¯ Ù„Ø¹Ø¨Ø© ØªÙÙƒÙŠÙƒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¥Ù„Ù‰ Ø£ØµÙˆØ§Øª</h1>
                <div class="description">
                    ØªØ¹Ù„Ù… ÙƒÙŠÙ ØªÙ‚Ø³Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¥Ù„Ù‰ Ø£ØµÙˆØ§ØªÙ‡Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©!<br />
                    Ø§Ù†Ø·Ù‚ ÙƒÙ„ ÙƒÙ„Ù…Ø© ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…ÙØµÙˆÙ„Ø© Ø¨Ø´Ø±Ø·Ø©
                </div>

                <!-- Ù…Ø«Ø§Ù„ ØªÙˆØ¶ÙŠØ­ÙŠ -->
                <div style="background: #f8f9fa; border: 3px solid #28a745; border-radius: 15px; padding: 25px; margin: 25px 0; direction: rtl">
                    <h2 style="color: #28a745; margin-bottom: 15px">ğŸ“š Ù…Ø«Ø§Ù„ Ù„Ù„ØªÙˆØ¶ÙŠØ­:</h2>
                    <div style="font-size: 1.3em; margin-bottom: 15px">
                        <span style="font-size: 2em">â˜€ï¸</span>
                        <span style="color: #4a5568; font-weight: bold; margin: 0 10px">Ø´Ù…Ø³</span>
                    </div>
                    <div style="margin: 15px 0; font-size: 1.2em; color: #666">ğŸ—£ï¸ Ø§Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø¨Ø·Ø¡: "Ø´Ù€Ù€ - Ù…Ù€Ù€ - Ø³"</div>
                    <div style="background: white; padding: 15px; border-radius: 10px; border: 2px dashed #28a745">
                        <div style="margin-bottom: 10px; font-weight: bold">Ø§ÙƒØªØ¨ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚:</div>
                        <div style="font-size: 1.5em; color: #28a745; font-weight: bold; text-align: center; background: #e8f5e8; padding: 10px; border-radius: 8px">Ø´ - Ù… - Ø³</div>
                    </div>
                    <div style="margin-top: 15px; font-size: 1.1em; color: #666">
                        âœ… ÙƒÙ„ ØµÙˆØª Ù…Ù†ÙØµÙ„ Ø¨Ø´Ø±Ø·Ø©<br />
                        âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø£ÙŠØ¶Ø§Ù‹: Ø´ Ù… Ø³
                    </div>
                </div>

                <div class="level-buttons">
                    <button class="btn" onclick="startLevel(1)">
                        Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„<br />
                        <small>ÙƒÙ„Ù…Ø§Øª Ø¨Ø³ÙŠØ·Ø© (3 Ø£ØµÙˆØ§Øª)</small>
                    </button>
                    <button class="btn" onclick="startLevel(2)">
                        Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ<br />
                        <small>ÙƒÙ„Ù…Ø§Øª Ù…ØªÙˆØ³Ø·Ø© (4 Ø£ØµÙˆØ§Øª)</small>
                    </button>
                    <button class="btn" onclick="startLevel(3)">
                        Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«<br />
                        <small>Ù…Ø²ÙŠØ¬ Ù…ØªØ¯Ø±Ø¬</small>
                    </button>
                </div>
            </div>

            <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
            <div id="game-screen" class="screen">
                <div class="stats">
                    <span>Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="question-number">1</span> Ù…Ù† 10</span>
                    <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></span>
                </div>

                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 10%"></div>
                </div>

                <button id="show-word-btn" class="btn show-word-btn" onclick="toggleWordDisplay()">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø©</button>

                <div class="word-display">
                    <span id="emoji-display">â˜€ï¸</span>
                    <span id="word-display" class="word-text" style="display: none">Ø´Ù…Ø³</span>
                </div>

                <div class="question">Ø§Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªÙŠ ØªØ³Ù…Ø¹Ù‡Ø§ Ù…ÙØµÙˆÙ„Ø© Ø¨Ø´Ø±Ø·Ø©</div>

                <div class="input-area">
                    <input type="text" id="phoneme-input" class="phoneme-input" placeholder="Ù…Ø«Ø§Ù„: Ø´ - Ù… - Ø³" aria-label="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…ÙØµÙˆÙ„Ø© Ø¨Ø´Ø±Ø·Ø©" />
                </div>

                <div class="controls">
                    <button class="btn" onclick="checkAnswer()">ØªØ­Ù‚Ù‚</button>
                    <button class="btn secondary" onclick="speakWord()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹</button>
                    <button class="btn secondary" onclick="showHint()">ØªÙ„Ù…ÙŠØ­</button>
                </div>

                <div id="feedback" class="feedback" role="status" aria-live="polite"></div>
                <div id="colored-answer" class="colored-answer"></div>

                <div class="controls">
                    <button class="btn danger" onclick="endGame()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
                    <button class="btn secondary" onclick="nextQuestion()" id="next-btn" style="display: none">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>
            </div>

            <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
            <div id="end-screen" class="screen">
                <h1>ğŸ‰ Ø£Ø­Ø³Ù†Øª!</h1>
                <div class="description">
                    Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù„Ø¹Ø¨Ø©!<br />
                    Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="final-score">0</span> Ù…Ù† 10
                </div>

                <div class="level-buttons">
                    <button class="btn" onclick="restartGame()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
                    <button class="btn secondary" onclick="backToStart()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
                </div>
            </div>
        </div>

        <script>
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
            const levels = {
                1: [
                    { word: 'Ø´Ù…Ø³', phonemes: ['Ø´', 'Ù…', 'Ø³'], hint: 'Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'â˜€ï¸' },
                    { word: 'Ø¨Ø§Ø¨', phonemes: ['Ø¨', 'Ø§', 'Ø¨'], hint: 'Ù†ÙØªØ­Ù‡ Ù„Ù„Ø¯Ø®ÙˆÙ„', emoji: 'ğŸšª' },
                    { word: 'Ø¨ÙŠØª', phonemes: ['Ø¨', 'ÙŠ', 'Øª'], hint: 'Ù…ÙƒØ§Ù† Ù†Ø³ÙƒÙ† ÙÙŠÙ‡', emoji: 'ğŸ ' },
                    { word: 'ÙƒÙ„Ø¨', phonemes: ['Ùƒ', 'Ù„', 'Ø¨'], hint: 'Ø­ÙŠÙˆØ§Ù† Ø£Ù„ÙŠÙ', emoji: 'ğŸ¶' },
                    { word: 'Ù‚Ù…Ø±', phonemes: ['Ù‚', 'Ù…', 'Ø±'], hint: 'Ù†Ø±Ø§Ù‡ Ù„ÙŠÙ„Ø§Ù‹', emoji: 'ğŸŒ™' },
                    { word: 'Ù†Ø¬Ù…', phonemes: ['Ù†', 'Ø¬', 'Ù…'], hint: 'Ø´ÙŠØ¡ Ù„Ø§Ù…Ø¹ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'â­' },
                    { word: 'Ø®Ø¨Ø²', phonemes: ['Ø®', 'Ø¨', 'Ø²'], hint: 'Ø·Ø¹Ø§Ù… Ù†Ø£ÙƒÙ„Ù‡', emoji: 'ğŸ' },
                    { word: 'Ù…Ù„Ø­', phonemes: ['Ù…', 'Ù„', 'Ø­'], hint: 'Ù†Ø¶Ø¹Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¹Ø§Ù…', emoji: 'ğŸ§‚' },
                    { word: 'Ù†ÙˆØ±', phonemes: ['Ù†', 'Ùˆ', 'Ø±'], hint: 'ÙŠØ¶ÙŠØ¡ Ø§Ù„Ø¸Ù„Ø§Ù…', emoji: 'ğŸ’¡' },
                    { word: 'ÙˆØ±Ø¯', phonemes: ['Ùˆ', 'Ø±', 'Ø¯'], hint: 'Ø²Ù‡Ø±Ø© Ø¬Ù…ÙŠÙ„Ø©', emoji: 'ğŸŒ¹' }
                ],
                2: [
                    { word: 'Ù…ÙˆØ²Ø©', phonemes: ['Ù…', 'Ùˆ', 'Ø²', 'Ø©'], hint: 'ÙØ§ÙƒÙ‡Ø© ØµÙØ±Ø§Ø¡', emoji: 'ğŸŒ' },
                    { word: 'ÙƒØ±Ø³ÙŠ', phonemes: ['Ùƒ', 'Ø±', 'Ø³', 'ÙŠ'], hint: 'Ù†Ø¬Ù„Ø³ Ø¹Ù„ÙŠÙ‡', emoji: 'ğŸª‘' },
                    { word: 'ÙƒØªØ§Ø¨', phonemes: ['Ùƒ', 'Øª', 'Ø§', 'Ø¨'], hint: 'Ù†Ù‚Ø±Ø£ ÙÙŠÙ‡', emoji: 'ğŸ“–' },
                    { word: 'ØªÙØ§Ø­', phonemes: ['Øª', 'Ù', 'Ø§', 'Ø­'], hint: 'ÙØ§ÙƒÙ‡Ø© Ø­Ù…Ø±Ø§Ø¡', emoji: 'ğŸ' },
                    { word: 'Ø·Ù…Ø§Ø·', phonemes: ['Ø·', 'Ù…', 'Ø§', 'Ø·'], hint: 'Ø®Ø¶Ø±ÙˆØ§Øª Ø­Ù…Ø±Ø§Ø¡', emoji: 'ğŸ…' },
                    { word: 'Ù…Ø³Ø·Ø±Ø©', phonemes: ['Ù…', 'Ø³', 'Ø·', 'Ø±'], hint: 'Ù†Ø±Ø³Ù… Ø¨Ù‡Ø§ Ø®Ø·ÙˆØ·', emoji: 'ğŸ“' },
                    { word: 'Ø­Ù‚ÙŠØ¨Ø©', phonemes: ['Ø­', 'Ù‚', 'ÙŠ', 'Ø¨'], hint: 'Ù†Ø­Ù…Ù„ ÙÙŠÙ‡Ø§ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡', emoji: 'ğŸ’' },
                    { word: 'Ù†Ø§ÙØ°Ø©', phonemes: ['Ù†', 'Ø§', 'Ù', 'Ø°'], hint: 'Ù†Ø·Ù„ Ù…Ù†Ù‡Ø§', emoji: 'ğŸªŸ' },
                    { word: 'Ù…Ø¯Ø±Ø³', phonemes: ['Ù…', 'Ø¯', 'Ø±', 'Ø³'], hint: 'ÙŠØ¹Ù„Ù… Ø§Ù„Ø·Ù„Ø§Ø¨', emoji: 'ğŸ§‘â€ğŸ«' },
                    { word: 'Ù…ÙØªØ§Ø­', phonemes: ['Ù…', 'Ù', 'Øª', 'Ø§'], hint: 'Ù†ÙØªØ­ Ø¨Ù‡ Ø§Ù„Ø¨Ø§Ø¨', emoji: 'ğŸ”‘' }
                ],
                3: [
                    { word: 'Ø´Ù…Ø³', phonemes: ['Ø´', 'Ù…', 'Ø³'], hint: 'Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'â˜€ï¸' },
                    { word: 'Ø¨Ø§Ø¨', phonemes: ['Ø¨', 'Ø§', 'Ø¨'], hint: 'Ù†ÙØªØ­Ù‡ Ù„Ù„Ø¯Ø®ÙˆÙ„', emoji: 'ğŸšª' },
                    { word: 'Ù…ÙˆØ²Ø©', phonemes: ['Ù…', 'Ùˆ', 'Ø²', 'Ø©'], hint: 'ÙØ§ÙƒÙ‡Ø© ØµÙØ±Ø§Ø¡', emoji: 'ğŸŒ' },
                    { word: 'ÙƒØªØ§Ø¨', phonemes: ['Ùƒ', 'Øª', 'Ø§', 'Ø¨'], hint: 'Ù†Ù‚Ø±Ø£ ÙÙŠÙ‡', emoji: 'ğŸ“–' },
                    { word: 'ØªÙØ§Ø­Ø©', phonemes: ['Øª', 'Ù', 'Ø§', 'Ø­', 'Ø©'], hint: 'ÙØ§ÙƒÙ‡Ø© Ø­Ù…Ø±Ø§Ø¡', emoji: 'ğŸ' },
                    { word: 'Ø¨Ø·Ø§Ø·Ø³', phonemes: ['Ø¨', 'Ø·', 'Ø§', 'Ø·', 'Ø³'], hint: 'Ø®Ø¶Ø±ÙˆØ§Øª Ù†Ø£ÙƒÙ„Ù‡Ø§', emoji: 'ğŸ¥”' },
                    { word: 'ÙØ±Ø§Ø´Ø©', phonemes: ['Ù', 'Ø±', 'Ø§', 'Ø´', 'Ø©'], hint: 'Ø­Ø´Ø±Ø© Ø¬Ù…ÙŠÙ„Ø© ØªØ·ÙŠØ±', emoji: 'ğŸ¦‹' },
                    { word: 'Ù…Ø±Ø§ÙŠØ§', phonemes: ['Ù…', 'Ø±', 'Ø§', 'ÙŠ', 'Ø§'], hint: 'Ù†Ù†Ø¸Ø± ÙÙŠÙ‡Ø§', emoji: 'ğŸª' },
                    { word: 'Ø­Ø¯ÙŠÙ‚Ø©', phonemes: ['Ø­', 'Ø¯', 'ÙŠ', 'Ù‚', 'Ø©'], hint: 'Ù…ÙƒØ§Ù† ÙÙŠÙ‡ Ø£Ø´Ø¬Ø§Ø±', emoji: 'ğŸŒ³' },
                    { word: 'Ù†Ø¬Ù…', phonemes: ['Ù†', 'Ø¬', 'Ù…'], hint: 'Ø´ÙŠØ¡ Ù„Ø§Ù…Ø¹ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'â­' }
                ]
            };

            // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            let currentLevel = 1;
            let currentQuestionIndex = 0;
            let currentQuestions = [];
            let score = 0;
            let questionsAnswered = 0;
            let currentWord = null;
            let showingWord = false;
            let audioContext = null;

            // Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø£ØµÙˆØ§Øª
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'];

            // ØªÙ‡ÙŠØ¦Ø© Web Audio API
            function initAudio() {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¬Ù„ÙŠØªØ± (Ø§Ù„Ù†Ø¬Ø§Ø­)
            function playGlitter() {
                if (!audioContext) return;

                const frequencies = [600, 750, 900, 1200];
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';

                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.12);

                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.12);
                    }, index * 80);
                });
            }

            // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¨Ø§Ø² (Ø§Ù„Ø®Ø·Ø£)
            function playBuzzer() {
                if (!audioContext) return;

                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 200;
                oscillator.type = 'sawtooth';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.35);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.35);
            }

            // Ø¨Ø¯Ø¡ Ù…Ø³ØªÙˆÙ‰ Ù…Ø¹ÙŠÙ†
            function startLevel(level) {
                initAudio();
                currentLevel = level;
                currentQuestionIndex = 0;
                score = 0;
                questionsAnswered = 0;

                // Ø§Ø®ØªÙŠØ§Ø± 10 Ø£Ø³Ø¦Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                const levelWords = [...levels[level]];
                currentQuestions = [];
                for (let i = 0; i < 10; i++) {
                    if (levelWords.length === 0) {
                        levelWords.push(...levels[level]);
                    }
                    const randomIndex = Math.floor(Math.random() * levelWords.length);
                    currentQuestions.push(levelWords.splice(randomIndex, 1)[0]);
                }

                showScreen('game-screen');
                showQuestion();
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
            function showQuestion() {
                currentWord = currentQuestions[currentQuestionIndex];

                document.getElementById('emoji-display').textContent = currentWord.emoji;
                document.getElementById('word-display').textContent = currentWord.word;
                document.getElementById('word-display').style.display = 'none';
                document.getElementById('show-word-btn').textContent = 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø©';
                showingWord = false;

                document.getElementById('question-number').textContent = currentQuestionIndex + 1;
                document.getElementById('score').textContent = score;
                document.getElementById('phoneme-input').value = '';
                document.getElementById('feedback').innerHTML = '';
                document.getElementById('colored-answer').innerHTML = '';
                document.getElementById('next-btn').style.display = 'none';

                // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                const progress = ((currentQuestionIndex + 1) / 10) * 100;
                document.getElementById('progress-fill').style.width = progress + '%';

                // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                document.getElementById('phoneme-input').focus();
            }

            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„Ù…Ø©
            function toggleWordDisplay() {
                const wordElement = document.getElementById('word-display');
                const btn = document.getElementById('show-word-btn');

                if (showingWord) {
                    wordElement.style.display = 'none';
                    btn.textContent = 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø©';
                    showingWord = false;
                } else {
                    wordElement.style.display = 'inline';
                    btn.textContent = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„Ù…Ø©';
                    showingWord = true;
                }
            }

            // Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø©
            function speakWord() {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(currentWord.word);
                    utterance.lang = 'ar-SA';
                    utterance.rate = 0.7;
                    speechSynthesis.speak(utterance);
                }
            }

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ„Ù…ÙŠØ­
            function showHint() {
                const feedback = document.getElementById('feedback');
                feedback.className = 'feedback';
                feedback.innerHTML = `ğŸ’¡ ØªÙ„Ù…ÙŠØ­: ${currentWord.hint}`;
            }

            // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            function normalizeInput(input) {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„ÙÙˆØ§ØµÙ„
                let normalized = input.replace(/[\s\-,ØŒ]+/g, ' ').trim();

                // ØªÙ‚Ø³ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
                let phonemes = normalized.split(/\s+/).filter((p) => p.length > 0);

                // ØªÙˆØ­ÙŠØ¯ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø­Ø±Ù
                phonemes = phonemes.map((p) => {
                    return p
                        .replace(/[Ø£Ø¥Ø¢]/g, 'Ø§')
                        .replace(/Ù‰/g, 'ÙŠ')
                        .replace(/[Ù‹ÙŒÙÙÙÙÙ’Ù€]/g, ''); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„
                });

                return phonemes;
            }

            // ÙØ­Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ù…ÙØ¹Ø·Ù‰
            function checkAnswer() {
                const input = document.getElementById('phoneme-input').value;
                const userPhonemes = normalizeInput(input);
                const correctPhonemes = currentWord.phonemes;

                if (userPhonemes.length === 0) {
                    document.getElementById('feedback').innerHTML = 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ØµÙˆØ§Øª Ø£ÙˆÙ„Ø§Ù‹';
                    document.getElementById('feedback').className = 'feedback error';
                    return;
                }

                // Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª 5 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø±ØŒ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒØªØ¨ Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø®Ø§Ù…Ø³ØŒ Ø£Ø¶ÙÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                if (correctPhonemes.length >= 5 && userPhonemes.length === 4) {
                    userPhonemes.push(correctPhonemes[4]);
                }

                // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
                let isCorrect = userPhonemes.length === correctPhonemes.length;
                if (isCorrect) {
                    for (let i = 0; i < correctPhonemes.length; i++) {
                        if (userPhonemes[i] !== correctPhonemes[i]) {
                            isCorrect = false;
                            break;
                        }
                    }
                }

                if (isCorrect) {
                    // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                    score++;
                    playGlitter();
                    const message = correctPhonemes.length >= 5 ? 'Ø£Ø­Ø³Ù†Øª! Ø±ÙƒØ¨Øª ÙƒÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª ØµØ­ Ù…Ø¹ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø®Ø§Ù…Ø³ ğŸ‘' : 'Ø£Ø­Ø³Ù†Øª! Ø±ÙƒØ¨Øª ÙƒÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª ØµØ­ ğŸ‘';
                    document.getElementById('feedback').innerHTML = message;
                    document.getElementById('feedback').className = 'feedback success';
                    renderColoredAnswer(correctPhonemes, 'correct');

                    setTimeout(() => {
                        nextQuestion();
                    }, 1200);
                } else {
                    // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                    playBuzzer();
                    const message = correctPhonemes.length >= 5 ? 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ (ØªØ°ÙƒØ±: Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø®Ø§Ù…Ø³ Ù…Ø¹Ø·Ù‰)' : 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                    document.getElementById('feedback').innerHTML = message;
                    document.getElementById('feedback').className = 'feedback error';
                    renderComparisonAnswer(userPhonemes, correctPhonemes);

                    setTimeout(() => {
                        nextQuestion();
                    }, 3000);
                }

                questionsAnswered++;
                document.getElementById('score').textContent = score;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø©
            function renderColoredAnswer(phonemes, type) {
                const container = document.getElementById('colored-answer');
                container.innerHTML = '';

                phonemes.forEach((phoneme, index) => {
                    const span = document.createElement('span');
                    span.textContent = phoneme;
                    span.className = `phoneme-span ${type}`;
                    span.style.backgroundColor = colors[index % colors.length];
                    if (type === 'correct') {
                        span.style.color = 'white';
                    }
                    container.appendChild(span);
                });
            }

            // Ø¹Ø±Ø¶ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            function renderComparisonAnswer(userPhonemes, correctPhonemes) {
                const container = document.getElementById('colored-answer');
                container.innerHTML = '<div><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</strong></div>';

                const correctDiv = document.createElement('div');
                correctDiv.style.marginTop = '10px';

                correctPhonemes.forEach((phoneme, index) => {
                    const span = document.createElement('span');
                    span.textContent = phoneme;

                    if (index < userPhonemes.length && userPhonemes[index] === phoneme) {
                        span.className = 'phoneme-span correct';
                    } else {
                        span.className = 'phoneme-span missing';
                    }

                    correctDiv.appendChild(span);
                });

                container.appendChild(correctDiv);

                if (userPhonemes.length > correctPhonemes.length) {
                    const extraDiv = document.createElement('div');
                    extraDiv.innerHTML = '<strong style="margin-top: 15px; display: block;">Ø£ØµÙˆØ§Øª Ø²Ø§Ø¦Ø¯Ø©:</strong>';

                    for (let i = correctPhonemes.length; i < userPhonemes.length; i++) {
                        const span = document.createElement('span');
                        span.textContent = userPhonemes[i];
                        span.className = 'phoneme-span extra';
                        extraDiv.appendChild(span);
                    }

                    container.appendChild(extraDiv);
                }
            }

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
            function nextQuestion() {
                currentQuestionIndex++;

                if (currentQuestionIndex >= 10) {
                    endGame();
                } else {
                    showQuestion();
                }
            }

            // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function endGame() {
                document.getElementById('final-score').textContent = score;
                showScreen('end-screen');
            }

            // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function restartGame() {
                startLevel(currentLevel);
            }

            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
            function backToStart() {
                showScreen('start-screen');
            }

            // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ù…Ø¹ÙŠÙ†Ø©
            function showScreen(screenId) {
                document.querySelectorAll('.screen').forEach((screen) => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
            }

            // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', function (e) {
                if (document.getElementById('game-screen').classList.contains('active')) {
                    if (e.key === 'Enter') {
                        checkAnswer();
                    } else if (e.key === ' ') {
                        e.preventDefault();
                        speakWord();
                    }
                }
            });

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            document.addEventListener('DOMContentLoaded', function () {
                // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                const gameScreen = document.getElementById('game-screen');
                const observer = new MutationObserver(function (mutations) {
                    mutations.forEach(function (mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (gameScreen.classList.contains('active')) {
                                setTimeout(() => {
                                    document.getElementById('phoneme-input').focus();
                                }, 100);
                            }
                        }
                    });
                });
                observer.observe(gameScreen, { attributes: true });
            });
        </script>
    </body>
</html>
