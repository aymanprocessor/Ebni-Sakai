<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© "Ø§Ø³Ù…Ø¹ - Ù†ÙÙ‘Ø°"</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Arial', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                color: white;
            }

            .game-header {
                text-align: center;
                margin-bottom: 30px;
            }

            .game-title {
                font-size: 2.5rem;
                color: #fff;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                margin-bottom: 10px;
            }

            .level-indicator {
                background: rgba(255, 255, 255, 0.2);
                padding: 15px 25px;
                border-radius: 25px;
                backdrop-filter: blur(10px);
                margin-bottom: 20px;
                font-size: 1.1rem;
                font-weight: bold;
            }

            .instructor-panel {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                border-radius: 15px;
                padding: 20px;
                margin-bottom: 20px;
                width: 100%;
                max-width: 800px;
            }

            .current-instruction {
                font-size: 1.2rem;
                font-weight: bold;
                text-align: center;
                color: #fff;
                margin-bottom: 15px;
            }

            .instructor-controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .btn {
                padding: 10px 20px;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-size: 1rem;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .btn-primary {
                background: linear-gradient(45deg, #ff6b6b, #ffd93d);
                color: white;
            }

            .btn-secondary {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                color: white;
            }

            .btn-success {
                background: linear-gradient(45deg, #56ab2f, #a8e6cf);
                color: white;
            }

            .btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            .game-area {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                padding: 30px;
                width: 100%;
                max-width: 800px;
                min-height: 400px;
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
            }

            .shapes-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                justify-content: center;
                margin-bottom: 30px;
            }

            .shape {
                width: 80px;
                height: 80px;
                border-radius: 15px;
                cursor: grab;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
                font-weight: bold;
                color: white;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                user-select: none;
            }

            .shape:hover {
                transform: scale(1.1);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            }

            .shape.dragging {
                cursor: grabbing;
                transform: rotate(5deg) scale(1.1);
                z-index: 1000;
            }

            .red {
                background: linear-gradient(45deg, #ff6b6b, #ee5a52);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .blue {
                background: linear-gradient(45deg, #2196f3, #1976d2);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .green {
                background: linear-gradient(45deg, #4caf50, #2e7d32);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .yellow {
                background: linear-gradient(45deg, #ffeb3b, #f57c00);
                color: #333;
                text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
            }
            .purple {
                background: linear-gradient(45deg, #9c27b0, #6a1b9a);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .orange {
                background: linear-gradient(45deg, #ff9800, #e65100);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }

            .targets-container {
                display: flex;
                gap: 20px;
                justify-content: center;
                margin-top: 30px;
                flex-wrap: wrap;
            }

            .target-box {
                width: 100px;
                height: 100px;
                border: 3px dashed rgba(255, 255, 255, 0.5);
                border-radius: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.9rem;
                color: rgba(255, 255, 255, 0.8);
                transition: all 0.3s ease;
                background: rgba(255, 255, 255, 0.05);
            }

            .target-box.active {
                border-color: #ffd93d;
                background: rgba(255, 217, 61, 0.2);
                box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
            }

            .target-box.filled {
                border-color: #4ecdc4;
                background: rgba(78, 205, 196, 0.1);
                font-weight: bold;
                font-size: 1rem;
            }

            .progress-bar {
                width: 100%;
                height: 20px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                margin-top: 20px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #4ecdc4, #44a08d);
                width: 0%;
                transition: width 0.5s ease;
                border-radius: 10px;
            }

            .stars-display {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }

            .star {
                font-size: 2rem;
                color: #ffd93d;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                opacity: 0.3;
                transition: all 0.5s ease;
            }

            .star.earned {
                opacity: 1;
                animation: starPulse 0.6s ease-in-out;
            }

            @keyframes starPulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.3);
                }
                100% {
                    transform: scale(1);
                }
            }

            .level-complete {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                display: none;
            }

            .level-complete h2 {
                font-size: 2rem;
                margin-bottom: 20px;
                color: white;
            }

            .celebration {
                font-size: 3rem;
                margin-bottom: 20px;
            }

            .step-counter {
                background: rgba(255, 255, 255, 0.2);
                padding: 10px 15px;
                border-radius: 15px;
                margin-bottom: 20px;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div class="game-header">
            <h1 class="game-title">ğŸ® Ù„Ø¹Ø¨Ø© "Ø§Ø³Ù…Ø¹ - Ù†ÙÙ‘Ø°" ğŸ®</h1>
            <div class="level-indicator">
                <span id="levelDisplay">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: Ù…Ø¨ØªØ¯Ø¦ - Ø®Ø·ÙˆØªØ§Ù†</span>
            </div>
        </div>

        <div class="instructor-panel">
            <div class="current-instruction" id="currentInstruction">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</div>
            <div class="step-counter" id="stepCounter">Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 0</div>
            <div class="instructor-controls">
                <button class="btn btn-primary" onclick="generateNewInstructions()">ğŸ”Š ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</button>
                <button class="btn btn-secondary" onclick="repeatInstructions()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</button>
                <button class="btn btn-success" onclick="nextLevel()">â¬†ï¸ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                <button class="btn btn-secondary" onclick="resetGame()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„</button>
                <button class="btn btn-primary" onclick="showLevelSelector()" style="background: linear-gradient(45deg, #9c27b0, #6a1b9a)">ğŸ“Š Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
            </div>
        </div>

        <div class="game-area">
            <div class="shapes-container" id="shapesContainer">
                <!-- Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ø³ØªÙØ¶Ø§Ù Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
            </div>

            <div class="targets-container" id="targetsContainer">
                <!-- Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø³ØªÙØ¶Ø§Ù Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="stars-display" id="starsDisplay">
                <span class="star">â­</span>
                <span class="star">â­</span>
                <span class="star">â­</span>
            </div>
        </div>

        <div class="level-complete" id="levelCompleteModal">
            <div class="celebration">ğŸ‰ğŸŠâœ¨</div>
            <h2>Ø£Ø­Ø³Ù†Øª! Ù…Ø³ØªÙˆÙ‰ Ù…ÙƒØªÙ…Ù„!</h2>
            <div class="stars-display">
                <span class="star earned">â­</span>
                <span class="star earned">â­</span>
                <span class="star earned">â­</span>
            </div>
            <button class="btn btn-primary" onclick="proceedToNextLevel()" style="margin-top: 20px">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>

        <div class="level-complete" id="levelSelectorModal" style="display: none">
            <div class="celebration">ğŸ“Š</div>
            <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px">
                <button class="btn btn-primary" onclick="jumpToLevel(1)">1ï¸âƒ£ Ù…Ø¨ØªØ¯Ø¦</button>
                <button class="btn btn-primary" onclick="jumpToLevel(2)">2ï¸âƒ£ Ø³Ù‡Ù„</button>
                <button class="btn btn-primary" onclick="jumpToLevel(3)">3ï¸âƒ£ Ù…ØªÙˆØ³Ø·</button>
                <button class="btn btn-primary" onclick="jumpToLevel(4)">4ï¸âƒ£ Ù…ØªÙ‚Ø¯Ù…</button>
                <button class="btn btn-primary" onclick="jumpToLevel(5)">5ï¸âƒ£ ØµØ¹Ø¨</button>
                <button class="btn btn-primary" onclick="jumpToLevel(6)">6ï¸âƒ£ Ø®Ø¨ÙŠØ±</button>
                <button class="btn btn-primary" onclick="jumpToLevel(7)">7ï¸âƒ£ Ø¨Ø·Ù„</button>
            </div>
            <button class="btn btn-secondary" onclick="closeLevelSelector()" style="margin-top: 20px">Ø¥Ù„ØºØ§Ø¡</button>
        </div>

        <script>
            // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
            let currentLevel = 1;
            let currentSteps = [];
            let completedSteps = 0;
            let totalSteps = 2;
            let starsEarned = 0;
            let gameInProgress = false;

            // Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            const colorNames = {
                red: 'Ø£Ø­Ù…Ø±',
                blue: 'Ø£Ø²Ø±Ù‚',
                green: 'Ø£Ø®Ø¶Ø±',
                yellow: 'Ø£ØµÙØ±',
                purple: 'Ø¨Ù†ÙØ³Ø¬ÙŠ',
                orange: 'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ'
            };

            // ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰ - 7 Ù…Ø³ØªÙˆÙŠØ§Øª Ù…ØªØ¯Ø±Ø¬Ø©
            const levelInstructions = {
                1: 2, // Ø®Ø·ÙˆØªØ§Ù† - Ø³Ù‡Ù„ Ø¬Ø¯Ø§Ù‹
                2: 3, // 3 Ø®Ø·ÙˆØ§Øª - Ø³Ù‡Ù„
                3: 4, // 4 Ø®Ø·ÙˆØ§Øª - Ù…ØªÙˆØ³Ø·
                4: 5, // 5 Ø®Ø·ÙˆØ§Øª - Ù…ØªÙˆØ³Ø· ØµØ¹Ø¨
                5: 6, // 6 Ø®Ø·ÙˆØ§Øª - ØµØ¹Ø¨
                6: 7, // 7 Ø®Ø·ÙˆØ§Øª - ØµØ¹Ø¨ Ø¬Ø¯Ø§Ù‹
                7: 8 // 8 Ø®Ø·ÙˆØ§Øª - Ø®Ø¨ÙŠØ±
            };

            const levelNames = {
                1: 'Ù…Ø¨ØªØ¯Ø¦ - Ø®Ø·ÙˆØªØ§Ù†',
                2: 'Ø³Ù‡Ù„ - Ø«Ù„Ø§Ø« Ø®Ø·ÙˆØ§Øª',
                3: 'Ù…ØªÙˆØ³Ø· - Ø£Ø±Ø¨Ø¹ Ø®Ø·ÙˆØ§Øª',
                4: 'Ù…ØªÙ‚Ø¯Ù… - Ø®Ù…Ø³ Ø®Ø·ÙˆØ§Øª',
                5: 'ØµØ¹Ø¨ - Ø³Øª Ø®Ø·ÙˆØ§Øª',
                6: 'Ø®Ø¨ÙŠØ± - Ø³Ø¨Ø¹ Ø®Ø·ÙˆØ§Øª',
                7: 'Ø¨Ø·Ù„ - Ø«Ù…Ø§Ù†ÙŠ Ø®Ø·ÙˆØ§Øª'
            };

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙˆØ§Øª
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let speechSynthesis = window.speechSynthesis;
            let arabicVoice = null;

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØª Ø¹Ø±Ø¨ÙŠ
            function setupVoice() {
                const voices = speechSynthesis.getVoices();
                arabicVoice = voices.find((voice) => voice.lang.includes('ar') || voice.name.includes('Arabic') || voice.name.includes('Ø¹Ø±Ø¨ÙŠ')) || voices[0]; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ø£ÙˆÙ„ ÙƒØ¨Ø¯ÙŠÙ„
            }

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
            speechSynthesis.onvoiceschanged = setupVoice;
            setupVoice();

            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
            function playSound(type) {
                try {
                    if (type === 'success') {
                        // ØµÙˆØª Ø§Ù„Ù†Ø¬Ø§Ø­ - Ù†ØºÙ…Ø© Ù…Ø±ØªÙØ¹Ø©
                        playTone(800, 200);
                        setTimeout(() => playTone(1000, 200), 100);
                        document.body.style.filter = 'brightness(1.2)';
                        setTimeout(() => {
                            document.body.style.filter = 'brightness(1)';
                        }, 200);
                    } else if (type === 'error') {
                        // ØµÙˆØª Ø®Ø·Ø£ - Ù†ØºÙ…Ø© Ù…Ù†Ø®ÙØ¶Ø©
                        playTone(200, 500);
                        document.body.style.filter = 'hue-rotate(180deg)';
                        setTimeout(() => {
                            document.body.style.filter = 'none';
                        }, 300);
                    } else if (type === 'click') {
                        // ØµÙˆØª Ù†Ù‚Ø±Ø© - Ù†ØºÙ…Ø© Ù‚ØµÙŠØ±Ø©
                        playTone(600, 100);
                    }
                } catch (e) {
                    console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                }
            }

            // ØªØ´ØºÙŠÙ„ Ù†ØºÙ…Ø©
            function playTone(frequency, duration) {
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration / 1000);
                } catch (e) {
                    console.log('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø©:', e);
                }
            }

            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ØµÙˆØª
            function speakText(text) {
                try {
                    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙƒÙ„Ø§Ù… Ø³Ø§Ø¨Ù‚
                    speechSynthesis.cancel();

                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = arabicVoice;
                    utterance.rate = 0.8; // Ø³Ø±Ø¹Ø© Ø£Ø¨Ø·Ø£ Ù„Ù„Ø£Ø·ÙØ§Ù„
                    utterance.pitch = 1.2; // Ù†Ø¨Ø±Ø© Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹
                    utterance.volume = 0.8;

                    speechSynthesis.speak(utterance);
                } catch (e) {
                    console.log('ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ:', e);
                }
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø´ÙƒØ§Ù„
            function createShapes() {
                const container = document.getElementById('shapesContainer');
                container.innerHTML = '';

                colors.forEach((color) => {
                    const shape = document.createElement('div');
                    shape.className = `shape ${color}`;
                    shape.draggable = true;
                    shape.textContent = colorNames[color];
                    shape.dataset.color = color;

                    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
                    shape.addEventListener('dragstart', handleDragStart);
                    shape.addEventListener('dragend', handleDragEnd);
                    shape.addEventListener('click', () => playSound('click'));

                    container.appendChild(shape);
                });
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ÙˆØ¶Ø¹
            function createTargets() {
                const container = document.getElementById('targetsContainer');
                container.innerHTML = '';

                for (let i = 0; i < totalSteps; i++) {
                    const target = document.createElement('div');
                    target.className = 'target-box';
                    target.textContent = `Ø§Ù„Ø®Ø·ÙˆØ© ${i + 1}`;
                    target.dataset.step = i;

                    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥ÙÙ„Ø§Øª
                    target.addEventListener('dragover', handleDragOver);
                    target.addEventListener('drop', handleDrop);

                    // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                    target.classList.remove('red', 'blue', 'green', 'yellow', 'purple', 'orange', 'filled');

                    container.appendChild(target);
                }
            }

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø­Ø¨
            function handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.color);
                e.target.classList.add('dragging');
                playSound('click');
            }

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø³Ø­Ø¨ ÙÙˆÙ‚ Ø§Ù„Ù‡Ø¯Ù
            function handleDragOver(e) {
                e.preventDefault();
                e.target.classList.add('active');
            }

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¥ÙÙ„Ø§Øª
            function handleDrop(e) {
                e.preventDefault();
                e.target.classList.remove('active');

                if (!gameInProgress) return;

                const draggedColor = e.dataTransfer.getData('text/plain');
                const stepIndex = parseInt(e.target.dataset.step);
                const expectedColor = currentSteps[stepIndex];

                if (draggedColor === expectedColor && stepIndex === completedSteps) {
                    // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                    e.target.classList.add('filled');
                    e.target.textContent = colorNames[draggedColor];
                    e.target.classList.add(draggedColor); // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ Ø§Ù„Ù„ÙˆÙ†
                    e.target.style.color = draggedColor === 'yellow' ? '#333' : 'white';
                    e.target.style.textShadow = draggedColor === 'yellow' ? '1px 1px 2px rgba(255,255,255,0.8)' : '2px 2px 4px rgba(0,0,0,0.7)';

                    completedSteps++;
                    updateProgress();
                    playSound('success');
                    earnStar();

                    if (completedSteps === totalSteps) {
                        completeLevel();
                    } else {
                        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©
                        const nextStep = completedSteps;
                        const nextColor = currentSteps[nextStep];
                        setTimeout(() => {
                            speakText(`Ø§Ù„Ø¢Ù† Ø§Ù„Ù…Ø³ Ø§Ù„Ù„ÙˆÙ† ${colorNames[nextColor]}`);
                        }, 800);
                    }
                } else {
                    // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                    playSound('error');
                    e.target.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        e.target.style.animation = '';
                    }, 500);
                }
            }

            // ØªÙˆÙ„ÙŠØ¯ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
            function generateNewInstructions() {
                totalSteps = levelInstructions[currentLevel];
                currentSteps = [];
                completedSteps = 0;
                gameInProgress = true;

                // ØªÙˆÙ„ÙŠØ¯ Ø®Ø·ÙˆØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                for (let i = 0; i < totalSteps; i++) {
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    currentSteps.push(randomColor);
                }

                // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
                const instructionText = currentSteps.map((color, index) => `${index + 1}. Ø§Ù„Ù…Ø³ Ø§Ù„Ù„ÙˆÙ† ${colorNames[color]}`).join(' Ø«Ù… ');

                document.getElementById('currentInstruction').textContent = instructionText;
                document.getElementById('stepCounter').textContent = `Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${totalSteps}`;

                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¨Ø§Ù„ØµÙˆØª
                const speechText = currentSteps.map((color, index) => `Ø§Ù„Ø®Ø·ÙˆØ© ${index + 1}: Ø§Ù„Ù…Ø³ Ø§Ù„Ù„ÙˆÙ† ${colorNames[color]}`).join('. ');

                setTimeout(() => {
                    speakText(`Ø§Ø³ØªÙ…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹. ${speechText}`);
                }, 500);

                // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
                createTargets();
                updateProgress();
                resetStars();
                playSound('click');
            }

            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
            function repeatInstructions() {
                if (currentSteps.length > 0) {
                    const instructionText = currentSteps.map((color, index) => `${index + 1}. Ø§Ù„Ù…Ø³ Ø§Ù„Ù„ÙˆÙ† ${colorNames[color]}`).join(' Ø«Ù… ');

                    document.getElementById('currentInstruction').textContent = instructionText;

                    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¨Ø§Ù„ØµÙˆØª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    const speechText = currentSteps.map((color, index) => `Ø§Ù„Ø®Ø·ÙˆØ© ${index + 1}: Ø§Ù„Ù…Ø³ Ø§Ù„Ù„ÙˆÙ† ${colorNames[color]}`).join('. ');

                    speakText(`Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª. ${speechText}`);
                    playSound('click');
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            function updateProgress() {
                const progress = (completedSteps / totalSteps) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            // ÙƒØ³Ø¨ Ù†Ø¬Ù…Ø©
            function earnStar() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                if (starsEarned < stars.length) {
                    stars[starsEarned].classList.add('earned');
                    starsEarned++;
                }
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¬ÙˆÙ…
            function resetStars() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                stars.forEach((star) => star.classList.remove('earned'));
                starsEarned = 0;
            }

            // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            function completeLevel() {
                gameInProgress = false;
                document.getElementById('levelCompleteModal').style.display = 'block';
                playSound('success');

                // Ù‚Ø±Ø§Ø¡Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø©
                setTimeout(() => {
                    speakText('Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!');
                }, 1000);

                // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ø­ØªÙØ§Ù„
                setTimeout(() => {
                    document.body.style.background = 'linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%)';
                    setTimeout(() => {
                        document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }, 1000);
                }, 500);
            }

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ
            function nextLevel() {
                if (currentLevel < 7) {
                    currentLevel++;
                    document.getElementById('levelDisplay').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}: ${levelNames[currentLevel]}`;
                    document.getElementById('currentInstruction').textContent = 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ';
                    resetStars();
                    playSound('click');

                    // Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„ØµÙˆØª
                    setTimeout(() => {
                        speakText(`Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}: ${levelNames[currentLevel]}. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¨Ø¯Ø¡`);
                    }, 500);
                } else {
                    // Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
                    document.getElementById('currentInstruction').textContent = 'ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª! Ø£Ù†Øª Ø¨Ø·Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ! ğŸ‰';
                    setTimeout(() => {
                        speakText('ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø£Ù†Øª Ø¨Ø·Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ø³Ù…Ø¹ ÙˆÙ†ÙØ°!');
                    }, 500);
                }
            }

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ (Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„)
            function proceedToNextLevel() {
                document.getElementById('levelCompleteModal').style.display = 'none';
                nextLevel();
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©
            function resetGame() {
                currentLevel = 1;
                totalSteps = 2;
                completedSteps = 0;
                currentSteps = [];
                gameInProgress = false;

                document.getElementById('levelDisplay').textContent = 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: Ù…Ø¨ØªØ¯Ø¦ - Ø®Ø·ÙˆØªØ§Ù†';
                document.getElementById('currentInstruction').textContent = 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ';
                document.getElementById('stepCounter').textContent = 'Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 0';
                document.getElementById('levelCompleteModal').style.display = 'none';

                createTargets();
                updateProgress();
                resetStars();
                playSound('click');

                // Ø¥Ø¹Ù„Ø§Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
                setTimeout(() => {
                    speakText('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„');
                }, 500);
            }

            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„
            function initializeAudio() {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„
            document.addEventListener('click', initializeAudio, { once: true });
            document.addEventListener('touchstart', initializeAudio, { once: true });

            // ÙˆØ¸Ø§Ø¦Ù Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            function showLevelSelector() {
                document.getElementById('levelSelectorModal').style.display = 'block';
                playSound('click');
            }

            function closeLevelSelector() {
                document.getElementById('levelSelectorModal').style.display = 'none';
                playSound('click');
            }

            function jumpToLevel(level) {
                currentLevel = level;
                totalSteps = levelInstructions[currentLevel];
                completedSteps = 0;
                currentSteps = [];
                gameInProgress = false;

                document.getElementById('levelDisplay').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}: ${levelNames[currentLevel]}`;
                document.getElementById('currentInstruction').textContent = 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ';
                document.getElementById('stepCounter').textContent = 'Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 0';
                document.getElementById('levelSelectorModal').style.display = 'none';

                createTargets();
                updateProgress();
                resetStars();
                playSound('click');

                setTimeout(() => {
                    speakText(`ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}: ${levelNames[currentLevel]}`);
                }, 500);
            }

            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
            const shakeStyle = document.createElement('style');
            shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
            document.head.appendChild(shakeStyle);

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            document.addEventListener('DOMContentLoaded', function () {
                createShapes();
                createTargets();
                updateProgress();
            });
        </script>
    </body>
</html>
