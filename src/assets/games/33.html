<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ŸÑÿπÿ®ÿ© "ÿßÿ≥ŸÖÿπ - ŸÜŸÅŸëÿ∞"</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Arial', sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px;
                color: white;
            }

            .game-header {
                text-align: center;
                margin-bottom: 30px;
            }

            .game-title {
                font-size: 2.5rem;
                color: #fff;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                margin-bottom: 10px;
            }

            .level-indicator {
                background: rgba(255, 255, 255, 0.2);
                padding: 15px 25px;
                border-radius: 25px;
                backdrop-filter: blur(10px);
                margin-bottom: 20px;
                font-size: 1.1rem;
                font-weight: bold;
            }

            .instructor-panel {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(10px);
                border-radius: 15px;
                padding: 20px;
                margin-bottom: 20px;
                width: 100%;
                max-width: 800px;
            }

            .current-instruction {
                font-size: 1.2rem;
                font-weight: bold;
                text-align: center;
                color: #fff;
                margin-bottom: 15px;
            }

            .instructor-controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .btn {
                padding: 10px 20px;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-size: 1rem;
                font-weight: bold;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .btn-primary {
                background: linear-gradient(45deg, #ff6b6b, #ffd93d);
                color: white;
            }

            .btn-secondary {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                color: white;
            }

            .btn-success {
                background: linear-gradient(45deg, #56ab2f, #a8e6cf);
                color: white;
            }

            .btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            .game-area {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 20px;
                padding: 30px;
                width: 100%;
                max-width: 800px;
                min-height: 400px;
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
            }

            .shapes-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                justify-content: center;
                margin-bottom: 30px;
            }

            .shape {
                width: 80px;
                height: 80px;
                border-radius: 15px;
                cursor: grab;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
                font-weight: bold;
                color: white;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                user-select: none;
            }

            .shape:hover {
                transform: scale(1.1);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            }

            .shape.dragging {
                cursor: grabbing;
                transform: rotate(5deg) scale(1.1);
                z-index: 1000;
            }

            .red {
                background: linear-gradient(45deg, #ff6b6b, #ee5a52);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .blue {
                background: linear-gradient(45deg, #2196f3, #1976d2);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .green {
                background: linear-gradient(45deg, #4caf50, #2e7d32);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .yellow {
                background: linear-gradient(45deg, #ffeb3b, #f57c00);
                color: #333;
                text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
            }
            .purple {
                background: linear-gradient(45deg, #9c27b0, #6a1b9a);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }
            .orange {
                background: linear-gradient(45deg, #ff9800, #e65100);
                color: white;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }

            .targets-container {
                display: flex;
                gap: 20px;
                justify-content: center;
                margin-top: 30px;
                flex-wrap: wrap;
            }

            .target-box {
                width: 100px;
                height: 100px;
                border: 3px dashed rgba(255, 255, 255, 0.5);
                border-radius: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.9rem;
                color: rgba(255, 255, 255, 0.8);
                transition: all 0.3s ease;
                background: rgba(255, 255, 255, 0.05);
            }

            .target-box.active {
                border-color: #ffd93d;
                background: rgba(255, 217, 61, 0.2);
                box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
            }

            .target-box.filled {
                border-color: #4ecdc4;
                background: rgba(78, 205, 196, 0.1);
                font-weight: bold;
                font-size: 1rem;
            }

            .progress-bar {
                width: 100%;
                height: 20px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                margin-top: 20px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #4ecdc4, #44a08d);
                width: 0%;
                transition: width 0.5s ease;
                border-radius: 10px;
            }

            .stars-display {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }

            .star {
                font-size: 2rem;
                color: #ffd93d;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                opacity: 0.3;
                transition: all 0.5s ease;
            }

            .star.earned {
                opacity: 1;
                animation: starPulse 0.6s ease-in-out;
            }

            @keyframes starPulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.3);
                }
                100% {
                    transform: scale(1);
                }
            }

            .level-complete {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 2000;
                display: none;
            }

            .level-complete h2 {
                font-size: 2rem;
                margin-bottom: 20px;
                color: white;
            }

            .celebration {
                font-size: 3rem;
                margin-bottom: 20px;
            }

            .step-counter {
                background: rgba(255, 255, 255, 0.2);
                padding: 10px 15px;
                border-radius: 15px;
                margin-bottom: 20px;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div class="game-header">
            <h1 class="game-title">üéÆ ŸÑÿπÿ®ÿ© "ÿßÿ≥ŸÖÿπ - ŸÜŸÅŸëÿ∞" üéÆ</h1>
            <div class="level-indicator">
                <span id="levelDisplay">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 1: ŸÖÿ®ÿ™ÿØÿ¶ - ÿÆÿ∑Ÿàÿ™ÿßŸÜ</span>
            </div>
        </div>

        <div class="instructor-panel">
            <div class="current-instruction" id="currentInstruction">ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä</div>
            <div class="step-counter" id="stepCounter">ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: 0</div>
            <div class="instructor-controls">
                <button class="btn btn-primary" onclick="generateNewInstructions()">üîä ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ©</button>
                <button class="btn btn-secondary" onclick="repeatInstructions()">üîÅ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™</button>
                <button class="btn btn-success" onclick="nextLevel()">‚¨ÜÔ∏è ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ™ÿßŸÑŸä</button>
                <button class="btn btn-secondary" onclick="resetGame()">üîÑ ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ</button>
                <button class="btn btn-primary" onclick="showLevelSelector()" style="background: linear-gradient(45deg, #9c27b0, #6a1b9a)">üìä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ</button>
            </div>
        </div>

        <div class="game-area">
            <div class="shapes-container" id="shapesContainer">
                <!-- ÿßŸÑÿ£ÿ¥ŸÉÿßŸÑ ÿ≥ÿ™Ÿèÿ∂ÿßŸÅ ŸáŸÜÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã -->
            </div>

            <div class="targets-container" id="targetsContainer">
                <!-- ÿ£ŸÖÿßŸÉŸÜ ÿßŸÑŸàÿ∂ÿπ ÿ≥ÿ™Ÿèÿ∂ÿßŸÅ ŸáŸÜÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã -->
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="stars-display" id="starsDisplay">
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
                <span class="star">‚≠ê</span>
            </div>
        </div>

        <div class="level-complete" id="levelCompleteModal">
            <div class="celebration">üéâüéä‚ú®</div>
            <h2>ÿ£ÿ≠ÿ≥ŸÜÿ™! ŸÖÿ≥ÿ™ŸàŸâ ŸÖŸÉÿ™ŸÖŸÑ!</h2>
            <div class="stars-display">
                <span class="star earned">‚≠ê</span>
                <span class="star earned">‚≠ê</span>
                <span class="star earned">‚≠ê</span>
            </div>
            <button class="btn btn-primary" onclick="proceedToNextLevel()" style="margin-top: 20px">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ™ÿßŸÑŸä</button>
        </div>

        <div class="level-complete" id="levelSelectorModal" style="display: none">
            <div class="celebration">üìä</div>
            <h2>ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px">
                <button class="btn btn-primary" onclick="jumpToLevel(1)">1Ô∏è‚É£ ŸÖÿ®ÿ™ÿØÿ¶</button>
                <button class="btn btn-primary" onclick="jumpToLevel(2)">2Ô∏è‚É£ ÿ≥ŸáŸÑ</button>
                <button class="btn btn-primary" onclick="jumpToLevel(3)">3Ô∏è‚É£ ŸÖÿ™Ÿàÿ≥ÿ∑</button>
                <button class="btn btn-primary" onclick="jumpToLevel(4)">4Ô∏è‚É£ ŸÖÿ™ŸÇÿØŸÖ</button>
                <button class="btn btn-primary" onclick="jumpToLevel(5)">5Ô∏è‚É£ ÿµÿπÿ®</button>
                <button class="btn btn-primary" onclick="jumpToLevel(6)">6Ô∏è‚É£ ÿÆÿ®Ÿäÿ±</button>
                <button class="btn btn-primary" onclick="jumpToLevel(7)">7Ô∏è‚É£ ÿ®ÿ∑ŸÑ</button>
            </div>
            <button class="btn btn-secondary" onclick="closeLevelSelector()" style="margin-top: 20px">ÿ•ŸÑÿ∫ÿßÿ°</button>
        </div>

        <script>
            // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©
            let currentLevel = 1;
            let currentSteps = [];
            let completedSteps = 0;
            let totalSteps = 2;
            let starsEarned = 0;
            let gameInProgress = false;

            // ÿßŸÑÿ£ŸÑŸàÿßŸÜ ŸàÿßŸÑÿ£ÿ¥ŸÉÿßŸÑ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
            const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
            const colorNames = {
                red: 'ÿ£ÿ≠ŸÖÿ±',
                blue: 'ÿ£ÿ≤ÿ±ŸÇ',
                green: 'ÿ£ÿÆÿ∂ÿ±',
                yellow: 'ÿ£ÿµŸÅÿ±',
                purple: 'ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä',
                orange: 'ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä'
            };

            // ÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÑŸÉŸÑ ŸÖÿ≥ÿ™ŸàŸâ - 7 ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ŸÖÿ™ÿØÿ±ÿ¨ÿ©
            const levelInstructions = {
                1: 2, // ÿÆÿ∑Ÿàÿ™ÿßŸÜ - ÿ≥ŸáŸÑ ÿ¨ÿØÿßŸã
                2: 3, // 3 ÿÆÿ∑Ÿàÿßÿ™ - ÿ≥ŸáŸÑ
                3: 4, // 4 ÿÆÿ∑Ÿàÿßÿ™ - ŸÖÿ™Ÿàÿ≥ÿ∑
                4: 5, // 5 ÿÆÿ∑Ÿàÿßÿ™ - ŸÖÿ™Ÿàÿ≥ÿ∑ ÿµÿπÿ®
                5: 6, // 6 ÿÆÿ∑Ÿàÿßÿ™ - ÿµÿπÿ®
                6: 7, // 7 ÿÆÿ∑Ÿàÿßÿ™ - ÿµÿπÿ® ÿ¨ÿØÿßŸã
                7: 8 // 8 ÿÆÿ∑Ÿàÿßÿ™ - ÿÆÿ®Ÿäÿ±
            };

            const levelNames = {
                1: 'ŸÖÿ®ÿ™ÿØÿ¶ - ÿÆÿ∑Ÿàÿ™ÿßŸÜ',
                2: 'ÿ≥ŸáŸÑ - ÿ´ŸÑÿßÿ´ ÿÆÿ∑Ÿàÿßÿ™',
                3: 'ŸÖÿ™Ÿàÿ≥ÿ∑ - ÿ£ÿ±ÿ®ÿπ ÿÆÿ∑Ÿàÿßÿ™',
                4: 'ŸÖÿ™ŸÇÿØŸÖ - ÿÆŸÖÿ≥ ÿÆÿ∑Ÿàÿßÿ™',
                5: 'ÿµÿπÿ® - ÿ≥ÿ™ ÿÆÿ∑Ÿàÿßÿ™',
                6: 'ÿÆÿ®Ÿäÿ± - ÿ≥ÿ®ÿπ ÿÆÿ∑Ÿàÿßÿ™',
                7: 'ÿ®ÿ∑ŸÑ - ÿ´ŸÖÿßŸÜŸä ÿÆÿ∑Ÿàÿßÿ™'
            };

            // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ£ÿµŸàÿßÿ™
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let speechSynthesis = window.speechSynthesis;
            let arabicVoice = null;

            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿµŸàÿ™ ÿπÿ±ÿ®Ÿä
            function setupVoice() {
                const voices = speechSynthesis.getVoices();
                arabicVoice = voices.find((voice) => voice.lang.includes('ar') || voice.name.includes('Arabic') || voice.name.includes('ÿπÿ±ÿ®Ÿä')) || voices[0]; // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑÿ£ŸàŸÑ ŸÉÿ®ÿØŸäŸÑ
            }

            // ÿ•ÿπÿØÿßÿØ ÿßŸÑÿµŸàÿ™ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™
            speechSynthesis.onvoiceschanged = setupVoice;
            setupVoice();

            // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™
            function playSound(type) {
                try {
                    if (type === 'success') {
                        // ÿµŸàÿ™ ÿßŸÑŸÜÿ¨ÿßÿ≠ - ŸÜÿ∫ŸÖÿ© ŸÖÿ±ÿ™ŸÅÿπÿ©
                        playTone(800, 200);
                        setTimeout(() => playTone(1000, 200), 100);
                        document.body.style.filter = 'brightness(1.2)';
                        setTimeout(() => {
                            document.body.style.filter = 'brightness(1)';
                        }, 200);
                    } else if (type === 'error') {
                        // ÿµŸàÿ™ ÿÆÿ∑ÿ£ - ŸÜÿ∫ŸÖÿ© ŸÖŸÜÿÆŸÅÿ∂ÿ©
                        playTone(200, 500);
                        document.body.style.filter = 'hue-rotate(180deg)';
                        setTimeout(() => {
                            document.body.style.filter = 'none';
                        }, 300);
                    } else if (type === 'click') {
                        // ÿµŸàÿ™ ŸÜŸÇÿ±ÿ© - ŸÜÿ∫ŸÖÿ© ŸÇÿµŸäÿ±ÿ©
                        playTone(600, 100);
                    }
                } catch (e) {
                    console.log('ÿ™ÿπÿ∞ÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™:', e);
                }
            }

            // ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÜÿ∫ŸÖÿ©
            function playTone(frequency, duration) {
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration / 1000);
                } catch (e) {
                    console.log('ÿ™ÿπÿ∞ÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÜÿ∫ŸÖÿ©:', e);
                }
            }

            // ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÜÿµ ÿ®ÿßŸÑÿµŸàÿ™
            function speakText(text) {
                try {
                    // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ŸÉŸÑÿßŸÖ ÿ≥ÿßÿ®ŸÇ
                    speechSynthesis.cancel();

                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = arabicVoice;
                    utterance.rate = 0.8; // ÿ≥ÿ±ÿπÿ© ÿ£ÿ®ÿ∑ÿ£ ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ
                    utterance.pitch = 1.2; // ŸÜÿ®ÿ±ÿ© ÿ£ÿπŸÑŸâ ŸÇŸÑŸäŸÑÿßŸã
                    utterance.volume = 0.8;

                    speechSynthesis.speak(utterance);
                } catch (e) {
                    console.log('ÿ™ÿπÿ∞ÿ± ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÜÿµ:', e);
                }
            }

            // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ£ÿ¥ŸÉÿßŸÑ
            function createShapes() {
                const container = document.getElementById('shapesContainer');
                container.innerHTML = '';

                colors.forEach((color) => {
                    const shape = document.createElement('div');
                    shape.className = `shape ${color}`;
                    shape.draggable = true;
                    shape.textContent = colorNames[color];
                    shape.dataset.color = color;

                    // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™
                    shape.addEventListener('dragstart', handleDragStart);
                    shape.addEventListener('dragend', handleDragEnd);
                    shape.addEventListener('click', () => playSound('click'));

                    container.appendChild(shape);
                });
            }

            // ÿ•ŸÜÿ¥ÿßÿ° ÿ£ŸÖÿßŸÉŸÜ ÿßŸÑŸàÿ∂ÿπ
            function createTargets() {
                const container = document.getElementById('targetsContainer');
                container.innerHTML = '';

                for (let i = 0; i < totalSteps; i++) {
                    const target = document.createElement('div');
                    target.className = 'target-box';
                    target.textContent = `ÿßŸÑÿÆÿ∑Ÿàÿ© ${i + 1}`;
                    target.dataset.step = i;

                    // ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ•ŸÅŸÑÿßÿ™
                    target.addEventListener('dragover', handleDragOver);
                    target.addEventListener('drop', handleDrop);

                    // ÿ•ÿ≤ÿßŸÑÿ© ŸÉŸÑÿßÿ≥ÿßÿ™ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
                    target.classList.remove('red', 'blue', 'green', 'yellow', 'purple', 'orange', 'filled');

                    container.appendChild(target);
                }
            }

            // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ®ÿØÿ° ÿßŸÑÿ≥ÿ≠ÿ®
            function handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.color);
                e.target.classList.add('dragging');
                playSound('click');
            }

            // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≥ÿ≠ÿ®
            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿ≥ÿ≠ÿ® ŸÅŸàŸÇ ÿßŸÑŸáÿØŸÅ
            function handleDragOver(e) {
                e.preventDefault();
                e.target.classList.add('active');
            }

            // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿ•ŸÅŸÑÿßÿ™
            function handleDrop(e) {
                e.preventDefault();
                e.target.classList.remove('active');

                if (!gameInProgress) return;

                const draggedColor = e.dataTransfer.getData('text/plain');
                const stepIndex = parseInt(e.target.dataset.step);
                const expectedColor = currentSteps[stepIndex];

                if (draggedColor === expectedColor && stepIndex === completedSteps) {
                    // ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©
                    e.target.classList.add('filled');
                    e.target.textContent = colorNames[draggedColor];
                    e.target.classList.add(draggedColor); // ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÑÿßÿ≥ ÿßŸÑŸÑŸàŸÜ
                    e.target.style.color = draggedColor === 'yellow' ? '#333' : 'white';
                    e.target.style.textShadow = draggedColor === 'yellow' ? '1px 1px 2px rgba(255,255,255,0.8)' : '2px 2px 4px rgba(0,0,0,0.7)';

                    completedSteps++;
                    updateProgress();
                    playSound('success');
                    earnStar();

                    if (completedSteps === totalSteps) {
                        completeLevel();
                    } else {
                        // ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©
                        const nextStep = completedSteps;
                        const nextColor = currentSteps[nextStep];
                        setTimeout(() => {
                            speakText(`ÿßŸÑÿ¢ŸÜ ÿßŸÑŸÖÿ≥ ÿßŸÑŸÑŸàŸÜ ${colorNames[nextColor]}`);
                        }, 800);
                    }
                } else {
                    // ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©
                    playSound('error');
                    e.target.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        e.target.style.animation = '';
                    }, 500);
                }
            }

            // ÿ™ŸàŸÑŸäÿØ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ©
            function generateNewInstructions() {
                totalSteps = levelInstructions[currentLevel];
                currentSteps = [];
                completedSteps = 0;
                gameInProgress = true;

                // ÿ™ŸàŸÑŸäÿØ ÿÆÿ∑Ÿàÿßÿ™ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
                for (let i = 0; i < totalSteps; i++) {
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    currentSteps.push(randomColor);
                }

                // ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
                const instructionText = currentSteps.map((color, index) => `${index + 1}. ÿßŸÑŸÖÿ≥ ÿßŸÑŸÑŸàŸÜ ${colorNames[color]}`).join(' ÿ´ŸÖ ');

                document.getElementById('currentInstruction').textContent = instructionText;
                document.getElementById('stepCounter').textContent = `ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: ${totalSteps}`;

                // ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ®ÿßŸÑÿµŸàÿ™
                const speechText = currentSteps.map((color, index) => `ÿßŸÑÿÆÿ∑Ÿàÿ© ${index + 1}: ÿßŸÑŸÖÿ≥ ÿßŸÑŸÑŸàŸÜ ${colorNames[color]}`).join('. ');

                setTimeout(() => {
                    speakText(`ÿßÿ≥ÿ™ŸÖÿπ ÿ¨ŸäÿØÿßŸã. ${speechText}`);
                }, 500);

                // ÿ•ÿπÿßÿØÿ© ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ£ŸáÿØÿßŸÅ
                createTargets();
                updateProgress();
                resetStars();
                playSound('click');
            }

            // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
            function repeatInstructions() {
                if (currentSteps.length > 0) {
                    const instructionText = currentSteps.map((color, index) => `${index + 1}. ÿßŸÑŸÖÿ≥ ÿßŸÑŸÑŸàŸÜ ${colorNames[color]}`).join(' ÿ´ŸÖ ');

                    document.getElementById('currentInstruction').textContent = instructionText;

                    // ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ®ÿßŸÑÿµŸàÿ™ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ
                    const speechText = currentSteps.map((color, index) => `ÿßŸÑÿÆÿ∑Ÿàÿ© ${index + 1}: ÿßŸÑŸÖÿ≥ ÿßŸÑŸÑŸàŸÜ ${colorNames[color]}`).join('. ');

                    speakText(`ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™. ${speechText}`);
                    playSound('click');
                }
            }

            // ÿ™ÿ≠ÿØŸäÿ´ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
            function updateProgress() {
                const progress = (completedSteps / totalSteps) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            // ŸÉÿ≥ÿ® ŸÜÿ¨ŸÖÿ©
            function earnStar() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                if (starsEarned < stars.length) {
                    stars[starsEarned].classList.add('earned');
                    starsEarned++;
                }
            }

            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜÿ¨ŸàŸÖ
            function resetStars() {
                const stars = document.querySelectorAll('#starsDisplay .star');
                stars.forEach((star) => star.classList.remove('earned'));
                starsEarned = 0;
            }

            // ÿ•ŸÉŸÖÿßŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ
            function completeLevel() {
                gameInProgress = false;
                document.getElementById('levelCompleteModal').style.display = 'block';
                playSound('success');

                // ŸÇÿ±ÿßÿ°ÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ŸáŸÜÿ¶ÿ©
                setTimeout(() => {
                    speakText('ÿ£ÿ≠ÿ≥ŸÜÿ™! ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿ®ŸÜÿ¨ÿßÿ≠!');
                }, 1000);

                // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
                setTimeout(() => {
                    document.body.style.background = 'linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%)';
                    setTimeout(() => {
                        document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }, 1000);
                }, 500);
            }

            // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ™ÿßŸÑŸä
            function nextLevel() {
                if (currentLevel < 7) {
                    currentLevel++;
                    document.getElementById('levelDisplay').textContent = `ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${currentLevel}: ${levelNames[currentLevel]}`;
                    document.getElementById('currentInstruction').textContent = 'ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä';
                    resetStars();
                    playSound('click');

                    // ÿ•ÿπŸÑÿßŸÜ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ¨ÿØŸäÿØ ÿ®ÿßŸÑÿµŸàÿ™
                    setTimeout(() => {
                        speakText(`ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${currentLevel}: ${levelNames[currentLevel]}. ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ®ÿØÿ°`);
                    }, 500);
                } else {
                    // ÿ•ŸÜŸáÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™
                    document.getElementById('currentInstruction').textContent = 'üéâ ÿ™ŸáÿßŸÜŸäŸÜÿß! ÿ£ŸÉŸÖŸÑÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™! ÿ£ŸÜÿ™ ÿ®ÿ∑ŸÑ ÿ≠ŸÇŸäŸÇŸä! üéâ';
                    setTimeout(() => {
                        speakText('ÿ™ŸáÿßŸÜŸäŸÜÿß! ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠! ÿ£ŸÜÿ™ ÿ®ÿ∑ŸÑ ÿ≠ŸÇŸäŸÇŸä ŸÅŸä ŸÑÿπÿ®ÿ© ÿßÿ≥ŸÖÿπ ŸàŸÜŸÅÿ∞!');
                    }, 500);
                }
            }

            // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ™ÿßŸÑŸä (ŸÖŸÜ ÿßŸÑŸÖŸàÿØÿßŸÑ)
            function proceedToNextLevel() {
                document.getElementById('levelCompleteModal').style.display = 'none';
                nextLevel();
            }

            // ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©
            function resetGame() {
                currentLevel = 1;
                totalSteps = 2;
                completedSteps = 0;
                currentSteps = [];
                gameInProgress = false;

                document.getElementById('levelDisplay').textContent = 'ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 1: ŸÖÿ®ÿ™ÿØÿ¶ - ÿÆÿ∑Ÿàÿ™ÿßŸÜ';
                document.getElementById('currentInstruction').textContent = 'ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä';
                document.getElementById('stepCounter').textContent = 'ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: 0';
                document.getElementById('levelCompleteModal').style.display = 'none';

                createTargets();
                updateProgress();
                resetStars();
                playSound('click');

                // ÿ•ÿπŸÑÿßŸÜ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
                setTimeout(() => {
                    speakText('ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©. ÿßÿ®ÿØÿ£ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ£ŸàŸÑ');
                }, 500);
            }

            // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿµŸàÿ™ ÿπŸÜÿØ ÿ£ŸàŸÑ ÿ™ŸÅÿßÿπŸÑ
            function initializeAudio() {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }

            // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ŸÑŸÑÿ™ŸÅÿßÿπŸÑ ÿßŸÑÿ£ŸàŸÑ
            document.addEventListener('click', initializeAudio, { once: true });
            document.addEventListener('touchstart', initializeAudio, { once: true });

            // Ÿàÿ∏ÿßÿ¶ŸÅ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ
            function showLevelSelector() {
                document.getElementById('levelSelectorModal').style.display = 'block';
                playSound('click');
            }

            function closeLevelSelector() {
                document.getElementById('levelSelectorModal').style.display = 'none';
                playSound('click');
            }

            function jumpToLevel(level) {
                currentLevel = level;
                totalSteps = levelInstructions[currentLevel];
                completedSteps = 0;
                currentSteps = [];
                gameInProgress = false;

                document.getElementById('levelDisplay').textContent = `ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${currentLevel}: ${levelNames[currentLevel]}`;
                document.getElementById('currentInstruction').textContent = 'ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ "ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ¨ÿØŸäÿØÿ©" ŸÑÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä';
                document.getElementById('stepCounter').textContent = 'ÿßŸÑÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: 0';
                document.getElementById('levelSelectorModal').style.display = 'none';

                createTargets();
                updateProgress();
                resetStars();
                playSound('click');

                setTimeout(() => {
                    speakText(`ÿ™ŸÖ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${currentLevel}: ${levelNames[currentLevel]}`);
                }, 500);
            }

            // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÑŸÑÿ£ÿÆÿ∑ÿßÿ°
            const shakeStyle = document.createElement('style');
            shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
            document.head.appendChild(shakeStyle);

            // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÑÿπÿ®ÿ©
            document.addEventListener('DOMContentLoaded', function () {
                createShapes();
                createTargets();
                updateProgress();
            });
        </script>
    </body>
</html>
