<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ - 10 Ù…Ø³ØªÙˆÙŠØ§Øª</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: white;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .header {
                text-align: center;
                margin-bottom: 30px;
            }

            .title {
                font-size: 2.8rem;
                margin-bottom: 15px;
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
                background: linear-gradient(45deg, #ffd93d, #ff6b6b);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .level-info {
                background: rgba(255, 255, 255, 0.2);
                padding: 15px 30px;
                border-radius: 25px;
                backdrop-filter: blur(10px);
                display: inline-block;
                font-weight: bold;
                font-size: 1.2rem;
                border: 2px solid rgba(255, 255, 255, 0.3);
            }

            .control-panel {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(15px);
                border-radius: 20px;
                padding: 25px;
                margin-bottom: 25px;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }

            .stat-card {
                background: rgba(255, 255, 255, 0.1);
                padding: 15px;
                border-radius: 15px;
                text-align: center;
                border: 1px solid rgba(255, 255, 255, 0.2);
                transition: transform 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-5px);
            }

            .stat-label {
                font-size: 0.9rem;
                opacity: 0.8;
                margin-bottom: 8px;
            }

            .stat-value {
                font-size: 1.8rem;
                font-weight: bold;
                color: #ffd93d;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
                margin-bottom: 20px;
            }

            .btn {
                padding: 15px 30px;
                border: none;
                border-radius: 25px;
                font-size: 1.1rem;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                color: white;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
                position: relative;
                overflow: hidden;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                transition: all 0.3s ease;
            }

            .btn:hover::before {
                width: 200px;
                height: 200px;
            }

            .btn-primary {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
            }
            .btn-secondary {
                background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            }
            .btn-success {
                background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            }
            .btn-warning {
                background: linear-gradient(45deg, #ffa726, #ff7043);
            }

            .btn:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }

            .phase-indicator {
                text-align: center;
                padding: 18px;
                border-radius: 18px;
                font-weight: bold;
                font-size: 1.3rem;
                margin: 15px 0;
                background: linear-gradient(45deg, rgba(255, 217, 61, 0.3), rgba(255, 107, 107, 0.3));
                border: 2px solid #ffd93d;
                backdrop-filter: blur(10px);
            }

            .game-area {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(15px);
                border-radius: 25px;
                padding: 35px;
                min-height: 650px;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .scene-container {
                position: relative;
                width: 100%;
                max-width: 800px;
                height: 500px;
                margin: 0 auto 30px auto;
                border-radius: 25px;
                overflow: hidden;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
                border: 3px solid rgba(255, 255, 255, 0.3);
            }

            .scene {
                width: 100%;
                height: 100%;
                position: relative;
                transition: all 0.5s ease;
            }

            .object {
                position: absolute;
                width: 80px;
                height: 80px;
                font-size: 4rem;
                display: flex;
                align-items: center;
                justify-content: center;
                filter: drop-shadow(4px 4px 8px rgba(0, 0, 0, 0.6));
                transition: all 0.3s ease;
                user-select: none;
                z-index: 10;
                animation: popIn 0.5s ease-out;
            }

            @keyframes popIn {
                0% {
                    transform: scale(0);
                }
                80% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                }
            }

            .drop-zone {
                position: absolute;
                width: 100px;
                height: 100px;
                border: 3px dashed rgba(255, 255, 255, 0.7);
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                transform: translate(-50%, -50%);
                transition: all 0.3s ease;
                font-size: 1.1rem;
                color: rgba(255, 255, 255, 0.9);
                font-weight: bold;
                backdrop-filter: blur(5px);
            }

            .drop-zone.drag-over {
                border-color: #ffd93d;
                background: rgba(255, 217, 61, 0.4);
                box-shadow: 0 0 30px rgba(255, 217, 61, 0.9);
                transform: translate(-50%, -50%) scale(1.3);
            }

            .drop-zone.correct {
                border-color: #56ab2f;
                background: rgba(86, 171, 47, 0.5);
                animation: correctPulse 0.8s ease-in-out;
            }

            .drop-zone.wrong {
                border-color: #ff6b6b;
                background: rgba(255, 107, 107, 0.5);
                animation: wrongShake 0.8s ease-in-out;
            }

            @keyframes correctPulse {
                0%,
                100% {
                    transform: translate(-50%, -50%) scale(1.3);
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.6);
                }
            }

            @keyframes wrongShake {
                0%,
                100% {
                    transform: translate(-50%, -50%);
                }
                25% {
                    transform: translate(-60%, -45%);
                }
                75% {
                    transform: translate(-40%, -55%);
                }
            }

            .objects-panel {
                background: rgba(255, 255, 255, 0.15);
                border-radius: 20px;
                padding: 30px;
                margin: 25px 0;
                text-align: center;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .objects-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 25px;
                max-width: 700px;
                margin: 25px auto 0;
            }

            .draggable-object {
                width: 100px;
                height: 100px;
                background: linear-gradient(45deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
                border-radius: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 4rem;
                cursor: grab;
                transition: all 0.3s ease;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                user-select: none;
                border: 2px solid rgba(255, 255, 255, 0.5);
            }

            .draggable-object:hover:not(.used) {
                transform: scale(1.15) rotate(5deg);
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            }

            .draggable-object:active {
                cursor: grabbing;
            }

            .draggable-object.used {
                opacity: 0.3;
                cursor: not-allowed;
                transform: scale(0.9);
            }

            .countdown {
                text-align: center;
                font-size: 6rem;
                font-weight: bold;
                color: #ff6b6b;
                text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.6);
                margin: 80px 0;
                animation: countdownPulse 1s infinite;
            }

            @keyframes countdownPulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.2);
                }
                100% {
                    transform: scale(1);
                }
            }

            .progress-section {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 30px;
                margin: 40px 0;
                flex-wrap: wrap;
            }

            .progress-bar {
                width: 350px;
                height: 30px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 20px;
                overflow: hidden;
                border: 2px solid rgba(255, 255, 255, 0.3);
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #4ecdc4, #44a08d, #56ab2f);
                width: 0%;
                transition: width 1s ease;
                position: relative;
            }

            .progress-fill::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
                animation: progressShine 2s infinite;
            }

            @keyframes progressShine {
                0% {
                    left: -100%;
                }
                100% {
                    left: 100%;
                }
            }

            .stars {
                display: flex;
                gap: 15px;
            }

            .star {
                font-size: 3rem;
                color: #ffd93d;
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
                opacity: 0.3;
                transition: all 0.6s ease;
            }

            .star.earned {
                opacity: 1;
                transform: scale(1.3) rotate(360deg);
                animation: starGlow 2s infinite alternate;
            }

            @keyframes starGlow {
                0% {
                    filter: drop-shadow(0 0 10px #ffd93d);
                }
                100% {
                    filter: drop-shadow(0 0 20px #ffd93d);
                }
            }

            .hints-panel {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 18px;
                padding: 25px;
                margin: 25px 0;
                text-align: center;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .hint-text {
                font-size: 1.2rem;
                margin-bottom: 15px;
                min-height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.5s ease;
            }

            @keyframes fadeIn {
                0% {
                    opacity: 0;
                    transform: translateY(10px);
                }
                100% {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(5px);
            }

            .modal-content {
                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                padding: 60px;
                border-radius: 30px;
                text-align: center;
                box-shadow: 0 30px 70px rgba(0, 0, 0, 0.6);
                max-width: 600px;
                width: 90%;
                border: 3px solid rgba(255, 255, 255, 0.3);
            }

            .modal h2 {
                font-size: 2.5rem;
                margin-bottom: 25px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .celebration {
                font-size: 5rem;
                margin-bottom: 30px;
                animation: bounce 1s infinite;
            }

            @keyframes bounce {
                0%,
                100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-30px);
                }
            }

            .difficulty-indicator {
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.2);
                padding: 10px 20px;
                border-radius: 20px;
                font-weight: bold;
                backdrop-filter: blur(10px);
            }

            .timer-display {
                position: absolute;
                top: 20px;
                left: 20px;
                background: rgba(255, 107, 107, 0.3);
                padding: 10px 20px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 1.5rem;
                backdrop-filter: blur(10px);
                border: 2px solid #ff6b6b;
            }

            .hidden {
                display: none !important;
            }

            @media (max-width: 768px) {
                .title {
                    font-size: 2.2rem;
                }

                .scene-container {
                    height: 400px;
                }

                .object,
                .draggable-object {
                    width: 70px;
                    height: 70px;
                    font-size: 3rem;
                }

                .stats {
                    grid-template-columns: repeat(2, 1fr);
                }

                .progress-section {
                    flex-direction: column;
                    gap: 20px;
                }

                .progress-bar {
                    width: 280px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ  Ù„Ø¹Ø¨Ø© Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±Ø© ğŸ§ </h1>
                <div class="level-info">
                    <span id="levelDisplay">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: ØºØ±ÙØ© Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¨Ø³ÙŠØ·Ø©</span>
                </div>
            </div>

            <div class="control-panel">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                        <div class="stat-value" id="currentLevel">1</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ø£Ø´ÙŠØ§Ø¡</div>
                        <div class="stat-value" id="objectsCount">2</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ÙˆÙ‚Øª Ø§Ù„Ø¹Ø±Ø¶</div>
                        <div class="stat-value" id="studyTime">12</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                        <div class="stat-value" id="successRate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ù†Ø¬ÙˆÙ…</div>
                        <div class="stat-value" id="totalStars">0</div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="startBtn">ğŸ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
                    <button class="btn btn-secondary" id="nextBtn">â¬†ï¸ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</button>
                    <button class="btn btn-success" id="hintBtn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
                    <button class="btn btn-warning" id="resetBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡</button>
                </div>

                <div class="phase-indicator" id="phaseIndicator">ğŸ“š Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰" Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø£Ø´ÙŠØ§Ø¡</div>
            </div>

            <div class="game-area">
                <div class="timer-display hidden" id="timerDisplay">â° 12</div>
                <div class="difficulty-indicator" id="difficultyIndicator">Ø³Ù‡Ù„ ğŸŸ¢</div>
                <div class="countdown hidden" id="countdown">3</div>

                <div class="scene-container">
                    <div class="scene" id="scene"></div>
                </div>

                <div class="objects-panel hidden" id="objectsPanel">
                    <h3>ğŸ¯ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù…ÙˆØ§Ù‚Ø¹Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø©</h3>
                    <div class="objects-grid" id="objectsGrid"></div>
                </div>

                <div class="hints-panel">
                    <div class="hint-text" id="hintText">ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ©</div>
                </div>

                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="stars" id="stars">
                        <span class="star">â­</span>
                        <span class="star">â­</span>
                        <span class="star">â­</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="modal">
            <div class="modal-content">
                <div class="celebration">ğŸ‰</div>
                <h2 id="modalTitle">Ù…Ø¨Ø±ÙˆÙƒ!</h2>
                <div id="modalMessage">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!</div>
                <button class="btn btn-primary" id="continueBtn" style="margin-top: 25px">Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</button>
            </div>
        </div>

        <script>
            // Game variables
            let currentLevel = 1;
            let gamePhase = 'waiting';
            let studyTimer = null;
            let distractionTimer = null;
            let autoStartTimer = null;
            let correctPlacements = 0;
            let totalAttempts = 0;
            let hintsUsed = 0;
            let starsEarned = 0;
            let totalStarsCollected = 0;

            // Sound context
            let audioContext = null;

            // Auto-start configuration
            const AUTO_START_DELAY = 2000; // 2 seconds delay before auto-start

            // Initialize audio context
            function initAudio() {
                if (!audioContext) {
                    try {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (e) {
                        console.log('Audio not supported');
                    }
                }
            }

            // Enhanced sound functions
            function playSound(frequency, duration, type = 'sine') {
                initAudio();
                if (!audioContext) return;

                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }

            function playSuccessSound() {
                playSound(659, 0.2); // E5
                setTimeout(() => playSound(784, 0.2), 100); // G5
                setTimeout(() => playSound(1047, 0.3), 200); // C6
            }

            function playErrorSound() {
                playSound(220, 0.3, 'square'); // A3
            }

            function playButtonSound() {
                playSound(440, 0.1); // A4
            }

            function playCountdownSound() {
                playSound(800, 0.2);
            }

            // Game data with 10 levels
            const levels = [
                {
                    name: 'ØºØ±ÙØ© Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¨Ø³ÙŠØ·Ø©',
                    background: 'linear-gradient(135deg, #8EC5FC 0%, #E0C3FC 100%)',
                    objects: 2,
                    studyTime: 12,
                    distractionTime: 3,
                    difficulty: 'Ø³Ù‡Ù„ ğŸŸ¢',
                    items: ['ğŸ›ï¸', 'ğŸ•¯ï¸'],
                    positions: [
                        { left: '25%', top: '40%' },
                        { left: '70%', top: '30%' }
                    ],
                    hints: ['ğŸ›ï¸ Ø§Ù„Ø³Ø±ÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± Ù…Ù† Ø§Ù„ØºØ±ÙØ©', 'ğŸ•¯ï¸ Ø§Ù„Ø´Ù…Ø¹Ø© Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† Ø§Ù„Ø¹Ù„ÙˆÙŠ']
                },
                {
                    name: 'Ø§Ù„Ù…Ø·Ø¨Ø® Ø§Ù„ØµØºÙŠØ±',
                    background: 'linear-gradient(135deg, #FFF3B4 0%, #FFAAA5 100%)',
                    objects: 3,
                    studyTime: 10,
                    distractionTime: 3,
                    difficulty: 'Ø³Ù‡Ù„ ğŸŸ¢',
                    items: ['ğŸ', 'â˜•', 'ğŸ¥„'],
                    positions: [
                        { left: '30%', top: '45%' },
                        { left: '60%', top: '25%' },
                        { left: '45%', top: '65%' }
                    ],
                    hints: ['ğŸ Ø§Ù„ØªÙØ§Ø­Ø© Ø¹Ù„Ù‰ Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¹Ø§Ù… ÙÙŠ Ø§Ù„ÙˆØ³Ø· Ø§Ù„Ø£ÙŠØ³Ø±', 'â˜• ÙÙ†Ø¬Ø§Ù† Ø§Ù„Ù‚Ù‡ÙˆØ© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¯ Ø§Ù„Ø£ÙŠÙ…Ù†']
                },
                {
                    name: 'Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡',
                    background: 'linear-gradient(135deg, #92FE9D 0%, #00C9FF 100%)',
                    objects: 3,
                    studyTime: 9,
                    distractionTime: 4,
                    difficulty: 'Ø³Ù‡Ù„ ğŸŸ¢',
                    items: ['ğŸŒ¸', 'ğŸ¦‹', 'ğŸŒ³'],
                    positions: [
                        { left: '30%', top: '40%' },
                        { left: '60%', top: '25%' },
                        { left: '75%', top: '70%' }
                    ],
                    hints: ['ğŸŒ¸ Ø§Ù„ÙˆØ±Ø¯Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±', 'ğŸ¦‹ Ø§Ù„ÙØ±Ø§Ø´Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø© ØªØ·ÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙˆØ³Ø· Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©']
                },
                {
                    name: 'ØºØ±ÙØ© Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ù…Ø±Ø­Ø©',
                    background: 'linear-gradient(135deg, #FFD3A5 0%, #FD9853 100%)',
                    objects: 4,
                    studyTime: 8,
                    distractionTime: 4,
                    difficulty: 'Ù…ØªÙˆØ³Ø· ğŸŸ¡',
                    items: ['ğŸ§¸', 'ğŸ¨', 'ğŸ“š', 'ğŸš—'],
                    positions: [
                        { left: '20%', top: '50%' },
                        { left: '45%', top: '25%' },
                        { left: '70%', top: '60%' },
                        { left: '55%', top: '75%' }
                    ],
                    hints: ['ğŸ§¸ Ø§Ù„Ø¯Ø¨Ø¯ÙˆØ¨ Ø§Ù„ØµØºÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±ÙŠÙƒØ© ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø±', 'ğŸ“š Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ù…Ø±ØªØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†']
                },
                {
                    name: 'Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…',
                    background: 'linear-gradient(135deg, #A8EDEA 0%, #FED6E3 100%)',
                    objects: 4,
                    studyTime: 7,
                    distractionTime: 4,
                    difficulty: 'Ù…ØªÙˆØ³Ø· ğŸŸ¡',
                    items: ['ğŸ“', 'ğŸ', 'ğŸ–ï¸', 'ğŸ“–'],
                    positions: [
                        { left: '25%', top: '30%' },
                        { left: '50%', top: '55%' },
                        { left: '75%', top: '35%' },
                        { left: '40%', top: '70%' }
                    ],
                    hints: ['ğŸ“ Ø§Ù„Ù…Ø³Ø·Ø±Ø© Ø¹Ù„Ù‰ Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰', 'ğŸ–ï¸ Ø§Ù„Ø£Ù‚Ù„Ø§Ù… Ø§Ù„Ù…Ù„ÙˆÙ†Ø© ÙÙŠ Ø¹Ù„Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† Ø§Ù„Ø¹Ù„ÙˆÙŠ']
                },
                {
                    name: 'Ø§Ù„ØµØ§Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©',
                    background: 'linear-gradient(135deg, #D299C2 0%, #FED6E3 100%)',
                    objects: 5,
                    studyTime: 6,
                    distractionTime: 5,
                    difficulty: 'Ù…ØªÙˆØ³Ø· ğŸŸ¡',
                    items: ['ğŸ“º', 'ğŸ›‹ï¸', 'ğŸ•°ï¸', 'ğŸ–¼ï¸', 'ğŸŒ±'],
                    positions: [
                        { left: '50%', top: '25%' },
                        { left: '30%', top: '60%' },
                        { left: '70%', top: '20%' },
                        { left: '15%', top: '30%' },
                        { left: '80%', top: '65%' }
                    ],
                    hints: ['ğŸ“º Ø§Ù„ØªÙ„ÙØ§Ø² Ø§Ù„ÙƒØ¨ÙŠØ± Ù…Ø¹Ù„Ù‚ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ', 'ğŸ•°ï¸ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø£Ù†ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø¦Ø· Ø§Ù„Ø£ÙŠÙ…Ù† ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰']
                },
                {
                    name: 'Ù…ØªØ¬Ø± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ù„ÙˆÙ†',
                    background: 'linear-gradient(135deg, #FF9A9E 0%, #FECFEF 50%, #FECFEF 100%)',
                    objects: 5,
                    studyTime: 5,
                    distractionTime: 5,
                    difficulty: 'ØµØ¹Ø¨ ğŸŸ ',
                    items: ['ğŸˆ', 'ğŸ¯', 'ğŸ§©', 'ğŸª', 'ğŸ­'],
                    positions: [
                        { left: '20%', top: '25%' },
                        { left: '45%', top: '45%' },
                        { left: '70%', top: '25%' },
                        { left: '30%', top: '70%' },
                        { left: '65%', top: '70%' }
                    ],
                    hints: ['ğŸˆ Ø§Ù„Ø¨Ø§Ù„ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù„ÙˆÙ†Ø© ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰ Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±', 'ğŸª Ø®ÙŠÙ…Ø© Ø§Ù„Ø³ÙŠØ±Ùƒ Ø§Ù„ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± Ø§Ù„Ø³ÙÙ„ÙŠ']
                },
                {
                    name: 'Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø©',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    objects: 6,
                    studyTime: 4,
                    distractionTime: 5,
                    difficulty: 'ØµØ¹Ø¨ ğŸŸ ',
                    items: ['ğŸ“š', 'ğŸ–Šï¸', 'ğŸ’¡', 'ğŸ—‚ï¸', 'ğŸª‘', 'ğŸŒ¿'],
                    positions: [
                        { left: '15%', top: '30%' },
                        { left: '35%', top: '50%' },
                        { left: '55%', top: '20%' },
                        { left: '75%', top: '45%' },
                        { left: '25%', top: '75%' },
                        { left: '70%', top: '75%' }
                    ],
                    hints: ['ğŸ“š Ø±Ù Ø§Ù„ÙƒØªØ¨ Ø§Ù„ÙƒØ¨ÙŠØ± ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø©', 'ğŸ’¡ Ù…ØµØ¨Ø§Ø­ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¶ÙŠØ¡ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©']
                },
                {
                    name: 'Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¹Ù„Ù…ÙŠ',
                    background: 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)',
                    objects: 6,
                    studyTime: 4,
                    distractionTime: 6,
                    difficulty: 'ØµØ¹Ø¨ ğŸŸ ',
                    items: ['ğŸ§ª', 'ğŸ”¬', 'âš—ï¸', 'ğŸ“Š', 'ğŸ§¬', 'ğŸ¥½'],
                    positions: [
                        { left: '20%', top: '40%' },
                        { left: '45%', top: '25%' },
                        { left: '70%', top: '35%' },
                        { left: '30%', top: '65%' },
                        { left: '60%', top: '70%' },
                        { left: '80%', top: '60%' }
                    ],
                    hints: ['ğŸ”¬ Ø§Ù„Ù…Ø¬Ù‡Ø± Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰', 'ğŸ§ª Ø£Ù†Ø¨ÙˆØ¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± Ù…Ù† Ø§Ù„Ù…Ø®ØªØ¨Ø±']
                },
                {
                    name: 'Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø³Ø­Ø±ÙŠ',
                    background: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    objects: 7,
                    studyTime: 3,
                    distractionTime: 6,
                    difficulty: 'ØµØ¹Ø¨ Ø¬Ø¯Ø§Ù‹ ğŸ”´',
                    items: ['ğŸ‘‘', 'ğŸ—¡ï¸', 'ğŸ’', 'ğŸº', 'ğŸ•¯ï¸', 'ğŸ“œ', 'ğŸ”®'],
                    positions: [
                        { left: '15%', top: '25%' },
                        { left: '35%', top: '45%' },
                        { left: '55%', top: '20%' },
                        { left: '75%', top: '40%' },
                        { left: '25%', top: '70%' },
                        { left: '50%', top: '75%' },
                        { left: '80%', top: '70%' }
                    ],
                    hints: ['ğŸ‘‘ Ø§Ù„ØªØ§Ø¬ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ù„Ø§Ù…Ø¹ ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰ Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ù…Ù† Ø§Ù„Ù‚ØµØ±', 'ğŸ”® Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø¨Ù„ÙˆØ±ÙŠØ© Ø§Ù„Ø³Ø­Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø§Ù„Ø³ÙÙ„Ù‰']
                }
            ];

            // Get current level data
            function getCurrentLevel() {
                return levels[currentLevel - 1] || levels[0];
            }

            // Start level automatically
            function autoStartLevel() {
                if (gamePhase !== 'waiting') return;

                document.getElementById('phaseIndicator').textContent = 'â° Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†...';

                let countdown = 3;
                const countdownElement = document.getElementById('phaseIndicator');

                autoStartTimer = setInterval(() => {
                    countdownElement.textContent = `ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø®Ù„Ø§Ù„ ${countdown}...`;
                    playCountdownSound();
                    countdown--;

                    if (countdown < 0) {
                        clearInterval(autoStartTimer);
                        startLevel();
                    }
                }, 1000);
            }

            // Start level
            function startLevel() {
                if (gamePhase !== 'waiting') return;

                // Clear any existing auto-start timer
                if (autoStartTimer) {
                    clearInterval(autoStartTimer);
                    autoStartTimer = null;
                }

                playButtonSound();
                gamePhase = 'studying';
                const level = getCurrentLevel();

                // Disable start button and enable it again after level completion
                const startBtn = document.getElementById('startBtn');
                startBtn.disabled = true;
                startBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù„Ø¹Ø¨...';

                document.getElementById('phaseIndicator').textContent = 'ğŸ‘€ Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ ÙˆØ§Ø­ÙØ¸ Ù…ÙˆØ§Ù‚Ø¹Ù‡Ø§ Ø¨Ø¹Ù†Ø§ÙŠØ©!';
                document.getElementById('timerDisplay').classList.remove('hidden');

                // Reset hint button
                const hintBtn = document.getElementById('hintBtn');
                hintBtn.disabled = false;
                hintBtn.textContent = 'ğŸ’¡ ØªÙ„Ù…ÙŠØ­';

                showStudyPhase();
            }

            // Show study phase
            function showStudyPhase() {
                const level = getCurrentLevel();
                const scene = document.getElementById('scene');

                scene.style.background = level.background;
                scene.innerHTML = '';

                // Add objects with animation delay
                level.items.forEach((item, index) => {
                    setTimeout(() => {
                        const object = document.createElement('div');
                        object.className = 'object';
                        object.textContent = item;
                        object.style.left = level.positions[index].left;
                        object.style.top = level.positions[index].top;
                        scene.appendChild(object);
                        playSound(600 + index * 100, 0.1);
                    }, index * 200);
                });

                // Start timer
                let timeLeft = level.studyTime;
                document.getElementById('timerDisplay').textContent = `â° ${timeLeft}`;

                studyTimer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timerDisplay').textContent = `â° ${timeLeft}`;

                    if (timeLeft <= 3 && timeLeft > 0) {
                        playCountdownSound();
                    }

                    if (timeLeft <= 0) {
                        clearInterval(studyTimer);
                        document.getElementById('timerDisplay').classList.add('hidden');
                        startDistraction();
                    }
                }, 1000);
            }

            // Start distraction phase
            function startDistraction() {
                gamePhase = 'distraction';
                document.getElementById('scene').innerHTML = '';
                document.getElementById('phaseIndicator').textContent = 'ğŸ”¢ Ø¹Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹ ÙˆØ±ÙƒØ²!';

                const level = getCurrentLevel();
                let timeLeft = level.distractionTime;
                const countdownEl = document.getElementById('countdown');

                countdownEl.classList.remove('hidden');
                countdownEl.textContent = timeLeft;

                distractionTimer = setInterval(() => {
                    timeLeft--;
                    if (timeLeft > 0) {
                        countdownEl.textContent = timeLeft;
                        playCountdownSound();
                    } else {
                        countdownEl.classList.add('hidden');
                        clearInterval(distractionTimer);
                        startRecall();
                    }
                }, 1000);
            }

            // Start recall phase
            function startRecall() {
                gamePhase = 'recall';
                document.getElementById('phaseIndicator').textContent = 'ğŸ¯ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù…ÙˆØ§Ù‚Ø¹Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø©!';

                setupDropZones();
                setupDraggableObjects();
                document.getElementById('objectsPanel').classList.remove('hidden');
            }

            // Setup drop zones
            function setupDropZones() {
                const level = getCurrentLevel();
                const scene = document.getElementById('scene');
                scene.innerHTML = '';

                level.positions.forEach((position, index) => {
                    const dropZone = document.createElement('div');
                    dropZone.className = 'drop-zone';
                    dropZone.style.left = position.left;
                    dropZone.style.top = position.top;
                    dropZone.dataset.position = index;
                    dropZone.textContent = index + 1;

                    dropZone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        dropZone.classList.add('drag-over');
                    });

                    dropZone.addEventListener('dragleave', () => {
                        dropZone.classList.remove('drag-over');
                    });

                    dropZone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        dropZone.classList.remove('drag-over');
                        handleDrop(e, dropZone);
                    });

                    scene.appendChild(dropZone);
                });
            }

            // Setup draggable objects with touch support
            function setupDraggableObjects() {
                const level = getCurrentLevel();
                const grid = document.getElementById('objectsGrid');
                grid.innerHTML = '';

                const shuffled = [...level.items].sort(() => Math.random() - 0.5);

                shuffled.forEach((item) => {
                    const originalIndex = level.items.indexOf(item);
                    const draggable = document.createElement('div');
                    draggable.className = 'draggable-object';
                    draggable.textContent = item;
                    draggable.draggable = true;
                    draggable.dataset.item = item;
                    draggable.dataset.originalIndex = originalIndex;

                    // Desktop drag events
                    draggable.addEventListener('dragstart', (e) => {
                        playButtonSound();
                        e.dataTransfer.setData(
                            'text/plain',
                            JSON.stringify({
                                item: item,
                                originalIndex: originalIndex
                            })
                        );
                    });

                    // Touch events for mobile
                    let isDragging = false;
                    let startX, startY;
                    let draggedElement = null;

                    draggable.addEventListener('touchstart', (e) => {
                        if (draggable.classList.contains('used')) return;

                        e.preventDefault();
                        playButtonSound();
                        isDragging = true;

                        const touch = e.touches[0];
                        startX = touch.clientX;
                        startY = touch.clientY;

                        draggedElement = draggable.cloneNode(true);
                        draggedElement.style.position = 'fixed';
                        draggedElement.style.zIndex = '3000';
                        draggedElement.style.pointerEvents = 'none';
                        draggedElement.style.transform = 'scale(1.2)';
                        draggedElement.style.opacity = '0.8';
                        document.body.appendChild(draggedElement);

                        updateDraggedElementPosition(touch.clientX, touch.clientY);
                    });

                    draggable.addEventListener('touchmove', (e) => {
                        if (!isDragging || !draggedElement) return;
                        e.preventDefault();

                        const touch = e.touches[0];
                        updateDraggedElementPosition(touch.clientX, touch.clientY);

                        // Highlight drop zones
                        const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                        const dropZone = elementBelow?.closest('.drop-zone');

                        document.querySelectorAll('.drop-zone').forEach((zone) => {
                            zone.classList.remove('drag-over');
                        });

                        if (dropZone && !dropZone.classList.contains('filled')) {
                            dropZone.classList.add('drag-over');
                        }
                    });

                    draggable.addEventListener('touchend', (e) => {
                        if (!isDragging || !draggedElement) return;

                        const touch = e.changedTouches[0];
                        const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                        const dropZone = elementBelow?.closest('.drop-zone');

                        if (dropZone && !dropZone.classList.contains('filled')) {
                            // Create a fake drop event
                            const fakeDropEvent = {
                                preventDefault: () => {},
                                dataTransfer: {
                                    getData: () =>
                                        JSON.stringify({
                                            item: item,
                                            originalIndex: originalIndex
                                        })
                                }
                            };
                            handleDrop(fakeDropEvent, dropZone);
                        }

                        // Cleanup
                        isDragging = false;
                        if (draggedElement) {
                            document.body.removeChild(draggedElement);
                            draggedElement = null;
                        }

                        document.querySelectorAll('.drop-zone').forEach((zone) => {
                            zone.classList.remove('drag-over');
                        });
                    });

                    function updateDraggedElementPosition(x, y) {
                        if (draggedElement) {
                            draggedElement.style.left = x - 40 + 'px';
                            draggedElement.style.top = y - 40 + 'px';
                        }
                    }

                    grid.appendChild(draggable);
                });
            }

            // Handle drop
            function handleDrop(e, dropZone) {
                if (dropZone.classList.contains('filled')) return;

                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                const targetPosition = parseInt(dropZone.dataset.position);

                dropZone.classList.add('filled');
                dropZone.textContent = data.item;
                dropZone.style.fontSize = '3.5rem';

                totalAttempts++;

                if (targetPosition === data.originalIndex) {
                    // Correct!
                    dropZone.classList.add('correct');
                    correctPlacements++;
                    earnStar();
                    playSuccessSound();

                    // Mark object as used
                    const objects = document.querySelectorAll('.draggable-object');
                    objects.forEach((obj) => {
                        if (obj.dataset.item === data.item) {
                            obj.classList.add('used');
                            obj.draggable = false;
                        }
                    });

                    if (correctPlacements === getCurrentLevel().objects) {
                        setTimeout(completeLevel, 1500);
                    }
                } else {
                    // Wrong
                    dropZone.classList.add('wrong');
                    playErrorSound();
                    setTimeout(() => {
                        dropZone.classList.remove('filled', 'wrong');
                        dropZone.textContent = targetPosition + 1;
                        dropZone.style.fontSize = '';
                    }, 1500);
                }

                updateProgress();
                updateStats();
            }

            // Complete level
            function completeLevel() {
                gamePhase = 'completed';
                totalStarsCollected += starsEarned;
                const modal = document.getElementById('modal');

                playSound(523, 0.3); // C5
                setTimeout(() => playSound(659, 0.3), 150); // E5
                setTimeout(() => playSound(784, 0.5), 300); // G5

                if (currentLevel === levels.length) {
                    document.getElementById('modalTitle').textContent = 'ğŸ† ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª!';
                    document.getElementById('modalMessage').textContent = `Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø¬ÙˆÙ…: ${totalStarsCollected} â­`;
                } else {
                    document.getElementById('modalTitle').textContent = `âœ¨ Ø±Ø§Ø¦Ø¹! Ø£ÙƒÙ…Ù„Øª ${getCurrentLevel().name}`;
                    document.getElementById('modalMessage').textContent = `Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${starsEarned} Ù†Ø¬ÙˆÙ… Ù…Ù† 3! ğŸŒŸ`;
                }

                modal.classList.remove('hidden');
            }

            // Earn star
            function earnStar() {
                const stars = document.querySelectorAll('.star');
                if (starsEarned < stars.length) {
                    stars[starsEarned].classList.add('earned');
                    starsEarned++;
                    playSound(880, 0.3); // A5
                }
            }

            // Update progress
            function updateProgress() {
                const progress = (correctPlacements / getCurrentLevel().objects) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }

            // Update stats
            function updateStats() {
                document.getElementById('currentLevel').textContent = currentLevel;
                document.getElementById('objectsCount').textContent = getCurrentLevel().objects;
                document.getElementById('totalStars').textContent = totalStarsCollected;

                const rate = totalAttempts > 0 ? Math.round((correctPlacements / totalAttempts) * 100) : 0;
                document.getElementById('successRate').textContent = rate + '%';
            }

            // Update level display
            function updateLevelDisplay() {
                const level = getCurrentLevel();
                document.getElementById('levelDisplay').textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}: ${level.name}`;
                document.getElementById('studyTime').textContent = level.studyTime;
                document.getElementById('difficultyIndicator').textContent = level.difficulty;
            }

            // Reset level
            function resetLevel() {
                if (studyTimer) clearInterval(studyTimer);
                if (distractionTimer) clearInterval(distractionTimer);
                if (autoStartTimer) clearInterval(autoStartTimer);

                gamePhase = 'waiting';
                correctPlacements = 0;
                totalAttempts = 0;
                hintsUsed = 0;
                starsEarned = 0;

                // Reset start button
                const startBtn = document.getElementById('startBtn');
                startBtn.disabled = false;
                startBtn.textContent = 'ğŸ¯ Ø¨Ø¯Ø¡ ÙŠØ¯ÙˆÙŠ';

                // Reset hint button
                const hintBtn = document.getElementById('hintBtn');
                hintBtn.disabled = false;
                hintBtn.textContent = 'ğŸ’¡ ØªÙ„Ù…ÙŠØ­';

                document.getElementById('objectsPanel').classList.add('hidden');
                document.getElementById('countdown').classList.add('hidden');
                document.getElementById('modal').classList.add('hidden');
                document.getElementById('timerDisplay').classList.add('hidden');
                document.getElementById('phaseIndicator').textContent = 'ğŸ® Ø§Ø³ØªØ¹Ø¯! Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù‚Ø±ÙŠØ¨Ø§Ù‹...';
                document.getElementById('hintText').textContent = 'ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ©';

                const scene = document.getElementById('scene');
                scene.innerHTML = '';
                scene.style.background = getCurrentLevel().background;

                const stars = document.querySelectorAll('.star');
                stars.forEach((star) => star.classList.remove('earned'));

                updateProgress();
                updateStats();
                updateLevelDisplay();

                // Auto-start the level after a short delay
                setTimeout(autoStartLevel, AUTO_START_DELAY);
            }

            // Next level
            function nextLevel() {
                playButtonSound();
                if (currentLevel < levels.length) {
                    currentLevel++;
                } else {
                    currentLevel = 1;
                    totalStarsCollected = 0;
                }
                resetLevel();
            }

            // Show hint
            function showHint() {
                if (gamePhase !== 'recall' || hintsUsed >= 2) return;

                playButtonSound();
                const level = getCurrentLevel();
                const hintBtn = document.getElementById('hintBtn');

                if (hintsUsed < level.hints.length) {
                    document.getElementById('hintText').textContent = level.hints[hintsUsed];
                    hintsUsed++;

                    // Update hint button text
                    if (hintsUsed >= level.hints.length) {
                        hintBtn.disabled = true;
                        hintBtn.textContent = 'âŒ Ù†ÙØ¯Øª Ø§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª';
                    } else {
                        hintBtn.textContent = `ğŸ’¡ ØªÙ„Ù…ÙŠØ­ (${2 - hintsUsed} Ù…ØªØ¨Ù‚ÙŠ)`;
                    }
                }
            }

            // Reset game
            function resetGame() {
                playButtonSound();
                currentLevel = 1;
                totalStarsCollected = 0;
                resetLevel();
            }

            // Event listeners
            document.addEventListener('DOMContentLoaded', () => {
                updateLevelDisplay();
                updateStats();

                const scene = document.getElementById('scene');
                scene.style.background = getCurrentLevel().background;

                // Button event listeners with sound effects
                document.getElementById('startBtn').addEventListener('click', startLevel);
                document.getElementById('nextBtn').addEventListener('click', nextLevel);
                document.getElementById('hintBtn').addEventListener('click', showHint);
                document.getElementById('resetBtn').addEventListener('click', resetGame);
                document.getElementById('continueBtn').addEventListener('click', () => {
                    playButtonSound();
                    document.getElementById('modal').classList.add('hidden');
                    if (currentLevel === levels.length && starsEarned > 0) {
                        nextLevel();
                    } else if (currentLevel < levels.length) {
                        nextLevel();
                    } else {
                        resetGame();
                    }
                });

                // Add hover sound effects to buttons (desktop only)
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach((btn) => {
                    btn.addEventListener('mouseenter', () => {
                        if (!btn.disabled && window.innerWidth > 768) {
                            playSound(330, 0.05); // E4
                        }
                    });
                });

                // Auto-start the first level
                setTimeout(() => {
                    autoStartLevel();
                }, AUTO_START_DELAY);
            });

            // Prevent default drag behavior and improve mobile experience
            document.addEventListener('dragstart', (e) => {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                }
            });

            // Prevent text selection during drag operations
            document.addEventListener('selectstart', (e) => {
                if (e.target.classList.contains('draggable-object') || e.target.classList.contains('object')) {
                    e.preventDefault();
                }
            });

            // Prevent context menu on long press (mobile)
            document.addEventListener('contextmenu', (e) => {
                if (e.target.classList.contains('draggable-object') || e.target.classList.contains('drop-zone')) {
                    e.preventDefault();
                }
            });

            // Prevent page refresh on pull-to-refresh (mobile)
            document.body.addEventListener(
                'touchstart',
                (e) => {
                    if (e.touches.length === 1 && window.scrollY === 0) {
                        e.preventDefault();
                    }
                },
                { passive: false }
            );

            document.body.addEventListener(
                'touchmove',
                (e) => {
                    if (e.touches.length === 1) {
                        e.preventDefault();
                    }
                },
                { passive: false }
            );

            // Enable audio on first user interaction
            document.addEventListener(
                'click',
                () => {
                    initAudio();
                },
                { once: true }
            );

            document.addEventListener(
                'touchstart',
                () => {
                    initAudio();
                },
                { once: true }
            );

            // Handle orientation change
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    // Recalculate layout after orientation change
                    const scene = document.getElementById('scene');
                    scene.style.height = '';
                    setTimeout(() => {
                        const rect = scene.getBoundingClientRect();
                        scene.style.height = rect.height + 'px';
                    }, 100);
                }, 500);
            });

            // Handle window resize
            window.addEventListener('resize', () => {
                // Debounce resize events
                clearTimeout(window.resizeTimeout);
                window.resizeTimeout = setTimeout(() => {
                    // Update layout if needed
                    updateProgress();
                }, 250);
            });
        </script>
    </body>
</html>
