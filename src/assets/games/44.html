<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØµÙÙŠÙ‚ Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
                font-size: 20px;
                overflow-x: hidden;
            }

            .container {
                max-width: 900px;
                margin: 0 auto;
                padding: 20px;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .game-header {
                text-align: center;
                margin-bottom: 30px;
                background: rgba(255, 255, 255, 0.95);
                padding: 25px;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                backdrop-filter: blur(10px);
            }

            .game-title {
                font-size: 2.5em;
                color: #5a67d8;
                margin-bottom: 10px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }

            .game-subtitle {
                font-size: 1.2em;
                color: #666;
                line-height: 1.4;
            }

            .level-selection,
            .game-area,
            .results-screen {
                background: rgba(255, 255, 255, 0.95);
                padding: 30px;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                text-align: center;
                display: none;
                backdrop-filter: blur(10px);
                position: relative;
            }

            .level-selection.active,
            .game-area.active,
            .results-screen.active {
                display: block;
            }

            .level-description {
                font-size: 1.1em;
                color: #4a5568;
                margin-bottom: 25px;
                line-height: 1.5;
            }

            .level-buttons {
                display: flex;
                flex-direction: column;
                gap: 20px;
                margin-top: 30px;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
            }

            .level-btn {
                padding: 25px 30px;
                font-size: 1.3em;
                background: linear-gradient(45deg, #4facfe, #00f2fe);
                color: white;
                border: none;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                position: relative;
                overflow: hidden;
                line-height: 1.4;
            }

            .level-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 15px 30px rgba(79, 172, 254, 0.4);
            }

            .level-btn:focus {
                outline: 3px solid #ffd700;
                outline-offset: 2px;
            }

            .level-btn:active {
                transform: translateY(0);
            }

            .word-display {
                margin: 30px 0;
                text-align: center;
                background: rgba(247, 250, 252, 0.8);
                padding: 25px;
                border-radius: 15px;
                border: 2px solid rgba(203, 213, 224, 0.5);
            }

            .word-emoji {
                font-size: 4em;
                margin-bottom: 15px;
                display: block;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .word-text {
                font-size: 2.8em;
                font-weight: bold;
                color: #2d3748;
                margin-bottom: 15px;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }

            .word-segments {
                font-size: 1.8em;
                color: #4a5568;
                letter-spacing: 5px;
                margin-bottom: 20px;
                background: rgba(255, 255, 255, 0.7);
                padding: 15px;
                border-radius: 10px;
                border: 2px dashed #cbd5e0;
                font-weight: 600;
            }

            .question-text {
                font-size: 1.5em;
                color: #2d3748;
                margin: 25px 0;
                font-weight: bold;
                line-height: 1.4;
            }

            .answer-buttons {
                display: flex;
                justify-content: center;
                gap: 40px;
                margin: 40px 0;
                flex-wrap: wrap;
            }

            .answer-btn {
                width: 90px;
                height: 90px;
                font-size: 2.2em;
                font-weight: bold;
                border: none;
                border-radius: 50%;
                cursor: pointer;
                transition: all 0.3s ease;
                background: linear-gradient(45deg, #ff6b6b, #ffa07a);
                color: white;
                box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
                position: relative;
            }

            .answer-btn:hover {
                transform: scale(1.15);
                box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
            }

            .answer-btn:focus {
                outline: 3px solid #ffd700;
                outline-offset: 3px;
            }

            .answer-btn:active {
                transform: scale(1.05);
            }

            .answer-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .control-buttons {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 25px 0;
                flex-wrap: wrap;
            }

            .control-btn {
                padding: 15px 25px;
                font-size: 1.1em;
                border: none;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                background: #48bb78;
                color: white;
                font-weight: bold;
                min-width: 140px;
            }

            .control-btn:hover {
                background: #38a169;
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
            }

            .control-btn:focus {
                outline: 3px solid #ffd700;
                outline-offset: 2px;
            }

            .control-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .progress-area {
                margin: 25px 0;
                text-align: center;
                background: rgba(247, 250, 252, 0.8);
                padding: 20px;
                border-radius: 15px;
            }

            .progress-bar {
                width: 100%;
                height: 25px;
                background: #e2e8f0;
                border-radius: 15px;
                overflow: hidden;
                margin: 15px 0;
                box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(45deg, #48bb78, #68d391);
                width: 0%;
                transition: width 0.6s ease;
                border-radius: 15px;
            }

            .score-display {
                font-size: 1.4em;
                font-weight: bold;
                color: #2d3748;
                margin: 15px 0;
            }

            .feedback-message {
                font-size: 1.4em;
                font-weight: bold;
                margin: 25px 0;
                padding: 20px;
                border-radius: 15px;
                min-height: 70px;
                display: flex;
                align-items: center;
                justify-content: center;
                line-height: 1.4;
                text-align: center;
            }

            .feedback-correct {
                background: linear-gradient(45deg, #c6f6d5, #9ae6b4);
                color: #22543d;
                border: 3px solid #48bb78;
                box-shadow: 0 5px 15px rgba(72, 187, 120, 0.3);
            }

            .feedback-incorrect {
                background: linear-gradient(45deg, #fed7d7, #fbb6ce);
                color: #742a2a;
                border: 3px solid #e53e3e;
                box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
            }

            .feedback-hint {
                background: linear-gradient(45deg, #fef5e7, #fbd38d);
                color: #744210;
                border: 3px solid #ed8936;
                box-shadow: 0 5px 15px rgba(237, 137, 54, 0.3);
            }

            .hint-text {
                font-size: 1.3em;
                color: #4a5568;
                margin: 20px 0;
                font-style: italic;
                background: rgba(255, 255, 255, 0.8);
                padding: 15px;
                border-radius: 10px;
                border-left: 4px solid #ed8936;
            }

            .celebration {
                animation: bounce 0.8s ease-in-out;
            }

            @keyframes bounce {
                0%,
                20%,
                60%,
                100% {
                    transform: translateY(0) scale(1);
                }
                40% {
                    transform: translateY(-25px) scale(1.05);
                }
                80% {
                    transform: translateY(-15px) scale(1.02);
                }
            }

            .pulse {
                animation: pulse 1.5s infinite;
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.08);
                }
                100% {
                    transform: scale(1);
                }
            }

            .hidden {
                display: none !important;
            }

            .back-btn {
                position: absolute;
                top: 15px;
                left: 15px;
                padding: 12px 20px;
                background: #718096;
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 1em;
                font-weight: bold;
                transition: all 0.3s ease;
            }

            .back-btn:hover {
                background: #4a5568;
                transform: translateY(-2px);
            }

            .back-btn:focus {
                outline: 3px solid #ffd700;
            }

            .loading {
                opacity: 0.7;
                pointer-events: none;
            }

            .final-score {
                font-size: 1.6em;
                line-height: 1.5;
                margin: 25px 0;
                color: #2d3748;
            }

            .results-emoji {
                font-size: 3em;
                margin: 20px 0;
                display: block;
            }

            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                }

                .game-title {
                    font-size: 2em;
                }

                .word-text {
                    font-size: 2.2em;
                }

                .word-segments {
                    font-size: 1.5em;
                    letter-spacing: 3px;
                }

                .answer-buttons {
                    gap: 25px;
                }

                .answer-btn {
                    width: 75px;
                    height: 75px;
                    font-size: 1.8em;
                }

                .control-buttons {
                    flex-direction: column;
                    align-items: center;
                }

                .control-btn {
                    min-width: 200px;
                }

                .back-btn {
                    position: relative;
                    top: 0;
                    left: 0;
                    margin-bottom: 20px;
                }
            }

            @media (max-width: 480px) {
                .game-header,
                .level-selection,
                .game-area,
                .results-screen {
                    padding: 20px;
                }

                .word-emoji {
                    font-size: 3em;
                }

                .word-text {
                    font-size: 1.8em;
                }

                .answer-btn {
                    width: 65px;
                    height: 65px;
                    font-size: 1.6em;
                }
            }

            /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù„Ù„Ù†Ø¬Ø§Ø­ */
            .success-glow {
                animation: successGlow 1s ease-in-out;
            }

            @keyframes successGlow {
                0% {
                    box-shadow: 0 0 5px rgba(72, 187, 120, 0.5);
                }
                50% {
                    box-shadow:
                        0 0 20px rgba(72, 187, 120, 0.8),
                        0 0 30px rgba(72, 187, 120, 0.6);
                }
                100% {
                    box-shadow: 0 0 5px rgba(72, 187, 120, 0.5);
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="game-header">
                <h1 class="game-title">ğŸµ Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØµÙÙŠÙ‚ Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ ğŸµ</h1>
                <p class="game-subtitle">Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ÙƒÙ„Ù…Ø© Ù…Ù‚Ø·Ø¹Ø© Ø¨Ø¨Ø·Ø¡ØŒ Ø«Ù… ØµÙÙ‚ Ù…Ø¹Ù‡Ø§ ÙˆØ§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹!</p>
            </div>

            <!-- Level Selection Screen -->
            <div class="level-selection active" id="levelSelection">
                <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</h2>
                <p class="level-description">Ø³ØªØ³Ù…Ø¹ 10 ÙƒÙ„Ù…Ø§Øª ÙÙŠ ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰. Ø§Ø³ØªÙ…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹ ÙˆØµÙÙ‚ Ù…Ø¹ ÙƒÙ„ Ù…Ù‚Ø·Ø¹!</p>
                <div class="level-buttons">
                    <button class="level-btn" onclick="startLevel(1)" aria-label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ - ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ù…Ù‚Ø·Ø¹ÙŠÙ†">
                        Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: Ù…Ù‚Ø·Ø¹Ø§Ù†
                        <br /><small>ÙƒÙ„Ù…Ø§Øª Ù‚ØµÙŠØ±Ø© ÙˆÙ…Ø£Ù„ÙˆÙØ© Ù…Ø«Ù„: Ù…Ø§Ù…Ø§ØŒ Ù‚Ù„Ù…ØŒ ÙƒØ±Ø©</small>
                    </button>
                    <button class="level-btn" onclick="startLevel(2)" aria-label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ - ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø«Ù„Ø§Ø«Ø© Ù…Ù‚Ø§Ø·Ø¹">
                        Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2: Ø«Ù„Ø§Ø«Ø© Ù…Ù‚Ø§Ø·Ø¹
                        <br /><small>ÙƒÙ„Ù…Ø§Øª Ø£Ø·ÙˆÙ„ Ù…Ø«Ù„: Ù…Ø¯Ø±Ø³Ø©ØŒ ØªÙØ§Ø­Ø©ØŒ Ø³ÙŠØ§Ø±Ø©</small>
                    </button>
                    <button class="level-btn" onclick="startLevel(3)" aria-label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø« - Ù…Ø²ÙŠØ¬ Ù…Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹ÙŠÙ† ÙˆØ§Ù„Ø«Ù„Ø§Ø«Ø©">
                        Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3: Ø§Ù„ØªØ­Ø¯ÙŠ
                        <br /><small>Ù…Ø²ÙŠØ¬ Ù…Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹ÙŠÙ† ÙˆØ§Ù„Ø«Ù„Ø§Ø«Ø© Ù…Ø¹Ø§Ù‹</small>
                    </button>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-area" id="gameArea">
                <button class="back-btn" onclick="goToLevelSelection()" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>

                <div class="progress-area">
                    <div class="score-display" id="scoreDisplay">Ø§Ù„Ø³Ø¤Ø§Ù„: 1/10 | Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
                    <div class="progress-bar" role="progressbar" aria-label="ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div class="word-display">
                    <span class="word-emoji" id="wordEmoji" aria-hidden="true">ğŸ¯</span>
                    <div class="word-text" id="wordText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    <div class="word-segments hidden" id="wordSegments" aria-label="ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹"></div>
                </div>

                <div class="question-text" id="questionText">Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ÙƒÙ„Ù…Ø©... ØµÙÙ‚ Ù…Ø¹ ÙƒÙ„ Ù…Ù‚Ø·Ø¹... ÙƒÙ… Ù…Ù‚Ø·Ø¹Ø§Ù‹ Ø³Ù…Ø¹ØªØŸ</div>

                <div class="answer-buttons" id="answerButtons">
                    <button class="answer-btn" onclick="checkAnswer(2)" aria-label="Ù…Ù‚Ø·Ø¹Ø§Ù†" data-answer="2">2</button>
                    <button class="answer-btn" onclick="checkAnswer(3)" aria-label="Ø«Ù„Ø§Ø«Ø© Ù…Ù‚Ø§Ø·Ø¹" data-answer="3">3</button>
                </div>

                <div class="control-buttons">
                    <button class="control-btn" id="listenBtn" onclick="speakWord()" aria-label="Ø£Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ÙƒÙ„Ù…Ø©">ğŸ”Š Ø£Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹</button>
                    <button class="control-btn" onclick="showHint()" aria-label="Ø§Ø·Ù„Ø¨ ØªÙ„Ù…ÙŠØ­Ø§Ù‹">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
                </div>

                <div class="feedback-message hidden" id="feedbackMessage" role="status" aria-live="polite" aria-atomic="true"></div>
                <div class="hint-text hidden" id="hintText"></div>
            </div>

            <!-- Results Screen -->
            <div class="results-screen" id="resultsScreen">
                <span class="results-emoji" id="resultsEmoji">ğŸ‰</span>
                <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
                <div class="final-score" id="finalScore">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                <div class="control-buttons">
                    <button class="control-btn" onclick="restartGame()" aria-label="Ø¥Ø¹Ø§Ø¯Ø© Ù„Ø¹Ø¨ Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªÙˆÙ‰">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
                    <button class="control-btn" onclick="goToLevelSelection()" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªÙˆÙ‰ Ø¢Ø®Ø±">ğŸ“š Ù…Ø³ØªÙˆÙ‰ Ø¢Ø®Ø±</button>
                </div>
            </div>
        </div>

        <script>
            // Game Data - Fixed syllable segmentation
            const LEVEL1 = [
                { word: 'Ù…Ø§Ù…Ø§', syllables: 2, segments: 'Ù…Ø§ . . Ù…Ø§', hint: 'Ø£Ù…ÙŠ Ø§Ù„Ø­Ø¨ÙŠØ¨Ø©', emoji: 'ğŸ‘©' },
                { word: 'Ø¨Ø§Ø¨Ø§', syllables: 2, segments: 'Ø¨Ø§ . . Ø¨Ø§', hint: 'Ø£Ø¨ÙŠ Ø§Ù„Ø¹Ø²ÙŠØ²', emoji: 'ğŸ‘¨' },
                { word: 'ÙƒØ±Ø³ÙŠ', syllables: 2, segments: 'ÙƒØ± . . Ø³ÙŠ', hint: 'Ù†Ø¬Ù„Ø³ Ø¹Ù„ÙŠÙ‡ ÙÙŠ Ø§Ù„ÙØµÙ„', emoji: 'ğŸª‘' },
                { word: 'Ù‚Ù„Ù…', syllables: 2, segments: 'Ù‚Ù€Ù . . Ù„Ù…', hint: 'Ù†ÙƒØªØ¨ ÙˆÙ†Ø±Ø³Ù… Ø¨Ù‡', emoji: 'âœï¸' },
                { word: 'Ø´Ù†Ø·Ø©', syllables: 2, segments: 'Ø´Ù† . . Ø·Ø©', hint: 'Ù†Ø­Ù…Ù„ ÙÙŠÙ‡Ø§ Ø§Ù„ÙƒØªØ¨', emoji: 'ğŸ’' },
                { word: 'Ù„Ù…Ø¨Ø©', syllables: 2, segments: 'Ù„Ù… . . Ø¨Ø©', hint: 'ØªØ¶ÙŠØ¡ Ø§Ù„ØºØ±ÙØ©', emoji: 'ğŸ’¡' },
                { word: 'ÙƒØ±Ø©', syllables: 2, segments: 'ÙƒÙ€Ù . . Ø±Ø©', hint: 'Ù†Ù„Ø¹Ø¨ Ø¨Ù‡Ø§ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…', emoji: 'âš½' },
                { word: 'Ø´Ø¨Ø§Ùƒ', syllables: 2, segments: 'Ø´Ø¨Ø§ . . Ùƒ', hint: 'Ù†Ù†Ø¸Ø± Ù…Ù†Ù‡ Ù„Ù„Ø­Ø¯ÙŠÙ‚Ø©', emoji: 'ğŸªŸ' },
                { word: 'Ù‚Ø·Ø©', syllables: 2, segments: 'Ù‚Ù€Ù . . Ø·Ø©', hint: 'Ø­ÙŠÙˆØ§Ù† Ø£Ù„ÙŠÙ ÙŠÙ…ÙˆØ¡', emoji: 'ğŸ±' },
                { word: 'Ø¨Ø·Ø©', syllables: 2, segments: 'Ø¨Ù€Ù . . Ø·Ø©', hint: 'ØªØ³Ø¨Ø­ ÙÙŠ Ø§Ù„Ø¨Ø±ÙƒØ©', emoji: 'ğŸ¦†' },
                { word: 'Ù…ÙˆØ²Ø©', syllables: 2, segments: 'Ù…Ùˆ . . Ø²Ø©', hint: 'ÙØ§ÙƒÙ‡Ø© ØµÙØ±Ø§Ø¡ Ø·ÙˆÙŠÙ„Ø©', emoji: 'ğŸŒ' },
                { word: 'Ø¬Ø¨Ù†Ø©', syllables: 2, segments: 'Ø¬Ø¨ . . Ù†Ø©', hint: 'Ø·Ø¹Ø§Ù… Ø£Ø¨ÙŠØ¶ Ù…Ù† Ø§Ù„Ø­Ù„ÙŠØ¨', emoji: 'ğŸ§€' },
                { word: 'Ø¨ÙŠØ¶Ø©', syllables: 2, segments: 'Ø¨ÙŠ . . Ø¶Ø©', hint: 'Ù†Ø£ÙƒÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„ÙØ·Ø§Ø±', emoji: 'ğŸ¥š' },
                { word: 'Ø¯ÙØªØ±', syllables: 2, segments: 'Ø¯Ù . . ØªØ±', hint: 'Ù†ÙƒØªØ¨ ÙÙŠÙ‡ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª', emoji: 'ğŸ“’' },
                { word: 'Ø³Ù„Ù…Ù‰', syllables: 2, segments: 'Ø³Ù„ . . Ù…Ù‰', hint: 'Ø§Ø³Ù… ÙØªØ§Ø© Ø¬Ù…ÙŠÙ„', emoji: 'ğŸ‘§' },
                { word: 'Ù†Ø¬Ù…Ø©', syllables: 2, segments: 'Ù†Ø¬ . . Ù…Ø©', hint: 'ØªØ¶ÙŠØ¡ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„ÙŠÙ„Ø§Ù‹', emoji: 'â­' },
                { word: 'ÙˆØ±Ø¯Ø©', syllables: 2, segments: 'ÙˆØ± . . Ø¯Ø©', hint: 'Ø²Ù‡Ø±Ø© Ø¬Ù…ÙŠÙ„Ø© ÙˆØ±Ø§Ø¦Ø­ØªÙ‡Ø§ Ø·ÙŠØ¨Ø©', emoji: 'ğŸŒ¹' },
                { word: 'Ø¬Ø¨Ù„', syllables: 2, segments: 'Ø¬Ù€Ù . . Ø¨Ù„', hint: 'Ù…Ø±ØªÙØ¹ Ø¹Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø£Ø±Ø¶', emoji: 'â›°ï¸' }
            ];

            const LEVEL2 = [
                { word: 'Ù…Ø¯Ø±Ø³Ø©', syllables: 3, segments: 'Ù…Ø¯ . . Ø±Ø³ . . Ø©', hint: 'Ù†ØªØ¹Ù„Ù… ÙÙŠÙ‡Ø§ Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', emoji: 'ğŸ«' },
                { word: 'Ù…ÙƒØªØ¨Ø©', syllables: 3, segments: 'Ù…Ùƒ . . ØªÙ€Ù . . Ø¨Ø©', hint: 'Ù†Ù‚Ø±Ø£ ÙÙŠÙ‡Ø§ Ø§Ù„ÙƒØªØ¨', emoji: 'ğŸ“š' },
                { word: 'Ù…Ø¯ÙŠÙ†Ø©', syllables: 3, segments: 'Ù…Ø¯ . . ÙŠ . . Ù†Ø©', hint: 'Ù…ÙƒØ§Ù† ÙƒØ¨ÙŠØ± Ù„Ù„Ø³ÙƒÙ†', emoji: 'ğŸ™ï¸' },
                { word: 'Ø­Ø¯ÙŠÙ‚Ø©', syllables: 3, segments: 'Ø­Ø¯ . . ÙŠ . . Ù‚Ø©', hint: 'Ù…ÙƒØ§Ù† Ø§Ù„Ø£Ø´Ø¬Ø§Ø± ÙˆØ§Ù„ÙˆØ±ÙˆØ¯', emoji: 'ğŸŒ³' },
                { word: 'Ø³ÙŠØ§Ø±Ø©', syllables: 3, segments: 'Ø³ÙŠ . . ÙŠØ§ . . Ø±Ø©', hint: 'ØªÙ†Ù‚Ù„Ù†Ø§ Ù…Ù† Ù…ÙƒØ§Ù† Ù„Ø¢Ø®Ø±', emoji: 'ğŸš—' },
                { word: 'Ø·ÙŠØ§Ø±Ø©', syllables: 3, segments: 'Ø·ÙŠ . . ÙŠØ§ . . Ø±Ø©', hint: 'ØªØ·ÙŠØ± Ø¹Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'âœˆï¸' },
                { word: 'Ù…Ø³ØªØ´ÙÙ‰', syllables: 3, segments: 'Ù…Ø³ . . ØªØ´ . . ÙÙ‰', hint: 'Ù†Ø°Ù‡Ø¨ Ø¥Ù„ÙŠÙ‡Ø§ Ù„Ù„Ø¹Ù„Ø§Ø¬', emoji: 'ğŸ¥' },
                { word: 'Ù…ÙƒÙ†Ø³Ø©', syllables: 3, segments: 'Ù…Ùƒ . . Ù†Ø³ . . Ø©', hint: 'Ù†Ù†Ø¸Ù Ø¨Ù‡Ø§ Ø§Ù„Ø£Ø±Ø¶', emoji: 'ğŸ§¹' },
                { word: 'Ø«Ù„Ø§Ø¬Ø©', syllables: 3, segments: 'Ø«Ù„Ø§ . . Ø¬ . . Ø©', hint: 'ØªØ­ÙØ¸ Ø§Ù„Ø·Ø¹Ø§Ù… Ø¨Ø§Ø±Ø¯Ø§Ù‹', emoji: 'â„ï¸' },
                { word: 'Ù…Ù‚Ù„Ù…Ø©', syllables: 3, segments: 'Ù…Ù‚ . . Ù„Ù€Ù . . Ù…Ø©', hint: 'Ù†Ø¶Ø¹ ÙÙŠÙ‡Ø§ Ø§Ù„Ø£Ù‚Ù„Ø§Ù…', emoji: 'ğŸ“' },
                { word: 'Ù…Ø³Ø·Ø±Ø©', syllables: 3, segments: 'Ù…Ø³ . . Ø·Ù€Ù . . Ø±Ø©', hint: 'Ù†Ø±Ø³Ù… Ø¨Ù‡Ø§ Ø®Ø·ÙˆØ· Ù…Ø³ØªÙ‚ÙŠÙ…Ø©', emoji: 'ğŸ“' },
                { word: 'Ø´Ù…Ø³ÙŠØ©', syllables: 3, segments: 'Ø´Ù… . . Ø³ÙŠ . . Ø©', hint: 'ØªØ­Ù…ÙŠÙ†Ø§ Ù…Ù† Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ù„Ù…Ø·Ø±', emoji: 'â˜‚ï¸' },
                { word: 'ØªÙØ§Ø­Ø©', syllables: 3, segments: 'ØªÙ . . ÙØ§ . . Ø­Ø©', hint: 'ÙØ§ÙƒÙ‡Ø© Ø­Ù…Ø±Ø§Ø¡ Ù…ÙÙŠØ¯Ø©', emoji: 'ğŸ' },
                { word: 'Ø·Ù…Ø§Ø·Ù…', syllables: 3, segments: 'Ø·Ù€Ù . . Ù…Ø§ . . Ø·Ù…', hint: 'Ø®Ø¶Ø§Ø± Ø­Ù…Ø±Ø§Ø¡ Ù„Ù„Ø³Ù„Ø·Ø©', emoji: 'ğŸ…' },
                { word: 'ÙØ±Ø§ÙˆÙ„Ø©', syllables: 3, segments: 'ÙÙ€Ù . . Ø±Ø§Ùˆ . . Ù„Ø©', hint: 'ÙØ§ÙƒÙ‡Ø© Ø­Ù…Ø±Ø§Ø¡ ØµØºÙŠØ±Ø© Ø­Ù„ÙˆØ©', emoji: 'ğŸ“' },
                { word: 'Ø²Ø±Ø§ÙØ©', syllables: 3, segments: 'Ø²Ù . . Ø±Ø§ . . ÙØ©', hint: 'Ø­ÙŠÙˆØ§Ù† Ø·ÙˆÙŠÙ„ Ø§Ù„Ø±Ù‚Ø¨Ø©', emoji: 'ğŸ¦’' },
                { word: 'ÙØ±Ø§Ø´Ø©', syllables: 3, segments: 'ÙÙ€Ù . . Ø±Ø§ . . Ø´Ø©', hint: 'Ø­Ø´Ø±Ø© Ù…Ù„ÙˆÙ†Ø© ØªØ·ÙŠØ±', emoji: 'ğŸ¦‹' }
            ];

            // Game State
            let currentLevel = 1;
            let currentQuestionIndex = 0;
            let currentQuestions = [];
            let score = 0;
            let attempts = 0;
            let maxAttempts = 2;
            let audioContext;
            let speechSynthesis = window.speechSynthesis;
            let isGameActive = false;
            let isSpeaking = false;

            // Initialize Audio Context on first user interaction
            function initAudio() {
                if (!audioContext) {
                    try {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        console.log('Audio context initialized');
                    } catch (e) {
                        console.warn('Web Audio API not supported:', e);
                    }
                }
            }

            // Enhanced Sound Effects
            function playBuzzer() {
                if (!audioContext) return;

                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(180, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.4);

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.4);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                } catch (e) {
                    console.warn('Could not play buzzer sound:', e);
                }
            }

            function playGlitter() {
                if (!audioContext) return;

                try {
                    const frequencies = [523, 659, 784, 1047]; // C, E, G, C (major chord)

                    frequencies.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);

                        const startTime = audioContext.currentTime + index * 0.1;
                        gainNode.gain.setValueAtTime(0, startTime);
                        gainNode.gain.linearRampToValueAtTime(0.15, startTime + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 0.15);

                        oscillator.start(startTime);
                        oscillator.stop(startTime + 0.15);
                    });
                } catch (e) {
                    console.warn('Could not play glitter sound:', e);
                }
            }

            // Enhanced Speech Synthesis
            function speakWord() {
                if (isSpeaking) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                    updateListenButton(false);
                    return;
                }

                const currentWord = currentQuestions[currentQuestionIndex];
                if (!currentWord) return;

                // Disable buttons during speech
                disableAnswerButtons(true);
                updateListenButton(true);
                isSpeaking = true;

                // Cancel any ongoing speech
                speechSynthesis.cancel();

                // Get segments and clean them
                const segments = currentWord.segments.split(' . . ').map((seg) => seg.trim());
                let segmentIndex = 0;

                function speakNextSegment() {
                    if (segmentIndex < segments.length && isSpeaking) {
                        const utterance = new SpeechSynthesisUtterance(segments[segmentIndex]);
                        utterance.lang = 'ar-SA';
                        utterance.rate = 0.6;
                        utterance.pitch = 1.1;
                        utterance.volume = 0.9;

                        utterance.onend = () => {
                            segmentIndex++;
                            if (segmentIndex < segments.length && isSpeaking) {
                                setTimeout(speakNextSegment, 400); // Pause between segments
                            } else {
                                // Speech finished
                                isSpeaking = false;
                                disableAnswerButtons(false);
                                updateListenButton(false);
                            }
                        };

                        utterance.onerror = () => {
                            console.warn('Speech synthesis error');
                            isSpeaking = false;
                            disableAnswerButtons(false);
                            updateListenButton(false);
                        };

                        speechSynthesis.speak(utterance);
                    } else {
                        isSpeaking = false;
                        disableAnswerButtons(false);
                        updateListenButton(false);
                    }
                }

                speakNextSegment();
            }

            function updateListenButton(isPlaying) {
                const btn = document.getElementById('listenBtn');
                if (isPlaying) {
                    btn.textContent = 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù';
                    btn.classList.add('pulse');
                } else {
                    btn.textContent = 'ğŸ”Š Ø£Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹';
                    btn.classList.remove('pulse');
                }
            }

            function disableAnswerButtons(disabled) {
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach((btn) => {
                    btn.disabled = disabled;
                    if (disabled) {
                        btn.style.opacity = '0.6';
                        btn.style.cursor = 'not-allowed';
                    } else {
                        btn.style.opacity = '1';
                        btn.style.cursor = 'pointer';
                    }
                });
            }

            // Game Logic
            function startLevel(level) {
                currentLevel = level;
                currentQuestionIndex = 0;
                score = 0;
                attempts = 0;
                isGameActive = true;

                // Initialize audio on user interaction
                initAudio();

                // Generate questions based on level
                let wordPool = [];
                if (level === 1) {
                    wordPool = [...LEVEL1];
                } else if (level === 2) {
                    wordPool = [...LEVEL2];
                } else {
                    wordPool = [...LEVEL1, ...LEVEL2];
                }

                // Shuffle and select 10 questions
                currentQuestions = shuffleArray(wordPool).slice(0, 10);

                // Show game area
                document.getElementById('levelSelection').classList.remove('active');
                document.getElementById('gameArea').classList.add('active');
                document.getElementById('resultsScreen').classList.remove('active');

                // Start first question
                showQuestion();
            }

            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            function showQuestion() {
                if (currentQuestionIndex >= currentQuestions.length) {
                    showResults();
                    return;
                }

                const currentWord = currentQuestions[currentQuestionIndex];
                attempts = 0;

                // Update UI
                document.getElementById('wordEmoji').textContent = currentWord.emoji;
                document.getElementById('wordText').textContent = currentWord.word;
                document.getElementById('wordSegments').textContent = currentWord.segments;
                document.getElementById('wordSegments').classList.add('hidden');

                // Update progress
                updateProgress();

                // Clear feedback
                clearFeedback();

                // Reset button states
                disableAnswerButtons(false);
                updateListenButton(false);

                // Auto-speak the word after a short delay
                setTimeout(() => {
                    if (isGameActive) {
                        speakWord();
                    }
                }, 800);
            }

            function updateProgress() {
                const progress = (currentQuestionIndex / currentQuestions.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('scoreDisplay').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„: ${currentQuestionIndex + 1}/${currentQuestions.length} | Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
            }

            function checkAnswer(selectedSyllables) {
                if (!isGameActive || isSpeaking) return;

                const currentWord = currentQuestions[currentQuestionIndex];
                const correctSyllables = currentWord.syllables;

                attempts++;

                // Stop any ongoing speech
                speechSynthesis.cancel();
                isSpeaking = false;
                updateListenButton(false);

                if (selectedSyllables === correctSyllables) {
                    // Correct answer
                    score++;
                    playGlitter();
                    showFeedback(`ğŸ‰ Ù…Ù…ØªØ§Ø²! "${currentWord.word}" ÙÙŠÙ‡Ø§ ${correctSyllables} Ù…Ù‚Ø§Ø·Ø¹`, 'correct');

                    // Add celebration animation
                    const wordText = document.getElementById('wordText');
                    wordText.classList.add('celebration', 'success-glow');

                    // Disable buttons during celebration
                    disableAnswerButtons(true);

                    // Auto-advance to next question
                    setTimeout(() => {
                        wordText.classList.remove('celebration', 'success-glow');
                        nextQuestion();
                    }, 1500);
                } else {
                    // Incorrect answer
                    playBuzzer();

                    if (attempts >= maxAttempts) {
                        // Show correct answer after max attempts
                        showFeedback(`Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: "${currentWord.word}" ÙÙŠÙ‡Ø§ ${correctSyllables} Ù…Ù‚Ø§Ø·Ø¹. ${currentWord.hint}`, 'incorrect');
                        document.getElementById('wordSegments').classList.remove('hidden');

                        // Disable buttons
                        disableAnswerButtons(true);

                        setTimeout(() => {
                            nextQuestion();
                        }, 3000);
                    } else {
                        // Give hint and allow retry
                        showFeedback(`Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ğŸ’¡ ${currentWord.hint}`, 'hint');

                        // Re-speak word slower after a delay
                        setTimeout(() => {
                            if (isGameActive) {
                                speakWord();
                            }
                        }, 1500);
                    }
                }
            }

            function showFeedback(message, type) {
                const feedbackElement = document.getElementById('feedbackMessage');
                feedbackElement.textContent = message;
                feedbackElement.className = 'feedback-message feedback-' + type;
                feedbackElement.classList.remove('hidden');

                // Announce to screen readers
                feedbackElement.setAttribute('aria-live', 'assertive');
            }

            function clearFeedback() {
                const feedbackElement = document.getElementById('feedbackMessage');
                feedbackElement.classList.add('hidden');
                feedbackElement.setAttribute('aria-live', 'polite');
                document.getElementById('hintText').classList.add('hidden');
            }

            function showHint() {
                const currentWord = currentQuestions[currentQuestionIndex];
                const hintElement = document.getElementById('hintText');
                hintElement.textContent = `ğŸ’¡ ØªÙ„Ù…ÙŠØ­: ${currentWord.hint}`;
                hintElement.classList.remove('hidden');
            }

            function nextQuestion() {
                currentQuestionIndex++;
                showQuestion();
            }

            function showResults() {
                isGameActive = false;

                // Stop any ongoing speech
                speechSynthesis.cancel();
                isSpeaking = false;

                document.getElementById('gameArea').classList.remove('active');
                document.getElementById('resultsScreen').classList.add('active');

                const percentage = Math.round((score / currentQuestions.length) * 100);
                let message = `Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ ${score} Ù…Ù† ${currentQuestions.length} Ø£Ø³Ø¦Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­\n`;
                message += `Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${percentage}%`;

                let emoji = 'ğŸ‰';
                let encouragement = '';

                if (percentage >= 90) {
                    emoji = 'ğŸŒŸ';
                    encouragement = 'Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ø§Ù‹! Ø£Ù†Øª Ø¨Ø·Ù„ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹!';
                } else if (percentage >= 80) {
                    emoji = 'ğŸ‰';
                    encouragement = 'Ø£Ø­Ø³Ù†Øª Ø¬Ø¯Ø§Ù‹! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!';
                } else if (percentage >= 60) {
                    emoji = 'ğŸ‘';
                    encouragement = 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨!';
                } else {
                    emoji = 'ğŸ’ª';
                    encouragement = 'Ù„Ø§ Ø¨Ø£Ø³ØŒ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø³ØªÙƒÙˆÙ† Ø£ÙØ¶Ù„!';
                }

                document.getElementById('resultsEmoji').textContent = emoji;
                document.getElementById('finalScore').innerHTML = `
                <div>${message}</div>
                <div style="margin-top: 15px; color: #5a67d8; font-weight: bold;">
                    ${encouragement}
                </div>
            `;
            }

            function restartGame() {
                startLevel(currentLevel);
            }

            function goToLevelSelection() {
                isGameActive = false;

                // Stop any ongoing speech
                speechSynthesis.cancel();
                isSpeaking = false;

                document.getElementById('gameArea').classList.remove('active');
                document.getElementById('resultsScreen').classList.remove('active');
                document.getElementById('levelSelection').classList.add('active');
            }

            // Enhanced Keyboard support with audio feedback
            document.addEventListener('keydown', function (e) {
                if (!isGameActive) return;

                if (document.getElementById('gameArea').classList.contains('active')) {
                    switch (e.key) {
                        case '2':
                            e.preventDefault();
                            // Add visual feedback
                            const btn2 = document.querySelector('[data-answer="2"]');
                            btn2.style.transform = 'scale(0.95)';
                            setTimeout(() => (btn2.style.transform = ''), 100);
                            checkAnswer(2);
                            break;
                        case '3':
                            e.preventDefault();
                            // Add visual feedback
                            const btn3 = document.querySelector('[data-answer="3"]');
                            btn3.style.transform = 'scale(0.95)';
                            setTimeout(() => (btn3.style.transform = ''), 100);
                            checkAnswer(3);
                            break;
                        case ' ':
                            e.preventDefault();
                            speakWord();
                            break;
                        case 'Enter':
                            e.preventDefault();
                            speakWord();
                            break;
                        case 'h':
                        case 'H':
                            e.preventDefault();
                            showHint();
                            break;
                        case 'Escape':
                            e.preventDefault();
                            goToLevelSelection();
                            break;
                    }
                }
            });

            // Add click sound for buttons
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('answer-btn') || e.target.classList.contains('control-btn') || e.target.classList.contains('level-btn')) {
                    // Ensure audio context is active
                    if (audioContext && audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                }
            });

            // Ensure proper cleanup when page unloads
            window.addEventListener('beforeunload', function () {
                isGameActive = false;
                speechSynthesis.cancel();
            });

            // Initialize the game when page loads
            window.addEventListener('load', function () {
                // Ensure speech synthesis is ready
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = function () {
                        console.log('Speech synthesis voices loaded');
                    };
                }

                // Focus management
                document.getElementById('levelSelection').setAttribute('tabindex', '-1');
                document.getElementById('levelSelection').focus();
            });

            // Handle visibility change (tab switching)
            document.addEventListener('visibilitychange', function () {
                if (document.hidden && isSpeaking) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                    updateListenButton(false);
                    disableAnswerButtons(false);
                }
            });

            // Touch device optimization
            if ('ontouchstart' in window) {
                document.body.style.cursor = 'pointer';
            }
        </script>
    </body>
</html>
