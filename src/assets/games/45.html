<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>لعبة تركيب الكلمة من أصواتها</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
                direction: rtl;
            }

            .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
            }

            header {
                text-align: center;
                margin-bottom: 30px;
                background: white;
                border-radius: 20px;
                padding: 20px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

            h1 {
                color: #4a5568;
                font-size: 28px;
                margin-bottom: 10px;
            }

            .subtitle {
                color: #718096;
                font-size: 18px;
            }

            .panel {
                background: white;
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                text-align: center;
                display: none;
            }

            .panel.active {
                display: block;
            }

            .level-select {
                display: grid;
                gap: 20px;
                margin: 20px 0;
            }

            .level-btn {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 20px;
                border-radius: 15px;
                font-size: 20px;
                cursor: pointer;
                transition:
                    transform 0.3s,
                    box-shadow 0.3s;
                font-family: inherit;
            }

            .level-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            }

            .segments-display {
                background: #f7fafc;
                border: 3px dashed #cbd5e0;
                border-radius: 15px;
                padding: 30px;
                margin: 30px 0;
                font-size: 32px;
                font-weight: bold;
                color: #2d3748;
                letter-spacing: 3px;
                min-height: 80px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .question-text {
                font-size: 24px;
                color: #4a5568;
                margin: 20px 0;
                font-weight: bold;
            }

            .input-section {
                margin: 30px 0;
            }

            .answer-input {
                font-size: 24px;
                padding: 15px 20px;
                border: 3px solid #cbd5e0;
                border-radius: 15px;
                width: 100%;
                max-width: 300px;
                text-align: center;
                font-family: inherit;
                direction: rtl;
            }

            .answer-input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            .buttons {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
                margin: 20px 0;
            }

            .btn {
                background: #667eea;
                color: white;
                border: none;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                cursor: pointer;
                transition: all 0.3s;
                font-family: inherit;
                min-width: 120px;
            }

            .btn:hover {
                background: #5a67d8;
                transform: translateY(-2px);
            }

            .btn:disabled {
                background: #a0aec0;
                cursor: not-allowed;
                transform: none;
            }

            .btn-success {
                background: #48bb78;
            }

            .btn-success:hover {
                background: #38a169;
            }

            .btn-danger {
                background: #f56565;
            }

            .btn-danger:hover {
                background: #e53e3e;
            }

            .progress-section {
                margin: 20px 0;
                text-align: center;
            }

            .progress-bar {
                background: #e2e8f0;
                border-radius: 25px;
                height: 10px;
                margin: 10px 0;
                overflow: hidden;
            }

            .progress-fill {
                background: linear-gradient(45deg, #667eea, #764ba2);
                height: 100%;
                border-radius: 25px;
                transition: width 0.5s ease;
                width: 0%;
            }

            .stats {
                display: flex;
                justify-content: space-around;
                margin: 20px 0;
                font-size: 18px;
                font-weight: bold;
            }

            .feedback {
                margin: 20px 0;
                padding: 15px;
                border-radius: 10px;
                font-size: 18px;
                min-height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .feedback.success {
                background: #c6f6d5;
                color: #22543d;
                border: 2px solid #48bb78;
            }

            .feedback.error {
                background: #fed7d7;
                color: #742a2a;
                border: 2px solid #f56565;
            }

            .hint {
                background: #fef5e7;
                color: #744210;
                border: 2px solid #ed8936;
                padding: 10px 15px;
                border-radius: 10px;
                margin: 10px 0;
                font-size: 16px;
            }

            .word-result {
                font-size: 36px;
                margin: 20px 0;
                color: #2d3748;
            }

            .emoji {
                font-size: 48px;
                margin: 10px 0;
            }

            .final-results {
                text-align: center;
                font-size: 24px;
            }

            .final-score {
                font-size: 48px;
                color: #667eea;
                font-weight: bold;
                margin: 20px 0;
            }

            @media (max-width: 600px) {
                .container {
                    padding: 10px;
                }

                .segments-display {
                    font-size: 24px;
                    padding: 20px;
                }

                .question-text {
                    font-size: 20px;
                }

                .answer-input {
                    font-size: 20px;
                }

                .btn {
                    font-size: 16px;
                    padding: 12px 20px;
                    min-width: 100px;
                }
            }

            /* Accessibility improvements */
            .btn:focus,
            .answer-input:focus,
            .level-btn:focus {
                outline: 3px solid #667eea;
                outline-offset: 2px;
            }

            /* Animation for correct answer */
            @keyframes celebration {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }

            .celebrate {
                animation: celebration 0.6s ease-in-out;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <h1>🎯 لعبة تركيب الكلمة من أصواتها</h1>
                <p class="subtitle">ساعد الطفل على تعلم تجميع الكلمات من أصواتها</p>
            </header>

            <!-- Level Selection Panel -->
            <div class="panel active" id="levelPanel">
                <h2>اختر المستوى</h2>
                <div class="level-select">
                    <button class="level-btn" onclick="startGame(1)" aria-label="المستوى الأول - كلمات من مقطعين">
                        📚 المستوى الأول
                        <br /><small>كلمات من مقطعين (ماما، بابا، قلم)</small>
                    </button>
                    <button class="level-btn" onclick="startGame(2)" aria-label="المستوى الثاني - كلمات من ثلاثة مقاطع">
                        🎓 المستوى الثاني
                        <br /><small>كلمات من ثلاثة مقاطع (مدرسة، سيارة)</small>
                    </button>
                    <button class="level-btn" onclick="startGame(3)" aria-label="المستوى الثالث - مزيج من المستويين">
                        🏆 المستوى الثالث
                        <br /><small>مزيج من جميع المستويات</small>
                    </button>
                </div>
            </div>

            <!-- Game Panel -->
            <div class="panel" id="gamePanel">
                <div class="progress-section">
                    <div class="stats">
                        <span>السؤال: <span id="currentQ">1</span>/10</span>
                        <span>النقاط: <span id="score">0</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div class="segments-display" id="segmentsDisplay">جاري التحضير...</div>

                <div class="question-text">ما هي الكلمة؟</div>

                <div class="input-section">
                    <input type="text" class="answer-input" id="answerInput" placeholder="اكتب الكلمة هنا" aria-label="مكان كتابة الإجابة" />
                </div>

                <div class="buttons">
                    <button class="btn" id="listenBtn" onclick="speakSegments()" aria-label="أعد الاستماع">🔊 أعد الاستماع</button>
                    <button class="btn btn-success" id="checkBtn" onclick="checkAnswer()" aria-label="تحقق من الإجابة">✅ تحقق</button>
                </div>

                <div class="feedback" id="feedback"></div>
                <div class="hint" id="hint" style="display: none"></div>

                <div class="buttons">
                    <button class="btn btn-danger" onclick="showLevels()" aria-label="العودة للمستويات">🏠 المستويات</button>
                    <button class="btn" onclick="skipQuestion()" aria-label="تخطي السؤال">⏭️ تخطي</button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="panel" id="resultsPanel">
                <div class="final-results">
                    <h2>🎉 انتهت الجلسة!</h2>
                    <div class="final-score" id="finalScore">8/10</div>
                    <div class="emoji" id="resultEmoji">🌟</div>
                    <p id="resultMessage">أحسنت! أداء رائع</p>

                    <div class="buttons">
                        <button class="btn btn-success" onclick="restartGame()" aria-label="إعادة نفس المستوى">🔄 إعادة المستوى</button>
                        <button class="btn" onclick="showLevels()" aria-label="اختيار مستوى جديد">📚 مستوى جديد</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Game Data
            const gameData = {
                level1: [
                    { word: 'ماما', segments: 'ما . . ما', hint: 'أمي الحبيبة', emoji: '👩' },
                    { word: 'بابا', segments: 'با . . با', hint: 'أبي الحبيب', emoji: '👨' },
                    { word: 'كرسي', segments: 'كر . . سي', hint: 'نجلس عليه', emoji: '🪑' },
                    { word: 'قلم', segments: 'قـل . . م', hint: 'نكتب به', emoji: '✏️' },
                    { word: 'شنطة', segments: 'شن . . طة', hint: 'نحمل فيها الكتب', emoji: '🎒' },
                    { word: 'لمبة', segments: 'لم . . بة', hint: 'تضيء الغرفة', emoji: '💡' },
                    { word: 'كورة', segments: 'كو . . رة', hint: 'نلعب بها', emoji: '⚽' },
                    { word: 'قطة', segments: 'قط . . ة', hint: 'حيوان أليف', emoji: '🐱' },
                    { word: 'بطة', segments: 'بط . . ة', hint: 'طائر يسبح', emoji: '🦆' },
                    { word: 'موزة', segments: 'مو . . زة', hint: 'فاكهة صفراء', emoji: '🍌' },
                    { word: 'جبنة', segments: 'جب . . نة', hint: 'طعام أبيض', emoji: '🧀' },
                    { word: 'بيضة', segments: 'بي . . ضة', hint: 'من الدجاج', emoji: '🥚' },
                    { word: 'نجمة', segments: 'نج . . مة', hint: 'تضيء في السماء', emoji: '⭐' },
                    { word: 'وردة', segments: 'ور . . دة', hint: 'زهرة جميلة', emoji: '🌹' },
                    { word: 'سلمى', segments: 'سل . . مى', hint: 'اسم بنت', emoji: '👧' }
                ],
                level2: [
                    { word: 'مدرسة', segments: 'مد . . رسة', hint: 'نتعلم فيها', emoji: '🏫' },
                    { word: 'مكتبة', segments: 'مك . . تبة', hint: 'مكان الكتب', emoji: '📚' },
                    { word: 'مدينة', segments: 'مدي . . نة', hint: 'مكان كبير نسكن فيه', emoji: '🏙️' },
                    { word: 'سيارة', segments: 'سيا . . رة', hint: 'وسيلة مواصلات', emoji: '🚗' },
                    { word: 'طيارة', segments: 'طيا . . رة', hint: 'تطير في السماء', emoji: '✈️' },
                    { word: 'مكنسة', segments: 'مك . . نسة', hint: 'ننظف بها', emoji: '🧹' },
                    { word: 'ثلاجة', segments: 'ثلا . . جة', hint: 'تبرد الطعام', emoji: '❄️' },
                    { word: 'مقلمة', segments: 'مق . . لمة', hint: 'نضع فيها الأقلام', emoji: '📝' },
                    { word: 'مسطرة', segments: 'مس . . طرة', hint: 'نرسم بها خطوط', emoji: '📏' },
                    { word: 'شمسية', segments: 'شم . . سية', hint: 'تحمي من المطر', emoji: '☂️' },
                    { word: 'مراية', segments: 'مرا . . ية', hint: 'نرى فيها أنفسنا', emoji: '🪞' },
                    { word: 'زرافة', segments: 'زرا . . فة', hint: 'حيوان طويل الرقبة', emoji: '🦒' },
                    { word: 'فراشة', segments: 'فرا . . شة', hint: 'حشرة جميلة تطير', emoji: '🦋' },
                    { word: 'تفاحة', segments: 'تفا . . حة', hint: 'فاكهة حمراء', emoji: '🍎' },
                    { word: 'طماطم', segments: 'طما . . طم', hint: 'خضار حمراء', emoji: '🍅' },
                    { word: 'بطاطس', segments: 'بطا . . طس', hint: 'خضار نأكلها مقلية', emoji: '🥔' }
                ]
            };

            // Add simple words with separate letters for level 3
            const simpleWords = [
                { word: 'باب', segments: 'ب . . ا . . ب', hint: 'مدخل البيت', emoji: '🚪' },
                { word: 'بيت', segments: 'ب . . ي . . ت', hint: 'مكان نسكن فيه', emoji: '🏠' },
                { word: 'نور', segments: 'ن . . و . . ر', hint: 'ضوء', emoji: '💡' },
                { word: 'كتاب', segments: 'ك . . تا . . ب', hint: 'نقرأ فيه', emoji: '📖' }
            ];

            // Combine all levels for level 3
            gameData.level3 = [...gameData.level1, ...gameData.level2, ...simpleWords];

            // Game state
            let currentLevel = 1;
            let currentQuestionIndex = 0;
            let currentQuestions = [];
            let score = 0;
            let attemptCount = 0;
            let currentWord = null;

            // Audio context for sound effects
            let audioContext;

            function initAudio() {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            // Sound effects
            function playBuzzer() {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.type = 'sawtooth';
                oscillator.frequency.value = 200;

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            }

            function playGlitter() {
                initAudio();
                const frequencies = [600, 800, 1000, 1200];

                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.type = 'sine';
                        oscillator.frequency.value = freq;

                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);

                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.15);
                    }, index * 120);
                });
            }

            // Text-to-speech
            function speakSegments() {
                if (!currentWord) return;

                const utterance = new SpeechSynthesisUtterance();
                utterance.text = currentWord.segments.replace(/\s\.\s\./g, ' ');
                utterance.lang = 'ar-SA';
                utterance.rate = 0.6;
                utterance.pitch = 1.2;

                speechSynthesis.speak(utterance);
            }

            // Game logic
            function startGame(level) {
                currentLevel = level;
                currentQuestionIndex = 0;
                score = 0;

                // Select 10 random questions from the chosen level
                const levelData = gameData[`level${level}`];
                currentQuestions = shuffleArray([...levelData]).slice(0, 10);

                showPanel('gamePanel');
                nextQuestion();
            }

            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            function nextQuestion() {
                if (currentQuestionIndex >= 10) {
                    endGame();
                    return;
                }

                currentWord = currentQuestions[currentQuestionIndex];
                attemptCount = 0;

                // Update UI
                document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
                document.getElementById('score').textContent = score;
                document.getElementById('segmentsDisplay').textContent = currentWord.segments;
                document.getElementById('answerInput').value = '';
                document.getElementById('feedback').textContent = '';
                document.getElementById('feedback').className = 'feedback';
                document.getElementById('hint').style.display = 'none';

                // Update progress bar
                const progress = (currentQuestionIndex / 10) * 100;
                document.getElementById('progressFill').style.width = progress + '%';

                // Speak the segments automatically
                setTimeout(speakSegments, 500);

                // Focus on input
                document.getElementById('answerInput').focus();
            }

            function checkAnswer() {
                const userAnswer = document.getElementById('answerInput').value.trim();
                const correctAnswer = currentWord.word;

                if (userAnswer === correctAnswer) {
                    // Correct answer
                    score++;
                    playGlitter();
                    showFeedback('success', `أحسنت! ${currentWord.emoji} ${correctAnswer}`, currentWord.emoji);

                    // Auto advance to next question
                    setTimeout(() => {
                        currentQuestionIndex++;
                        nextQuestion();
                    }, 1500);
                } else {
                    // Wrong answer
                    attemptCount++;
                    playBuzzer();

                    if (attemptCount === 1) {
                        showFeedback('error', 'حاول مرة أخرى! استمع جيداً للأصوات');
                        speakSegments();
                    } else if (attemptCount === 2) {
                        showFeedback('error', 'محاولة أخيرة!');
                        document.getElementById('hint').textContent = `تلميح: ${currentWord.hint}`;
                        document.getElementById('hint').style.display = 'block';
                    } else {
                        // Show answer after 3 attempts
                        showFeedback('error', `الإجابة الصحيحة: ${currentWord.emoji} ${correctAnswer}`);
                        setTimeout(() => {
                            currentQuestionIndex++;
                            nextQuestion();
                        }, 2000);
                    }
                }
            }

            function showFeedback(type, message, emoji = '') {
                const feedback = document.getElementById('feedback');
                feedback.className = `feedback ${type}`;
                feedback.innerHTML = emoji ? `${emoji} ${message}` : message;

                if (type === 'success') {
                    feedback.classList.add('celebrate');
                    setTimeout(() => feedback.classList.remove('celebrate'), 600);
                }
            }

            function skipQuestion() {
                currentQuestionIndex++;
                nextQuestion();
            }

            function endGame() {
                const percentage = Math.round((score / 10) * 100);
                let emoji, message;

                if (percentage >= 80) {
                    emoji = '🌟';
                    message = 'أداء ممتاز! أنت نجم!';
                } else if (percentage >= 60) {
                    emoji = '👏';
                    message = 'أداء جيد جداً! واصل التدريب';
                } else if (percentage >= 40) {
                    emoji = '💪';
                    message = 'أداء لا بأس به! تحتاج لمزيد من التدريب';
                } else {
                    emoji = '🎯';
                    message = 'لا تيأس! المحاولة مرة أخرى ستكون أفضل';
                }

                document.getElementById('finalScore').textContent = `${score}/10`;
                document.getElementById('resultEmoji').textContent = emoji;
                document.getElementById('resultMessage').textContent = message;

                showPanel('resultsPanel');
            }

            function restartGame() {
                startGame(currentLevel);
            }

            function showLevels() {
                showPanel('levelPanel');
            }

            function showPanel(panelId) {
                document.querySelectorAll('.panel').forEach((panel) => {
                    panel.classList.remove('active');
                });
                document.getElementById(panelId).classList.add('active');
            }

            // Event listeners
            document.getElementById('answerInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });

            document.addEventListener('keydown', function (e) {
                if (e.key === ' ' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    speakSegments();
                }
            });

            // Initialize
            window.onload = function () {
                showPanel('levelPanel');
            };
        </script>
    </body>
</html>
