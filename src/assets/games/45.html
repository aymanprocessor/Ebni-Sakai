<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù„Ø¹Ø¨Ø© ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ù† Ø£ØµÙˆØ§ØªÙ‡Ø§</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
                direction: rtl;
            }

            .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
            }

            header {
                text-align: center;
                margin-bottom: 30px;
                background: white;
                border-radius: 20px;
                padding: 20px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

            h1 {
                color: #4a5568;
                font-size: 28px;
                margin-bottom: 10px;
            }

            .subtitle {
                color: #718096;
                font-size: 18px;
            }

            .panel {
                background: white;
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                text-align: center;
                display: none;
            }

            .panel.active {
                display: block;
            }

            .level-select {
                display: grid;
                gap: 20px;
                margin: 20px 0;
            }

            .level-btn {
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 20px;
                border-radius: 15px;
                font-size: 20px;
                cursor: pointer;
                transition:
                    transform 0.3s,
                    box-shadow 0.3s;
                font-family: inherit;
            }

            .level-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            }

            .segments-display {
                background: #f7fafc;
                border: 3px dashed #cbd5e0;
                border-radius: 15px;
                padding: 30px;
                margin: 30px 0;
                font-size: 32px;
                font-weight: bold;
                color: #2d3748;
                letter-spacing: 3px;
                min-height: 80px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .question-text {
                font-size: 24px;
                color: #4a5568;
                margin: 20px 0;
                font-weight: bold;
            }

            .input-section {
                margin: 30px 0;
            }

            .answer-input {
                font-size: 24px;
                padding: 15px 20px;
                border: 3px solid #cbd5e0;
                border-radius: 15px;
                width: 100%;
                max-width: 300px;
                text-align: center;
                font-family: inherit;
                direction: rtl;
            }

            .answer-input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            .buttons {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
                margin: 20px 0;
            }

            .btn {
                background: #667eea;
                color: white;
                border: none;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 18px;
                cursor: pointer;
                transition: all 0.3s;
                font-family: inherit;
                min-width: 120px;
            }

            .btn:hover {
                background: #5a67d8;
                transform: translateY(-2px);
            }

            .btn:disabled {
                background: #a0aec0;
                cursor: not-allowed;
                transform: none;
            }

            .btn-success {
                background: #48bb78;
            }

            .btn-success:hover {
                background: #38a169;
            }

            .btn-danger {
                background: #f56565;
            }

            .btn-danger:hover {
                background: #e53e3e;
            }

            .progress-section {
                margin: 20px 0;
                text-align: center;
            }

            .progress-bar {
                background: #e2e8f0;
                border-radius: 25px;
                height: 10px;
                margin: 10px 0;
                overflow: hidden;
            }

            .progress-fill {
                background: linear-gradient(45deg, #667eea, #764ba2);
                height: 100%;
                border-radius: 25px;
                transition: width 0.5s ease;
                width: 0%;
            }

            .stats {
                display: flex;
                justify-content: space-around;
                margin: 20px 0;
                font-size: 18px;
                font-weight: bold;
            }

            .feedback {
                margin: 20px 0;
                padding: 15px;
                border-radius: 10px;
                font-size: 18px;
                min-height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .feedback.success {
                background: #c6f6d5;
                color: #22543d;
                border: 2px solid #48bb78;
            }

            .feedback.error {
                background: #fed7d7;
                color: #742a2a;
                border: 2px solid #f56565;
            }

            .hint {
                background: #fef5e7;
                color: #744210;
                border: 2px solid #ed8936;
                padding: 10px 15px;
                border-radius: 10px;
                margin: 10px 0;
                font-size: 16px;
            }

            .word-result {
                font-size: 36px;
                margin: 20px 0;
                color: #2d3748;
            }

            .emoji {
                font-size: 48px;
                margin: 10px 0;
            }

            .final-results {
                text-align: center;
                font-size: 24px;
            }

            .final-score {
                font-size: 48px;
                color: #667eea;
                font-weight: bold;
                margin: 20px 0;
            }

            @media (max-width: 600px) {
                .container {
                    padding: 10px;
                }

                .segments-display {
                    font-size: 24px;
                    padding: 20px;
                }

                .question-text {
                    font-size: 20px;
                }

                .answer-input {
                    font-size: 20px;
                }

                .btn {
                    font-size: 16px;
                    padding: 12px 20px;
                    min-width: 100px;
                }
            }

            /* Accessibility improvements */
            .btn:focus,
            .answer-input:focus,
            .level-btn:focus {
                outline: 3px solid #667eea;
                outline-offset: 2px;
            }

            /* Animation for correct answer */
            @keyframes celebration {
                0%,
                100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }

            .celebrate {
                animation: celebration 0.6s ease-in-out;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <h1>ğŸ¯ Ù„Ø¹Ø¨Ø© ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ù† Ø£ØµÙˆØ§ØªÙ‡Ø§</h1>
                <p class="subtitle">Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø·ÙÙ„ Ø¹Ù„Ù‰ ØªØ¹Ù„Ù… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø£ØµÙˆØ§ØªÙ‡Ø§</p>
            </header>

            <!-- Level Selection Panel -->
            <div class="panel active" id="levelPanel">
                <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h2>
                <div class="level-select">
                    <button class="level-btn" onclick="startGame(1)" aria-label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ - ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ù…Ù‚Ø·Ø¹ÙŠÙ†">
                        ğŸ“š Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„
                        <br /><small>ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ù…Ù‚Ø·Ø¹ÙŠÙ† (Ù…Ø§Ù…Ø§ØŒ Ø¨Ø§Ø¨Ø§ØŒ Ù‚Ù„Ù…)</small>
                    </button>
                    <button class="level-btn" onclick="startGame(2)" aria-label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ - ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø«Ù„Ø§Ø«Ø© Ù…Ù‚Ø§Ø·Ø¹">
                        ğŸ“ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ
                        <br /><small>ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø«Ù„Ø§Ø«Ø© Ù…Ù‚Ø§Ø·Ø¹ (Ù…Ø¯Ø±Ø³Ø©ØŒ Ø³ÙŠØ§Ø±Ø©)</small>
                    </button>
                    <button class="level-btn" onclick="startGame(3)" aria-label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø« - Ù…Ø²ÙŠØ¬ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙŠÙŠÙ†">
                        ğŸ† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«
                        <br /><small>Ù…Ø²ÙŠØ¬ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</small>
                    </button>
                </div>
            </div>

            <!-- Game Panel -->
            <div class="panel" id="gamePanel">
                <div class="progress-section">
                    <div class="stats">
                        <span>Ø§Ù„Ø³Ø¤Ø§Ù„: <span id="currentQ">1</span>/10</span>
                        <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div class="segments-display" id="segmentsDisplay">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</div>

                <div class="question-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ</div>

                <div class="input-section">
                    <input type="text" class="answer-input" id="answerInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù‡Ù†Ø§" aria-label="Ù…ÙƒØ§Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©" />
                </div>

                <div class="buttons">
                    <button class="btn" id="listenBtn" onclick="speakSegments()" aria-label="Ø£Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹">ğŸ”Š Ø£Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹</button>
                    <button class="btn btn-success" id="checkBtn" onclick="checkAnswer()" aria-label="ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©">âœ… ØªØ­Ù‚Ù‚</button>
                </div>

                <div class="feedback" id="feedback"></div>
                <div class="hint" id="hint" style="display: none"></div>

                <div class="buttons">
                    <button class="btn btn-danger" onclick="showLevels()" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø³ØªÙˆÙŠØ§Øª">ğŸ  Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</button>
                    <button class="btn" onclick="skipQuestion()" aria-label="ØªØ®Ø·ÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„">â­ï¸ ØªØ®Ø·ÙŠ</button>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="panel" id="resultsPanel">
                <div class="final-results">
                    <h2>ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©!</h2>
                    <div class="final-score" id="finalScore">8/10</div>
                    <div class="emoji" id="resultEmoji">ğŸŒŸ</div>
                    <p id="resultMessage">Ø£Ø­Ø³Ù†Øª! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹</p>

                    <div class="buttons">
                        <button class="btn btn-success" onclick="restartGame()" aria-label="Ø¥Ø¹Ø§Ø¯Ø© Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªÙˆÙ‰">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
                        <button class="btn" onclick="showLevels()" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯">ğŸ“š Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Game Data
            const gameData = {
                level1: [
                    { word: 'Ù…Ø§Ù…Ø§', segments: 'Ù…Ø§ . . Ù…Ø§', hint: 'Ø£Ù…ÙŠ Ø§Ù„Ø­Ø¨ÙŠØ¨Ø©', emoji: 'ğŸ‘©' },
                    { word: 'Ø¨Ø§Ø¨Ø§', segments: 'Ø¨Ø§ . . Ø¨Ø§', hint: 'Ø£Ø¨ÙŠ Ø§Ù„Ø­Ø¨ÙŠØ¨', emoji: 'ğŸ‘¨' },
                    { word: 'ÙƒØ±Ø³ÙŠ', segments: 'ÙƒØ± . . Ø³ÙŠ', hint: 'Ù†Ø¬Ù„Ø³ Ø¹Ù„ÙŠÙ‡', emoji: 'ğŸª‘' },
                    { word: 'Ù‚Ù„Ù…', segments: 'Ù‚Ù€Ù„ . . Ù…', hint: 'Ù†ÙƒØªØ¨ Ø¨Ù‡', emoji: 'âœï¸' },
                    { word: 'Ø´Ù†Ø·Ø©', segments: 'Ø´Ù† . . Ø·Ø©', hint: 'Ù†Ø­Ù…Ù„ ÙÙŠÙ‡Ø§ Ø§Ù„ÙƒØªØ¨', emoji: 'ğŸ’' },
                    { word: 'Ù„Ù…Ø¨Ø©', segments: 'Ù„Ù… . . Ø¨Ø©', hint: 'ØªØ¶ÙŠØ¡ Ø§Ù„ØºØ±ÙØ©', emoji: 'ğŸ’¡' },
                    { word: 'ÙƒÙˆØ±Ø©', segments: 'ÙƒÙˆ . . Ø±Ø©', hint: 'Ù†Ù„Ø¹Ø¨ Ø¨Ù‡Ø§', emoji: 'âš½' },
                    { word: 'Ù‚Ø·Ø©', segments: 'Ù‚Ø· . . Ø©', hint: 'Ø­ÙŠÙˆØ§Ù† Ø£Ù„ÙŠÙ', emoji: 'ğŸ±' },
                    { word: 'Ø¨Ø·Ø©', segments: 'Ø¨Ø· . . Ø©', hint: 'Ø·Ø§Ø¦Ø± ÙŠØ³Ø¨Ø­', emoji: 'ğŸ¦†' },
                    { word: 'Ù…ÙˆØ²Ø©', segments: 'Ù…Ùˆ . . Ø²Ø©', hint: 'ÙØ§ÙƒÙ‡Ø© ØµÙØ±Ø§Ø¡', emoji: 'ğŸŒ' },
                    { word: 'Ø¬Ø¨Ù†Ø©', segments: 'Ø¬Ø¨ . . Ù†Ø©', hint: 'Ø·Ø¹Ø§Ù… Ø£Ø¨ÙŠØ¶', emoji: 'ğŸ§€' },
                    { word: 'Ø¨ÙŠØ¶Ø©', segments: 'Ø¨ÙŠ . . Ø¶Ø©', hint: 'Ù…Ù† Ø§Ù„Ø¯Ø¬Ø§Ø¬', emoji: 'ğŸ¥š' },
                    { word: 'Ù†Ø¬Ù…Ø©', segments: 'Ù†Ø¬ . . Ù…Ø©', hint: 'ØªØ¶ÙŠØ¡ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'â­' },
                    { word: 'ÙˆØ±Ø¯Ø©', segments: 'ÙˆØ± . . Ø¯Ø©', hint: 'Ø²Ù‡Ø±Ø© Ø¬Ù…ÙŠÙ„Ø©', emoji: 'ğŸŒ¹' },
                    { word: 'Ø³Ù„Ù…Ù‰', segments: 'Ø³Ù„ . . Ù…Ù‰', hint: 'Ø§Ø³Ù… Ø¨Ù†Øª', emoji: 'ğŸ‘§' }
                ],
                level2: [
                    { word: 'Ù…Ø¯Ø±Ø³Ø©', segments: 'Ù…Ø¯ . . Ø±Ø³Ø©', hint: 'Ù†ØªØ¹Ù„Ù… ÙÙŠÙ‡Ø§', emoji: 'ğŸ«' },
                    { word: 'Ù…ÙƒØªØ¨Ø©', segments: 'Ù…Ùƒ . . ØªØ¨Ø©', hint: 'Ù…ÙƒØ§Ù† Ø§Ù„ÙƒØªØ¨', emoji: 'ğŸ“š' },
                    { word: 'Ù…Ø¯ÙŠÙ†Ø©', segments: 'Ù…Ø¯ÙŠ . . Ù†Ø©', hint: 'Ù…ÙƒØ§Ù† ÙƒØ¨ÙŠØ± Ù†Ø³ÙƒÙ† ÙÙŠÙ‡', emoji: 'ğŸ™ï¸' },
                    { word: 'Ø³ÙŠØ§Ø±Ø©', segments: 'Ø³ÙŠØ§ . . Ø±Ø©', hint: 'ÙˆØ³ÙŠÙ„Ø© Ù…ÙˆØ§ØµÙ„Ø§Øª', emoji: 'ğŸš—' },
                    { word: 'Ø·ÙŠØ§Ø±Ø©', segments: 'Ø·ÙŠØ§ . . Ø±Ø©', hint: 'ØªØ·ÙŠØ± ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', emoji: 'âœˆï¸' },
                    { word: 'Ù…ÙƒÙ†Ø³Ø©', segments: 'Ù…Ùƒ . . Ù†Ø³Ø©', hint: 'Ù†Ù†Ø¸Ù Ø¨Ù‡Ø§', emoji: 'ğŸ§¹' },
                    { word: 'Ø«Ù„Ø§Ø¬Ø©', segments: 'Ø«Ù„Ø§ . . Ø¬Ø©', hint: 'ØªØ¨Ø±Ø¯ Ø§Ù„Ø·Ø¹Ø§Ù…', emoji: 'â„ï¸' },
                    { word: 'Ù…Ù‚Ù„Ù…Ø©', segments: 'Ù…Ù‚ . . Ù„Ù…Ø©', hint: 'Ù†Ø¶Ø¹ ÙÙŠÙ‡Ø§ Ø§Ù„Ø£Ù‚Ù„Ø§Ù…', emoji: 'ğŸ“' },
                    { word: 'Ù…Ø³Ø·Ø±Ø©', segments: 'Ù…Ø³ . . Ø·Ø±Ø©', hint: 'Ù†Ø±Ø³Ù… Ø¨Ù‡Ø§ Ø®Ø·ÙˆØ·', emoji: 'ğŸ“' },
                    { word: 'Ø´Ù…Ø³ÙŠØ©', segments: 'Ø´Ù… . . Ø³ÙŠØ©', hint: 'ØªØ­Ù…ÙŠ Ù…Ù† Ø§Ù„Ù…Ø·Ø±', emoji: 'â˜‚ï¸' },
                    { word: 'Ù…Ø±Ø§ÙŠØ©', segments: 'Ù…Ø±Ø§ . . ÙŠØ©', hint: 'Ù†Ø±Ù‰ ÙÙŠÙ‡Ø§ Ø£Ù†ÙØ³Ù†Ø§', emoji: 'ğŸª' },
                    { word: 'Ø²Ø±Ø§ÙØ©', segments: 'Ø²Ø±Ø§ . . ÙØ©', hint: 'Ø­ÙŠÙˆØ§Ù† Ø·ÙˆÙŠÙ„ Ø§Ù„Ø±Ù‚Ø¨Ø©', emoji: 'ğŸ¦’' },
                    { word: 'ÙØ±Ø§Ø´Ø©', segments: 'ÙØ±Ø§ . . Ø´Ø©', hint: 'Ø­Ø´Ø±Ø© Ø¬Ù…ÙŠÙ„Ø© ØªØ·ÙŠØ±', emoji: 'ğŸ¦‹' },
                    { word: 'ØªÙØ§Ø­Ø©', segments: 'ØªÙØ§ . . Ø­Ø©', hint: 'ÙØ§ÙƒÙ‡Ø© Ø­Ù…Ø±Ø§Ø¡', emoji: 'ğŸ' },
                    { word: 'Ø·Ù…Ø§Ø·Ù…', segments: 'Ø·Ù…Ø§ . . Ø·Ù…', hint: 'Ø®Ø¶Ø§Ø± Ø­Ù…Ø±Ø§Ø¡', emoji: 'ğŸ…' },
                    { word: 'Ø¨Ø·Ø§Ø·Ø³', segments: 'Ø¨Ø·Ø§ . . Ø·Ø³', hint: 'Ø®Ø¶Ø§Ø± Ù†Ø£ÙƒÙ„Ù‡Ø§ Ù…Ù‚Ù„ÙŠØ©', emoji: 'ğŸ¥”' }
                ]
            };

            // Add simple words with separate letters for level 3
            const simpleWords = [
                { word: 'Ø¨Ø§Ø¨', segments: 'Ø¨ . . Ø§ . . Ø¨', hint: 'Ù…Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØª', emoji: 'ğŸšª' },
                { word: 'Ø¨ÙŠØª', segments: 'Ø¨ . . ÙŠ . . Øª', hint: 'Ù…ÙƒØ§Ù† Ù†Ø³ÙƒÙ† ÙÙŠÙ‡', emoji: 'ğŸ ' },
                { word: 'Ù†ÙˆØ±', segments: 'Ù† . . Ùˆ . . Ø±', hint: 'Ø¶ÙˆØ¡', emoji: 'ğŸ’¡' },
                { word: 'ÙƒØªØ§Ø¨', segments: 'Ùƒ . . ØªØ§ . . Ø¨', hint: 'Ù†Ù‚Ø±Ø£ ÙÙŠÙ‡', emoji: 'ğŸ“–' }
            ];

            // Combine all levels for level 3
            gameData.level3 = [...gameData.level1, ...gameData.level2, ...simpleWords];

            // Game state
            let currentLevel = 1;
            let currentQuestionIndex = 0;
            let currentQuestions = [];
            let score = 0;
            let attemptCount = 0;
            let currentWord = null;

            // Audio context for sound effects
            let audioContext;

            function initAudio() {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            // Sound effects
            function playBuzzer() {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.type = 'sawtooth';
                oscillator.frequency.value = 200;

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            }

            function playGlitter() {
                initAudio();
                const frequencies = [600, 800, 1000, 1200];

                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.type = 'sine';
                        oscillator.frequency.value = freq;

                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);

                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.15);
                    }, index * 120);
                });
            }

            // Text-to-speech
            function speakSegments() {
                if (!currentWord) return;

                const utterance = new SpeechSynthesisUtterance();
                utterance.text = currentWord.segments.replace(/\s\.\s\./g, ' ');
                utterance.lang = 'ar-SA';
                utterance.rate = 0.6;
                utterance.pitch = 1.2;

                speechSynthesis.speak(utterance);
            }

            // Game logic
            function startGame(level) {
                currentLevel = level;
                currentQuestionIndex = 0;
                score = 0;

                // Select 10 random questions from the chosen level
                const levelData = gameData[`level${level}`];
                currentQuestions = shuffleArray([...levelData]).slice(0, 10);

                showPanel('gamePanel');
                nextQuestion();
            }

            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            function nextQuestion() {
                if (currentQuestionIndex >= 10) {
                    endGame();
                    return;
                }

                currentWord = currentQuestions[currentQuestionIndex];
                attemptCount = 0;

                // Update UI
                document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
                document.getElementById('score').textContent = score;
                document.getElementById('segmentsDisplay').textContent = currentWord.segments;
                document.getElementById('answerInput').value = '';
                document.getElementById('feedback').textContent = '';
                document.getElementById('feedback').className = 'feedback';
                document.getElementById('hint').style.display = 'none';

                // Update progress bar
                const progress = (currentQuestionIndex / 10) * 100;
                document.getElementById('progressFill').style.width = progress + '%';

                // Speak the segments automatically
                setTimeout(speakSegments, 500);

                // Focus on input
                document.getElementById('answerInput').focus();
            }

            function checkAnswer() {
                const userAnswer = document.getElementById('answerInput').value.trim();
                const correctAnswer = currentWord.word;

                if (userAnswer === correctAnswer) {
                    // Correct answer
                    score++;
                    playGlitter();
                    showFeedback('success', `Ø£Ø­Ø³Ù†Øª! ${currentWord.emoji} ${correctAnswer}`, currentWord.emoji);

                    // Auto advance to next question
                    setTimeout(() => {
                        currentQuestionIndex++;
                        nextQuestion();
                    }, 1500);
                } else {
                    // Wrong answer
                    attemptCount++;
                    playBuzzer();

                    if (attemptCount === 1) {
                        showFeedback('error', 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! Ø§Ø³ØªÙ…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹ Ù„Ù„Ø£ØµÙˆØ§Øª');
                        speakSegments();
                    } else if (attemptCount === 2) {
                        showFeedback('error', 'Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ø®ÙŠØ±Ø©!');
                        document.getElementById('hint').textContent = `ØªÙ„Ù…ÙŠØ­: ${currentWord.hint}`;
                        document.getElementById('hint').style.display = 'block';
                    } else {
                        // Show answer after 3 attempts
                        showFeedback('error', `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${currentWord.emoji} ${correctAnswer}`);
                        setTimeout(() => {
                            currentQuestionIndex++;
                            nextQuestion();
                        }, 2000);
                    }
                }
            }

            function showFeedback(type, message, emoji = '') {
                const feedback = document.getElementById('feedback');
                feedback.className = `feedback ${type}`;
                feedback.innerHTML = emoji ? `${emoji} ${message}` : message;

                if (type === 'success') {
                    feedback.classList.add('celebrate');
                    setTimeout(() => feedback.classList.remove('celebrate'), 600);
                }
            }

            function skipQuestion() {
                currentQuestionIndex++;
                nextQuestion();
            }

            function endGame() {
                const percentage = Math.round((score / 10) * 100);
                let emoji, message;

                if (percentage >= 80) {
                    emoji = 'ğŸŒŸ';
                    message = 'Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²! Ø£Ù†Øª Ù†Ø¬Ù…!';
                } else if (percentage >= 60) {
                    emoji = 'ğŸ‘';
                    message = 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! ÙˆØ§ØµÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨';
                } else if (percentage >= 40) {
                    emoji = 'ğŸ’ª';
                    message = 'Ø£Ø¯Ø§Ø¡ Ù„Ø§ Ø¨Ø£Ø³ Ø¨Ù‡! ØªØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨';
                } else {
                    emoji = 'ğŸ¯';
                    message = 'Ù„Ø§ ØªÙŠØ£Ø³! Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø³ØªÙƒÙˆÙ† Ø£ÙØ¶Ù„';
                }

                document.getElementById('finalScore').textContent = `${score}/10`;
                document.getElementById('resultEmoji').textContent = emoji;
                document.getElementById('resultMessage').textContent = message;

                showPanel('resultsPanel');
            }

            function restartGame() {
                startGame(currentLevel);
            }

            function showLevels() {
                showPanel('levelPanel');
            }

            function showPanel(panelId) {
                document.querySelectorAll('.panel').forEach((panel) => {
                    panel.classList.remove('active');
                });
                document.getElementById(panelId).classList.add('active');
            }

            // Event listeners
            document.getElementById('answerInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });

            document.addEventListener('keydown', function (e) {
                if (e.key === ' ' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    speakSegments();
                }
            });

            // Initialize
            window.onload = function () {
                showPanel('levelPanel');
            };
        </script>
    </body>
</html>
