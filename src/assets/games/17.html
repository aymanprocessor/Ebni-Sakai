<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>لعبة تصنيف الأطعمة (HTML/JS)</title>
        <style>
            :root {
                --bg1: #f5f7fb;
                --accent: #25d366;
            }
            html,
            body {
                height: 100%;
                margin: 0;
                font-family:
                    system-ui,
                    -apple-system,
                    'Segoe UI',
                    Roboto,
                    'Noto Naskh Arabic',
                    sans-serif;
            }
            body {
                background: linear-gradient(135deg, #b3a3ff 0%, #ff9bb3 50%, #ffd3a5 100%);
                min-height: 100vh;
                padding: 16px;
            }
            .card {
                background: #fff;
                border-radius: 20px;
                box-shadow: 0 12px 30px rgba(2, 6, 23, 0.12);
                padding: 20px;
            }
            .center {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            h1 {
                font-size: 28px;
                margin: 0 0 12px;
            }
            .levels {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 16px;
                margin-bottom: 18px;
            }
            .level-tile {
                color: #fff;
                padding: 18px;
                border-radius: 14px;
                cursor: pointer;
                transition:
                    transform 0.18s,
                    opacity 0.18s;
            }
            .level-tile.locked {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .level-tile:hover {
                transform: translateY(-6px);
            }
            .grid-main {
                display: grid;
                grid-template-columns: 1fr 360px;
                gap: 16px;
            }
            @media (max-width: 980px) {
                .grid-main {
                    grid-template-columns: 1fr;
                }
            }
            .items-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                max-height: 420px;
                overflow: auto;
            }
            .item {
                background: linear-gradient(135deg, #fff8e1, #fff0d1);
                border-radius: 12px;
                padding: 10px;
                text-align: center;
                cursor: grab;
                border: 2px solid rgba(0, 0, 0, 0.04);
                transition:
                    transform 0.15s,
                    box-shadow 0.15s;
            }
            .item:active {
                cursor: grabbing;
            }
            .item:hover {
                transform: scale(1.05);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            }
            .emoji {
                font-size: 28px;
            }
            .category-box {
                padding: 14px;
                border-radius: 14px;
                min-height: 120px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                justify-content: flex-start;
            }
            .category-box .title {
                font-weight: 700;
                color: #fff;
            }
            .category-content {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                margin-top: 8px;
            }
            .placed {
                background: rgba(255, 255, 255, 0.9);
                padding: 6px;
                border-radius: 8px;
                text-align: center;
            }
            .controls {
                display: flex;
                gap: 8px;
                align-items: center;
            }
            button {
                border: 0;
                background: #eee;
                padding: 8px 12px;
                border-radius: 8px;
                cursor: pointer;
            }
            button.primary {
                background: linear-gradient(90deg, #3b82f6, #06b6d4);
                color: #fff;
            }
            .progress {
                height: 10px;
                background: #eee;
                border-radius: 20px;
                overflow: hidden;
            }
            .progress > i {
                display: block;
                height: 100%;
                background: linear-gradient(90deg, #34d399, #60a5fa);
                width: 0;
            }
            .muted {
                color: #666;
            }
            /* category colors */
            .fruits {
                background: linear-gradient(135deg, #34d399, #10b981);
                border: 4px dashed rgba(255, 255, 255, 0.18);
            }
            .vegetables {
                background: linear-gradient(135deg, #fb923c, #f97316);
                border: 4px dashed rgba(255, 255, 255, 0.18);
            }
            .sweets {
                background: linear-gradient(135deg, #fb7185, #f472b6);
                border: 4px dashed rgba(255, 255, 255, 0.18);
            }
            .meals {
                background: linear-gradient(135deg, #60a5fa, #3b82f6);
                border: 4px dashed rgba(255, 255, 255, 0.18);
            }
            .locked-icon {
                font-size: 28px;
                opacity: 0.95;
            }
            .center-col {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
            .big-emoji {
                font-size: 48px;
            }
        </style>
    </head>
    <body>
        <div id="app">
            <!-- Menu / main screen -->
            <div id="menu" class="center" style="min-height: 80vh">
                <div class="card" style="max-width: 980px; width: 100%">
                    <h1 class="center">🎯 لعبة تصنيف الأطعمة</h1>
                    <div style="text-align: center; margin-bottom: 12px">
                        <div style="font-weight: 700; color: #6b21a8">🏅 النقاط الإجمالية: <span id="totalScore">0</span></div>
                    </div>

                    <div class="levels" id="levelsContainer"></div>

                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px">
                        <div style="background: #ecfccb; padding: 12px; border-radius: 12px; text-align: center">
                            <div style="font-size: 22px">🍎</div>
                            <div style="font-weight: 700; color: #166534">فواكه</div>
                            <div class="muted">المستوى الأول</div>
                        </div>
                        <div style="background: #fff7ed; padding: 12px; border-radius: 12px; text-align: center">
                            <div style="font-size: 22px">🥕</div>
                            <div style="font-weight: 700; color: #92400e">خضروات</div>
                            <div class="muted">المستوى الأول</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game screen -->
            <div id="game" style="display: none">
                <div class="card" style="margin-bottom: 12px">
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap">
                        <div style="display: flex; align-items: center; gap: 12px">
                            <div id="levelName" style="background: #34d399; color: #fff; padding: 8px 10px; border-radius: 10px; font-weight: 700"></div>
                            <div style="font-weight: 700">الصفحة <span id="currentPage">1</span>/<span id="totalPages">2</span></div>
                        </div>
                        <div style="text-align: center">
                            <div style="font-weight: 800; color: #7835b1">⭐ النقاط: <span id="score">0</span></div>
                            <div class="muted">التقدم: <span id="progressPercent">0</span>%</div>
                            <div class="progress" style="width: 160px; margin: 6px auto"><i id="progressBar"></i></div>
                        </div>
                        <div style="display: flex; gap: 8px">
                            <button id="prevBtn">◀ سابقة</button>
                            <button id="nextBtn">التالي ▶</button>
                            <button id="homeBtn">🏠 الرئيسية</button>
                        </div>
                    </div>
                </div>

                <div class="grid-main">
                    <div>
                        <div class="card">
                            <h2 style="text-align: center">🍽️ اسحب الأطعمة إلى الصناديق الصحيحة</h2>
                            <div id="itemsGrid" class="items-grid" aria-live="polite" style="margin-top: 12px"></div>
                            <div id="allPlaced" style="display: none; text-align: center; padding: 18px">
                                <div class="big-emoji">🎉</div>
                                <div class="muted">تم وضع جميع الأطعمة!</div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div id="categoriesColumn" class="center-col"></div>
                    </div>
                </div>

                <div style="margin-top: 12px">
                    <div class="card" style="text-align: center">
                        <div id="instructions">🎯 اسحب كل طعام إلى الصندوق الصحيح • كل إجابة صحيحة = 10 نقاط</div>
                    </div>
                </div>
            </div>

            <!-- Page complete overlay -->
            <div id="pageComplete" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.45); align-items: center; justify-content: center">
                <div class="card" style="max-width: 420px; margin: auto; text-align: center">
                    <div style="font-size: 56px">🎉</div>
                    <h2>أحسنت!</h2>
                    <p id="pcText"></p>
                    <div style="font-weight: 700; color: #2563eb; margin: 10px 0">النقاط: <span id="pcScore">0</span></div>
                    <button id="pcNext" class="primary">الصفحة التالية ▶</button>
                </div>
            </div>

            <!-- Level complete overlay -->
            <div id="levelComplete" style="display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.45); align-items: center; justify-content: center">
                <div class="card" style="max-width: 420px; margin: auto; text-align: center">
                    <div style="font-size: 56px">🏆</div>
                    <h2>مبروك!</h2>
                    <p id="lcText"></p>
                    <div style="font-weight: 800; color: #7c3aed; margin: 10px 0">النقاط: <span id="lcScore">0</span></div>
                    <div style="display: flex; gap: 8px; justify-content: center">
                        <button id="lcHome" class="primary">🏠 القائمة الرئيسية</button>
                        <button id="lcNext" style="display: none" class="primary">المستوى التالي ▶</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Data (copied from original)
            const allFoodItems = [
                { id: 'apple', name: 'تفاح', emoji: '🍎', category: 'fruits', level: 1, page: 1 },
                { id: 'banana', name: 'موز', emoji: '🍌', category: 'fruits', level: 1, page: 1 },
                { id: 'orange', name: 'برتقال', emoji: '🍊', category: 'fruits', level: 1, page: 1 },
                { id: 'grapes', name: 'عنب', emoji: '🍇', category: 'fruits', level: 1, page: 1 },
                { id: 'carrot', name: 'جزر', emoji: '🥕', category: 'vegetables', level: 1, page: 1 },
                { id: 'tomato', name: 'طماطم', emoji: '🍅', category: 'vegetables', level: 1, page: 1 },
                { id: 'cucumber', name: 'خيار', emoji: '🥒', category: 'vegetables', level: 1, page: 1 },
                { id: 'lettuce', name: 'خس', emoji: '🥬', category: 'vegetables', level: 1, page: 1 },
                { id: 'strawberry', name: 'فراولة', emoji: '🍓', category: 'fruits', level: 1, page: 2 },
                { id: 'watermelon', name: 'بطيخ', emoji: '🍉', category: 'fruits', level: 1, page: 2 },
                { id: 'pineapple', name: 'أناناس', emoji: '🍍', category: 'fruits', level: 1, page: 2 },
                { id: 'peach', name: 'خوخ', emoji: '🍑', category: 'fruits', level: 1, page: 2 },
                { id: 'onion', name: 'بصل', emoji: '🧅', category: 'vegetables', level: 1, page: 2 },
                { id: 'potato', name: 'بطاطس', emoji: '🥔', category: 'vegetables', level: 1, page: 2 },
                { id: 'corn', name: 'ذرة', emoji: '🌽', category: 'vegetables', level: 1, page: 2 },
                { id: 'broccoli', name: 'بروكلي', emoji: '🥦', category: 'vegetables', level: 1, page: 2 },
                { id: 'cake', name: 'كيك', emoji: '🍰', category: 'sweets', level: 2, page: 1 },
                { id: 'cookie', name: 'بسكويت', emoji: '🍪', category: 'sweets', level: 2, page: 1 },
                { id: 'chocolate', name: 'شوكولاتة', emoji: '🍫', category: 'sweets', level: 2, page: 1 },
                { id: 'candy', name: 'حلوى', emoji: '🍭', category: 'sweets', level: 2, page: 1 },
                { id: 'icecream', name: 'آيس كريم', emoji: '🍦', category: 'sweets', level: 2, page: 1 },
                { id: 'bread', name: 'خبز', emoji: '🍞', category: 'meals', level: 2, page: 1 },
                { id: 'cheese', name: 'جبن', emoji: '🧀', category: 'meals', level: 2, page: 1 },
                { id: 'egg', name: 'بيض', emoji: '🥚', category: 'meals', level: 2, page: 1 },
                { id: 'chicken', name: 'دجاج', emoji: '🍗', category: 'meals', level: 2, page: 1 },
                { id: 'fish', name: 'سمك', emoji: '🐟', category: 'meals', level: 2, page: 1 },
                { id: 'donut', name: 'دونات', emoji: '🍩', category: 'sweets', level: 2, page: 2 },
                { id: 'cupcake', name: 'كب كيك', emoji: '🧁', category: 'sweets', level: 2, page: 2 },
                { id: 'honey', name: 'عسل', emoji: '🍯', category: 'sweets', level: 2, page: 2 },
                { id: 'pie', name: 'فطيرة حلوة', emoji: '🥧', category: 'sweets', level: 2, page: 2 },
                { id: 'pudding', name: 'بودينج', emoji: '🍮', category: 'sweets', level: 2, page: 2 },
                { id: 'rice', name: 'أرز', emoji: '🍚', category: 'meals', level: 2, page: 2 },
                { id: 'pasta', name: 'مكرونة', emoji: '🍝', category: 'meals', level: 2, page: 2 },
                { id: 'pizza', name: 'بيتزا', emoji: '🍕', category: 'meals', level: 2, page: 2 },
                { id: 'sandwich', name: 'ساندويش', emoji: '🥪', category: 'meals', level: 2, page: 2 },
                { id: 'soup', name: 'شوربة', emoji: '🍲', category: 'meals', level: 2, page: 2 },
                { id: 'waffle', name: 'وافل', emoji: '🧇', category: 'sweets', level: 3, page: 1 },
                { id: 'pancake', name: 'بان كيك', emoji: '🥞', category: 'sweets', level: 3, page: 1 },
                { id: 'croissant', name: 'كرواسون', emoji: '🥐', category: 'sweets', level: 3, page: 1 },
                { id: 'muffin', name: 'مافن', emoji: '🧁', category: 'sweets', level: 3, page: 1 },
                { id: 'pretzel', name: 'بريتزل', emoji: '🥨', category: 'sweets', level: 3, page: 1 },
                { id: 'lollipop', name: 'مصاصة', emoji: '🍭', category: 'sweets', level: 3, page: 1 },
                { id: 'meat', name: 'لحم', emoji: '🥩', category: 'meals', level: 3, page: 1 },
                { id: 'bacon', name: 'بيكون', emoji: '🥓', category: 'meals', level: 3, page: 1 },
                { id: 'sausage', name: 'نقانق', emoji: '🌭', category: 'meals', level: 3, page: 1 },
                { id: 'burger', name: 'برجر', emoji: '🍔', category: 'meals', level: 3, page: 1 },
                { id: 'fries', name: 'بطاطس مقلية', emoji: '🍟', category: 'meals', level: 3, page: 1 },
                { id: 'taco', name: 'تاكو', emoji: '🌮', category: 'meals', level: 3, page: 1 },
                { id: 'cotton_candy', name: 'غزل البنات', emoji: '🍥', category: 'sweets', level: 3, page: 2 },
                { id: 'gummy', name: 'حلوى مطاطية', emoji: '🍬', category: 'sweets', level: 3, page: 2 },
                { id: 'chocolate_bar', name: 'لوح شوكولاتة', emoji: '🍫', category: 'sweets', level: 3, page: 2 },
                { id: 'caramel', name: 'كراميل', emoji: '🍮', category: 'sweets', level: 3, page: 2 },
                { id: 'jelly', name: 'جيلي', emoji: '🟢', category: 'sweets', level: 3, page: 2 },
                { id: 'candy_cane', name: 'عصا حلوى', emoji: '🍭', category: 'sweets', level: 3, page: 2 },
                { id: 'steak', name: 'ستيك', emoji: '🥩', category: 'meals', level: 3, page: 2 },
                { id: 'drumstick', name: 'فخذ دجاج', emoji: '🍗', category: 'meals', level: 3, page: 2 },
                { id: 'shrimp', name: 'جمبري', emoji: '🍤', category: 'meals', level: 3, page: 2 },
                { id: 'noodles', name: 'نودلز', emoji: '🍜', category: 'meals', level: 3, page: 2 },
                { id: 'salad', name: 'سلطة', emoji: '🥗', category: 'meals', level: 3, page: 2 },
                { id: 'popcorn', name: 'فشار', emoji: '🍿', category: 'meals', level: 3, page: 2 }
            ];

            const categories = {
                fruits: { name: 'فواكه', icon: '🍎', cls: 'fruits' },
                vegetables: { name: 'خضروات', icon: '🥕', cls: 'vegetables' },
                sweets: { name: 'حلويات', icon: '🍰', cls: 'sweets' },
                meals: { name: 'وجبات', icon: '🍽️', cls: 'meals' }
            };

            const levels = {
                1: { name: 'مستوى سهل - فواكه وخضار', itemsPerPage: 8, totalPages: 2 },
                2: { name: 'مستوى متوسط - حلويات ووجبات', itemsPerPage: 10, totalPages: 2 },
                3: { name: 'مستوى صعب - وجبات وحلويات متقدمة', itemsPerPage: 12, totalPages: 2 }
            };

            // State
            let gameStarted = false;
            let currentLevel = 1;
            let currentPage = 1;
            let score = 0;
            let totalScore = 0;
            let placedItems = {}; // { category: [items] }
            let draggedItem = null;
            let completedLevels = [];
            let levelComplete = false;

            // DOM refs
            const menuEl = document.getElementById('menu');
            const gameEl = document.getElementById('game');
            const itemsGrid = document.getElementById('itemsGrid');
            const categoriesColumn = document.getElementById('categoriesColumn');
            const levelNameEl = document.getElementById('levelName');
            const currentPageEl = document.getElementById('currentPage');
            const totalPagesEl = document.getElementById('totalPages');
            const scoreEl = document.getElementById('score');
            const totalScoreEl = document.getElementById('totalScore');
            const progressBar = document.getElementById('progressBar');
            const progressPercentEl = document.getElementById('progressPercent');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const homeBtn = document.getElementById('homeBtn');
            const allPlacedEl = document.getElementById('allPlaced');
            const pageCompleteEl = document.getElementById('pageComplete');
            const pcText = document.getElementById('pcText');
            const pcScore = document.getElementById('pcScore');
            const pcNext = document.getElementById('pcNext');
            const levelCompleteEl = document.getElementById('levelComplete');
            const lcText = document.getElementById('lcText');
            const lcScore = document.getElementById('lcScore');
            const lcHome = document.getElementById('lcHome');
            const lcNext = document.getElementById('lcNext');

            // Helpers
            function getCategoriesForLevel(level) {
                if (level === 1) return { fruits: categories.fruits, vegetables: categories.vegetables };
                return { sweets: categories.sweets, meals: categories.meals };
            }

            function getCurrentLevelItems() {
                return allFoodItems.filter((it) => it.level === currentLevel && it.page === currentPage);
            }

            function isLevelUnlocked(level) {
                if (level === 1) return true;
                return completedLevels.includes(level - 1);
            }

            function playTone(freq, duration, when = 0, volume = 0.2) {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const o = ctx.createOscillator();
                    const g = ctx.createGain();
                    o.connect(g);
                    g.connect(ctx.destination);
                    o.frequency.setValueAtTime(freq, ctx.currentTime + when);
                    g.gain.setValueAtTime(volume, ctx.currentTime + when);
                    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + when + duration);
                    o.start(ctx.currentTime + when);
                    o.stop(ctx.currentTime + when + duration + 0.02);
                } catch (e) {
                    /* ignore */
                }
            }

            function playCorrectSound() {
                playTone(523.25, 0.3);
                playTone(659.25, 0.3, 0.1);
                playTone(783.99, 0.3, 0.2);
            }
            function playIncorrectSound() {
                playTone(220, 0.55);
                playTone(196, 0.4, 0.2);
            }
            function playCelebration() {
                [523.25, 659.25, 783.99, 1046.5].forEach((f, i) => playTone(f, 0.28, i * 0.18, 0.18));
            }

            // Render menu levels
            function renderMenu() {
                const container = document.getElementById('levelsContainer');
                container.innerHTML = '';
                Object.keys(levels).forEach((key) => {
                    const lvl = levels[key];
                    const div = document.createElement('div');
                    div.className = 'level-tile ' + (isLevelUnlocked(+key) ? '' : 'locked');
                    if (+key === 1) div.style.background = 'linear-gradient(180deg,#7c3aed,#a78bfa)';
                    if (+key === 2) div.style.background = 'linear-gradient(180deg,#d97706,#f59e0b)';
                    if (+key === 3) div.style.background = 'linear-gradient(180deg,#dc2626,#f97316)';
                    div.innerHTML = `<h3 style="margin:0 0 8px">${lvl.name}</h3>
          <div style="font-weight:700">${lvl.itemsPerPage} أطعمة في كل صفحة</div>
          <div class="muted" style="margin-top:6px">${lvl.totalPages} صفحات</div>`;
                    if (!isLevelUnlocked(+key)) {
                        const lock = document.createElement('div');
                        lock.className = 'locked-icon';
                        lock.textContent = '🔒';
                        lock.style.marginTop = '8px';
                        div.appendChild(lock);
                    }
                    const pagesBox = document.createElement('div');
                    pagesBox.style.marginTop = '10px';
                    [1, 2].forEach((p) => {
                        const btn = document.createElement('button');
                        btn.textContent = 'الصفحة ' + p;
                        btn.style.display = 'block';
                        btn.style.width = '100%';
                        btn.style.marginTop = '6px';
                        btn.onclick = () => {
                            if (isLevelUnlocked(+key)) {
                                startLevel(+key, p);
                            }
                        };
                        btn.disabled = !isLevelUnlocked(+key);
                        pagesBox.appendChild(btn);
                    });
                    div.appendChild(pagesBox);
                    container.appendChild(div);
                });
            }

            function startLevel(lvl, page = 1) {
                currentLevel = lvl;
                currentPage = page;
                score = 0;
                placedItems = {};
                draggedItem = null;
                levelComplete = false;
                gameStarted = true;
                menuEl.style.display = 'none';
                gameEl.style.display = 'block';
                document.getElementById('menu').scrollTop = 0;
                renderGame();
            }

            function resetToMenu() {
                gameStarted = false;
                menuEl.style.display = 'flex';
                gameEl.style.display = 'none';
                renderMenu();
            }

            function renderGame() {
                const lvl = levels[currentLevel];
                levelNameEl.textContent = lvl.name;
                currentPageEl.textContent = currentPage;
                totalPagesEl.textContent = lvl.totalPages;
                scoreEl.textContent = score;
                totalScoreEl.textContent = totalScore;
                renderItems();
                renderCategories();
                updateProgress();
            }

            function renderItems() {
                const items = getAvailableItems();
                itemsGrid.innerHTML = '';
                if (items.length === 0) {
                    allPlacedEl.style.display = 'block';
                } else {
                    allPlacedEl.style.display = 'none';
                }
                items.forEach((it) => {
                    const d = document.createElement('div');
                    d.className = 'item';
                    d.draggable = true;
                    d.dataset.id = it.id;
                    d.dataset.cat = it.category;
                    d.innerHTML = `<div class="emoji">${it.emoji}</div><div style="font-weight:700">${it.name}</div>`;
                    d.addEventListener('dragstart', (e) => {
                        draggedItem = it;
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/plain', it.id);
                    });
                    itemsGrid.appendChild(d);
                });
            }

            function renderCategories() {
                categoriesColumn.innerHTML = '';
                const cats = getCategoriesForLevel(currentLevel);
                Object.entries(cats).forEach(([key, cat]) => {
                    const box = document.createElement('div');
                    box.className = 'category-box ' + cat.cls;
                    box.addEventListener('dragover', (e) => e.preventDefault());
                    box.addEventListener('drop', (e) => {
                        e.preventDefault();
                        handleDrop(key);
                    });
                    box.innerHTML = `<div class="text-center"><div class="big-emoji">${cat.icon}</div><div class="title">${cat.name}</div><div style="opacity:.85;color:rgba(255,255,255,.95);font-size:12px">🔊 اسحب هنا</div></div>`;
                    const content = document.createElement('div');
                    content.className = 'category-content';
                    const placed = placedItems[key] || [];
                    placed.forEach((item, idx) => {
                        const p = document.createElement('div');
                        p.className = 'placed';
                        p.innerHTML = `<div style="font-size:20px">${item.emoji}</div><div style="font-weight:700">${item.name}</div>`;
                        content.appendChild(p);
                    });
                    box.appendChild(content);
                    if (!placed.length) {
                        const hint = document.createElement('div');
                        hint.style.textAlign = 'center';
                        hint.style.color = 'rgba(255,255,255,0.85)';
                        hint.style.padding = '10px 0';
                        hint.textContent = 'اسحب ' + cat.name + ' هنا';
                        box.appendChild(hint);
                    }
                    categoriesColumn.appendChild(box);
                });
            }

            function handleDrop(targetCategory) {
                if (!draggedItem) return;
                if (draggedItem.category === targetCategory) {
                    playCorrectSound();
                    if (!placedItems[targetCategory]) placedItems[targetCategory] = [];
                    placedItems[targetCategory].push(draggedItem);
                    score += 10;
                    scoreEl.textContent = score;
                    // check completion
                    const currentItems = getCurrentLevelItems();
                    const totalPlaced = Object.values(placedItems).reduce((s, arr) => s + arr.length, 0);
                    renderItems();
                    renderCategories();
                    updateProgress();
                    if (totalPlaced === currentItems.length) {
                        if (currentPage === levels[currentLevel].totalPages) {
                            setTimeout(() => completeLevel(), 900);
                        } else {
                            setTimeout(() => showPageComplete(), 900);
                        }
                    }
                } else {
                    playIncorrectSound();
                }
                draggedItem = null;
            }

            function getAvailableItems() {
                const placedIds = Object.values(placedItems)
                    .flat()
                    .map((i) => i.id);
                return getCurrentLevelItems().filter((it) => !placedIds.includes(it.id));
            }

            function updateProgress() {
                const currentItems = getCurrentLevelItems();
                const totalPlaced = Object.values(placedItems).reduce((s, arr) => s + arr.length, 0);
                const pct = currentItems.length ? Math.round((totalPlaced / currentItems.length) * 100) : 0;
                progressPercentEl.textContent = pct;
                progressBar.style.width = pct + '%';
            }

            function showPageComplete() {
                pcText.textContent = `أكملت الصفحة ${currentPage} من ${levels[currentLevel].name}`;
                pcScore.textContent = score;
                pageCompleteEl.style.display = 'flex';
                pageCompleteEl.style.alignItems = 'center';
            }

            pcNext.onclick = () => {
                pageCompleteEl.style.display = 'none';
                currentPage++;
                placedItems = {};
                score = 0;
                renderGame();
            };

            function completeLevel() {
                playCelebration();
                if (!completedLevels.includes(currentLevel)) completedLevels.push(currentLevel);
                totalScore += score;
                totalScoreEl.textContent = totalScore;
                levelComplete = true;
                lcText.textContent = `أكملت ${levels[currentLevel].name} بنجاح!`;
                lcScore.textContent = score;
                levelCompleteEl.style.display = 'flex';
                levelCompleteEl.style.alignItems = 'center';
                // prepare next level button
                if (currentLevel < 3 && isLevelUnlocked(currentLevel + 1)) {
                    lcNext.style.display = 'inline-block';
                    lcNext.onclick = () => {
                        levelCompleteEl.style.display = 'none';
                        startLevel(currentLevel + 1, 1);
                    };
                } else {
                    lcNext.style.display = 'none';
                }
            }

            lcHome.onclick = () => {
                levelCompleteEl.style.display = 'none';
                resetToMenu();
            };

            // Navigation
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    placedItems = {};
                    score = 0;
                    renderGame();
                }
            };
            nextBtn.onclick = () => {
                if (currentPage < levels[currentLevel].totalPages) {
                    currentPage++;
                    placedItems = {};
                    score = 0;
                    renderGame();
                }
            };
            homeBtn.onclick = () => resetToMenu();

            // initial render
            renderMenu();

            // optional: expose start for demo, allow clicking level tiles via functions in renderMenu
        </script>
    </body>
</html>
