<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØªØ´Ø®ÙŠØµÙŠ Ù„ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            :root {
                --primary: #1877f2;
                --primary-2: #42a5f5;
                --ok: #4caf50;
                --warn: #ff9800;
                --mid: #f44336;
                --high: #d32f2f;
                --bg: #f8f9fa;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
                min-height: 100vh;
                padding: 10px;
            }
            .container {
                max-width: 980px;
                margin: 0 auto;
                background: #fff;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
                overflow: hidden;
            }
            .page {
                display: none;
                padding: 30px;
                min-height: 520px;
            }
            .page.active {
                display: block;
            }
            .header {
                text-align: center;
                margin-bottom: 24px;
            }
            .main-title {
                color: var(--primary);
                font-size: 2.2rem;
                font-weight: 800;
                margin-bottom: 8px;
                text-shadow: 0 2px 4px rgba(24, 119, 242, 0.08);
            }
            @media (max-width: 768px) {
                .main-title {
                    font-size: 1.8rem;
                }
            }
            .subtitle {
                color: #666;
                font-size: 1.05rem;
            }
            .welcome-text {
                background: linear-gradient(135deg, var(--primary), var(--primary-2));
                color: #fff;
                padding: 22px;
                border-radius: 16px;
                line-height: 1.7;
                margin: 20px 0;
                box-shadow: 0 10px 25px rgba(24, 119, 242, 0.2);
            }
            .instructions {
                background: var(--bg);
                padding: 18px;
                border-radius: 12px;
                margin: 14px 0;
                border-right: 4px solid var(--primary);
            }
            .instructions h3 {
                color: var(--primary);
                margin-bottom: 10px;
                font-size: 1.12rem;
            }
            .rating-scale {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: #e3f2fd;
                padding: 10px;
                border-radius: 10px;
            }
            .rating-item {
                background: #fff;
                padding: 6px 12px;
                border-radius: 8px;
                border: 2px solid var(--primary);
                font-weight: 700;
                color: var(--primary);
                font-size: 0.9rem;
            }
            .form-group {
                margin-bottom: 12px;
            }
            .form-group label {
                display: block;
                margin-bottom: 6px;
                font-weight: 700;
                color: #333;
                font-size: 0.95rem;
            }
            .form-group input,
            .form-group select {
                width: 100%;
                padding: 10px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                font-size: 14px;
                transition: 0.2s border-color;
                font-family: inherit;
            }
            .form-group input:focus,
            .form-group select:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.1);
            }
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            @media (max-width: 768px) {
                .form-row {
                    grid-template-columns: 1fr;
                    gap: 0;
                }
            }
            .question {
                background: #fff;
                border: 2px solid #e0e0e0;
                border-radius: 12px;
                padding: 16px;
                margin: 12px 0;
                transition: 0.2s all;
            }
            .question:focus-within {
                border-color: var(--primary);
                box-shadow: 0 6px 18px rgba(24, 119, 242, 0.12);
            }
            .question-number {
                background: linear-gradient(135deg, var(--primary), var(--primary-2));
                color: #fff;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 800;
                margin-bottom: 10px;
            }
            .question-text {
                font-size: 1rem;
                color: #333;
                margin-bottom: 10px;
                line-height: 1.6;
                font-weight: 600;
            }
            .rating-buttons {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
                gap: 8px;
            }
            .rating-button {
                background: #fff;
                border: 2px solid #e0e0e0;
                padding: 8px 10px;
                border-radius: 22px;
                cursor: pointer;
                transition: 0.15s all;
                font-weight: 800;
                text-align: center;
                font-size: 0.9rem;
                user-select: none;
            }
            .rating-button:hover {
                border-color: var(--primary);
                background: #f0f8ff;
            }
            .rating-button.selected {
                background: linear-gradient(135deg, var(--primary), var(--primary-2));
                color: #fff;
                border-color: var(--primary);
                box-shadow: 0 3px 10px rgba(24, 119, 242, 0.3);
            }
            .nav-buttons {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                margin-top: 24px;
            }
            .btn {
                background: linear-gradient(135deg, var(--primary), var(--primary-2));
                color: #fff;
                border: none;
                padding: 12px 22px;
                border-radius: 20px;
                font-size: 1rem;
                font-weight: 800;
                cursor: pointer;
                transition: 0.15s all;
                box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
            }
            .btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 5px 15px rgba(24, 119, 242, 0.4);
            }
            .btn:disabled {
                background: #cfcfcf;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }
            .btn-secondary {
                background: #6c757d;
            }
            .btn-secondary:hover {
                background: #545b62;
            }
            .btn-ghost {
                background: #eef5ff;
                color: #0b57d0;
            }
            .progress-wrap {
                display: flex;
                gap: 10px;
                align-items: center;
                margin: 10px 0 18px 0;
            }
            .progress-bar {
                background: #e0e0e0;
                height: 8px;
                border-radius: 4px;
                flex: 1;
                overflow: hidden;
            }
            .progress-fill {
                background: linear-gradient(90deg, var(--primary), var(--primary-2));
                height: 100%;
                width: 0%;
                transition: width 0.4s ease;
            }
            .badge {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 6px 10px;
                border-radius: 999px;
                font-weight: 700;
                font-size: 0.85rem;
                background: #eef5ff;
                color: #0b57d0;
            }
            .result-card {
                background: linear-gradient(135deg, var(--primary), var(--primary-2));
                color: #fff;
                padding: 28px;
                border-radius: 15px;
                margin: 18px 0;
                text-align: center;
                box-shadow: 0 10px 25px rgba(24, 119, 242, 0.28);
            }
            .result-score {
                font-size: 2.8rem;
                font-weight: 900;
            }
            .result-category {
                font-size: 1.2rem;
                margin: 10px 0;
                padding: 10px;
                border-radius: 10px;
                font-weight: 900;
            }
            .result-details {
                background: #fff;
                padding: 18px;
                border-radius: 12px;
                margin: 16px 0;
                color: #333;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            }
            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #eee;
                align-items: center;
            }
            .detail-row:last-child {
                border-bottom: none;
            }
            .recommendations {
                background: #e8f5e8;
                padding: 18px;
                border-radius: 12px;
                border-right: 4px solid var(--ok);
            }
            .recommendations h3 {
                color: #2e7d32;
                margin-bottom: 10px;
                font-size: 1.12rem;
            }
            .recommendations ul {
                list-style: none;
            }
            .recommendations li {
                padding: 6px 0;
                position: relative;
                padding-right: 20px;
                line-height: 1.6;
            }
            .recommendations li:before {
                content: 'âœ“';
                color: var(--ok);
                font-weight: 900;
                position: absolute;
                right: 0;
            }
            .print-btn {
                background: linear-gradient(135deg, var(--ok), #66bb6a);
            }
            .error-message {
                background: #ffebee;
                color: #c62828;
                padding: 12px;
                border-radius: 8px;
                border-right: 4px solid #c62828;
                margin: 10px 0;
                display: none;
                font-weight: 700;
            }
            .student-info-summary {
                background: var(--bg);
                padding: 18px;
                border-radius: 12px;
                margin: 16px 0;
            }
            .info-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }
            .info-item {
                background: #fff;
                padding: 12px;
                border-radius: 8px;
                border-right: 3px solid var(--primary);
            }
            .info-label {
                font-weight: 900;
                color: var(--primary);
                font-size: 0.85rem;
                margin-bottom: 4px;
            }
            .info-value {
                color: #333;
                font-size: 0.95rem;
                font-weight: 700;
            }
            .tools {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin: 10px 0;
            }
            .tools .btn {
                padding: 8px 14px;
                border-radius: 12px;
                font-size: 0.9rem;
            }
            .muted {
                color: #666;
                font-size: 0.9rem;
            }
            @media print {
                body {
                    background: #fff;
                    padding: 0;
                }
                .container {
                    box-shadow: none;
                    border-radius: 0;
                }
                .nav-buttons,
                .tools {
                    display: none !important;
                }
                .page {
                    display: block !important;
                    page-break-after: always;
                }
                .page:last-child {
                    page-break-after: auto;
                }
                @page {
                    margin: 1cm;
                    size: A4;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
            <div class="page active" id="page1">
                <div class="header">
                    <h1 class="main-title">ğŸ¯ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„ØªØ´Ø®ÙŠØµÙŠ Ù„ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</h1>
                    <p class="subtitle">Ù†Ø¸Ø§Ù… ØªØ´Ø®ÙŠØµÙŠ ØªÙØ§Ø¹Ù„ÙŠ Ù„Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† Ø§Ù„Ù†ÙØ³ÙŠÙŠÙ† ÙˆØ§Ù„ØªØ±Ø¨ÙˆÙŠÙŠÙ†</p>
                </div>

                <div class="welcome-text">
                    <h3 style="margin-bottom: 12px">ğŸŒŸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØ´Ø®ÙŠØµÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h3>
                    <p>ÙŠÙ‡Ø¯Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø°ÙˆÙŠ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù… ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø®Ù„Ø§Ù„ ØªÙ‚ÙŠÙŠÙ… Ù…Ø¬Ù…ÙˆØ¹Ø© Ø´Ø§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© ÙˆØ§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©.</p>
                    <br />
                    <p><strong>Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong></p>
                    <ul style="margin-right: 16px; margin-top: 6px; line-height: 1.6">
                        <li>âœ… ØªØ´Ø®ÙŠØµ Ø¯Ù‚ÙŠÙ‚ ÙˆÙ…ÙˆØ«ÙˆÙ‚ Ø¹Ù„Ù…ÙŠØ§Ù‹</li>
                        <li>âœ… ØªÙ‚Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠ Ø´Ø§Ù…Ù„</li>
                        <li>âœ… ØªÙˆØµÙŠØ§Øª Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</li>
                        <li>âœ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØªÙ†Ø²ÙŠÙ„ JSON</li>
                    </ul>
                </div>

                <div class="tools">
                    <button class="btn" onclick="showPage(2)">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† ğŸš€</button>
                    <button class="btn-ghost btn" onclick="resumeIfFound()">Ø§Ø³ØªØ¦Ù†Ø§Ù Ø¢Ø®Ø± Ø¬Ù„Ø³Ø©</button>
                    <span class="badge" id="sessionBadge">â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©: <span id="sessionTime">00:00</span></span>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
            <div class="page" id="page2">
                <div class="header">
                    <h2 class="main-title">ğŸ“‹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h2>
                    <div class="muted">Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±: <span id="reportId"></span></div>
                </div>

                <div class="instructions">
                    <h3>ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù…Ù‚ÙŠØ§Ø³</h3>
                    <p>Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø°ÙˆÙŠ Ø§Ø¶Ø·Ø±Ø§Ø¨Ø§Øª Ø£Ùˆ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù… ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ ÙˆØ§Ù„Ø°ÙŠÙ† ÙŠØªÙˆØ§ØªØ± Ù„Ø¯ÙŠÙ‡Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³.</p>
                </div>

                <div class="instructions">
                    <h3>âš ï¸ Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ù‡Ù…Ø©</h3>
                    <ul style="margin-right: 18px; line-height: 1.6">
                        <li>Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¬ÙŠØ¯Ø© Ø¨Ø§Ù„Ø·ÙÙ„ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</li>
                        <li>ØªÙƒØ±Ø§Ø± Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ© Ù„Ø¯Ù‰ Ø§Ù„ØªÙ„Ù…ÙŠØ°</li>
                        <li>Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ„ ÙÙ‚Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</li>
                        <li>Ø¹Ø¯Ù… ØªÙ‚Ø¯ÙŠØ± Ø£ÙƒØ«Ø± Ù…Ù† 6 ØªÙ„Ø§Ù…ÙŠØ° ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©</li>
                    </ul>
                </div>

                <div class="instructions">
                    <h3>ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</h3>
                    <p>ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù‚ÙŠØ§Ø³ Ø®Ù…Ø§Ø³ÙŠ ÙƒØ§Ù„ØªØ§Ù„ÙŠ:</p>
                    <div class="rating-scale">
                        <div class="rating-item">Ø¯Ø§Ø¦Ù…Ø§Ù‹ (4)</div>
                        <div class="rating-item">ØºØ§Ù„Ø¨Ø§Ù‹ (3)</div>
                        <div class="rating-item">Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ (2)</div>
                        <div class="rating-item">Ù†Ø§Ø¯Ø±Ø§Ù‹ (1)</div>
                        <div class="rating-item">Ù„Ø§ ØªÙ†Ø·Ø¨Ù‚ (0)</div>
                    </div>
                </div>

                <div class="instructions">
                    <h3>ğŸ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>
                    <div style="background: #fff; padding: 10px; border-radius: 8px; margin-top: 8px">
                        <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee">
                            <span><strong>Ø£Ù‚Ù„ Ù…Ù† 20:</strong></span
                            ><span style="color: var(--ok); font-weight: 900">Ø¹Ø§Ø¯ÙŠ / Ù„Ø§ ØªÙˆØ¬Ø¯ ØµØ¹ÙˆØ¨Ø©</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee">
                            <span><strong>21 - 40:</strong></span
                            ><span style="color: var(--warn); font-weight: 900">ØµØ¹ÙˆØ¨Ø§Øª Ø®ÙÙŠÙØ©</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee">
                            <span><strong>41 - 60:</strong></span
                            ><span style="color: var(--mid); font-weight: 900">ØµØ¹ÙˆØ¨Ø§Øª Ù…ØªÙˆØ³Ø·Ø©</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 6px 0">
                            <span><strong>61 ÙØ£ÙƒØ«Ø±:</strong></span
                            ><span style="color: var(--high); font-weight: 900">ØµØ¹ÙˆØ¨Ø§Øª Ø´Ø¯ÙŠØ¯Ø©</span>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="showPage(1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                    <button class="btn" onclick="showPage(3)">Ø§Ù„ØªØ§Ù„ÙŠ - Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ°</button>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
            <div class="page" id="page3">
                <div class="header">
                    <h2 class="main-title">ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ° ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…</h2>
                </div>

                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <span class="badge">ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: <span id="answeredCount">0</span>/20</span>
                </div>

                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ° -->
                <div class="instructions" id="studentDataForm">
                    <h3>ğŸ‘¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù„ØªÙ„Ù…ÙŠØ°</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ° *</label>
                            <input type="text" id="studentName" autocomplete="name" required />
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø¬Ù†Ø³ *</label>
                            <select id="studentGender" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                                <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                                <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„ØµÙ *</label>
                            <input type="text" id="studentGrade" required />
                        </div>
                        <div class="form-group">
                            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ *</label>
                            <input type="date" id="studentBirthDate" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¯Ø±Ø³Ø© *</label>
                        <input type="text" id="studentSchool" required />
                    </div>

                    <h3 style="margin-top: 18px">ğŸ‘¨â€âš•ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠØ± *</label>
                            <input type="text" id="evaluatorName" required />
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ÙˆØ¸ÙŠÙØ© *</label>
                            <input type="text" id="evaluatorJob" required />
                        </div>
                    </div>

                    <div class="tools">
                        <button class="btn" onclick="startAssessment()" style="flex: 1">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ğŸ“Š</button>
                        <button class="btn-ghost btn" onclick="saveProgress()">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…</button>
                        <button class="btn-ghost btn" onclick="clearProgress()">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    </div>

                    <div class="error-message" id="formError">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
                </div>

                <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
                <div id="questionsContainer" style="display: none">
                    <h3 style="color: var(--primary); margin-bottom: 10px">ğŸ“‹ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (20 Ø³Ø¤Ø§Ù„)</h3>
                    <div id="questionsForm"></div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="showPage(2)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                    <button class="btn" onclick="calculateResults()" id="calculateBtn" style="display: none">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸ¯</button>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
            <div class="page" id="page4">
                <div class="header">
                    <h2 class="main-title">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ´Ø®ÙŠØµÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                </div>

                <div id="resultsContent"></div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="showPage(3)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                    <div class="tools">
                        <button class="btn print-btn" onclick="printReport()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± ğŸ–¨ï¸</button>
                        <button class="btn-ghost btn" onclick="downloadJSON()">ØªÙ†Ø²ÙŠÙ„ JSON</button>
                        <button class="btn-ghost btn" onclick="resetAll()">ØªÙ‚ÙŠÙŠÙ… Ø¬Ø¯ÙŠØ¯</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ====== Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø© ======
            let currentPage = 1;
            let answers = {};
            let studentData = {};
            let startTs = Date.now();
            let tickInterval = null;

            const LS_KEY = 'reading_scale_state_v1';

            // ====== Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ======
            const questions = [
                'ÙŠØ¨Ø¯Ùˆ Ø¹ØµØ¨ÙŠØ§Ù‹ â€“ Ù…ØªÙ…Ù„Ù…Ù„Ø§Ù‹ â€“ Ø¹Ø¨ÙˆØ³Ø§Ù‹ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ‚Ø±Ø£.',
                'ÙŠÙ‚Ø±Ø£ Ø¨ØµÙˆØª Ù…Ø±ØªÙØ¹ ÙˆØ­Ø§Ø¯ â€“ ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„Ø­Ø±ÙˆÙ.',
                'ÙŠÙ‚Ø§ÙˆÙ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ ÙŠØ¨ÙƒÙŠØŒ ÙŠØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª.',
                'ÙŠÙÙ‚Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ ÙˆÙŠØ¹ÙŠØ¯ Ù…Ø§ ÙŠÙ‚Ø±Ø£ Ø¨ØµÙˆØ±Ø© Ù…ØªÙƒØ±Ø±Ø©.',
                'ÙŠÙ†Ø·Ù‚ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…ØªÙ‚Ø·Ø¹Ø© Ù…ØªØ´Ù†Ø¬Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.',
                'ÙŠØ¨Ø¯Ùˆ Ù‚Ù„Ù‚Ø§Ù‹ Ù…Ø±ØªØ¨ÙƒØ§Ù‹ØŒ ÙŠÙ‚Ø±Ø¨ Ù…ÙˆØ§Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø¹ÙŠÙ†ÙŠÙ‡.',
                'ÙŠØ­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§ØªØŒ ÙŠÙ‚ÙØ² Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø¥Ù„Ù‰ Ø¢Ø®Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.',
                'ÙŠØ³ØªØ¨Ø¯Ù„ Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„Ù†Øµ.',
                'ÙŠØ¹ÙƒØ³/ ÙŠØ³ØªØ¨Ø¯Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª.',
                'ÙŠØ®Ø·Ø¦ ÙÙŠ Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø§Øª/ ÙŠØ¹Ø§Ù†ÙŠ Ù…Ù† Ø³ÙˆØ¡ Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±ÙˆÙ.',
                'ÙŠÙ‚Ø±Ø£ Ø¯ÙˆÙ† Ø£Ù† ÙŠØ¨Ø¯ÙŠ Ø£ÙŠ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„ÙÙ‡Ù… Ù„Ù…Ø§ ÙŠÙ‚Ø±Ø£.',
                'ÙŠÙ‚Ø±Ø£ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¨ØªØ±ØªÙŠØ¨ Ø®Ø§Ø·Ø¦.',
                'ÙŠØ¨Ø¯ÙŠ ØªØ±Ø¯Ø¯Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ³ØªØ·ÙŠØ¹ Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§.',
                'ÙŠØ¬Ø¯ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„Ù…Ù‚Ø§Ø·Ø¹ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª.',
                'ÙŠØ¬Ø¯ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø§Ù„Ø­Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ù„Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© ÙÙŠ Ø§Ù„Ù†Øµ.',
                'ÙŠÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø¶Ù…ÙˆÙ† Ù‚ØµØ© Ù‚ØµÙŠØ±Ø© Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§.',
                'ÙŠØ¹Ø¬Ø² Ø¹Ù† Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…Ø§ ÙŠÙ‚Ø±Ø£.',
                'ÙŠÙ‚Ø±Ø£ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…ØªÙ‚Ø·Ø¹Ø©: Ø­Ø±Ù Ø­Ø±ÙØŒ Ù…Ù‚Ø·Ø¹ Ù…Ù‚Ø·Ø¹ØŒ ÙƒÙ„Ù…Ø© ÙƒÙ„Ù…Ø©.',
                'ÙŠÙ‚Ø±Ø£ Ø¨ØµÙˆØª Ù…Ø±ØªÙØ¹ ÙˆØ­Ø§Ø¯ØŒ ÙˆÙ…ØªØ´Ù†Ø¬.',
                'ÙŠØ¬Ø¯ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ù‚Ø· ÙˆØ§Ù„ÙÙˆØ§ØµÙ„ ÙˆØ§Ù„ÙˆÙ‚Ù Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.'
            ];

            // ====== ØªÙ†Ù‚Ù‘Ù„ Ø§Ù„ØµÙØ­Ø§Øª ======
            function showPage(n) {
                document.querySelectorAll('.page').forEach((p) => p.classList.remove('active'));
                document.getElementById(`page${n}`).classList.add('active');
                currentPage = n;
                saveProgress(false);
            }

            // ====== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ù„Ù…Ø¹Ø±Ù‘Ù ======
            function genReportId() {
                const t = new Date();
                const rand = Math.random().toString(36).slice(2, 6).toUpperCase();
                return `RD-${t.getFullYear()}${String(t.getMonth() + 1).padStart(2, '0')}${String(t.getDate()).padStart(2, '0')}-${rand}`;
            }

            // ====== Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ======
            function startAssessment() {
                const fields = ['studentName', 'studentGender', 'studentGrade', 'studentBirthDate', 'studentSchool', 'evaluatorName', 'evaluatorJob'];
                let ok = true;
                for (const f of fields) {
                    const el = document.getElementById(f);
                    if (!el || !el.value.trim()) {
                        ok = false;
                        break;
                    }
                }
                if (!ok) {
                    document.getElementById('formError').style.display = 'block';
                    return;
                }

                studentData = {
                    name: document.getElementById('studentName').value.trim(),
                    gender: document.getElementById('studentGender').value,
                    grade: document.getElementById('studentGrade').value.trim(),
                    birthDate: document.getElementById('studentBirthDate').value,
                    school: document.getElementById('studentSchool').value.trim(),
                    evaluatorName: document.getElementById('evaluatorName').value.trim(),
                    evaluatorJob: document.getElementById('evaluatorJob').value.trim(),
                    evaluationDate: new Date().toLocaleDateString('ar-EG'),
                    reportId: document.getElementById('reportId').textContent || genReportId()
                };

                document.getElementById('formError').style.display = 'none';
                document.getElementById('studentDataForm').style.display = 'none';
                document.getElementById('questionsContainer').style.display = 'block';
                document.getElementById('calculateBtn').style.display = 'inline-block';

                generateQuestions();
                saveProgress();
            }

            // ====== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ======
            function generateQuestions() {
                const container = document.getElementById('questionsForm');
                container.innerHTML = '';
                questions.forEach((q, i) => {
                    const wrap = document.createElement('div');
                    wrap.className = 'question';
                    wrap.tabIndex = 0;
                    wrap.innerHTML = `
          <div class="question-number">${i + 1}</div>
          <div class="question-text">${q}</div>
          <div class="rating-buttons" role="radiogroup" aria-label="Ø§Ù„ØªÙ‚Ø¯ÙŠØ±">
            ${[4, 3, 2, 1, 0]
                .map(
                    (v) => `
              <button class="rating-button" role="radio" aria-checked="false"
                data-q="${i}" data-v="${v}" onclick="selectAnswer(${i},${v},this)">
                ${labelFor(v)}<span class="muted" style="display:block;font-weight:600">(${v})</span>
              </button>
            `
                )
                .join('')}
          </div>
        `;
                    container.appendChild(wrap);

                    // Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø­ÙÙˆØ¸Ø© ÙØ¹Ù‘Ù„ Ø§Ù„Ø²Ø±
                    if (answers[i] !== undefined) {
                        const btn = wrap.querySelector(`.rating-button[data-v="${answers[i]}"]`);
                        if (btn) btn.classList.add('selected');
                    }
                });
                updateProgress();
            }

            function labelFor(v) {
                return v === 4 ? 'Ø¯Ø§Ø¦Ù…Ø§Ù‹' : v === 3 ? 'ØºØ§Ù„Ø¨Ø§Ù‹' : v === 2 ? 'Ø£Ø­ÙŠØ§Ù†Ø§Ù‹' : v === 1 ? 'Ù†Ø§Ø¯Ø±Ø§Ù‹' : 'Ù„Ø§ ØªÙ†Ø·Ø¨Ù‚';
            }

            // ====== Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© ======
            function selectAnswer(qIndex, value, btn) {
                answers[qIndex] = value;

                const qDiv = btn.closest('.question');
                qDiv.querySelectorAll('.rating-button').forEach((b) => {
                    b.classList.remove('selected');
                    b.setAttribute('aria-checked', 'false');
                });
                btn.classList.add('selected');
                btn.setAttribute('aria-checked', 'true');

                updateProgress();
                saveProgress(false);
            }

            // ====== Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… ======
            function updateProgress() {
                const answered = Object.keys(answers).length;
                const pct = (answered / questions.length) * 100;
                document.getElementById('progressFill').style.width = pct + '%';
                document.getElementById('answeredCount').textContent = answered;
            }

            // ====== Ø§Ù„Ø­Ø³Ø§Ø¨ ======
            function calculateResults() {
                if (Object.keys(answers).length < questions.length) {
                    // ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù…ÙÙ‚ÙˆØ¯
                    const firstMissing = [...Array(questions.length).keys()].find((i) => answers[i] === undefined);
                    if (firstMissing !== undefined) {
                        const target = document.querySelector(`.question:nth-child(${firstMissing + 1})`);
                        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        target.classList.add('pulse');
                        setTimeout(() => target.classList.remove('pulse'), 1200);
                    }
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
                    return;
                }

                const total = Object.values(answers).reduce((s, v) => s + v, 0);
                const max = questions.length * 4;
                const percentage = Math.round((total / max) * 100);

                let category, color, recs;
                if (total < 20) {
                    category = 'Ø¹Ø§Ø¯ÙŠ / Ù„Ø§ ØªÙˆØ¬Ø¯ ØµØ¹ÙˆØ¨Ø©';
                    color = 'var(--ok)';
                    recs = ['Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', 'Ø£Ù†Ø´Ø·Ø© Ø¥Ø«Ø±Ø§Ø¦ÙŠØ© Ù„ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª', 'ØªØ´Ø¬ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø±Ø© ÙˆØ§Ù„Ù…Ù…ØªØ¹Ø©', 'ØªÙ‚ÙŠÙŠÙ… Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 3â€“6 Ø£Ø´Ù‡Ø±'];
                } else if (total <= 40) {
                    category = 'ØµØ¹ÙˆØ¨Ø§Øª Ø®ÙÙŠÙØ©';
                    color = 'var(--warn)';
                    recs = ['ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù„Ù‰ Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', 'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø³Ø·Ø© ÙˆØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ', 'ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ÙˆØ¬Ù‘ÙÙ‡Ø©', 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ù†ØªØ¸Ù… Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØµ', 'ØªØ¯Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ'];
                } else if (total <= 60) {
                    category = 'ØµØ¹ÙˆØ¨Ø§Øª Ù…ØªÙˆØ³Ø·Ø©';
                    color = 'var(--mid)';
                    recs = ['Ø®Ø·Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù…ÙƒØ«ÙØ© Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', 'Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¹ÙŠ Ø§Ù„ØµÙˆØªÙŠ ÙˆØªØ´ÙÙŠØ±/ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±', 'Ø¬Ù„Ø³Ø§Øª Ù…Ù†ØªØ¸Ù…Ø© Ù…Ø¹ Ø£Ø®ØµØ§Ø¦ÙŠ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…', 'Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ³Ø§Ø¦Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø¯Ø§Ø¹Ù…Ø©', 'Ø¥Ø´Ø±Ø§Ùƒ Ø§Ù„Ø£Ø³Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©'];
                } else {
                    category = 'ØµØ¹ÙˆØ¨Ø§Øª Ø´Ø¯ÙŠØ¯Ø©';
                    color = 'var(--high)';
                    recs = ['ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±ÙŠ Ù„Ø£Ø®ØµØ§Ø¦ÙŠ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…', 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¹Ù„Ø§Ø¬ÙŠ ÙØ±Ø¯ÙŠ Ù…ÙƒØ«Ù‘Ù', 'ØªÙ‚ÙŠÙŠÙ… Ù…Ø¹Ø±ÙÙŠ-Ù„ØºÙˆÙŠ Ø´Ø§Ù…Ù„', 'ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ù†Ù‡Ø¬ÙŠØ© Ø¬ÙˆÙ‡Ø±ÙŠØ© ÙˆØ¯Ø¹Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø­ÙˆØ§Ø³', 'Ù…ØªØ§Ø¨Ø¹Ø© Ù„ØµÙŠÙ‚Ø© ÙˆØªÙˆØ«ÙŠÙ‚ ØªÙ‚Ø¯Ù‘Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠ'];
                }

                generateResultsPage({ total, max, percentage, category, color, recs });
                saveProgress();
                showPage(4);
            }

            // ====== ØµÙØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ======
            function generateResultsPage({ total, max, percentage, category, color, recs }) {
                const dist = { 4: 0, 3: 0, 2: 0, 1: 0, 0: 0 };
                Object.values(answers).forEach((v) => dist[v]++);
                const resultsContent = document.getElementById('resultsContent');

                resultsContent.innerHTML = `
        <div class="student-info-summary">
          <h3 style="color:var(--primary); margin-bottom:10px">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ„Ù…ÙŠØ°</h3>
          <div class="info-grid">
            ${infoItem('Ø§Ø³Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ°', studentData.name)}
            ${infoItem('Ø§Ù„Ø¬Ù†Ø³', studentData.gender)}
            ${infoItem('Ø§Ù„ØµÙ', studentData.grade)}
            ${infoItem('ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯', new Date(studentData.birthDate).toLocaleDateString('ar-EG'))}
            ${infoItem('Ø§Ù„Ù…Ø¯Ø±Ø³Ø©', studentData.school)}
            ${infoItem('Ø§Ù„Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠØ±', studentData.evaluatorName)}
            ${infoItem('Ø§Ù„ÙˆØ¸ÙŠÙØ©', studentData.evaluatorJob)}
            ${infoItem('ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠØ±', studentData.evaluationDate)}
            ${infoItem('Ø±Ù‚Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ±', studentData.reportId)}
          </div>
        </div>

        <div class="result-card">
          <div class="result-score">${total}</div>
          <div style="opacity:.9">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ù…Ù† ${max}</div>
          <div class="result-category" style="background:${color}">${category}</div>
          <div>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©: <strong>${percentage}%</strong></div>
        </div>

        <div class="result-details">
          <h3 style="color:var(--primary); margin-bottom:10px">ğŸ“Š ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ</h3>
          ${row('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª', `<span style="color:${color}; font-weight:900">${total} Ù…Ù† ${max}</span>`)}
          ${row('Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ø±Ø¬Ø©', (total / questions.length).toFixed(2))}
          ${row('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©', `${questions.length} Ø³Ø¤Ø§Ù„`)}
          ${row('Ø§Ù„ØªØ´Ø®ÙŠØµ', `<span style="color:${color}; font-weight:900">${category}</span>`)}
        </div>

        <div class="result-details">
          <h3 style="color:var(--primary); margin-bottom:12px">ğŸ“‹ ØªØ­Ù„ÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h3>
          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:10px">
            ${distCard('Ø¯Ø§Ø¦Ù…Ø§Ù‹', dist[4], colorFor(4))}
            ${distCard('ØºØ§Ù„Ø¨Ø§Ù‹', dist[3], colorFor(3))}
            ${distCard('Ø£Ø­ÙŠØ§Ù†Ø§Ù‹', dist[2], colorFor(2))}
            ${distCard('Ù†Ø§Ø¯Ø±Ø§Ù‹', dist[1], colorFor(1))}
            ${distCard('Ù„Ø§ ØªÙ†Ø·Ø¨Ù‚', dist[0], colorFor(0))}
          </div>
        </div>

        <div class="recommendations">
          <h3>ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©</h3>
          <ul>${recs.map((r) => `<li>${r}</li>`).join('')}</ul>
        </div>

        <div class="instructions" style="margin-top:14px">
          <h3>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©</h3>
          <ul style="margin-right:18px; line-height:1.6">
            <li>Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø© ÙØ­Øµ Ø£ÙˆÙ„ÙŠØ© ÙˆÙ„ÙŠØ³ ØªØ´Ø®ÙŠØµØ§Ù‹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</li>
            <li>ÙŠÙÙˆØµÙ‰ Ø¨ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù…Ù† Ù‚Ø¨Ù„ Ù…Ø®ØªØµÙŠÙ†</li>
            <li>ÙŠØ¬Ø¨ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©/Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„Ù…Ø¤Ø«Ø±Ø©</li>
            <li>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ø¶Ø±ÙˆØ±ÙŠØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ­Ø³Ù†</li>
          </ul>
        </div>
      `;
            }

            function infoItem(label, value) {
                return `<div class="info-item"><div class="info-label">${label}</div><div class="info-value">${value || 'â€”'}</div></div>`;
            }
            function row(k, v) {
                return `<div class="detail-row"><strong>${k}</strong><span>${v}</span></div>`;
            }
            function colorFor(v) {
                return v === 4 ? 'var(--high)' : v === 3 ? 'var(--mid)' : v === 2 ? 'var(--warn)' : v === 1 ? 'var(--ok)' : 'var(--primary)';
            }
            function distCard(label, count, color) {
                const pct = Math.round((count / questions.length) * 100);
                return `<div style="background:${color}; color:#fff; padding:14px; border-radius:10px; text-align:center">
        <div style="font-weight:900; margin-bottom:4px">${label}</div>
        <div style="font-size:1.4rem; font-weight:900">${count}</div>
        <div style="opacity:.9">${pct}%</div>
      </div>`;
            }

            // ====== Ø·Ø¨Ø§Ø¹Ø© ÙˆØªÙ†Ø²ÙŠÙ„ ======
            function printReport() {
                window.print();
            }
            function downloadJSON() {
                const payload = {
                    reportId: studentData.reportId,
                    student: studentData,
                    answers,
                    questions,
                    computedAt: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `reading-report-${studentData.reportId}.json`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
            }

            // ====== Ø­ÙØ¸/Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… ======
            function saveProgress(showToast = true) {
                const state = {
                    currentPage,
                    answers,
                    studentData,
                    reportId: document.getElementById('reportId')?.textContent || '',
                    startTs
                };
                localStorage.setItem(LS_KEY, JSON.stringify(state));
                if (showToast) toast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… âœ…');
            }

            function resumeIfFound() {
                const raw = localStorage.getItem(LS_KEY);
                if (!raw) {
                    toast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©');
                    return;
                }
                const state = JSON.parse(raw);
                currentPage = state.currentPage || 1;
                answers = state.answers || {};
                studentData = state.studentData || {};
                startTs = state.startTs || Date.now();

                if (state.reportId) document.getElementById('reportId').textContent = state.reportId;

                if (currentPage === 3) {
                    document.getElementById('studentDataForm').style.display = Object.keys(studentData).length ? 'none' : 'block';
                    if (Object.keys(studentData).length) {
                        document.getElementById('questionsContainer').style.display = 'block';
                        document.getElementById('calculateBtn').style.display = 'inline-block';
                        generateQuestions();
                    }
                }
                if (currentPage === 4) {
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©
                    if (!studentData.reportId) studentData.reportId = state.reportId || genReportId();
                    const total = Object.values(answers).reduce((s, v) => s + v, 0);
                    const max = questions.length * 4;
                    const percentage = Math.round((total / max) * 100);
                    let category, color, recs;
                    if (total < 20) {
                        category = 'Ø¹Ø§Ø¯ÙŠ / Ù„Ø§ ØªÙˆØ¬Ø¯ ØµØ¹ÙˆØ¨Ø©';
                        color = 'var(--ok)';
                        recs = ['Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ', 'Ø£Ù†Ø´Ø·Ø© Ø¥Ø«Ø±Ø§Ø¦ÙŠØ©', 'Ù‚Ø±Ø§Ø¡Ø© Ø­Ø±Ø©', 'ØªÙ‚ÙŠÙŠÙ… Ø¯ÙˆØ±ÙŠ'];
                    } else if (total <= 40) {
                        category = 'ØµØ¹ÙˆØ¨Ø§Øª Ø®ÙÙŠÙØ©';
                        color = 'var(--warn)';
                        recs = ['ØªØ¯Ø±ÙŠØ¨Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©', 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…Ø¨Ø³Ø·Ø©', 'Ø·Ù„Ø§Ù‚Ø© Ù‚Ø±Ø§Ø¦ÙŠØ©', 'Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…'];
                    } else if (total <= 60) {
                        category = 'ØµØ¹ÙˆØ¨Ø§Øª Ù…ØªÙˆØ³Ø·Ø©';
                        color = 'var(--mid)';
                        recs = ['Ø®Ø·Ø© Ù…ÙƒØ«ÙØ©', 'ÙˆØ¹ÙŠ ØµÙˆØªÙŠ', 'Ø¬Ù„Ø³Ø§Øª Ù…Ø¹ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ', 'ÙˆØ³Ø§Ø¦Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©'];
                    } else {
                        category = 'ØµØ¹ÙˆØ¨Ø§Øª Ø´Ø¯ÙŠØ¯Ø©';
                        color = 'var(--high)';
                        recs = ['ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±ÙŠ', 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙØ±Ø¯ÙŠ', 'ØªÙ‚ÙŠÙŠÙ… Ø´Ø§Ù…Ù„', 'ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ù†Ù‡Ø¬ÙŠØ©'];
                    }
                    generateResultsPage({ total, max, percentage, category, color, recs });
                }

                showPage(currentPage);
                toast('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© âœ…');
            }

            function clearProgress() {
                localStorage.removeItem(LS_KEY);
                toast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }

            function resetAll() {
                answers = {};
                studentData = {};
                clearProgress();
                document.getElementById('studentDataForm').style.display = 'block';
                document.getElementById('questionsContainer').style.display = 'none';
                document.getElementById('calculateBtn').style.display = 'none';
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('answeredCount').textContent = '0';
                document.getElementById('reportId').textContent = genReportId();
                showPage(1);
            }

            // ====== Ø£Ø¯ÙˆØ§Øª ØµØºÙŠØ±Ø© ======
            function toast(msg) {
                // ØªÙ†Ø¨ÙŠÙ‡ Ø®ÙÙŠÙ
                console.log(msg);
            }

            // ====== ØªÙ‡ÙŠØ¦Ø© ======
            function init() {
                document.getElementById('reportId').textContent = genReportId();
                updateProgress();
                // Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø©
                tickInterval = setInterval(() => {
                    const sec = Math.floor((Date.now() - startTs) / 1000);
                    const mm = String(Math.floor(sec / 60)).padStart(2, '0');
                    const ss = String(sec % 60).padStart(2, '0');
                    const el = document.getElementById('sessionTime');
                    if (el) el.textContent = `${mm}:${ss}`;
                }, 1000);

                // Ø¯Ø¹Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± (Space/Enter)
                document.addEventListener('keydown', (e) => {
                    if (!(e.key === ' ' || e.key === 'Enter')) return;
                    const active = document.activeElement;
                    if (active && active.classList.contains('rating-button')) {
                        e.preventDefault();
                        const q = Number(active.dataset.q),
                            v = Number(active.dataset.v);
                        selectAnswer(q, v, active);
                    }
                });

                // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ùˆ ÙˆÙØ¬Ø¯
                const raw = localStorage.getItem(LS_KEY);
                if (raw) {
                    // Ù„Ø§ Ù†Ø³ØªØ±Ø¬Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­ØªÙ‰ ÙŠØ¶ØºØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø­ÙØ§Ø¸Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©)
                    // Ù„ÙƒÙ† Ù†ÙØ¸Ù‡Ø± Ø´Ø§Ø±Ø© ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
                }
            }

            // ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø±Ø¦ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
            const stylePulse = document.createElement('style');
            stylePulse.textContent = `.pulse{animation:pulse .9s ease-in-out 2}
      @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(24,119,242,.4)}70%{box-shadow:0 0 0 12px rgba(24,119,242,0)}100%{box-shadow:0 0 0 0 rgba(24,119,242,0)}}`;
            document.head.appendChild(stylePulse);

            document.addEventListener('DOMContentLoaded', init);
            window.addEventListener('beforeunload', () => saveProgress(false));
        </script>
    </body>
</html>
