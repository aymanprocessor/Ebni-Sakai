<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>مقياس التقدير التشخيصي لصعوبات الكتابة</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                direction: rtl;
            }

            .container {
                max-width: 900px;
                margin: 0 auto;
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                animation: fadeIn 1s ease-out;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .header {
                background: #1877f2;
                color: white;
                padding: 30px;
                text-align: center;
                position: relative;
                overflow: hidden;
            }

            .header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
                pointer-events: none;
            }

            .header h1 {
                font-size: 2.2rem;
                margin-bottom: 10px;
                font-weight: 700;
            }

            .header p {
                font-size: 1.1rem;
                opacity: 0.9;
            }

            .page {
                display: none;
                padding: 40px;
                min-height: 500px;
            }

            .page.active {
                display: block;
                animation: slideIn 0.5s ease-out;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(50px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            .form-group {
                margin-bottom: 25px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #333;
                font-size: 1.1rem;
            }

            .form-group input {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #e1e5e9;
                border-radius: 10px;
                font-size: 1rem;
                transition: all 0.3s ease;
            }

            .form-group input:focus {
                outline: none;
                border-color: #1877f2;
                box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            }

            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }

            .btn {
                padding: 12px 30px;
                border: none;
                border-radius: 25px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                margin: 10px;
            }

            .btn-primary {
                background: #1877f2;
                color: white;
            }

            .btn-primary:hover {
                background: #166fe5;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(24, 119, 242, 0.3);
            }

            .btn-secondary {
                background: #6c757d;
                color: white;
            }

            .btn-secondary:hover {
                background: #5a6268;
                transform: translateY(-2px);
            }

            .navigation {
                text-align: center;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 2px solid #f0f2f5;
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: #e9ecef;
                border-radius: 4px;
                margin-bottom: 30px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #1877f2, #42a5f5);
                border-radius: 4px;
                transition: width 0.5s ease;
                width: 0%;
            }

            .question-card {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                border-left: 5px solid #1877f2;
                transition: all 0.3s ease;
            }

            .question-card:hover {
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                transform: translateY(-2px);
            }

            .question-text {
                font-size: 1.1rem;
                font-weight: 600;
                margin-bottom: 15px;
                color: #333;
            }

            .rating-options {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .rating-option {
                position: relative;
            }

            .rating-option input[type='radio'] {
                display: none;
            }

            .rating-option label {
                display: block;
                padding: 10px 20px;
                background: #fff;
                border: 2px solid #e1e5e9;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 500;
                text-align: center;
                min-width: 80px;
            }

            .rating-option input:checked + label {
                background: #1877f2;
                color: white;
                border-color: #1877f2;
                transform: scale(1.05);
            }

            .rating-option label:hover {
                border-color: #1877f2;
                background: #f8f9ff;
            }

            .instructions {
                background: #e3f2fd;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 25px;
                border-right: 5px solid #2196f3;
            }

            .instructions h3 {
                color: #1976d2;
                margin-bottom: 15px;
                font-size: 1.3rem;
            }

            .instructions ul {
                list-style-position: inside;
                line-height: 1.8;
            }

            .instructions li {
                margin-bottom: 8px;
                color: #424242;
            }

            .result-section {
                margin-bottom: 30px;
            }

            .result-card {
                background: #fff;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .result-header {
                background: linear-gradient(135deg, #1877f2, #42a5f5);
                color: white;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
            }

            .score-display {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin: 20px 0;
            }

            .score-item {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                border: 2px solid transparent;
                transition: all 0.3s ease;
            }

            .score-item.severe {
                border-color: #dc3545;
                background: #fff5f5;
            }

            .score-item.moderate {
                border-color: #fd7e14;
                background: #fff8f0;
            }

            .score-item.mild {
                border-color: #ffc107;
                background: #fffbf0;
            }

            .score-item.normal {
                border-color: #28a745;
                background: #f0fff4;
            }

            .recommendations {
                background: #e8f5e8;
                border-radius: 15px;
                padding: 25px;
                margin-top: 20px;
                border-right: 5px solid #28a745;
            }

            .print-btn {
                background: #28a745;
                color: white;
                padding: 15px 30px;
                border: none;
                border-radius: 25px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                margin-top: 20px;
                transition: all 0.3s ease;
            }

            .print-btn:hover {
                background: #218838;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            }

            @media print {
                body {
                    background: white;
                }
                .container {
                    box-shadow: none;
                    border-radius: 0;
                }
                .btn,
                .navigation {
                    display: none;
                }
            }

            .welcome-section {
                text-align: center;
                padding: 40px 20px;
            }

            .welcome-icon {
                font-size: 4rem;
                color: #1877f2;
                margin-bottom: 20px;
            }

            .welcome-text {
                font-size: 1.2rem;
                line-height: 1.8;
                color: #555;
                margin-bottom: 30px;
            }

            .feature-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }

            .feature-card {
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
                text-align: center;
                transition: all 0.3s ease;
            }

            .feature-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }

            .feature-icon {
                font-size: 2.5rem;
                color: #1877f2;
                margin-bottom: 15px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>مقياس التقدير التشخيصي لصعوبات الكتابة</h1>
                <p>إعداد: الأستاذ الدكتور فتحي مصطفى الزيات</p>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <!-- الصفحة الأولى: الترحيب -->
            <div class="page active" id="page1">
                <div class="welcome-section">
                    <div class="welcome-icon">📝</div>
                    <h2 style="color: #1877f2; margin-bottom: 20px; font-size: 2rem">مرحباً بك في المقياس التشخيصي</h2>
                    <div class="welcome-text">
                        <p>هذا المقياس مصمم لمساعدة الأخصائيين في تشخيص صعوبات التعلم في الكتابة لدى الأطفال.</p>
                        <p>يتكون المقياس من عدة مراحل تساعدك في الوصول إلى تشخيص دقيق ومفصل.</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">🎯</div>
                            <h3 style="color: #333; margin-bottom: 10px">تشخيص دقيق</h3>
                            <p>نظام تقييم شامل مبني على أسس علمية</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📊</div>
                            <h3 style="color: #333; margin-bottom: 10px">تقرير مفصل</h3>
                            <p>تقرير شامل قابل للطباعة مع التوصيات</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">⏱️</div>
                            <h3 style="color: #333; margin-bottom: 10px">سهل الاستخدام</h3>
                            <p>واجهة بديهية توفر الوقت والجهد</p>
                        </div>
                    </div>

                    <h3 style="color: #1877f2; margin: 30px 0 20px 0">معلومات الطفل</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="studentName">اسم الطفل:</label>
                            <input type="text" id="studentName" required />
                        </div>
                        <div class="form-group">
                            <label for="studentAge">العمر:</label>
                            <input type="number" id="studentAge" min="5" max="18" required />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="studentGrade">الصف الدراسي:</label>
                            <input type="text" id="studentGrade" required />
                        </div>
                        <div class="form-group">
                            <label for="studentSchool">المدرسة:</label>
                            <input type="text" id="studentSchool" required />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="evaluatorName">اسم الأخصائي:</label>
                            <input type="text" id="evaluatorName" required />
                        </div>
                        <div class="form-group">
                            <label for="evaluationDate">تاريخ التقييم:</label>
                            <input type="date" id="evaluationDate" required />
                        </div>
                    </div>
                </div>
            </div>

            <!-- الصفحة الثانية: التعليمات -->
            <div class="page" id="page2">
                <h2 style="color: #1877f2; margin-bottom: 30px; text-align: center">التعليمات وطريقة الاستخدام</h2>

                <div class="instructions">
                    <h3>🎯 هدف المقياس</h3>
                    <p>يهدف هذا المقياس إلى الكشف عن التلاميذ ذوي اضطرابات أو صعوبات التعلم في الكتابة من خلال تقييم الخصائص السلوكية المتعلقة بهذه الصعوبات.</p>
                </div>

                <div class="instructions">
                    <h3>📋 طريقة التقدير</h3>
                    <ul>
                        <li><strong>دائماً (4 نقاط):</strong> إذا كانت الخاصية تظهر لدى الطفل بشكل دائم</li>
                        <li><strong>غالباً (3 نقاط):</strong> إذا كانت الخاصية تظهر لدى الطفل في معظم الأوقات</li>
                        <li><strong>أحياناً (2 نقطة):</strong> إذا كانت الخاصية تظهر لدى الطفل أحياناً</li>
                        <li><strong>نادراً (1 نقطة):</strong> إذا كانت الخاصية تظهر لدى الطفل نادراً</li>
                        <li><strong>لا تنطبق (0 نقاط):</strong> إذا كانت الخاصية لا تنطبق على الطفل إطلاقاً</li>
                    </ul>
                </div>

                <div class="instructions">
                    <h3>⚠️ تعليمات مهمة</h3>
                    <ul>
                        <li>اقرأ كل فقرة بعناية قبل إعطاء التقدير</li>
                        <li>اعتمد على ملاحظاتك المتكررة للطفل</li>
                        <li>كن موضوعياً في التقدير</li>
                        <li>لا تترك أي سؤال بدون إجابة</li>
                        <li>استغرق الوقت الكافي للتفكير في كل إجابة</li>
                    </ul>
                </div>

                <div class="instructions">
                    <h3>📊 نظام التشخيص</h3>
                    <ul>
                        <li><strong>عادي (0-20 نقطة):</strong> لا توجد صعوبات تذكر</li>
                        <li><strong>صعوبة خفيفة (21-40 نقطة):</strong> تحتاج متابعة بسيطة</li>
                        <li><strong>صعوبة متوسطة (41-60 نقطة):</strong> تحتاج تدخل متخصص</li>
                        <li><strong>صعوبة شديدة (61+ نقطة):</strong> تحتاج تدخل عاجل ومكثف</li>
                    </ul>
                </div>

                <div class="instructions">
                    <h3>⏰ الوقت المطلوب</h3>
                    <p>يستغرق تطبيق المقياس حوالي 15-20 دقيقة. يُنصح بعدم تقييم أكثر من 6 تلاميذ في الجلسة الواحدة لضمان دقة التقدير.</p>
                </div>
            </div>

            <!-- الصفحة الثالثة: الأسئلة -->
            <div class="page" id="page3">
                <h2 style="color: #1877f2; margin-bottom: 30px; text-align: center">أسئلة المقياس</h2>
                <p style="text-align: center; color: #666; margin-bottom: 30px">يرجى تقدير مدى انطباق كل خاصية على الطفل موضوع التقييم</p>

                <div id="questionsContainer">
                    <!-- الأسئلة ستُضاف هنا بواسطة JavaScript -->
                </div>
            </div>

            <!-- الصفحة الرابعة: النتائج -->
            <div class="page" id="page4">
                <h2 style="color: #1877f2; margin-bottom: 30px; text-align: center">تقرير التشخيص</h2>
                <div id="resultsContainer">
                    <!-- النتائج ستُضاف هنا بواسطة JavaScript -->
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousPage()" style="display: none">السابق</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextPage()">التالي</button>
            </div>
        </div>

        <script>
            let currentPage = 1;
            const totalPages = 4;
            let answers = {};

            const questions = [
                'يجد صعوبة في نسخ الفقرات والواجبات والأعمال الكتابية',
                'يجد صعوبة في التعبير الكتابي عما يريد',
                'يجد صعوبة أن يميز اللام الشمسية، واللام القمرية، وبين الحروف الكبيرة والصغيرة في اللغة الإنجليزية',
                'يجد صعوبة في الكتابة على سطور الكراسات العادية للكتابة',
                'يجد صعوبة في نسخ بعض الحروف والأشكال على نحو صحيح',
                'يجد صعوبة في كتابة أدوات الوصل الملائمة للحروف والكلمات',
                'يجد صعوبة في كتابة الحروف الهجائية من الذاكرة مكوناً كلمات',
                'يجد صعوبة في الكتابة المتصلة مكوناً كلمات وجمل منضبطة',
                'يجد صعوبة في تنسيق واجباته اليومية المكتوبة',
                'يجد صعوبة في الكتابة بالقلم الحبر والقلم الجاف',
                'يجد صعوبة أن يكتب بطلاقة ومرونة ونعومة',
                'يجد صعوبة أن يحتفظ بأدوات الكتابة والرسم والألوان',
                'يجد صعوبة في عمل الرسوم، والخرائط، والعناوين المكتوبة',
                'يجد صعوبة في كتابة الحروف والأرقام بشكل مقبول ومنظم',
                'يجد صعوبة في الالتزام بالحيز المخصص للكتابة',
                'يجد صعوبة في الكتابة بشكل سلس وناعم',
                'يجد صعوبة في الكتابة وفقاً لقواعد الخط والكتابة اليدوية',
                'يجد صعوبة في المحافظة على حجم الكتابة وتنسيقها',
                'يجد صعوبة في تنظيم مسافات الحروف والكلمات والجمل',
                'كتاباته مفككة وركيكة، مع ضعف القدرة على التعبير'
            ];

            const ratingLabels = {
                4: 'دائماً',
                3: 'غالباً',
                2: 'أحياناً',
                1: 'نادراً',
                0: 'لا تنطبق'
            };

            function updateProgressBar() {
                const progress = (currentPage / totalPages) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
            }

            function validatePersonalInfo() {
                const requiredFields = ['studentName', 'studentAge', 'studentGrade', 'studentSchool', 'evaluatorName', 'evaluationDate'];
                for (let field of requiredFields) {
                    if (!document.getElementById(field).value.trim()) {
                        alert('يرجى ملء جميع الحقول المطلوبة');
                        return false;
                    }
                }
                return true;
            }

            function createQuestions() {
                const container = document.getElementById('questionsContainer');
                container.innerHTML = '';

                questions.forEach((question, index) => {
                    const questionCard = document.createElement('div');
                    questionCard.className = 'question-card';

                    questionCard.innerHTML = `
                    <div class="question-text">${index + 1}. ${question}</div>
                    <div class="rating-options">
                        ${Object.entries(ratingLabels)
                            .map(
                                ([value, label]) => `
                            <div class="rating-option">
                                <input type="radio" id="q${index}_${value}" name="question_${index}" value="${value}">
                                <label for="q${index}_${value}">${label}</label>
                            </div>
                        `
                            )
                            .join('')}
                    </div>
                `;

                    container.appendChild(questionCard);
                });
            }

            function validateQuestions() {
                for (let i = 0; i < questions.length; i++) {
                    const questionInputs = document.querySelectorAll(`input[name="question_${i}"]`);
                    let answered = false;
                    for (let input of questionInputs) {
                        if (input.checked) {
                            answered = true;
                            answers[i] = parseInt(input.value);
                            break;
                        }
                    }
                    if (!answered) {
                        alert(`يرجى الإجابة على السؤال رقم ${i + 1}`);
                        return false;
                    }
                }
                return true;
            }

            function calculateResults() {
                const totalScore = Object.values(answers).reduce((sum, score) => sum + score, 0);

                let severity = '';
                let severityClass = '';
                let diagnosis = '';

                if (totalScore <= 20) {
                    severity = 'عادي - لا توجد صعوبة';
                    severityClass = 'normal';
                    diagnosis = 'احتمال ألا تكون لدى التلميذ صعوبة في الكتابة';
                } else if (totalScore <= 40) {
                    severity = 'صعوبة خفيفة';
                    severityClass = 'mild';
                    diagnosis = 'احتمال أن تكون لدى التلميذ صعوبة خفيفة في الكتابة';
                } else if (totalScore <= 60) {
                    severity = 'صعوبة متوسطة';
                    severityClass = 'moderate';
                    diagnosis = 'احتمال أن تكون لدى التلميذ صعوبة متوسطة في الكتابة';
                } else {
                    severity = 'صعوبة شديدة';
                    severityClass = 'severe';
                    diagnosis = 'احتمال أن تكون لدى التلميذ صعوبة شديدة في الكتابة';
                }

                const percentile = Math.round((totalScore / 80) * 100);

                return {
                    totalScore,
                    severity,
                    severityClass,
                    diagnosis,
                    percentile
                };
            }

            function getRecommendations(severity) {
                const recommendations = {
                    'عادي - لا توجد صعوبة': ['متابعة التطور الطبيعي للمهارات الكتابية', 'توفير أنشطة إثرائية لتطوير الكتابة الإبداعية', 'تشجيع القراءة لتحسين الكتابة'],
                    'صعوبة خفيفة': ['توفير تدريبات إضافية على الكتابة اليدوية', 'استخدام أوراق مسطرة لتحسين تنظيم الكتابة', 'متابعة دورية مع معلم الصف', 'تشجيع الطفل وتعزيز ثقته بنفسه'],
                    'صعوبة متوسطة': ['إحالة للأخصائي النفسي التربوي', 'وضع خطة تعليمية فردية', 'تدريب مكثف على مهارات الكتابة الأساسية', 'استخدام تقنيات مساعدة للكتابة', 'متابعة أسبوعية للتقدم'],
                    'صعوبة شديدة': [
                        'إحالة عاجلة للفريق متعدد التخصصات',
                        'تقييم شامل للقدرات المعرفية',
                        'برنامج تدخل مكثف ومتخصص',
                        'تعديل البيئة التعليمية لتناسب احتياجات الطفل',
                        'تدريب الأسرة على كيفية المساعدة في المنزل',
                        'متابعة يومية ومراجعة دورية للخطة العلاجية'
                    ]
                };
                return recommendations[severity] || [];
            }

            function generateReport() {
                const results = calculateResults();
                const studentInfo = {
                    name: document.getElementById('studentName').value,
                    age: document.getElementById('studentAge').value,
                    grade: document.getElementById('studentGrade').value,
                    school: document.getElementById('studentSchool').value,
                    evaluator: document.getElementById('evaluatorName').value,
                    date: document.getElementById('evaluationDate').value
                };

                const recommendations = getRecommendations(results.severity);
                const today = new Date().toLocaleDateString('ar-SA');

                const reportHTML = `
                <div class="result-header">
                    <h3 style="margin: 0; font-size: 1.5rem;">📋 تقرير التشخيص النهائي</h3>
                    <p style="margin: 10px 0 0 0; opacity: 0.9;">تاريخ إعداد التقرير: ${today}</p>
                </div>

                <div class="result-section">
                    <div class="result-card">
                        <h4 style="color: #1877f2; margin-bottom: 15px; font-size: 1.3rem;">👤 بيانات الطفل</h4>
                        <div class="score-display">
                            <div class="score-item">
                                <strong>الاسم:</strong> ${studentInfo.name}
                            </div>
                            <div class="score-item">
                                <strong>العمر:</strong> ${studentInfo.age} سنة
                            </div>
                            <div class="score-item">
                                <strong>الصف:</strong> ${studentInfo.grade}
                            </div>
                            <div class="score-item">
                                <strong>المدرسة:</strong> ${studentInfo.school}
                            </div>
                            <div class="score-item">
                                <strong>الأخصائي:</strong> ${studentInfo.evaluator}
                            </div>
                            <div class="score-item">
                                <strong>تاريخ التقييم:</strong> ${new Date(studentInfo.date).toLocaleDateString('ar-SA')}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <div class="result-card">
                        <h4 style="color: #1877f2; margin-bottom: 15px; font-size: 1.3rem;">📊 نتائج التقييم</h4>
                        <div class="score-display">
                            <div class="score-item ${results.severityClass}">
                                <h5 style="margin: 0 0 10px 0;">الدرجة الخام</h5>
                                <div style="font-size: 2rem; font-weight: bold; color: #1877f2;">${results.totalScore}</div>
                                <div style="color: #666;">من أصل 80</div>
                            </div>
                            <div class="score-item ${results.severityClass}">
                                <h5 style="margin: 0 0 10px 0;">النسبة المئوية</h5>
                                <div style="font-size: 2rem; font-weight: bold; color: #1877f2;">${results.percentile}%</div>
                                <div style="color: #666;">من إجمالي الدرجات</div>
                            </div>
                            <div class="score-item ${results.severityClass}">
                                <h5 style="margin: 0 0 10px 0;">مستوى الصعوبة</h5>
                                <div style="font-size: 1.2rem; font-weight: bold; color: #1877f2;">${results.severity}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <div class="result-card">
                        <h4 style="color: #1877f2; margin-bottom: 15px; font-size: 1.3rem;">🔍 التشخيص التفصيلي</h4>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-right: 4px solid #1877f2;">
                            <p style="font-size: 1.1rem; line-height: 1.6; margin: 0; color: #333;">
                                <strong>${results.diagnosis}</strong>
                            </p>
                            <br>
                            <p style="color: #666; line-height: 1.6; margin: 0;">
                                هذا التشخيص يقوم على أساس أن درجة التلميذ في مقياس التقدير التشخيصي لصعوبات الكتابة بلغت ${results.totalScore} نقطة.
                                ${
                                    results.totalScore <= 20
                                        ? 'جميع درجات التلميذ في المقياس تقل عن الدرجة الحدية (20).'
                                        : results.totalScore <= 40
                                          ? 'الدرجة تقع في النطاق الخفيف (21-40).'
                                          : results.totalScore <= 60
                                            ? 'الدرجة تقع في النطاق المتوسط (41-60).'
                                            : 'الدرجة تقع في النطاق الشديد (61 فأكثر).'
                                }
                            </p>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <div class="result-card">
                        <h4 style="color: #1877f2; margin-bottom: 15px; font-size: 1.3rem;">📈 تحليل مفصل للإجابات</h4>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 8px;">
                            ${questions
                                .map((question, index) => {
                                    const score = answers[index];
                                    const label = ratingLabels[score];
                                    const colorClass = score >= 3 ? 'severe' : score >= 2 ? 'moderate' : score >= 1 ? 'mild' : 'normal';
                                    return `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid #f0f2f5;">
                                        <span style="flex: 1; font-size: 0.9rem;">${index + 1}. ${question}</span>
                                        <span class="score-item ${colorClass}" style="margin: 0; padding: 5px 10px; min-width: 80px; font-size: 0.8rem;">
                                            ${label} (${score})
                                        </span>
                                    </div>
                                `;
                                })
                                .join('')}
                        </div>
                    </div>
                </div>

                <div class="recommendations">
                    <h4 style="color: #28a745; margin-bottom: 15px; font-size: 1.3rem;">💡 التوصيات والخطوات التالية</h4>
                    <ul style="line-height: 1.8; padding-right: 20px;">
                        ${recommendations.map((rec) => `<li style="margin-bottom: 8px;">${rec}</li>`).join('')}
                    </ul>
                    ${
                        results.totalScore > 40
                            ? `
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-top: 20px;">
                            <strong style="color: #856404;">⚠️ ملاحظة مهمة:</strong>
                            <p style="margin: 10px 0 0 0; color: #856404;">
                                نظراً لأن الطفل يظهر صعوبات ${results.severity === 'صعوبة متوسطة' ? 'متوسطة' : 'شديدة'} في الكتابة،
                                يُنصح بشدة بالتدخل المتخصص والمتابعة الدورية مع فريق من الأخصائيين.
                            </p>
                        </div>
                    `
                            : ''
                    }
                </div>

                <div style="text-align: center; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.6; margin: 0;">
                        <strong>إخلاء مسؤولية:</strong> هذا التقرير أداة مساعدة في التشخيص ولا يغني عن التقييم الشامل من قبل متخصصين مؤهلين.
                        يُنصح بمراجعة أخصائي صعوبات التعلم للحصول على تشخيص نهائي ووضع خطة علاجية مناسبة.
                    </p>
                </div>

                <button class="print-btn" onclick="window.print()">🖨️ طباعة التقرير</button>
            `;

                document.getElementById('resultsContainer').innerHTML = reportHTML;
            }

            function nextPage() {
                if (currentPage === 1) {
                    if (!validatePersonalInfo()) return;
                } else if (currentPage === 2) {
                    createQuestions();
                } else if (currentPage === 3) {
                    if (!validateQuestions()) return;
                    generateReport();
                }

                if (currentPage < totalPages) {
                    document.getElementById(`page${currentPage}`).classList.remove('active');
                    currentPage++;
                    document.getElementById(`page${currentPage}`).classList.add('active');
                    updateProgressBar();
                    updateNavigationButtons();
                }
            }

            function previousPage() {
                if (currentPage > 1) {
                    document.getElementById(`page${currentPage}`).classList.remove('active');
                    currentPage--;
                    document.getElementById(`page${currentPage}`).classList.add('active');
                    updateProgressBar();
                    updateNavigationButtons();
                }
            }

            function updateNavigationButtons() {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');

                prevBtn.style.display = currentPage === 1 ? 'none' : 'inline-block';

                if (currentPage === totalPages) {
                    nextBtn.style.display = 'none';
                } else {
                    nextBtn.style.display = 'inline-block';
                    nextBtn.textContent = currentPage === totalPages - 1 ? 'عرض النتائج' : 'التالي';
                }
            }

            // تهيئة المقياس عند تحميل الصفحة
            document.addEventListener('DOMContentLoaded', function () {
                updateProgressBar();
                updateNavigationButtons();

                // تعيين التاريخ الحالي
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('evaluationDate').value = today;
            });

            // إضافة تأثيرات تفاعلية للأزرار
            document.addEventListener('click', function (e) {
                if (e.target.matches('input[type="radio"]')) {
                    const questionCard = e.target.closest('.question-card');
                    questionCard.style.transform = 'scale(1.02)';
                    setTimeout(() => {
                        questionCard.style.transform = 'scale(1)';
                    }, 150);
                }
            });
        </script>
    </body>
</html>
